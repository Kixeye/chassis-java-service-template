(function () {if (KXL && KXL.i18n && KXL.i18n.addLocales) {KXL.i18n.addLocales({"sidebar.notifications.title":"notifications","sidebar.chat.title":"chat","sidebar.search.title":"search"});}}());

(function () {var head = document.getElementsByTagName("head")[0];var style = document.createElement("style");style.type = "text/css";style.innerHTML = ".kx-sidebar{position:relative;height:100%;width:339px}.kx-sidebar .kx-sidebar-content-region{height:100%;background-color:#131313}.kx-sidebar .kx-sidebar-content-region .kx-sidebar-panel-layout{overflow-y:auto;overflow-x:hidden;position:relative}.kx-sidebar .kx-sidebar-content-region .kx-sidebar-panel-layout .kx-heading{height:41px;line-height:41px;background-color:#252525;border-bottom:1px solid #424242;text-align:center}.kx-sidebar .kx-sidebar-content-region .kx-sidebar-panel-layout .kx-heading .kx-sidebar-close-btn{position:absolute;right:4px;top:10px;width:21px;height:21px;border:none;background-color:transparent;background-image:url(/modules/sidebar/images/../../common/images/sidebar-close-button-sprite.png);background-position:0 -100%;cursor:pointer}.kx-sidebar .kx-sidebar-content-region .kx-sidebar-panel-layout .kx-heading .kx-sidebar-close-btn:hover{background-position:0 0}.kx-sidebar .kx-sidebar-content-region .kx-sidebar-panel-layout .kx-heading .kx-heading-title{display:inline-block}.kx-sidebar .kx-sidebar-content-region .kx-sidebar-panel-layout .kx-heading .kx-heading-title span{width:200px;height:41px;display:block;line-height:41px;padding-left:7px;vertical-align:middle;font-weight:700;font-size:14px;color:#FFF;font-family:myriad-pro,verdana,helvetica,sans-serif;text-transform:uppercase;text-shadow:#000 0 -1px 0}.kx-sidebar .kx-sidebar-content-region .kx-sidebar-panel-layout .kx-heading .kx-heading-cta-region .kx-settings-button{position:absolute;right:31px;top:9px;width:24px;height:23px;border:none;background:url(/modules/sidebar/images/../../common/images/sidebar-settings-cog-sprite.png) 0 -100%;cursor:pointer}.kx-sidebar .kx-sidebar-content-region .kx-sidebar-panel-layout .kx-heading .kx-heading-cta-region .kx-settings-button:hover{background-position:0 0}.kx-sidebar .kx-sidebar-content-region .kx-sidebar-panel-layout .kx-heading .kx-heading-cta-region .kx-sidebar-cta-button{position:absolute;right:37px;top:8px;height:19px}.kx-sidebar .kx-sidebar-content-region .kx-sidebar-panel-layout .kx-heading .kx-heading-cta-region .kx-breadcrumb-back-button{position:absolute;left:8px;top:12px;width:12px;height:18px;border:none;background:url(/modules/sidebar/images/../../common/images/back-button-sprite.png) 0 -100%;cursor:pointer}.kx-sidebar .kx-sidebar-content-region .kx-sidebar-panel-layout .kx-heading .kx-heading-cta-region .kx-breadcrumb-back-button:hover{background-position:0 0}.kx-sidebar .kx-sidebar-content-region .kx-ribbon-region{position:relative;max-height:400px;overflow-y:auto;background-color:#252525;-webkit-box-shadow:rgba(0,0,0,.6) 0 3px 5px inset;-moz-box-shadow:rgba(0,0,0,.6) 0 3px 5px inset;box-shadow:rgba(0,0,0,.6) 0 3px 5px inset}.kx-sidebar .kx-sidebar-content-region .kx-content-region{overflow-x:hidden;background-color:#0e0e0e}.kx-sidebar .kx-sidebar-content-region .kx-sidebar-footer-region{display:none}.kx-sidebar .kx-sidebar-content-region .kx-sidebar-footer-region.visible{display:block;position:absolute;height:41px;right:0;bottom:0;left:0;text-align:right;background-color:#2d2d2d}";head.appendChild(style);}());

(function () {this.Templates=this.Templates||{},this.Templates["sidebar/sidebar-panel-layout"]=Handlebars.template(function(i,e,s,n,a){return this.compilerInfo=[4,">= 1.0.0"],s=this.merge(s,i.helpers),a=a||{},'<div class="kx-heading">\n<div class="kx-heading-cta-region"></div>\n<button class="kx-sidebar-close-btn"></button>\n</div>\n<div class="kx-ribbon-region"></div>\n<div class="kx-content-region"></div>\n<div class="kx-sidebar-footer-region"></div>\n<div class="kx-veil-region"></div>\n'});}());

/* kxl-deployment-tools 2016-05-18 */

KXL.module("Sidebar.Views",function(a,b,c,d,e,f){a.SidebarLayout=b.Components.Layout.extend({initialize:function(){this.debouncedSizeAdjust=f.debounce(this.sizeAdjust.bind(this),5)},template:function(){return""},className:"kx-sidebar",onRender:function(){e(window).on("resize",this.sizeAdjust.bind(this))},onClose:function(){e(window).off("resize",this.sizeAdjust.bind(this))},sizeAdjust:function(){var a=this.regions,b=this;if(a){var c=f.keys(a);f.each(c,function(c){a[c].currentView&&a[c].currentView.trigger("container:size:adjust",b.$el.outerHeight(!0))})}}}),a.SidebarPanelLayout=b.Components.Layout.extend({template:Templates["sidebar/sidebar-panel-layout"],className:"kx-sidebar-panel-layout",regions:{ribbonRegion:".kx-ribbon-region",contentRegion:".kx-content-region",headerCTARegion:".kx-heading-cta-region",footerCTARegion:".kx-sidebar-footer-region"},ui:{header:".kx-heading"},triggers:{"click .kx-sidebar-close-btn":"sidebar:close"},currentId:null,onRender:function(){var a=this;this.currentId=this.options.contentId,this.on("container:size:adjust",function(b){a.containerHeight=b,a.sizeAdjust(b)})},onSidebarClose:function(){if(this.currentId){"chat"===this.currentId&&b.execute("chat:toggle");var a=b.request("sidebar:get:content",this.currentId);a&&a.$el.is(":visible")&&b.request("sidebar:hide:content",this.currentId)}},sizeAdjust:function(a){var b=a||this.containerHeight,c=0,d=this.ui.header.outerHeight(!0)||0;if(b&&this.ribbonRegion.currentView&&this.ribbonRegion.currentView.$el){var e=this.ribbonRegion.$el,f=this.ribbonRegion.currentView&&this.ribbonRegion.currentView.$el,g=(b-d)/1.33;f&&f.outerHeight(!0)<e.outerHeight(!0)&&(g=f.outerHeight(!0)),e.css("maxHeight",g),c=e.is(":visible")&&e.outerHeight(!0)||0}if(b&&this.contentRegion.currentView){var h=b-c-d;this.contentRegion.$el.css("height",h+"px"),this._checkScrollingAtBottom(),"function"==typeof this.contentRegion.currentView.sizeAdjust&&this.contentRegion.currentView.sizeAdjust(h)}},initContentEventListeners:function(){var a=this;this.contentRegion.$el.scroll(function(){a._checkScrollingAtBottom()}),this.contentRegion.currentView.options.vent&&(this.contentRegion.currentView.options.vent.on("view:check:scrolling:at:bottom",function(){a._checkScrollingAtBottom()}),this.contentRegion.currentView.options.vent.on("content:size:adjust",function(){a.sizeAdjust()}),this.contentRegion.currentView.options.vent.on("content:isolate:scrolling",function(a){b.Common.Utils.Dom.isolatedScroll(a)}))},_checkScrollingAtBottom:function(){var a=50;this.contentRegion.$el.scrollTop()+this.contentRegion.$el.innerHeight()>=this.contentRegion.$el.prop("scrollHeight")-a&&this.contentRegion.currentView.trigger("sidebar:content:at:bottom:scroll")},templateHelpers:function(){var a={};return this.options.headingText&&(a.headingText=this.options.headingText),a}})}),KXL.module("Sidebar",function(a,b,c,d,e,f){var g,h=null,i=!1,j=new b.Entities.Collection([{id:"chat",preload:!1,command:"chat:show",title:b.i18n.t("chat.title")},{id:"friends",preload:!0,asyncRequest:"get:friendspanel:view",title:b.i18n.t("friends.panel.title")},{id:"notifications",preload:!0,request:"notifications:get",title:b.i18n.t("sidebar.notifications.title"),asyncModule:"notifications"}]),k=!1;j=f.extend(j,new c.PickThis.SingleSelect(j,"sidebarStates"));var l=d.Controller.extend({initialize:function(){var c=this;g=b.request("current:user:settings:entity"),h=new a.Views.SidebarLayout,h.on("show",function(){b.atom.set("sidebar",h)}),b.atom.once("sidebar:states:ready",function(){c._loadSideBarFromState()})},setupSidebar:function(a){b.sidebarRegion.show(this.getSidebar(a))},showSidebar:function(){b.sidebarRegion.$el.show(),this.toggleSidebarPinned(!0),this.adjustViewsToContainerHeight()},hideSidebar:function(){b.sidebarRegion.$el.hide(),this.toggleSidebarPinned(!1)},getSidebar:function(){return h},getSidebarContent:function(a){return h.regions[a]},getSidebarStates:function(){return j},showSidebarContent:function(a,c){var d=h.regions[a];if(d){var e=this,g=f.defaults({},c,{hideOthers:!0}),i=d.$el;if(d.ensureEl(),i.show(),j.select(j.get(a)),b.appModel.set("sideBarState",a),this._saveSideBarState(),g.hideOthers){var k=f.keys(h.regions);f.each(k,function(b){b!==a&&e.hideSidebarContent(b,!1,{silent:!0})})}this.showSidebar()}},hideSidebarContent:function(a,c,d){var e=this,g=f.defaults({},d,{silent:!1});if(!a){var i=f.keys(h.regions);return void f.each(i,function(a){e.hideSidebarContent(a,c,g)})}var k=h.regions[a];if(k){var l=k.$el;l&&(l.hide(),c&&e.removeSidebarContent(a)),this._isAllSidebarContentHidden()&&!g.silent&&(b.appModel.set("sideBarState","closed"),this._saveSideBarState(),j.deselect(j.get(a)),this.hideSidebar())}},removeSidebarContent:function(a){var b=h.regions[a];b&&(b.close(),h.removeRegion(a),b.$el.remove())},createSidebarContent:function(d){var g=this,j=f.defaults({},d,{show:!0,checkExists:!0,removeOnClose:!0}),k=j.contentId,l=j.contentView,m=j.topBarView,n=j.headerCTAViewPointer,o=j.headerCTABreadcrumbViewPointer,p=j.footerCTAViewPointer,q=j.modulePointer||null,r=j.title;if(j.checkExists&&this.getSidebarContent(j.contentId)&&j.show)return void this.showSidebarContent(j.contentId);var s=new n({title:j.title});h.$el.show();var t,u=new a.Views.SidebarPanelLayout({headingText:j.title,contentId:k}),v=h.regions[j.contentId];if(!v){t=e('<div class="kx-sidebar-content-region '+j.contentId+(j.className?" "+j.className:"")+'" style="display:none;"></div>'),h.$el.append(t),v=new c.Marionette.Region({el:t});var w={};w[j.contentId]=v,h.addRegions(w)}return j.show&&v.on("show",function(){g.showSidebarContent(j.contentId,j)}),u.on("show",function(){function a(a){var c=a.get("members"),d="";if("group"===a.get("type"))f.each(c.models,function(a){d.length?d+=", "+a.get("username"):d=a.get("username")});else if("private"===a.get("type")){var e=c.find(function(a){return a.get("userId")!==b.request("get:current:user").id});e&&(d=e.get("username"))}else d=a.get("title");return d}l.on("show",function(){u.initContentEventListeners()}),u.contentRegion.show(l),q&&g.listenTo(q,"all",function(){}),m&&u.ribbonRegion.show(m),s&&u.headerCTARegion.show(s),q&&(this.listenTo(q,"breadcrumb:show",function(b){i=!0;var c=r;b&&b.thread?(q.trigger("default"===b.thread.get("type")||"private"===b.thread.get("type")?"chat:recipient:hide":"chat:recipient:show"),c=r+": "+a(b.thread)):q.trigger("chat:recipient:show"),l.ui.conversation.addClass("visible"),l.ui.threadsContainer.removeClass("visible"),u.headerCTARegion.show(new o({title:c,thread:b.thread}))}),this.listenTo(q,"breadcrumb:hide",function(){i=!1;var a=r;l.ui.conversation.removeClass("visible"),l.ui.threadsContainer.addClass("visible"),u.headerCTARegion.reset(),u.headerCTARegion.show(new n({title:a})),q.trigger("footer:hide")}),this.listenTo(q,"footer:show",function(){u.footerCTARegion.show(new p),u.footerCTARegion.$el.addClass("visible"),b.vent.trigger("chat:update:ui",this)}),this.listenTo(q,"footer:hide",function(){u.footerCTARegion.$el&&u.footerCTARegion.$el.hasClass("visible")&&(u.footerCTARegion.$el.removeClass("visible"),u.footerCTARegion.reset(),b.vent.trigger("chat:update:ui",this))})),h.sizeAdjust()}),v.show(u),v},_isAllSidebarContentHidden:function(){var a=!0,b=this,c=f.keys(h.regions);return f.each(c,function(c){b.getSidebarContent(c).$el.is(":visible")&&(a=!1)}),a},_preloadStates:function(){var a=this;j.each(function(c){function d(){h=g.get("sideBarState")===c.get("id"),c.get("request")?(e=b.request(c.get("request")),f(e,h)):b.asyncRequest(c.get("asyncRequest")).then(function(a){f(a,h)})}if(c.get("preload")&&c.get("id")&&(c.get("request")||c.get("asyncRequest"))){var e,f=function(b,d){a.createSidebarContent((b.topBarView||b.headerCTAView)&&b.contentView?{contentId:c.get("id"),title:c.get("title"),topBarView:b.topBarView,contentView:b.contentView,headerCTAViewPointer:b.headerCTAView,headerCTABreadcrumbViewPointer:b.headerCTABreadcrumbView,show:d}:{contentId:c.get("id"),title:c.get("title"),contentView:b,show:d})},h=!1;c.get("asyncModule")?b.asyncRequest("async:load:module",c.get("asyncModule")).then(d):d()}}),k=!0,b.atom.set("sidebar:states:ready",!0)},_saveSideBarState:function(){g.set("sideBarState",b.appModel.get("sideBarState")),g.save()},_loadSideBarFromState:function(){var a=b.appModel.get("sideBarState")||g.get("sideBarState");switch(a){case"open":case"chat":b.execute("chat:show");break;case"closed":b.execute("sidebar:hide");break;default:this.getSidebarContent(a)&&this.showSidebarContent(a)}},adjustViewsToContainerHeight:function(){h&&h.sizeAdjust()},checkSidebar:function(){var a=b.request("get:current:user");a?k||this._preloadStates():b.execute("chat:hide")},toggleSidebarPinned:function(a){a?e("body").addClass("kx-pinned"):j.selected||e("body").removeClass("kx-pinned")}});a.Controller=new l}),KXL.module("Sidebar",function(a,b){var c={setupSidebar:function(b){a.Controller.setupSidebar(b)},showSidebarContent:function(b,c){a.Controller.showSidebarContent(b,c)},createSidebarContent:function(b){return a.Controller.createSidebarContent(b)},hideSidebarContent:function(b,c,d){a.Controller.hideSidebarContent(b,c,d)},removeSidebarContent:function(b){a.Controller.removeSidebarContent(b)},getSidebarContent:function(b){return a.Controller.getSidebarContent(b)},showSidebar:function(){a.Controller.showSidebar()},hideSidebar:function(){a.Controller.hideSidebar()},getSidebar:function(){a.Controller.getSidebar()},getSidebarStates:function(){return a.Controller.getSidebarStates()},toggleSidebarPinned:function(b){a.Controller.toggleSidebarPinned(b)},checkSidebar:function(){a.Controller.checkSidebar()},adjustViewsToContainerHeight:function(){a.Controller.adjustViewsToContainerHeight()}};b.addInitializer(function(){b.reqres.setHandlers({"sidebar:create:content":function(a){return c.createSidebarContent(a)},"sidebar:show:content":function(a,b){c.showSidebarContent(a,b)},"sidebar:hide:content":function(a,b,d){c.hideSidebarContent(a,b,d)},"sidebar:remove:content":function(a){c.removeSidebarContent(a)},"sidebar:get:content":function(a){return c.getSidebarContent(a)},"sidebar:get":function(){return c.getSidebar()},"sidebar:get:states":function(){return c.getSidebarStates()}}),b.commands.setHandlers({"sidebar:initialize":function(a){c.setupSidebar(a)},"sidebar:show":function(){c.showSidebar()},"sidebar:hide":function(){c.hideSidebar()},"sidebar:check":function(){c.checkSidebar()},"sidebar:toggle:pinned":function(a){c.toggleSidebarPinned(a)},"sidebar:adjust:children:to:container:height":function(){c.adjustViewsToContainerHeight()}})})});
//# sourceMappingURL=sidebar.min.js.map
