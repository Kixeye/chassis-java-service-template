/* kxl-deployment-tools 2016-05-18 */
    proxy=oauth2relay355790980
    hl=en_US
    immediate=false
    scope=https://www.kixeye.com/game/warcommander/?set:%3Chtml%20class=%22wf-franklingothicurwcond-n7-active%20wf-myriadpro-i4-active%20wf-myriadpro-i7-active%20wf-myriadpro-n4-active%20wf-myriadpro-n7-active%20wf-proximanova-n3-active%20wf-proximanova-n4-active%20wf-proximanova-n6-active%20wf-proximanova-n7-active%20wf-active%22%3E%3Chead%3E%3Cmeta%20charset=%22utf-8%22%3E%3Cmeta%20http-equiv=%22X-UA-Compatible%22%20content=%22IE=edge%22%3E%3Ctitle%3EKIXEYE%20-%20War%20Commander%3C/title%3E%3Cmeta%20content=%22War%20Commander%22%20property=%22og:title%22%3E%3Cmeta%20content=%22Battle%20enemies%20for%20earth%27s%20last%20remaining%20resources.%20Play%20Free!%22%20property=%22og:description%22%3E%3Cmeta%20content=%22website%22%20property=%22og:type%22%3E%3Cmeta%20content=%22https://www.kixeye.com/modules/game/nav/images/wc/logo.png%22%20property=%22og:image%22%3E%3Cmeta%20content=%22https://www.kixeye.com/game/warcommander/home%22%20property=%22og:url%22%3E%3Cmeta%20name=%22description%22%20content=%22Battle%20enemies%20for%20earth%27s%20last%20remaining%20resources.%20Play%20Free!%22%3E%3Cmeta%20name=%22viewport%22%20content=%22width=device-width,%20initial-scale=1%22%3E%3Clink%20href=%22/favicon.ico%22%20rel=%22shortcut%20icon%22%3E%3Clink%20href=%22https://www.kixeye.com/game/warcommander/home/%22%20rel=%22canonical%22%3E%3Clink%20href=%22//cdn.optimizely.com%22%20rel=%22dns-prefetch%22%3E%3Clink%20href=%22//use.typekit.net%22%20rel=%22dns-prefetch%22%3E%3Clink%20href=%22kxl-cdn-static.kixeye.com%22%20rel=%22dns-prefetch%22%3E%3Clink%20href=%22api.kixeye.com%22%20rel=%22dns-prefetch%22%3E%3Clink%20href=%22//kxl-cdn-static.kixeye.com/siteprod/release-1.72.0-1/css/main.min.css%22%20rel=%22stylesheet%22%3E%3Cscript%20src=%22https://plus.google.com/js/client:plusone.js%22%20type=%22text/javascript%22%20async=%22%22%3E%3C/script%3E%3Cscript%20src=%22https://stats.g.doubleclick.net/dc.js%22%20type=%22text/javascript%22%20async=%22%22%3E%3C/script%3E%3Cscript%20type=%22text/javascript%22%3Eif%20(localStorage%20&&%20localStorage.getItem(%22js.override.head%22))%20{document.write(%22%3Cscr%22%20+%20%22ipt%20type=%27text/javascript%27%20src=%27%22%20+%20localStorage.getItem(%22js.override.head%22)%20+%20%22%27%3E%3C/scr%22%20+%20%22ipt%3E%22);}%20else%20{document.write(%22%3Cscr%22%20+%20%22ipt%20type=%27text/javascript%27%20src=%27//kxl-cdn-static.kixeye.com/siteprod/release-1.72.0-1/js/main.head.min.js%27%3E%3C/scr%22%20+%20%22ipt%3E%22);}%3C/script%3E%3Cscript%20src=%22//kxl-cdn-static.ki
    origin=https://developers.google.com
    response_type=token
    redirect_uri=postmessage
    state=620880886|0.3506209661
    client_id=292824132082.apps.googleusercontent.com
    include_granted_scopes=false
    jsh=m;/_/scs/apps-static/_/js/k=oz.gapi.en.2cv2ukNQR74.O/m=__features__/am=AQ/rt=j/d=1/rs=AGLTcCNOPOlYPyViTRZzB0LhQcLsf3eauw

That’s all we know.
function PxLoaderImage(a,b,c){var d=this,e=null;this.img=new Image,this.tags=b,this.priority=c;var f=function(){"complete"===d.img.readyState&&(i(),e.onLoad(d))},g=function(){i(),e.onLoad(d)},h=function(){i(),e.onError(d)},i=function(){d.unbind("load",g),d.unbind("readystatechange",f),d.unbind("error",h)};this.start=function(b){e=b,d.bind("load",g),d.bind("readystatechange",f),d.bind("error",h),d.img.src=a},this.checkStatus=function(){d.img.complete&&(i(),e.onLoad(d))},this.onTimeout=function(){i(),d.img.complete?e.onLoad(d):e.onTimeout(d)},this.getName=function(){return a},this.bind=function(a,b){d.img.addEventListener?d.img.addEventListener(a,b,!1):d.img.attachEvent&&d.img.attachEvent("on"+a,b)},this.unbind=function(a,b){d.img.removeEventListener?d.img.removeEventListener(a,b,!1):d.img.detachEvent&&d.img.detachEvent("on"+a,b)}}function b64_sha1(a){return binb2b64(core_sha1(str2binb(a),8*a.length))}function str_sha1(a){return binb2str(core_sha1(str2binb(a),8*a.length))}function b64_hmac_sha1(a,b){return binb2b64(core_hmac_sha1(a,b))}function str_hmac_sha1(a,b){return binb2str(core_hmac_sha1(a,b))}function core_sha1(a,b){a[b>>5]|=128<<24-b%32,a[(b+64>>9<<4)+15]=b;var c,d,e,f,g,h,i,j,k=new Array(80),l=1732584193,m=-271733879,n=-1732584194,o=271733878,p=-1009589776;for(c=0;c<a.length;c+=16){for(f=l,g=m,h=n,i=o,j=p,d=0;80>d;d++)k[d]=16>d?a[c+d]:rol(k[d-3]^k[d-8]^k[d-14]^k[d-16],1),e=safe_add(safe_add(rol(l,5),sha1_ft(d,m,n,o)),safe_add(safe_add(p,k[d]),sha1_kt(d))),p=o,o=n,n=rol(m,30),m=l,l=e;l=safe_add(l,f),m=safe_add(m,g),n=safe_add(n,h),o=safe_add(o,i),p=safe_add(p,j)}return[l,m,n,o,p]}function sha1_ft(a,b,c,d){return 20>a?b&c|~b&d:40>a?b^c^d:60>a?b&c|b&d|c&d:b^c^d}function sha1_kt(a){return 20>a?1518500249:40>a?1859775393:60>a?-1894007588:-899497514}function core_hmac_sha1(a,b){var c=str2binb(a);c.length>16&&(c=core_sha1(c,8*a.length));for(var d=new Array(16),e=new Array(16),f=0;16>f;f++)d[f]=909522486^c[f],e[f]=1549556828^c[f];var g=core_sha1(d.concat(str2binb(b)),512+8*b.length);return core_sha1(e.concat(g),672)}function safe_add(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function rol(a,b){return a<<b|a>>>32-b}function str2binb(a){for(var b=[],c=255,d=0;d<8*a.length;d+=8)b[d>>5]|=(a.charCodeAt(d/8)&c)<<24-d%32;return b}function binb2str(a){for(var b="",c=255,d=0;d<32*a.length;d+=8)b+=String.fromCharCode(a[d>>5]>>>24-d%32&c);return b}function binb2b64(a){for(var b,c,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",e="",f=0;f<4*a.length;f+=3)for(b=(a[f>>2]>>8*(3-f%4)&255)<<16|(a[f+1>>2]>>8*(3-(f+1)%4)&255)<<8|a[f+2>>2]>>8*(3-(f+2)%4)&255,c=0;4>c;c++)e+=8*f+6*c>32*a.length?"=":d.charAt(b>>6*(3-c)&63);return e}function setWebsocketListeners(){var a=KXL.module("Websocket");a.on("systemEvent",function(a){"forceLogout"===a.eventType&&KXL.execute("logout"),"passwordChanged"===a.eventType&&(KXL.request("get:client:initiated:password:change")||(KXL.request("set:client:initiated:password:change",!1),KXL.execute("logout")))}),a.on("userUpdate",function(a){KXL.currentUser&&a&&KXL.currentUser.set(a)}),a.on("settings",function(a){var b=KXL.request("current:user:settings:entity");_.each(a,function(a,c){b.set(c,a)})}),a.on("games",function(a){var b,c=KXL.request("current:user:game:entities");a.gameId&&(b=c.get(a.gameId)),b?b.set(a):c.add(new KXL.Entities.UserGame(a)),c.sort()}),a.on("friends",function(a){var b=KXL.request("current:user:friend:entities");b.then(function(b){if(a&&a.data&&a.data.userId){var c=b.get(a.data.userId);c&&a.action&&"remove"===a.action?(KXL.request("decrement:service:friends:count",a.data.userId),KXL.request("decrement:service:friends:count",KXL.currentUser.id),c.destroy(),KXL.execute("fetch:sent:friend:requests")):!c&&a.action&&"add"===a.action&&(KXL.request("increment:service:friends:count",KXL.currentUser.id),KXL.request("increment:service:friends:count",a.data.userId),b.add(new KXL.Entities.Friend(a.data)))}})}),a.on("battleLog",function(a){var b=KXL.request("get:services:battlelog",a.gameId);if(b){var c=b.findWhere({userId:a.userId,gameId:a.gameId,start:a.start,end:a.end});c||b.add(a,{at:0})}}),a.on("presence",function(a){var b=KXL.request("current:user:friend:entities"),c=b._collection;c.fetchComplete||(c.sortOnFetchComplete=!0),b.then(function(){var b=c.get(a.userId);b&&b.set("presence",a.status)})}),a.on("chat",function(a){var b=KXL.request("get:chat:interface");b.isConnected()&&b._onNotification(a)})}function processNotification(a,b){if("applicants"===b.entityType){var c=a.get("applicants");switch(b.operation){case"upsert":c.add(b.entity,{id:b.groupId,parse:!0});break;case"delete":c.remove(b.entityId)}}if("lists"===b.entityType){var d=a.get("lists");switch(b.operation){case"upsert":d.add(b.entity,{id:b.groupId,parse:!0,merge:!0});break;case"delete":d.remove(b.entityId)}}if("listitems"===b.entityType)switch(b.operation){case"upsert":var e=KXL.request("group:get:discussion:subpod:list",a,b.entity.listId);e.done(function(a){var c=a.get("listItems");if(c){var d=c.get(b.entity.id);d?(c.add(b.entity,{id:b.entity.id,parse:!0,merge:!0}),c.remove(d),c.add(d,{at:b.entity.index})):c.add(b.entity,{id:b.entity.id,parse:!0,at:b.entity.index})}});break;case"delete":var e=KXL.request("group:get:discussion:subpod:list",a,b.entityId.listId);e.done(function(a){var c=a.get("listItems");c&&c.remove(b.entityId.id)})}if("attackBeacons"===b.entityType){var f=a.get("attackBeacons");switch(b.operation){case"upsert":f.add(b.entity,{id:b.entityId,parse:!0,merge:!0});break;case"delete":f.remove(b.entityId)}}if("members"===b.entityType){var g=a.get("members"),h=a.get("recruits");switch(b.operation){case"upsert":0===b.entity.rankId?h.add(b.entity,{id:b.groupId,parse:!0,merge:!0}):g.add(b.entity,{id:b.groupId,parse:!0,merge:!0}),b.entity.userId===KXL.currentUser.id&&KXL.currentUserGroups.get(b.groupId)&&KXL.currentUserGroups.get(b.groupId).set("rankId",b.entity.rankId);break;case"delete":h.remove(h.get(b.entityId)),g.remove(g.get(b.entityId)),b.entityId===KXL.currentUser.id&&KXL.currentUserGroups.get(b.groupId)&&KXL.currentUserGroups.remove(b.groupId)}}if("online"===b.entityType){var i=a.get("online");switch(b.operation){case"upsert":i.add(b.entity,{parse:!0,merge:!0});break;case"delete":i.remove(i.get(b.entityId))}}if("discussions"===b.entityType){var j=a.get("discussions");switch(b.operation){case"upsert":j.add(b.entity,{parse:!0,merge:!0});break;case"delete":j.remove(j.get(b.entityId))}}if("invites"===b.entityType){var k=a.get("invites");switch(b.operation){case"upsert":k.add(b.entity,{parse:!0,merge:!0});break;case"delete":k.remove(b.entityId)}}}!function(a,b){function c(a){var b=a.length,c=jQuery.type(a);return jQuery.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||"function"!==c&&(0===b||"number"==typeof b&&b>0&&b-1 in a)}function d(a){var b=nb[a]={};return jQuery.each(a.match(gb)||[],function(a,c){b[c]=!0}),b}function e(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=jQuery.expando+Math.random()}function f(a,c,d){var e;if(d===b&&1===a.nodeType)if(e="data-"+c.replace(rb,"-$1").toLowerCase(),d=a.getAttribute(e),"string"==typeof d){try{d="true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:qb.test(d)?JSON.parse(d):d}catch(f){}ob.set(a,c,d)}else d=b;return d}function g(){return!0}function h(){return!1}function i(){try{return T.activeElement}catch(a){}}function j(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function k(a,b,c){if(jQuery.isFunction(b))return jQuery.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return jQuery.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(Bb.test(b))return jQuery.filter(b,a,c);b=jQuery.filter(b,a)}return jQuery.grep(a,function(a){return bb.call(b,a)>=0!==c})}function l(a,b){return jQuery.nodeName(a,"table")&&jQuery.nodeName(1===b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function m(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function n(a){var b=Mb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function o(a,b){for(var c=a.length,d=0;c>d;d++)pb.set(a[d],"globalEval",!b||pb.get(b[d],"globalEval"))}function p(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(pb.hasData(a)&&(f=pb.access(a),g=pb.set(b,f),j=f.events)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)jQuery.event.add(b,e,j[e][c])}ob.hasData(a)&&(h=ob.access(a),i=jQuery.extend({},h),ob.set(b,i))}}function q(a,c){var d=a.getElementsByTagName?a.getElementsByTagName(c||"*"):a.querySelectorAll?a.querySelectorAll(c||"*"):[];return c===b||c&&jQuery.nodeName(a,c)?jQuery.merge([a],d):d}function r(a,b){var c=b.nodeName.toLowerCase();"input"===c&&Jb.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}function s(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=$b.length;e--;)if(b=$b[e]+c,b in a)return b;return d}function t(a,b){return a=b||a,"none"===jQuery.css(a,"display")||!jQuery.contains(a.ownerDocument,a)}function u(b){return a.getComputedStyle(b,null)}function v(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=pb.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&t(d)&&(f[g]=pb.access(d,"olddisplay",z(d.nodeName)))):f[g]||(e=t(d),(c&&"none"!==c||!e)&&pb.set(d,"olddisplay",e?c:jQuery.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function w(a,b,c){var d=Tb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function x(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=jQuery.css(a,c+Zb[f],!0,e)),d?("content"===c&&(g-=jQuery.css(a,"padding"+Zb[f],!0,e)),"margin"!==c&&(g-=jQuery.css(a,"border"+Zb[f]+"Width",!0,e))):(g+=jQuery.css(a,"padding"+Zb[f],!0,e),"padding"!==c&&(g+=jQuery.css(a,"border"+Zb[f]+"Width",!0,e)));return g}function y(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=u(a),g=jQuery.support.boxSizing&&"border-box"===jQuery.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Pb(a,b,f),(0>e||null==e)&&(e=a.style[b]),Ub.test(e))return e;d=g&&(jQuery.support.boxSizingReliable||e===a.style[b]),e=parseFloat(e)||0}return e+x(a,b,c||(g?"border":"content"),d,f)+"px"}function z(a){var b=T,c=Wb[a];return c||(c=A(a,b),"none"!==c&&c||(Qb=(Qb||jQuery("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(b.documentElement),b=(Qb[0].contentWindow||Qb[0].contentDocument).document,b.write("<!doctype html><html><body>"),b.close(),c=A(a,b),Qb.detach()),Wb[a]=c),c}function A(a,b){var c=jQuery(b.createElement(a)).appendTo(b.body),d=jQuery.css(c[0],"display");return c.remove(),d}function B(a,b,c,d){var e;if(jQuery.isArray(b))jQuery.each(b,function(b,e){c||ac.test(a)?d(a,e):B(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==jQuery.type(b))d(a,b);else for(e in b)B(a+"["+e+"]",b[e],c,d)}function C(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(gb)||[];if(jQuery.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function D(a,b,c,d){function e(h){var i;return f[h]=!0,jQuery.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||g||f[j]?g?!(i=j):void 0:(b.dataTypes.unshift(j),e(j),!1)}),i}var f={},g=a===rc;return e(b.dataTypes[0])||!f["*"]&&e("*")}function E(a,c){var d,e,f=jQuery.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d]);return e&&jQuery.extend(!0,a,e),a}function F(a,c,d){for(var e,f,g,h,i=a.contents,j=a.dataTypes;"*"===j[0];)j.shift(),e===b&&(e=a.mimeType||c.getResponseHeader("Content-Type"));if(e)for(f in i)if(i[f]&&i[f].test(e)){j.unshift(f);break}if(j[0]in d)g=j[0];else{for(f in d){if(!j[0]||a.converters[f+" "+j[0]]){g=f;break}h||(h=f)}g=g||h}return g?(g!==j[0]&&j.unshift(g),d[g]):void 0}function G(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function H(){return setTimeout(function(){Ac=b}),Ac=jQuery.now()}function I(a,b,c){for(var d,e=(Gc[b]||[]).concat(Gc["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function J(a,b,c){var d,e,f=0,g=Fc.length,h=jQuery.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Ac||H(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:jQuery.extend({},b),opts:jQuery.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Ac||H(),duration:c.duration,tweens:[],createTween:function(b,c){var d=jQuery.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(K(k,j.opts.specialEasing);g>f;f++)if(d=Fc[f].call(j,a,k,j.opts))return d;return jQuery.map(k,I,j),jQuery.isFunction(j.opts.start)&&j.opts.start.call(a,j),jQuery.fx.timer(jQuery.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function K(a,b){var c,d,e,f,g;for(c in a)if(d=jQuery.camelCase(c),e=b[d],f=a[c],jQuery.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=jQuery.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function L(a,c,d){var e,f,g,h,i,j,k=this,l={},m=a.style,n=a.nodeType&&t(a),o=pb.get(a,"fxshow");d.queue||(i=jQuery._queueHooks(a,"fx"),null==i.unqueued&&(i.unqueued=0,j=i.empty.fire,i.empty.fire=function(){i.unqueued||j()}),i.unqueued++,k.always(function(){k.always(function(){i.unqueued--,jQuery.queue(a,"fx").length||i.empty.fire()})})),1===a.nodeType&&("height"in c||"width"in c)&&(d.overflow=[m.overflow,m.overflowX,m.overflowY],"inline"===jQuery.css(a,"display")&&"none"===jQuery.css(a,"float")&&(m.display="inline-block")),d.overflow&&(m.overflow="hidden",k.always(function(){m.overflow=d.overflow[0],m.overflowX=d.overflow[1],m.overflowY=d.overflow[2]}));for(e in c)if(f=c[e],Cc.exec(f)){if(delete c[e],g=g||"toggle"===f,f===(n?"hide":"show")){if("show"!==f||!o||o[e]===b)continue;n=!0}l[e]=o&&o[e]||jQuery.style(a,e)}if(!jQuery.isEmptyObject(l)){o?"hidden"in o&&(n=o.hidden):o=pb.access(a,"fxshow",{}),g&&(o.hidden=!n),n?jQuery(a).show():k.done(function(){jQuery(a).hide()}),k.done(function(){var b;pb.remove(a,"fxshow");for(b in l)jQuery.style(a,b,l[b])});for(e in l)h=I(n?o[e]:0,e,k),e in o||(o[e]=h.start,n&&(h.end=h.start,h.start="width"===e||"height"===e?1:0))}}function M(a,b,c,d,e){return new M.prototype.init(a,b,c,d,e)}function N(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=Zb[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function O(a){return jQuery.isWindow(a)?a:9===a.nodeType&&a.defaultView}var P,Q,R=typeof b,S=a.location,T=a.document,U=T.documentElement,V=a.jQuery,W=a.$,X={},Y=[],Z="2.0.3",$=Y.concat,_=Y.push,ab=Y.slice,bb=Y.indexOf,cb=X.toString,db=X.hasOwnProperty,eb=Z.trim,jQuery=function(a,b){return new jQuery.fn.init(a,b,P)},fb=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,gb=/\S+/g,hb=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ib=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,jb=/^-ms-/,kb=/-([\da-z])/gi,lb=function(a,b){return b.toUpperCase()},mb=function(){T.removeEventListener("DOMContentLoaded",mb,!1),a.removeEventListener("load",mb,!1),jQuery.ready()};jQuery.fn=jQuery.prototype={jquery:Z,constructor:jQuery,init:function(a,c,d){var e,f;if(!a)return this;if("string"==typeof a){if(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:hb.exec(a),!e||!e[1]&&c)return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a);if(e[1]){if(c=c instanceof jQuery?c[0]:c,jQuery.merge(this,jQuery.parseHTML(e[1],c&&c.nodeType?c.ownerDocument||c:T,!0)),ib.test(e[1])&&jQuery.isPlainObject(c))for(e in c)jQuery.isFunction(this[e])?this[e](c[e]):this.attr(e,c[e]);return this}return f=T.getElementById(e[2]),f&&f.parentNode&&(this.length=1,this[0]=f),this.context=T,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):jQuery.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),jQuery.makeArray(a,this))},selector:"",length:0,toArray:function(){return ab.call(this)},get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a){var b=jQuery.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return jQuery.each(this,a,b)},ready:function(a){return jQuery.ready.promise().done(a),this},slice:function(){return this.pushStack(ab.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},map:function(a){return this.pushStack(jQuery.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:_,sort:[].sort,splice:[].splice},jQuery.fn.init.prototype=jQuery.fn,jQuery.extend=jQuery.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"==typeof h||jQuery.isFunction(h)||(h={}),j===i&&(h=this,--i);j>i;i++)if(null!=(a=arguments[i]))for(c in a)d=h[c],e=a[c],h!==e&&(k&&e&&(jQuery.isPlainObject(e)||(f=jQuery.isArray(e)))?(f?(f=!1,g=d&&jQuery.isArray(d)?d:[]):g=d&&jQuery.isPlainObject(d)?d:{},h[c]=jQuery.extend(k,g,e)):e!==b&&(h[c]=e));return h},jQuery.extend({expando:"jQuery"+(Z+Math.random()).replace(/\D/g,""),noConflict:function(b){return a.$===jQuery&&(a.$=W),b&&a.jQuery===jQuery&&(a.jQuery=V),jQuery},isReady:!1,readyWait:1,holdReady:function(a){a?jQuery.readyWait++:jQuery.ready(!0)},ready:function(a){(a===!0?--jQuery.readyWait:jQuery.isReady)||(jQuery.isReady=!0,a!==!0&&--jQuery.readyWait>0||(Q.resolveWith(T,[jQuery]),jQuery.fn.trigger&&jQuery(T).trigger("ready").off("ready")))},isFunction:function(a){return"function"===jQuery.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?String(a):"object"==typeof a||"function"==typeof a?X[cb.call(a)]||"object":typeof a},isPlainObject:function(a){if("object"!==jQuery.type(a)||a.nodeType||jQuery.isWindow(a))return!1;try{if(a.constructor&&!db.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},error:function(a){throw new Error(a)},parseHTML:function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||T;var d=ib.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=jQuery.buildFragment([a],b,e),e&&jQuery(e).remove(),jQuery.merge([],d.childNodes))},parseJSON:JSON.parse,parseXML:function(a){var c,d;if(!a||"string"!=typeof a)return null;try{d=new DOMParser,c=d.parseFromString(a,"text/xml")}catch(e){c=b}return(!c||c.getElementsByTagName("parsererror").length)&&jQuery.error("Invalid XML: "+a),c},noop:function(){},globalEval:function(a){var b,c=eval;a=jQuery.trim(a),a&&(1===a.indexOf("use strict")?(b=T.createElement("script"),b.text=a,T.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(jb,"ms-").replace(kb,lb)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var e,f=0,g=a.length,h=c(a);if(d){if(h)for(;g>f&&(e=b.apply(a[f],d),e!==!1);f++);else for(f in a)if(e=b.apply(a[f],d),e===!1)break}else if(h)for(;g>f&&(e=b.call(a[f],f,a[f]),e!==!1);f++);else for(f in a)if(e=b.call(a[f],f,a[f]),e===!1)break;return a},trim:function(a){return null==a?"":eb.call(a)},makeArray:function(a,b){var d=b||[];return null!=a&&(c(Object(a))?jQuery.merge(d,"string"==typeof a?[a]:a):_.call(d,a)),d},inArray:function(a,b,c){return null==b?-1:bb.call(b,a,c)},merge:function(a,c){var d=c.length,e=a.length,f=0;if("number"==typeof d)for(;d>f;f++)a[e++]=c[f];else for(;c[f]!==b;)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;for(c=!!c;g>f;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,b,d){var e,f=0,g=a.length,h=c(a),i=[];if(h)for(;g>f;f++)e=b(a[f],f,d),null!=e&&(i[i.length]=e);else for(f in a)e=b(a[f],f,d),null!=e&&(i[i.length]=e);return $.apply([],i)},guid:1,proxy:function(a,c){var d,e,f;return"string"==typeof c&&(d=a[c],c=a,a=d),jQuery.isFunction(a)?(e=ab.call(arguments,2),f=function(){return a.apply(c||this,e.concat(ab.call(arguments)))},f.guid=a.guid=a.guid||jQuery.guid++,f):b},access:function(a,c,d,e,f,g,h){var i=0,j=a.length,k=null==d;if("object"===jQuery.type(d)){f=!0;for(i in d)jQuery.access(a,c,i,d[i],!0,g,h)}else if(e!==b&&(f=!0,jQuery.isFunction(e)||(h=!0),k&&(h?(c.call(a,e),c=null):(k=c,c=function(a,b,c){return k.call(jQuery(a),c)})),c))for(;j>i;i++)c(a[i],d,h?e:e.call(a[i],i,c(a[i],d)));return f?a:k?c.call(a):j?c(a[0],d):g},now:Date.now,swap:function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e}}),jQuery.ready.promise=function(b){return Q||(Q=jQuery.Deferred(),"complete"===T.readyState?setTimeout(jQuery.ready):(T.addEventListener("DOMContentLoaded",mb,!1),a.addEventListener("load",mb,!1))),Q.promise(b)},jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){X["[object "+b+"]"]=b.toLowerCase()}),P=jQuery(T),function(a,b){function c(a,b,c,d){var e,f,g,h,i,j,k,l,o,p;if((b?b.ownerDocument||b:O)!==G&&F(b),b=b||G,c=c||[],!a||"string"!=typeof a)return c;if(1!==(h=b.nodeType)&&9!==h)return[];if(I&&!d){if(e=sb.exec(a))if(g=e[1]){if(9===h){if(f=b.getElementById(g),!f||!f.parentNode)return c;if(f.id===g)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(g))&&M(b,f)&&f.id===g)return c.push(f),c}else{if(e[2])return ab.apply(c,b.getElementsByTagName(a)),c;if((g=e[3])&&x.getElementsByClassName&&b.getElementsByClassName)return ab.apply(c,b.getElementsByClassName(g)),c}if(x.qsa&&(!J||!J.test(a))){if(l=k=N,o=b,p=9===h&&a,1===h&&"object"!==b.nodeName.toLowerCase()){for(j=m(a),(k=b.getAttribute("id"))?l=k.replace(vb,"\\$&"):b.setAttribute("id",l),l="[id='"+l+"'] ",i=j.length;i--;)j[i]=l+n(j[i]);o=mb.test(a)&&b.parentNode||b,p=j.join(",")}if(p)try{return ab.apply(c,o.querySelectorAll(p)),c}catch(q){}finally{k||b.removeAttribute("id")}}}return v(a.replace(jb,"$1"),b,c,d)}function d(){function a(c,d){return b.push(c+=" ")>z.cacheLength&&delete a[b.shift()],a[c]=d}var b=[];return a}function e(a){return a[N]=!0,a}function f(a){var b=G.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function g(a,b){for(var c=a.split("|"),d=a.length;d--;)z.attrHandle[c[d]]=b}function h(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||X)-(~a.sourceIndex||X);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function i(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function j(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function k(a){return e(function(b){return b=+b,e(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function l(){}function m(a,b){var d,e,f,g,h,i,j,k=S[a+" "];if(k)return b?0:k.slice(0);for(h=a,i=[],j=z.preFilter;h;){(!d||(e=kb.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),d=!1,(e=lb.exec(h))&&(d=e.shift(),f.push({value:d,type:e[0].replace(jb," ")}),h=h.slice(d.length));for(g in z.filter)!(e=qb[g].exec(h))||j[g]&&!(e=j[g](e))||(d=e.shift(),f.push({value:d,type:g,matches:e}),h=h.slice(d.length));if(!d)break}return b?h.length:h?c.error(a):S(a,i).slice(0)}function n(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function o(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=Q++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=P+" "+f;if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e)if(j=b[N]||(b[N]={}),(i=j[d])&&i[0]===k){if((h=i[1])===!0||h===y)return h===!0}else if(i=j[d]=[k],i[1]=a(b,c,g)||y,i[1]===!0)return!0}}function p(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function q(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function r(a,b,c,d,f,g){return d&&!d[N]&&(d=r(d)),f&&!f[N]&&(f=r(f,g)),e(function(e,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=e||u(b||"*",h.nodeType?[h]:h,[]),r=!a||!e&&b?p:q(p,m,a,h,i),s=c?f||(e?a:o||d)?[]:g:r;if(c&&c(r,s,h,i),d)for(j=q(s,n),d(j,[],h,i),k=j.length;k--;)(l=j[k])&&(s[n[k]]=!(r[n[k]]=l));if(e){if(f||a){if(f){for(j=[],k=s.length;k--;)(l=s[k])&&j.push(r[k]=l);f(null,s=[],j,i)}for(k=s.length;k--;)(l=s[k])&&(j=f?cb.call(e,l):m[k])>-1&&(e[j]=!(g[j]=l))}}else s=q(s===g?s.splice(o,s.length):s),f?f(null,g,s,i):ab.apply(g,s)})}function s(a){for(var b,c,d,e=a.length,f=z.relative[a[0].type],g=f||z.relative[" "],h=f?1:0,i=o(function(a){return a===b},g,!0),j=o(function(a){return cb.call(b,a)>-1},g,!0),k=[function(a,c,d){return!f&&(d||c!==D)||((b=c).nodeType?i(a,c,d):j(a,c,d))}];e>h;h++)if(c=z.relative[a[h].type])k=[o(p(k),c)];else{if(c=z.filter[a[h].type].apply(null,a[h].matches),c[N]){for(d=++h;e>d&&!z.relative[a[d].type];d++);return r(h>1&&p(k),h>1&&n(a.slice(0,h-1).concat({value:" "===a[h-2].type?"*":""})).replace(jb,"$1"),c,d>h&&s(a.slice(h,d)),e>d&&s(a=a.slice(d)),e>d&&n(a))}k.push(c)}return p(k)}function t(a,b){var d=0,f=b.length>0,g=a.length>0,h=function(e,h,i,j,k){var l,m,n,o=[],p=0,r="0",s=e&&[],t=null!=k,u=D,v=e||g&&z.find.TAG("*",k&&h.parentNode||h),w=P+=null==u?1:Math.random()||.1;for(t&&(D=h!==G&&h,y=d);null!=(l=v[r]);r++){if(g&&l){for(m=0;n=a[m++];)if(n(l,h,i)){j.push(l);break}t&&(P=w,y=++d)}f&&((l=!n&&l)&&p--,e&&s.push(l))}if(p+=r,f&&r!==p){for(m=0;n=b[m++];)n(s,o,h,i);if(e){if(p>0)for(;r--;)s[r]||o[r]||(o[r]=$.call(j));o=q(o)}ab.apply(j,o),t&&!e&&o.length>0&&p+b.length>1&&c.uniqueSort(j)}return t&&(P=w,D=u),s};return f?e(h):h}function u(a,b,d){for(var e=0,f=b.length;f>e;e++)c(a,b[e],d);return d}function v(a,b,c,d){var e,f,g,h,i,j=m(a);if(!d&&1===j.length){if(f=j[0]=j[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&x.getById&&9===b.nodeType&&I&&z.relative[f[1].type]){if(b=(z.find.ID(g.matches[0].replace(wb,xb),b)||[])[0],!b)return c;a=a.slice(f.shift().value.length)}for(e=qb.needsContext.test(a)?0:f.length;e--&&(g=f[e],!z.relative[h=g.type]);)if((i=z.find[h])&&(d=i(g.matches[0].replace(wb,xb),mb.test(f[0].type)&&b.parentNode||b))){if(f.splice(e,1),a=d.length&&n(f),!a)return ab.apply(c,d),c;break}}return C(a,j)(d,b,!I,c,mb.test(a)),c}var w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N="sizzle"+-new Date,O=a.document,P=0,Q=0,R=d(),S=d(),T=d(),U=!1,V=function(a,b){return a===b?(U=!0,0):0},W=typeof b,X=1<<31,Y={}.hasOwnProperty,Z=[],$=Z.pop,_=Z.push,ab=Z.push,bb=Z.slice,cb=Z.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},db="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",eb="[\\x20\\t\\r\\n\\f]",fb="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",gb=fb.replace("w","w#"),hb="\\["+eb+"*("+fb+")"+eb+"*(?:([*^$|!~]?=)"+eb+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+gb+")|)|)"+eb+"*\\]",ib=":("+fb+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+hb.replace(3,8)+")*)|.*)\\)|)",jb=new RegExp("^"+eb+"+|((?:^|[^\\\\])(?:\\\\.)*)"+eb+"+$","g"),kb=new RegExp("^"+eb+"*,"+eb+"*"),lb=new RegExp("^"+eb+"*([>+~]|"+eb+")"+eb+"*"),mb=new RegExp(eb+"*[+~]"),nb=new RegExp("="+eb+"*([^\\]'\"]*)"+eb+"*\\]","g"),ob=new RegExp(ib),pb=new RegExp("^"+gb+"$"),qb={ID:new RegExp("^#("+fb+")"),CLASS:new RegExp("^\\.("+fb+")"),TAG:new RegExp("^("+fb.replace("w","w*")+")"),ATTR:new RegExp("^"+hb),PSEUDO:new RegExp("^"+ib),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+eb+"*(even|odd|(([+-]|)(\\d*)n|)"+eb+"*(?:([+-]|)"+eb+"*(\\d+)|))"+eb+"*\\)|)","i"),bool:new RegExp("^(?:"+db+")$","i"),needsContext:new RegExp("^"+eb+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+eb+"*((?:-\\d)?\\d*)"+eb+"*\\)|)(?=[^-]|$)","i")},rb=/^[^{]+\{\s*\[native \w/,sb=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tb=/^(?:input|select|textarea|button)$/i,ub=/^h\d$/i,vb=/'|\\/g,wb=new RegExp("\\\\([\\da-f]{1,6}"+eb+"?|("+eb+")|.)","ig"),xb=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)};try{ab.apply(Z=bb.call(O.childNodes),O.childNodes),Z[O.childNodes.length].nodeType}catch(yb){ab={apply:Z.length?function(a,b){_.apply(a,bb.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}B=c.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},x=c.support={},F=c.setDocument=function(a){var b=a?a.ownerDocument||a:O,c=b.defaultView;return b!==G&&9===b.nodeType&&b.documentElement?(G=b,H=b.documentElement,I=!B(b),c&&c.attachEvent&&c!==c.top&&c.attachEvent("onbeforeunload",function(){F()}),x.attributes=f(function(a){return a.className="i",!a.getAttribute("className")}),x.getElementsByTagName=f(function(a){return a.appendChild(b.createComment("")),!a.getElementsByTagName("*").length}),x.getElementsByClassName=f(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),x.getById=f(function(a){return H.appendChild(a).id=N,!b.getElementsByName||!b.getElementsByName(N).length}),x.getById?(z.find.ID=function(a,b){if(typeof b.getElementById!==W&&I){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},z.filter.ID=function(a){var b=a.replace(wb,xb);return function(a){return a.getAttribute("id")===b}}):(delete z.find.ID,z.filter.ID=function(a){var b=a.replace(wb,xb);return function(a){var c=typeof a.getAttributeNode!==W&&a.getAttributeNode("id");return c&&c.value===b}}),z.find.TAG=x.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==W?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},z.find.CLASS=x.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==W&&I?b.getElementsByClassName(a):void 0},K=[],J=[],(x.qsa=rb.test(b.querySelectorAll))&&(f(function(a){a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||J.push("\\["+eb+"*(?:value|"+db+")"),a.querySelectorAll(":checked").length||J.push(":checked")}),f(function(a){var c=b.createElement("input");c.setAttribute("type","hidden"),a.appendChild(c).setAttribute("t",""),a.querySelectorAll("[t^='']").length&&J.push("[*^$]="+eb+"*(?:''|\"\")"),a.querySelectorAll(":enabled").length||J.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),J.push(",.*:")})),(x.matchesSelector=rb.test(L=H.webkitMatchesSelector||H.mozMatchesSelector||H.oMatchesSelector||H.msMatchesSelector))&&f(function(a){x.disconnectedMatch=L.call(a,"div"),L.call(a,"[s!='']:x"),K.push("!=",ib)
}),J=J.length&&new RegExp(J.join("|")),K=K.length&&new RegExp(K.join("|")),M=rb.test(H.contains)||H.compareDocumentPosition?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},V=H.compareDocumentPosition?function(a,c){if(a===c)return U=!0,0;var d=c.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(c);return d?1&d||!x.sortDetached&&c.compareDocumentPosition(a)===d?a===b||M(O,a)?-1:c===b||M(O,c)?1:E?cb.call(E,a)-cb.call(E,c):0:4&d?-1:1:a.compareDocumentPosition?-1:1}:function(a,c){var d,e=0,f=a.parentNode,g=c.parentNode,i=[a],j=[c];if(a===c)return U=!0,0;if(!f||!g)return a===b?-1:c===b?1:f?-1:g?1:E?cb.call(E,a)-cb.call(E,c):0;if(f===g)return h(a,c);for(d=a;d=d.parentNode;)i.unshift(d);for(d=c;d=d.parentNode;)j.unshift(d);for(;i[e]===j[e];)e++;return e?h(i[e],j[e]):i[e]===O?-1:j[e]===O?1:0},b):G},c.matches=function(a,b){return c(a,null,null,b)},c.matchesSelector=function(a,b){if((a.ownerDocument||a)!==G&&F(a),b=b.replace(nb,"='$1']"),!(!x.matchesSelector||!I||K&&K.test(b)||J&&J.test(b)))try{var d=L.call(a,b);if(d||x.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return c(b,G,null,[a]).length>0},c.contains=function(a,b){return(a.ownerDocument||a)!==G&&F(a),M(a,b)},c.attr=function(a,c){(a.ownerDocument||a)!==G&&F(a);var d=z.attrHandle[c.toLowerCase()],e=d&&Y.call(z.attrHandle,c.toLowerCase())?d(a,c,!I):b;return e===b?x.attributes||!I?a.getAttribute(c):(e=a.getAttributeNode(c))&&e.specified?e.value:null:e},c.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},c.uniqueSort=function(a){var b,c=[],d=0,e=0;if(U=!x.detectDuplicates,E=!x.sortStable&&a.slice(0),a.sort(V),U){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return a},A=c.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=A(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d];d++)c+=A(b);return c},z=c.selectors={cacheLength:50,createPseudo:e,match:qb,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(wb,xb),a[3]=(a[4]||a[5]||"").replace(wb,xb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||c.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&c.error(a[0]),a},PSEUDO:function(a){var c,d=!a[5]&&a[2];return qb.CHILD.test(a[0])?null:(a[3]&&a[4]!==b?a[2]=a[4]:d&&ob.test(d)&&(c=m(d,!0))&&(c=d.indexOf(")",d.length-c)-d.length)&&(a[0]=a[0].slice(0,c),a[2]=d.slice(0,c)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(wb,xb).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=R[a+" "];return b||(b=new RegExp("(^|"+eb+")"+a+"("+eb+"|$)"))&&R(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==W&&a.getAttribute("class")||"")})},ATTR:function(a,b,d){return function(e){var f=c.attr(e,a);return null==f?"!="===b:b?(f+="","="===b?f===d:"!="===b?f!==d:"^="===b?d&&0===f.indexOf(d):"*="===b?d&&f.indexOf(d)>-1:"$="===b?d&&f.slice(-d.length)===d:"~="===b?(" "+f+" ").indexOf(d)>-1:"|="===b?f===d||f.slice(0,d.length+1)===d+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(k=q[N]||(q[N]={}),j=k[a]||[],n=j[0]===P&&j[1],m=j[0]===P&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[P,n,m];break}}else if(s&&(j=(b[N]||(b[N]={}))[a])&&j[0]===P)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[N]||(l[N]={}))[a]=[P,m]),l!==b)););return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var d,f=z.pseudos[a]||z.setFilters[a.toLowerCase()]||c.error("unsupported pseudo: "+a);return f[N]?f(b):f.length>1?(d=[a,a,"",b],z.setFilters.hasOwnProperty(a.toLowerCase())?e(function(a,c){for(var d,e=f(a,b),g=e.length;g--;)d=cb.call(a,e[g]),a[d]=!(c[d]=e[g])}):function(a){return f(a,0,d)}):f}},pseudos:{not:e(function(a){var b=[],c=[],d=C(a.replace(jb,"$1"));return d[N]?e(function(a,b,c,e){for(var f,g=d(a,null,e,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:e(function(a){return function(b){return c(a,b).length>0}}),contains:e(function(a){return function(b){return(b.textContent||b.innerText||A(b)).indexOf(a)>-1}}),lang:e(function(a){return pb.test(a||"")||c.error("unsupported lang: "+a),a=a.replace(wb,xb).toLowerCase(),function(b){var c;do if(c=I?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===H},focus:function(a){return a===G.activeElement&&(!G.hasFocus||G.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeName>"@"||3===a.nodeType||4===a.nodeType)return!1;return!0},parent:function(a){return!z.pseudos.empty(a)},header:function(a){return ub.test(a.nodeName)},input:function(a){return tb.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||b.toLowerCase()===a.type)},first:k(function(){return[0]}),last:k(function(a,b){return[b-1]}),eq:k(function(a,b,c){return[0>c?c+b:c]}),even:k(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:k(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:k(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:k(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},z.pseudos.nth=z.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})z.pseudos[w]=i(w);for(w in{submit:!0,reset:!0})z.pseudos[w]=j(w);l.prototype=z.filters=z.pseudos,z.setFilters=new l,C=c.compile=function(a,b){var c,d=[],e=[],f=T[a+" "];if(!f){for(b||(b=m(a)),c=b.length;c--;)f=s(b[c]),f[N]?d.push(f):e.push(f);f=T(a,t(e,d))}return f},x.sortStable=N.split("").sort(V).join("")===N,x.detectDuplicates=U,F(),x.sortDetached=f(function(a){return 1&a.compareDocumentPosition(G.createElement("div"))}),f(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||g("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),x.attributes&&f(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||g("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),f(function(a){return null==a.getAttribute("disabled")})||g(db,function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&d.specified?d.value:a[b]===!0?b.toLowerCase():null}),jQuery.find=c,jQuery.expr=c.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.unique=c.uniqueSort,jQuery.text=c.getText,jQuery.isXMLDoc=c.isXML,jQuery.contains=c.contains}(a);var nb={};jQuery.Callbacks=function(a){a="string"==typeof a?nb[a]||d(a):jQuery.extend({},a);var c,e,f,g,h,i,j=[],k=!a.once&&[],l=function(b){for(c=a.memory&&b,e=!0,i=g||0,g=0,h=j.length,f=!0;j&&h>i;i++)if(j[i].apply(b[0],b[1])===!1&&a.stopOnFalse){c=!1;break}f=!1,j&&(k?k.length&&l(k.shift()):c?j=[]:m.disable())},m={add:function(){if(j){var b=j.length;!function d(b){jQuery.each(b,function(b,c){var e=jQuery.type(c);"function"===e?a.unique&&m.has(c)||j.push(c):c&&c.length&&"string"!==e&&d(c)})}(arguments),f?h=j.length:c&&(g=b,l(c))}return this},remove:function(){return j&&jQuery.each(arguments,function(a,b){for(var c;(c=jQuery.inArray(b,j,c))>-1;)j.splice(c,1),f&&(h>=c&&h--,i>=c&&i--)}),this},has:function(a){return a?jQuery.inArray(a,j)>-1:!(!j||!j.length)},empty:function(){return j=[],h=0,this},disable:function(){return j=k=c=b,this},disabled:function(){return!j},lock:function(){return k=b,c||m.disable(),this},locked:function(){return!k},fireWith:function(a,b){return!j||e&&!k||(b=b||[],b=[a,b.slice?b.slice():b],f?k.push(b):l(b)),this},fire:function(){return m.fireWith(this,arguments),this},fired:function(){return!!e}};return m},jQuery.extend({Deferred:function(a){var b=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return jQuery.Deferred(function(c){jQuery.each(b,function(b,f){var g=f[0],h=jQuery.isFunction(a[b])&&a[b];e[f[1]](function(){var a=h&&h.apply(this,arguments);a&&jQuery.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[g+"With"](this===d?c.promise():this,h?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?jQuery.extend(a,d):d}},e={};return d.pipe=d.then,jQuery.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=ab.call(arguments),g=f.length,h=1!==g||a&&jQuery.isFunction(a.promise)?g:0,i=1===h?a:jQuery.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?ab.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=new Array(g),c=new Array(g),d=new Array(g);g>e;e++)f[e]&&jQuery.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}}),jQuery.support=function(b){var c=T.createElement("input"),d=T.createDocumentFragment(),e=T.createElement("div"),f=T.createElement("select"),g=f.appendChild(T.createElement("option"));return c.type?(c.type="checkbox",b.checkOn=""!==c.value,b.optSelected=g.selected,b.reliableMarginRight=!0,b.boxSizingReliable=!0,b.pixelPosition=!1,c.checked=!0,b.noCloneChecked=c.cloneNode(!0).checked,f.disabled=!0,b.optDisabled=!g.disabled,c=T.createElement("input"),c.value="t",c.type="radio",b.radioValue="t"===c.value,c.setAttribute("checked","t"),c.setAttribute("name","t"),d.appendChild(c),b.checkClone=d.cloneNode(!0).cloneNode(!0).lastChild.checked,b.focusinBubbles="onfocusin"in a,e.style.backgroundClip="content-box",e.cloneNode(!0).style.backgroundClip="",b.clearCloneStyle="content-box"===e.style.backgroundClip,jQuery(function(){var c,d,f="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",g=T.getElementsByTagName("body")[0];g&&(c=T.createElement("div"),c.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",g.appendChild(c).appendChild(e),e.innerHTML="",e.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",jQuery.swap(g,null!=g.style.zoom?{zoom:1}:{},function(){b.boxSizing=4===e.offsetWidth}),a.getComputedStyle&&(b.pixelPosition="1%"!==(a.getComputedStyle(e,null)||{}).top,b.boxSizingReliable="4px"===(a.getComputedStyle(e,null)||{width:"4px"}).width,d=e.appendChild(T.createElement("div")),d.style.cssText=e.style.cssText=f,d.style.marginRight=d.style.width="0",e.style.width="1px",b.reliableMarginRight=!parseFloat((a.getComputedStyle(d,null)||{}).marginRight)),g.removeChild(c))}),b):b}({});var ob,pb,qb=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rb=/([A-Z])/g;e.uid=1,e.accepts=function(a){return a.nodeType?1===a.nodeType||9===a.nodeType:!0},e.prototype={key:function(a){if(!e.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=e.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,jQuery.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(jQuery.isEmptyObject(f))jQuery.extend(this.cache[e],b);else for(d in b)f[d]=b[d];return f},get:function(a,c){var d=this.cache[this.key(a)];return c===b?d:d[c]},access:function(a,c,d){var e;return c===b||c&&"string"==typeof c&&d===b?(e=this.get(a,c),e!==b?e:this.get(a,jQuery.camelCase(c))):(this.set(a,c,d),d!==b?d:c)},remove:function(a,c){var d,e,f,g=this.key(a),h=this.cache[g];if(c===b)this.cache[g]={};else{jQuery.isArray(c)?e=c.concat(c.map(jQuery.camelCase)):(f=jQuery.camelCase(c),c in h?e=[c,f]:(e=f,e=e in h?[e]:e.match(gb)||[])),d=e.length;for(;d--;)delete h[e[d]]}},hasData:function(a){return!jQuery.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){a[this.expando]&&delete this.cache[a[this.expando]]}},ob=new e,pb=new e,jQuery.extend({acceptData:e.accepts,hasData:function(a){return ob.hasData(a)||pb.hasData(a)},data:function(a,b,c){return ob.access(a,b,c)},removeData:function(a,b){ob.remove(a,b)},_data:function(a,b,c){return pb.access(a,b,c)},_removeData:function(a,b){pb.remove(a,b)}}),jQuery.fn.extend({data:function(a,c){var d,e,g=this[0],h=0,i=null;if(a===b){if(this.length&&(i=ob.get(g),1===g.nodeType&&!pb.get(g,"hasDataAttrs"))){for(d=g.attributes;h<d.length;h++)e=d[h].name,0===e.indexOf("data-")&&(e=jQuery.camelCase(e.slice(5)),f(g,e,i[e]));pb.set(g,"hasDataAttrs",!0)}return i}return"object"==typeof a?this.each(function(){ob.set(this,a)}):jQuery.access(this,function(c){var d,e=jQuery.camelCase(a);if(g&&c===b){if(d=ob.get(g,a),d!==b)return d;if(d=ob.get(g,e),d!==b)return d;if(d=f(g,e,b),d!==b)return d}else this.each(function(){var d=ob.get(this,e);ob.set(this,e,c),-1!==a.indexOf("-")&&d!==b&&ob.set(this,a,c)})},null,c,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){ob.remove(this,a)})}}),jQuery.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=pb.get(a,b),c&&(!d||jQuery.isArray(c)?d=pb.access(a,b,jQuery.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=jQuery.queue(a,b),d=c.length,e=c.shift(),f=jQuery._queueHooks(a,b),g=function(){jQuery.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return pb.get(a,c)||pb.access(a,c,{empty:jQuery.Callbacks("once memory").add(function(){pb.remove(a,[b+"queue",c])})})}}),jQuery.fn.extend({queue:function(a,c){var d=2;return"string"!=typeof a&&(c=a,a="fx",d--),arguments.length<d?jQuery.queue(this[0],a):c===b?this:this.each(function(){var b=jQuery.queue(this,a,c);jQuery._queueHooks(this,a),"fx"===a&&"inprogress"!==b[0]&&jQuery.dequeue(this,a)})},dequeue:function(a){return this.each(function(){jQuery.dequeue(this,a)})},delay:function(a,b){return a=jQuery.fx?jQuery.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=jQuery.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};for("string"!=typeof a&&(c=a,a=b),a=a||"fx";h--;)d=pb.get(g[h],a+"queueHooks"),d&&d.empty&&(e++,d.empty.add(i));return i(),f.promise(c)}});var sb,tb,ub=/[\t\r\n\f]/g,vb=/\r/g,wb=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({attr:function(a,b){return jQuery.access(this,jQuery.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){jQuery.removeAttr(this,a)})},prop:function(a,b){return jQuery.access(this,jQuery.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[jQuery.propFix[a]||a]})},addClass:function(a){var b,c,d,e,f,g=0,h=this.length,i="string"==typeof a&&a;if(jQuery.isFunction(a))return this.each(function(b){jQuery(this).addClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(gb)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ub," "):" ")){for(f=0;e=b[f++];)d.indexOf(" "+e+" ")<0&&(d+=e+" ");c.className=jQuery.trim(d)}return this},removeClass:function(a){var b,c,d,e,f,g=0,h=this.length,i=0===arguments.length||"string"==typeof a&&a;if(jQuery.isFunction(a))return this.each(function(b){jQuery(this).removeClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(gb)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ub," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");c.className=a?jQuery.trim(d):""}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(jQuery.isFunction(a)?function(c){jQuery(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c)for(var b,d=0,e=jQuery(this),f=a.match(gb)||[];b=f[d++];)e.hasClass(b)?e.removeClass(b):e.addClass(b);else(c===R||"boolean"===c)&&(this.className&&pb.set(this,"__className__",this.className),this.className=this.className||a===!1?"":pb.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(ub," ").indexOf(b)>=0)return!0;return!1},val:function(a){var c,d,e,f=this[0];{if(arguments.length)return e=jQuery.isFunction(a),this.each(function(d){var f;1===this.nodeType&&(f=e?a.call(this,d,jQuery(this).val()):a,null==f?f="":"number"==typeof f?f+="":jQuery.isArray(f)&&(f=jQuery.map(f,function(a){return null==a?"":a+""})),c=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()],c&&"set"in c&&c.set(this,f,"value")!==b||(this.value=f))});if(f)return c=jQuery.valHooks[f.type]||jQuery.valHooks[f.nodeName.toLowerCase()],c&&"get"in c&&(d=c.get(f,"value"))!==b?d:(d=f.value,"string"==typeof d?d.replace(vb,""):null==d?"":d)}}}),jQuery.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(jQuery.support.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&jQuery.nodeName(c.parentNode,"optgroup"))){if(b=jQuery(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=jQuery.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=jQuery.inArray(jQuery(d).val(),f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}},attr:function(a,c,d){var e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return typeof a.getAttribute===R?jQuery.prop(a,c,d):(1===g&&jQuery.isXMLDoc(a)||(c=c.toLowerCase(),e=jQuery.attrHooks[c]||(jQuery.expr.match.bool.test(c)?tb:sb)),d===b?e&&"get"in e&&null!==(f=e.get(a,c))?f:(f=jQuery.find.attr(a,c),null==f?b:f):null!==d?e&&"set"in e&&(f=e.set(a,d,c))!==b?f:(a.setAttribute(c,d+""),d):void jQuery.removeAttr(a,c))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(gb);if(f&&1===a.nodeType)for(;c=f[e++];)d=jQuery.propFix[c]||c,jQuery.expr.match.bool.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!jQuery.support.radioValue&&"radio"===b&&jQuery.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(a&&3!==h&&8!==h&&2!==h)return g=1!==h||!jQuery.isXMLDoc(a),g&&(c=jQuery.propFix[c]||c,f=jQuery.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&null!==(e=f.get(a,c))?e:a[c]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||wb.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),tb={set:function(a,b,c){return b===!1?jQuery.removeAttr(a,c):a.setAttribute(c,c),c}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(a,c){var d=jQuery.expr.attrHandle[c]||jQuery.find.attr;jQuery.expr.attrHandle[c]=function(a,c,e){var f=jQuery.expr.attrHandle[c],g=e?b:(jQuery.expr.attrHandle[c]=b)!=d(a,c,e)?c.toLowerCase():null;return jQuery.expr.attrHandle[c]=f,g}}),jQuery.support.optSelected||(jQuery.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(a,b){return jQuery.isArray(b)?a.checked=jQuery.inArray(jQuery(a).val(),b)>=0:void 0}},jQuery.support.checkOn||(jQuery.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var xb=/^key/,yb=/^(?:mouse|contextmenu)|click/,zb=/^(?:focusinfocus|focusoutblur)$/,Ab=/^([^.]*)(?:\.(.+)|)$/;jQuery.event={global:{},add:function(a,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r=pb.get(a);if(r){for(d.handler&&(g=d,d=g.handler,f=g.selector),d.guid||(d.guid=jQuery.guid++),(j=r.events)||(j=r.events={}),(h=r.handle)||(h=r.handle=function(a){return typeof jQuery===R||a&&jQuery.event.triggered===a.type?b:jQuery.event.dispatch.apply(h.elem,arguments)},h.elem=a),c=(c||"").match(gb)||[""],k=c.length;k--;)i=Ab.exec(c[k])||[],o=q=i[1],p=(i[2]||"").split(".").sort(),o&&(m=jQuery.event.special[o]||{},o=(f?m.delegateType:m.bindType)||o,m=jQuery.event.special[o]||{},l=jQuery.extend({type:o,origType:q,data:e,handler:d,guid:d.guid,selector:f,needsContext:f&&jQuery.expr.match.needsContext.test(f),namespace:p.join(".")},g),(n=j[o])||(n=j[o]=[],n.delegateCount=0,m.setup&&m.setup.call(a,e,p,h)!==!1||a.addEventListener&&a.addEventListener(o,h,!1)),m.add&&(m.add.call(a,l),l.handler.guid||(l.handler.guid=d.guid)),f?n.splice(n.delegateCount++,0,l):n.push(l),jQuery.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=pb.hasData(a)&&pb.get(a);if(q&&(i=q.events)){for(b=(b||"").match(gb)||[""],j=b.length;j--;)if(h=Ab.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=jQuery.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;f--;)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||jQuery.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)jQuery.event.remove(a,n+b[j],c,d,!0);jQuery.isEmptyObject(i)&&(delete q.handle,pb.remove(a,"events"))}},trigger:function(c,d,e,f){var g,h,i,j,k,l,m,n=[e||T],o=db.call(c,"type")?c.type:c,p=db.call(c,"namespace")?c.namespace.split("."):[];if(h=i=e=e||T,3!==e.nodeType&&8!==e.nodeType&&!zb.test(o+jQuery.event.triggered)&&(o.indexOf(".")>=0&&(p=o.split("."),o=p.shift(),p.sort()),k=o.indexOf(":")<0&&"on"+o,c=c[jQuery.expando]?c:new jQuery.Event(o,"object"==typeof c&&c),c.isTrigger=f?2:3,c.namespace=p.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,c.result=b,c.target||(c.target=e),d=null==d?[c]:jQuery.makeArray(d,[c]),m=jQuery.event.special[o]||{},f||!m.trigger||m.trigger.apply(e,d)!==!1)){if(!f&&!m.noBubble&&!jQuery.isWindow(e)){for(j=m.delegateType||o,zb.test(j+o)||(h=h.parentNode);h;h=h.parentNode)n.push(h),i=h;i===(e.ownerDocument||T)&&n.push(i.defaultView||i.parentWindow||a)}for(g=0;(h=n[g++])&&!c.isPropagationStopped();)c.type=g>1?j:m.bindType||o,l=(pb.get(h,"events")||{})[c.type]&&pb.get(h,"handle"),l&&l.apply(h,d),l=k&&h[k],l&&jQuery.acceptData(h)&&l.apply&&l.apply(h,d)===!1&&c.preventDefault();return c.type=o,f||c.isDefaultPrevented()||m._default&&m._default.apply(n.pop(),d)!==!1||!jQuery.acceptData(e)||k&&jQuery.isFunction(e[o])&&!jQuery.isWindow(e)&&(i=e[k],i&&(e[k]=null),jQuery.event.triggered=o,e[o](),jQuery.event.triggered=b,i&&(e[k]=i)),c.result}},dispatch:function(a){a=jQuery.event.fix(a);var c,d,e,f,g,h=[],i=ab.call(arguments),j=(pb.get(this,"events")||{})[a.type]||[],k=jQuery.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){for(h=jQuery.event.handlers.call(this,a,j),c=0;(f=h[c++])&&!a.isPropagationStopped();)for(a.currentTarget=f.elem,d=0;(g=f.handlers[d++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(g.namespace))&&(a.handleObj=g,a.data=g.data,e=((jQuery.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),e!==b&&(a.result=e)===!1&&(a.preventDefault(),a.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,c){var d,e,f,g,h=[],i=c.delegateCount,j=a.target;if(i&&j.nodeType&&(!a.button||"click"!==a.type))for(;j!==this;j=j.parentNode||this)if(j.disabled!==!0||"click"!==a.type){for(e=[],d=0;i>d;d++)g=c[d],f=g.selector+" ",e[f]===b&&(e[f]=g.needsContext?jQuery(f,this).index(j)>=0:jQuery.find(f,this,null,[j]).length),e[f]&&e.push(g);e.length&&h.push({elem:j,handlers:e})}return i<c.length&&h.push({elem:this,handlers:c.slice(i)}),h},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f,g=c.button;return null==a.pageX&&null!=c.clientX&&(d=a.target.ownerDocument||T,e=d.documentElement,f=d.body,a.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),a.which||g===b||(a.which=1&g?1:2&g?3:4&g?2:0),a}},fix:function(a){if(a[jQuery.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=yb.test(e)?this.mouseHooks:xb.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new jQuery.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return a.target||(a.target=T),3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==i()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===i()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&jQuery.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return jQuery.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){a.result!==b&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=jQuery.extend(new jQuery.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?jQuery.event.trigger(e,null,b):jQuery.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},jQuery.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},jQuery.Event=function(a,b){return this instanceof jQuery.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.getPreventDefault&&a.getPreventDefault()?g:h):this.type=a,b&&jQuery.extend(this,b),this.timeStamp=a&&a.timeStamp||jQuery.now(),void(this[jQuery.expando]=!0)):new jQuery.Event(a,b)},jQuery.Event.prototype={isDefaultPrevented:h,isPropagationStopped:h,isImmediatePropagationStopped:h,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=g,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=g,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=g,this.stopPropagation()}},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){jQuery.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!jQuery.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),jQuery.support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){jQuery.event.simulate(b,a.target,jQuery.event.fix(a),!0)};jQuery.event.special[b]={setup:function(){0===c++&&T.addEventListener(a,d,!0)},teardown:function(){0===--c&&T.removeEventListener(a,d,!0)}}}),jQuery.fn.extend({on:function(a,c,d,e,f){var g,i;if("object"==typeof a){"string"!=typeof c&&(d=d||c,c=b);for(i in a)this.on(i,c,d,a[i],f);return this}if(null==d&&null==e?(e=c,d=c=b):null==e&&("string"==typeof c?(e=d,d=b):(e=d,d=c,c=b)),e===!1)e=h;else if(!e)return this;return 1===f&&(g=e,e=function(a){return jQuery().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=jQuery.guid++)),this.each(function(){jQuery.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,f;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,jQuery(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof a){for(f in a)this.off(f,c,a[f]);return this}return(c===!1||"function"==typeof c)&&(d=c,c=b),d===!1&&(d=h),this.each(function(){jQuery.event.remove(this,a,d,c)})},trigger:function(a,b){return this.each(function(){jQuery.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?jQuery.event.trigger(a,b,c,!0):void 0}});var Bb=/^.[^:#\[\.,]*$/,Cb=/^(?:parents|prev(?:Until|All))/,Db=jQuery.expr.match.needsContext,Eb={children:!0,contents:!0,next:!0,prev:!0};jQuery.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(jQuery(a).filter(function(){for(b=0;e>b;b++)if(jQuery.contains(d[b],this))return!0}));for(b=0;e>b;b++)jQuery.find(a,d[b],c);return c=this.pushStack(e>1?jQuery.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},has:function(a){var b=jQuery(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(jQuery.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(k(this,a||[],!0))},filter:function(a){return this.pushStack(k(this,a||[],!1))},is:function(a){return!!k(this,"string"==typeof a&&Db.test(a)?jQuery(a):a||[],!1).length},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=Db.test(a)||"string"!=typeof a?jQuery(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&jQuery.find.matchesSelector(c,a))){c=f.push(c);break}return this.pushStack(f.length>1?jQuery.unique(f):f)},index:function(a){return a?"string"==typeof a?bb.call(jQuery(a),this[0]):bb.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){var c="string"==typeof a?jQuery(a,b):jQuery.makeArray(a&&a.nodeType?[a]:a),d=jQuery.merge(this.get(),c);
return this.pushStack(jQuery.unique(d))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),jQuery.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return jQuery.dir(a,"parentNode")},parentsUntil:function(a,b,c){return jQuery.dir(a,"parentNode",c)},next:function(a){return j(a,"nextSibling")},prev:function(a){return j(a,"previousSibling")},nextAll:function(a){return jQuery.dir(a,"nextSibling")},prevAll:function(a){return jQuery.dir(a,"previousSibling")},nextUntil:function(a,b,c){return jQuery.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return jQuery.dir(a,"previousSibling",c)},siblings:function(a){return jQuery.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return jQuery.sibling(a.firstChild)},contents:function(a){return a.contentDocument||jQuery.merge([],a.childNodes)}},function(a,b){jQuery.fn[a]=function(c,d){var e=jQuery.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=jQuery.filter(d,e)),this.length>1&&(Eb[a]||jQuery.unique(e),Cb.test(a)&&e.reverse()),this.pushStack(e)}}),jQuery.extend({filter:function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?jQuery.find.matchesSelector(d,a)?[d]:[]:jQuery.find.matches(a,jQuery.grep(b,function(a){return 1===a.nodeType}))},dir:function(a,c,d){for(var e=[],f=d!==b;(a=a[c])&&9!==a.nodeType;)if(1===a.nodeType){if(f&&jQuery(a).is(d))break;e.push(a)}return e},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var Fb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Gb=/<([\w:]+)/,Hb=/<|&#?\w+;/,Ib=/<(?:script|style|link)/i,Jb=/^(?:checkbox|radio)$/i,Kb=/checked\s*(?:[^=]|=\s*.checked.)/i,Lb=/^$|\/(?:java|ecma)script/i,Mb=/^true\/(.*)/,Nb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ob={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ob.optgroup=Ob.option,Ob.tbody=Ob.tfoot=Ob.colgroup=Ob.caption=Ob.thead,Ob.th=Ob.td,jQuery.fn.extend({text:function(a){return jQuery.access(this,function(a){return a===b?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||T).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=l(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=l(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?jQuery.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||jQuery.cleanData(q(c)),c.parentNode&&(b&&jQuery.contains(c.ownerDocument,c)&&o(q(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(jQuery.cleanData(q(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return jQuery.clone(this,a,b)})},html:function(a){return jQuery.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b&&1===c.nodeType)return c.innerHTML;if("string"==typeof a&&!Ib.test(a)&&!Ob[(Gb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Fb,"<$1></$2>");try{for(;e>d;d++)c=this[d]||{},1===c.nodeType&&(jQuery.cleanData(q(c,!1)),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=jQuery.map(this,function(a){return[a.nextSibling,a.parentNode]}),b=0;return this.domManip(arguments,function(c){var d=a[b++],e=a[b++];e&&(d&&d.parentNode!==e&&(d=this.nextSibling),jQuery(this).remove(),e.insertBefore(c,d))},!0),b?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b,c){a=$.apply([],a);var d,e,f,g,h,i,j=0,k=this.length,l=this,o=k-1,p=a[0],r=jQuery.isFunction(p);if(r||!(1>=k||"string"!=typeof p||jQuery.support.checkClone)&&Kb.test(p))return this.each(function(d){var e=l.eq(d);r&&(a[0]=p.call(this,d,e.html())),e.domManip(a,b,c)});if(k&&(d=jQuery.buildFragment(a,this[0].ownerDocument,!1,!c&&this),e=d.firstChild,1===d.childNodes.length&&(d=e),e)){for(f=jQuery.map(q(d,"script"),m),g=f.length;k>j;j++)h=d,j!==o&&(h=jQuery.clone(h,!0,!0),g&&jQuery.merge(f,q(h,"script"))),b.call(this[j],h,j);if(g)for(i=f[f.length-1].ownerDocument,jQuery.map(f,n),j=0;g>j;j++)h=f[j],Lb.test(h.type||"")&&!pb.access(h,"globalEval")&&jQuery.contains(i,h)&&(h.src?jQuery._evalUrl(h.src):jQuery.globalEval(h.textContent.replace(Nb,"")))}return this}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){jQuery.fn[a]=function(a){for(var c,d=[],e=jQuery(a),f=e.length-1,g=0;f>=g;g++)c=g===f?this:this.clone(!0),jQuery(e[g])[b](c),_.apply(d,c.get());return this.pushStack(d)}}),jQuery.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=jQuery.contains(a.ownerDocument,a);if(!(jQuery.support.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||jQuery.isXMLDoc(a)))for(g=q(h),f=q(a),d=0,e=f.length;e>d;d++)r(f[d],g[d]);if(b)if(c)for(f=f||q(a),g=g||q(h),d=0,e=f.length;e>d;d++)p(f[d],g[d]);else p(a,h);return g=q(h,"script"),g.length>0&&o(g,!i&&q(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=0,l=a.length,m=b.createDocumentFragment(),n=[];l>k;k++)if(e=a[k],e||0===e)if("object"===jQuery.type(e))jQuery.merge(n,e.nodeType?[e]:e);else if(Hb.test(e)){for(f=f||m.appendChild(b.createElement("div")),g=(Gb.exec(e)||["",""])[1].toLowerCase(),h=Ob[g]||Ob._default,f.innerHTML=h[1]+e.replace(Fb,"<$1></$2>")+h[2],j=h[0];j--;)f=f.lastChild;jQuery.merge(n,f.childNodes),f=m.firstChild,f.textContent=""}else n.push(b.createTextNode(e));for(m.textContent="",k=0;e=n[k++];)if((!d||-1===jQuery.inArray(e,d))&&(i=jQuery.contains(e.ownerDocument,e),f=q(m.appendChild(e),"script"),i&&o(f),c))for(j=0;e=f[j++];)Lb.test(e.type||"")&&c.push(e);return m},cleanData:function(a){for(var c,d,f,g,h,i,j=jQuery.event.special,k=0;(d=a[k])!==b;k++){if(e.accepts(d)&&(h=d[pb.expando],h&&(c=pb.cache[h]))){if(f=Object.keys(c.events||{}),f.length)for(i=0;(g=f[i])!==b;i++)j[g]?jQuery.event.remove(d,g):jQuery.removeEvent(d,g,c.handle);pb.cache[h]&&delete pb.cache[h]}delete ob.cache[d[ob.expando]]}},_evalUrl:function(a){return jQuery.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),jQuery.fn.extend({wrapAll:function(a){var b;return jQuery.isFunction(a)?this.each(function(b){jQuery(this).wrapAll(a.call(this,b))}):(this[0]&&(b=jQuery(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return this.each(jQuery.isFunction(a)?function(b){jQuery(this).wrapInner(a.call(this,b))}:function(){var b=jQuery(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=jQuery.isFunction(a);return this.each(function(c){jQuery(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}});var Pb,Qb,Rb=/^(none|table(?!-c[ea]).+)/,Sb=/^margin/,Tb=new RegExp("^("+fb+")(.*)$","i"),Ub=new RegExp("^("+fb+")(?!px)[a-z%]+$","i"),Vb=new RegExp("^([+-])=("+fb+")","i"),Wb={BODY:"block"},Xb={position:"absolute",visibility:"hidden",display:"block"},Yb={letterSpacing:0,fontWeight:400},Zb=["Top","Right","Bottom","Left"],$b=["Webkit","O","Moz","ms"];jQuery.fn.extend({css:function(a,c){return jQuery.access(this,function(a,c,d){var e,f,g={},h=0;if(jQuery.isArray(c)){for(e=u(a),f=c.length;f>h;h++)g[c[h]]=jQuery.css(a,c[h],!1,e);return g}return d!==b?jQuery.style(a,c,d):jQuery.css(a,c)},a,c,arguments.length>1)},show:function(){return v(this,!0)},hide:function(){return v(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){t(this)?jQuery(this).show():jQuery(this).hide()})}}),jQuery.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Pb(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,c,d,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var f,g,h,i=jQuery.camelCase(c),j=a.style;return c=jQuery.cssProps[i]||(jQuery.cssProps[i]=s(j,i)),h=jQuery.cssHooks[c]||jQuery.cssHooks[i],d===b?h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:j[c]:(g=typeof d,"string"===g&&(f=Vb.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(jQuery.css(a,c)),g="number"),null==d||"number"===g&&isNaN(d)||("number"!==g||jQuery.cssNumber[i]||(d+="px"),jQuery.support.clearCloneStyle||""!==d||0!==c.indexOf("background")||(j[c]="inherit"),h&&"set"in h&&(d=h.set(a,d,e))===b||(j[c]=d)),void 0)}},css:function(a,c,d,e){var f,g,h,i=jQuery.camelCase(c);return c=jQuery.cssProps[i]||(jQuery.cssProps[i]=s(a.style,i)),h=jQuery.cssHooks[c]||jQuery.cssHooks[i],h&&"get"in h&&(f=h.get(a,!0,d)),f===b&&(f=Pb(a,c,e)),"normal"===f&&c in Yb&&(f=Yb[c]),""===d||d?(g=parseFloat(f),d===!0||jQuery.isNumeric(g)?g||0:f):f}}),Pb=function(a,c,d){var e,f,g,h=d||u(a),i=h?h.getPropertyValue(c)||h[c]:b,j=a.style;return h&&(""!==i||jQuery.contains(a.ownerDocument,a)||(i=jQuery.style(a,c)),Ub.test(i)&&Sb.test(c)&&(e=j.width,f=j.minWidth,g=j.maxWidth,j.minWidth=j.maxWidth=j.width=i,i=h.width,j.width=e,j.minWidth=f,j.maxWidth=g)),i},jQuery.each(["height","width"],function(a,b){jQuery.cssHooks[b]={get:function(a,c,d){return c?0===a.offsetWidth&&Rb.test(jQuery.css(a,"display"))?jQuery.swap(a,Xb,function(){return y(a,b,d)}):y(a,b,d):void 0},set:function(a,c,d){var e=d&&u(a);return w(a,c,d?x(a,b,d,jQuery.support.boxSizing&&"border-box"===jQuery.css(a,"boxSizing",!1,e),e):0)}}}),jQuery(function(){jQuery.support.reliableMarginRight||(jQuery.cssHooks.marginRight={get:function(a,b){return b?jQuery.swap(a,{display:"inline-block"},Pb,[a,"marginRight"]):void 0}}),!jQuery.support.pixelPosition&&jQuery.fn.position&&jQuery.each(["top","left"],function(a,b){jQuery.cssHooks[b]={get:function(a,c){return c?(c=Pb(a,b),Ub.test(c)?jQuery(a).position()[b]+"px":c):void 0}}})}),jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},jQuery.expr.filters.visible=function(a){return!jQuery.expr.filters.hidden(a)}),jQuery.each({margin:"",padding:"",border:"Width"},function(a,b){jQuery.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+Zb[d]+b]=f[d]||f[d-2]||f[0];return e}},Sb.test(a)||(jQuery.cssHooks[a+b].set=w)});var _b=/%20/g,ac=/\[\]$/,bc=/\r?\n/g,cc=/^(?:submit|button|image|reset|file)$/i,dc=/^(?:input|select|textarea|keygen)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=jQuery.prop(this,"elements");return a?jQuery.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!jQuery(this).is(":disabled")&&dc.test(this.nodeName)&&!cc.test(a)&&(this.checked||!Jb.test(a))}).map(function(a,b){var c=jQuery(this).val();return null==c?null:jQuery.isArray(c)?jQuery.map(c,function(a){return{name:b.name,value:a.replace(bc,"\r\n")}}):{name:b.name,value:c.replace(bc,"\r\n")}}).get()}}),jQuery.param=function(a,c){var d,e=[],f=function(a,b){b=jQuery.isFunction(b)?b():null==b?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(c===b&&(c=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional),jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,function(){f(this.name,this.value)});else for(d in a)B(d,a[d],c,f);return e.join("&").replace(_b,"+")},jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){jQuery.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),jQuery.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var ec,fc,gc=jQuery.now(),hc=/\?/,ic=/#.*$/,jc=/([?&])_=[^&]*/,kc=/^(.*?):[ \t]*([^\r\n]*)$/gm,lc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,mc=/^(?:GET|HEAD)$/,nc=/^\/\//,oc=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,pc=jQuery.fn.load,qc={},rc={},sc="*/".concat("*");try{fc=S.href}catch(tc){fc=T.createElement("a"),fc.href="",fc=fc.href}ec=oc.exec(fc.toLowerCase())||[],jQuery.fn.load=function(a,c,d){if("string"!=typeof a&&pc)return pc.apply(this,arguments);var e,f,g,h=this,i=a.indexOf(" ");return i>=0&&(e=a.slice(i),a=a.slice(0,i)),jQuery.isFunction(c)?(d=c,c=b):c&&"object"==typeof c&&(f="POST"),h.length>0&&jQuery.ajax({url:a,type:f,dataType:"html",data:c}).done(function(a){g=arguments,h.html(e?jQuery("<div>").append(jQuery.parseHTML(a)).find(e):a)}).complete(d&&function(a,b){h.each(d,g||[a.responseText,b,a])}),this},jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){jQuery.fn[b]=function(a){return this.on(b,a)}}),jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:fc,type:"GET",isLocal:lc.test(ec[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":sc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?E(E(a,jQuery.ajaxSettings),b):E(jQuery.ajaxSettings,a)},ajaxPrefilter:C(qc),ajaxTransport:C(rc),ajax:function(a,c){function d(a,c,d,h){var j,l,s,t,v,x=c;2!==u&&(u=2,i&&clearTimeout(i),e=b,g=h||"",w.readyState=a>0?4:0,j=a>=200&&300>a||304===a,d&&(t=F(m,w,d)),t=G(m,t,w,j),j?(m.ifModified&&(v=w.getResponseHeader("Last-Modified"),v&&(jQuery.lastModified[f]=v),v=w.getResponseHeader("etag"),v&&(jQuery.etag[f]=v)),204===a||"HEAD"===m.type?x="nocontent":304===a?x="notmodified":(x=t.state,l=t.data,s=t.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),w.status=a,w.statusText=(c||x)+"",j?p.resolveWith(n,[l,x,w]):p.rejectWith(n,[w,x,s]),w.statusCode(r),r=b,k&&o.trigger(j?"ajaxSuccess":"ajaxError",[w,m,j?l:s]),q.fireWith(n,[w,x]),k&&(o.trigger("ajaxComplete",[w,m]),--jQuery.active||jQuery.event.trigger("ajaxStop")))}"object"==typeof a&&(c=a,a=b),c=c||{};var e,f,g,h,i,j,k,l,m=jQuery.ajaxSetup({},c),n=m.context||m,o=m.context&&(n.nodeType||n.jquery)?jQuery(n):jQuery.event,p=jQuery.Deferred(),q=jQuery.Callbacks("once memory"),r=m.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,getResponseHeader:function(a){var b;if(2===u){if(!h)for(h={};b=kc.exec(g);)h[b[1].toLowerCase()]=b[2];b=h[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===u?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return u||(a=t[c]=t[c]||a,s[a]=b),this},overrideMimeType:function(a){return u||(m.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>u)for(b in a)r[b]=[r[b],a[b]];else w.always(a[w.status]);return this},abort:function(a){var b=a||v;return e&&e.abort(b),d(0,b),this}};if(p.promise(w).complete=q.add,w.success=w.done,w.error=w.fail,m.url=((a||m.url||fc)+"").replace(ic,"").replace(nc,ec[1]+"//"),m.type=c.method||c.type||m.method||m.type,m.dataTypes=jQuery.trim(m.dataType||"*").toLowerCase().match(gb)||[""],null==m.crossDomain&&(j=oc.exec(m.url.toLowerCase()),m.crossDomain=!(!j||j[1]===ec[1]&&j[2]===ec[2]&&(j[3]||("http:"===j[1]?"80":"443"))===(ec[3]||("http:"===ec[1]?"80":"443")))),m.data&&m.processData&&"string"!=typeof m.data&&(m.data=jQuery.param(m.data,m.traditional)),D(qc,m,c,w),2===u)return w;k=m.global,k&&0===jQuery.active++&&jQuery.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!mc.test(m.type),f=m.url,m.hasContent||(m.data&&(f=m.url+=(hc.test(f)?"&":"?")+m.data,delete m.data),m.cache===!1&&(m.url=jc.test(f)?f.replace(jc,"$1_="+gc++):f+(hc.test(f)?"&":"?")+"_="+gc++)),m.ifModified&&(jQuery.lastModified[f]&&w.setRequestHeader("If-Modified-Since",jQuery.lastModified[f]),jQuery.etag[f]&&w.setRequestHeader("If-None-Match",jQuery.etag[f])),(m.data&&m.hasContent&&m.contentType!==!1||c.contentType)&&w.setRequestHeader("Content-Type",m.contentType),w.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+sc+"; q=0.01":""):m.accepts["*"]);for(l in m.headers)w.setRequestHeader(l,m.headers[l]);if(m.beforeSend&&(m.beforeSend.call(n,w,m)===!1||2===u))return w.abort();v="abort";for(l in{success:1,error:1,complete:1})w[l](m[l]);if(e=D(rc,m,c,w)){w.readyState=1,k&&o.trigger("ajaxSend",[w,m]),m.async&&m.timeout>0&&(i=setTimeout(function(){w.abort("timeout")},m.timeout));try{u=1,e.send(s,d)}catch(x){if(!(2>u))throw x;d(-1,x)}}else d(-1,"No Transport");return w},getJSON:function(a,b,c){return jQuery.get(a,b,c,"json")},getScript:function(a,c){return jQuery.get(a,b,c,"script")}}),jQuery.each(["get","post"],function(a,c){jQuery[c]=function(a,d,e,f){return jQuery.isFunction(d)&&(f=f||e,e=d,d=b),jQuery.ajax({url:a,type:c,dataType:f,data:d,success:e})}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return jQuery.globalEval(a),a}}}),jQuery.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),jQuery.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=jQuery("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),T.head.appendChild(b[0])},abort:function(){c&&c()}}}});var uc=[],vc=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=uc.pop()||jQuery.expando+"_"+gc++;return this[a]=!0,a}}),jQuery.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,i=c.jsonp!==!1&&(vc.test(c.url)?"url":"string"==typeof c.data&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&vc.test(c.data)&&"data");return i||"jsonp"===c.dataTypes[0]?(f=c.jsonpCallback=jQuery.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,i?c[i]=c[i].replace(vc,"$1"+f):c.jsonp!==!1&&(c.url+=(hc.test(c.url)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return h||jQuery.error(f+" was not called"),h[0]},c.dataTypes[0]="json",g=a[f],a[f]=function(){h=arguments},e.always(function(){a[f]=g,c[f]&&(c.jsonpCallback=d.jsonpCallback,uc.push(f)),h&&jQuery.isFunction(g)&&g(h[0]),h=g=b}),"script"):void 0}),jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var wc=jQuery.ajaxSettings.xhr(),xc={0:200,1223:204},yc=0,zc={};a.ActiveXObject&&jQuery(a).on("unload",function(){for(var a in zc)zc[a]();zc=b}),jQuery.support.cors=!!wc&&"withCredentials"in wc,jQuery.support.ajax=wc=!!wc,jQuery.ajaxTransport(function(a){var c;return jQuery.support.cors||wc&&!a.crossDomain?{send:function(d,e){var f,g,h=a.xhr();if(h.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(f in a.xhrFields)h[f]=a.xhrFields[f];a.mimeType&&h.overrideMimeType&&h.overrideMimeType(a.mimeType),a.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest");for(f in d)h.setRequestHeader(f,d[f]);c=function(a){return function(){c&&(delete zc[g],c=h.onload=h.onerror=null,"abort"===a?h.abort():"error"===a?e(h.status||404,h.statusText):e(xc[h.status]||h.status,h.statusText,"string"==typeof h.responseText?{text:h.responseText}:b,h.getAllResponseHeaders()))}},h.onload=c(),h.onerror=c("error"),c=zc[g=yc++]=c("abort"),h.send(a.hasContent&&a.data||null)},abort:function(){c&&c()}}:void 0});var Ac,Bc,Cc=/^(?:toggle|show|hide)$/,Dc=new RegExp("^(?:([+-])=|)("+fb+")([a-z%]*)$","i"),Ec=/queueHooks$/,Fc=[L],Gc={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=Dc.exec(b),f=e&&e[3]||(jQuery.cssNumber[a]?"":"px"),g=(jQuery.cssNumber[a]||"px"!==f&&+d)&&Dc.exec(jQuery.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,jQuery.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};jQuery.Animation=jQuery.extend(J,{tweener:function(a,b){jQuery.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],Gc[c]=Gc[c]||[],Gc[c].unshift(b)},prefilter:function(a,b){b?Fc.unshift(a):Fc.push(a)}}),jQuery.Tween=M,M.prototype={constructor:M,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(jQuery.cssNumber[c]?"":"px")},cur:function(){var a=M.propHooks[this.prop];return a&&a.get?a.get(this):M.propHooks._default.get(this)},run:function(a){var b,c=M.propHooks[this.prop];return this.pos=b=this.options.duration?jQuery.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):M.propHooks._default.set(this),this}},M.prototype.init.prototype=M.prototype,M.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=jQuery.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){jQuery.fx.step[a.prop]?jQuery.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[jQuery.cssProps[a.prop]]||jQuery.cssHooks[a.prop])?jQuery.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},M.propHooks.scrollTop=M.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},jQuery.each(["toggle","show","hide"],function(a,b){var c=jQuery.fn[b];jQuery.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(N(b,!0),a,d,e)}}),jQuery.fn.extend({fadeTo:function(a,b,c,d){return this.filter(t).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=jQuery.isEmptyObject(a),f=jQuery.speed(b,c,d),g=function(){var b=J(this,jQuery.extend({},a),f);(e||pb.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop,b(d)};return"string"!=typeof a&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=null!=a&&a+"queueHooks",f=jQuery.timers,g=pb.get(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&g[c].stop&&Ec.test(c)&&e(g[c]);for(c=f.length;c--;)f[c].elem!==this||null!=a&&f[c].queue!==a||(f[c].anim.stop(d),b=!1,f.splice(c,1));(b||!d)&&jQuery.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=pb.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=jQuery.timers,g=d?d.length:0;for(c.finish=!0,jQuery.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),jQuery.each({slideDown:N("show"),slideUp:N("hide"),slideToggle:N("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){jQuery.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),jQuery.speed=function(a,b,c){var d=a&&"object"==typeof a?jQuery.extend({},a):{complete:c||!c&&b||jQuery.isFunction(a)&&a,duration:a,easing:c&&b||b&&!jQuery.isFunction(b)&&b};return d.duration=jQuery.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in jQuery.fx.speeds?jQuery.fx.speeds[d.duration]:jQuery.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){jQuery.isFunction(d.old)&&d.old.call(this),d.queue&&jQuery.dequeue(this,d.queue)},d},jQuery.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},jQuery.timers=[],jQuery.fx=M.prototype.init,jQuery.fx.tick=function(){var a,c=jQuery.timers,d=0;for(Ac=jQuery.now();d<c.length;d++)a=c[d],a()||c[d]!==a||c.splice(d--,1);c.length||jQuery.fx.stop(),Ac=b},jQuery.fx.timer=function(a){a()&&jQuery.timers.push(a)&&jQuery.fx.start()},jQuery.fx.interval=13,jQuery.fx.start=function(){Bc||(Bc=setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.stop=function(){clearInterval(Bc),Bc=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fx.step={},jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.animated=function(a){return jQuery.grep(jQuery.timers,function(b){return a===b.elem}).length}),jQuery.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){jQuery.offset.setOffset(this,a,b)});var c,d,e=this[0],f={top:0,left:0},g=e&&e.ownerDocument;if(g)return c=g.documentElement,jQuery.contains(c,e)?(typeof e.getBoundingClientRect!==R&&(f=e.getBoundingClientRect()),d=O(g),{top:f.top+d.pageYOffset-c.clientTop,left:f.left+d.pageXOffset-c.clientLeft}):f},jQuery.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=jQuery.css(a,"position"),l=jQuery(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=jQuery.css(a,"top"),i=jQuery.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),jQuery.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},jQuery.fn.extend({position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===jQuery.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),jQuery.nodeName(a[0],"html")||(d=a.offset()),d.top+=jQuery.css(a[0],"borderTopWidth",!0),d.left+=jQuery.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-jQuery.css(c,"marginTop",!0),left:b.left-d.left-jQuery.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||U;a&&!jQuery.nodeName(a,"html")&&"static"===jQuery.css(a,"position");)a=a.offsetParent;return a||U})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(c,d){var e="pageYOffset"===d;jQuery.fn[c]=function(f){return jQuery.access(this,function(c,f,g){var h=O(c);return g===b?h?h[d]:c[f]:void(h?h.scrollTo(e?a.pageXOffset:g,e?g:a.pageYOffset):c[f]=g)},c,f,arguments.length,null)}}),jQuery.each({Height:"height",Width:"width"},function(a,c){jQuery.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){jQuery.fn[e]=function(e,f){var g=arguments.length&&(d||"boolean"!=typeof e),h=d||(e===!0||f===!0?"margin":"border");return jQuery.access(this,function(c,d,e){var f;return jQuery.isWindow(c)?c.document.documentElement["client"+a]:9===c.nodeType?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?jQuery.css(c,d,h):jQuery.style(c,d,e,h)},c,g?e:b,g,null)}})}),jQuery.fn.size=function(){return this.length},jQuery.fn.andSelf=jQuery.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=jQuery:"function"==typeof define&&define.amd&&define("jquery",[],function(){return jQuery}),"object"==typeof a&&"object"==typeof a.document&&(a.jQuery=a.$=jQuery)}(window),function(){jQuery.ajaxSetup({beforeSend:function(a,b){b&&-1===["GET","HEAD","OPTIONS","TRACE"].indexOf(b.type)&&a.setRequestHeader("X-CSRFToken",KXL.Common.Utils.CookieUtils.getCookie("csrftoken"))},complete:function(a){this.url&&KXL.Common.Utils.Url.isRelative(this.url)&&KXL&&KXL.currentUser&&401===a.status&&KXL.execute("logout")}})}(),function(a){"use strict";function b(a,b){for(var c=a.length;--c>=0;)if(a[c]===b)return!0}function c(a){return v(a)?a:[a]}function d(a){for(var b in a)if(o.call(a,b))return!1;return!0}function e(a,b,c){for(var d,e=v(b),f=e?b:[b],g=[],h=a.props,i={},j={values:g},k=f.length;--k>=0;)d=f[k],o.call(h,d)||(j.missing=i,i[d]=!0),g.unshift(h[d]);return c?c.apply({},g):j}function f(a){for(var b=a.length;--b>=0;)if(!a[b].calls)return a.splice(b,1)}function g(a,c,g){var h,i,j,k=a.listeners,l=[].concat(k),m=l.length,n=a.props,q=n[c],r=o.call(n,c),s=g&&typeof g===p;if(n[c]=g,!r||q!==g||s&&!b(w,g)){for(s&&w.push(g);--m>=0;)i=l[m],h=i.keys,j=i.missing,j?o.call(j,c)&&(delete j[c],d(j)&&(i.cb.apply({},e(a,h).values),i.calls--)):b(h,c)&&(i.cb.apply({},e(a,h).values),i.calls--),i.calls||f(k);delete a.needs[c],s&&w.pop()}}function h(a){var b;return function(){b||(b=1,a.apply(this,arguments))}}function i(a,b,c){c(h(function(c){g(a,b,c)}))}function j(a,b){var d,e;return a===b?!0:(d=[].concat(c(a)).sort(),e=[].concat(c(b)).sort(),d+""==e+"")}var k,l="atom",m="0.5.6",n=Object.prototype,o=n.hasOwnProperty,p="object",q="undefined",r=typeof window!==q?window:global,s=o.call(r,l),t=r[l],u=Array.prototype.slice,v=Array.isArray||function(a){return"[object Array]"===n.toString.call(a)},w=[];k=r[l]=function(){function a(){n&&(n.pending=n.next=!n.next&&n.length?n.shift():n.next,n.args=u.call(arguments,0),n.pending&&(n.next=0,n.pending.apply({},[h(a)].concat(n.args))))}var b=u.call(arguments,0),d={},f=d.props={},k=d.needs={},l=d.providers={},m=d.listeners=[],n=[],q={chain:function(){if(n)for(var b=0,c=arguments.length;c>b;b++)n.push(arguments[b]),n.pending||a.apply({},n.args||[]);return q},destroy:function(){for(delete d.props,delete d.needs,delete d.providers,delete d.listeners;n.length;)n.pop();d=f=k=l=m=n=n.pending=n.next=n.args=0},each:function(a,b){for(var d,e=c(a),f=-1,g=e.length;++f<g;)d=e[f],b(d,q.get(d));return q},entangle:function(a,b){var c,d,e=v(b),f=!e&&typeof b===p,g=e?b:f?[]:[b],h=f?b:{};if(f)for(d in h)o.call(h,d)&&g.push(d);else for(c=g.length;--c>=0;)d=g[c],h[d]=d;return q.each(g,function(b){var c=h[b];q.on(b,function(b){a.set(c,b)}),a.on(c,function(a){q.set(b,a)})}),q},get:function(a,b){var c=e(d,a,b);return b?c:"string"==typeof a?c.values[0]:c.values},has:function(a){for(var b=c(a),d=b.length;--d>=0;)if(!o.call(f,b[d]))return!1;return!0},keys:function(){var a=[];for(var b in f)o.call(f,b)&&a.push(b);return a},mixin:function(a){for(var b in a)o.call(a,b)&&(q[b]=a[b]);return q},need:function(a,b){for(var e,g,h=c(a),j=h.length;--j>=0;)e=h[j],g=l[e],!o.call(f,e)&&g?(i(d,e,g),delete l[e]):k[e]=!0;return b&&q.once(h,b),q},next:function(a,b){return m.unshift({keys:c(a),cb:b,calls:1}),q},off:function(a,b){var c,d=m.length;for(1===arguments.length&&(b=a,a=0);--d>=0;)c=m[d],c.cb!==b||a&&!j(c.keys,a)||m.splice(d,1);return q},on:function(a,b){return m.unshift({keys:c(a),cb:b,calls:1/0}),q},once:function(a,b){var f=c(a),g=e(d,f),h=g.values,i=g.missing;return i?m.unshift({keys:f,cb:b,missing:i,calls:1}):b.apply({},h),q},provide:function(a,b){return k[a]?i(d,a,b):l[a]||(l[a]=b),q},set:function(a,b){if(typeof a===p)for(var c in a)o.call(a,c)&&g(d,c,a[c]);else g(d,a,b);return q}};return q.bind=q.on,q.unbind=q.off,b.length&&q.set.apply(q,b),q},k.VERSION=m,k.create=k,k.noConflict=function(){if(r[l]===k&&(r[l]=s?t:a,!s))try{delete r[l]}catch(b){}return k},typeof module!==q&&module.exports&&(module.exports=k)}(),"object"!=typeof JSON&&(JSON={}),function(){"use strict";
function f(a){return 10>a?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(){function a(a,b,c){for(var d=(c||0)-1,e=a?a.length:0;++d<e;)if(a[d]===b)return d;return-1}function b(a,b){for(var c=a.criteria,d=b.criteria,e=-1,f=c.length;++e<f;){var g=c[e],h=d[e];if(g!==h){if(g>h||"undefined"==typeof g)return 1;if(h>g||"undefined"==typeof h)return-1}}return a.index-b.index}function c(a){return"\\"+vc[a]}function d(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}function e(a){return a instanceof e?a:new f(a)}function f(a,b){this.__chain__=!!b,this.__wrapped__=a}function g(a){function b(){if(e){var a=d(e);Jc.apply(a,arguments)}if(this instanceof b){var g=h(c.prototype),i=c.apply(g,a||arguments);return J(i)?i:g}return c.apply(f,a||arguments)}var c=a[0],e=a[2],f=a[4];return b}function h(a){return J(a)?Lc(a):{}}function i(a,b,c){if("function"!=typeof a)return Sb;if("undefined"==typeof b||!("prototype"in a))return a;switch(c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return Fb(a,b)}function j(a){function b(){var a=l?i:this;if(f){var q=d(f);Jc.apply(q,arguments)}if((g||n)&&(q||(q=d(arguments)),g&&Jc.apply(q,g),n&&q.length<k))return e|=16,j([c,o?e:-4&e,q,null,i,k]);if(q||(q=arguments),m&&(c=a[p]),this instanceof b){a=h(c.prototype);var r=c.apply(a,q);return J(r)?r:a}return c.apply(a,q)}var c=a[0],e=a[1],f=a[2],g=a[3],i=a[4],k=a[5],l=1&e,m=2&e,n=4&e,o=8&e,p=c;return b}function k(a,b){for(var c=-1,d=s(),e=a?a.length:0,f=[];++c<e;){var g=a[c];d(b,g)<0&&f.push(g)}return f}function l(a,b,c,d){for(var e=(d||0)-1,f=a?a.length:0,g=[];++e<f;){var h=a[e];if(h&&"object"==typeof h&&"number"==typeof h.length&&(Uc(h)||v(h))){b||(h=l(h,b,c));var i=-1,j=h.length,k=g.length;for(g.length+=j;++i<j;)g[k++]=h[i]}else c||g.push(h)}return g}function m(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;var f=typeof a,g=typeof b;if(!(a!==a||a&&uc[f]||b&&uc[g]))return!1;if(null==a||null==b)return a===b;var h=Ec.call(a),i=Ec.call(b);if(h!=i)return!1;switch(h){case nc:case oc:return+a==+b;case qc:return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case sc:case tc:return a==String(b)}var j=h==mc;if(!j){var k=a instanceof e,l=b instanceof e;if(k||l)return m(k?a.__wrapped__:a,l?b.__wrapped__:b,c,d);if(h!=rc)return!1;var n=a.constructor,o=b.constructor;if(n!=o&&!(I(n)&&n instanceof n&&I(o)&&o instanceof o)&&"constructor"in a&&"constructor"in b)return!1}c||(c=[]),d||(d=[]);for(var p=c.length;p--;)if(c[p]==a)return d[p]==b;var q=!0,r=0;if(c.push(a),d.push(b),j){if(r=b.length,q=r==a.length)for(;r--&&(q=m(a[r],b[r],c,d)););}else _c(b,function(b,e,f){return Ic.call(f,e)?(r++,!(q=Ic.call(a,e)&&m(a[e],b,c,d))&&gc):void 0}),q&&_c(a,function(a,b,c){return Ic.call(c,b)?!(q=--r>-1)&&gc:void 0});return c.pop(),d.pop(),q}function n(a,b){return a+Hc(Sc()*(b-a+1))}function o(a,b,c){for(var d=-1,e=s(),f=a?a.length:0,g=[],h=c?[]:g;++d<f;){var i=a[d],j=c?c(i,d,a):i;(b?!d||h[h.length-1]!==j:e(h,j)<0)&&(c&&h.push(j),g.push(i))}return g}function p(a){return function(b,c,d){var e={};c=Qb(c,d,3);var f=-1,g=b?b.length:0;if("number"==typeof g)for(;++f<g;){var h=b[f];a(e,h,c(h,f,b),b)}else ad(b,function(b,d,f){a(e,b,c(b,d,f),f)});return e}}function q(a,b,c,d,e,f){var h=2&b,i=16&b,k=32&b;if(!h&&!I(a))throw new TypeError;i&&!c.length&&(b&=-17,i=c=!1),k&&!d.length&&(b&=-33,k=d=!1);var l=1==b||17===b?g:j;return l([a,b,c,d,e,f])}function r(a){return Xc[a]}function s(){var b=(b=e.indexOf)===rb?a:b;return b}function t(a){return"function"==typeof a&&Fc.test(a)}function u(a){return Yc[a]}function v(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ec.call(a)==lc||!1}function w(a){if(!a)return a;for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];if(d)for(var e in d)a[e]=d[e]}return a}function x(a){return J(a)?Uc(a)?d(a):w({},a):a}function y(a){if(!a)return a;for(var b=1,c=arguments.length;c>b;b++){var d=arguments[b];if(d)for(var e in d)"undefined"==typeof a[e]&&(a[e]=d[e])}return a}function z(a){var b=[];return _c(a,function(a,c){I(a)&&b.push(c)}),b.sort()}function A(a,b){return a?Ic.call(a,b):!1}function B(a){for(var b=-1,c=Wc(a),d=c.length,e={};++b<d;){var f=c[b];e[a[f]]=f}return e}function C(a){return a===!0||a===!1||a&&"object"==typeof a&&Ec.call(a)==nc||!1}function D(a){return a&&"object"==typeof a&&Ec.call(a)==oc||!1}function E(a){return a&&1===a.nodeType||!1}function F(a){if(!a)return!0;if(Uc(a)||O(a))return!a.length;for(var b in a)if(Ic.call(a,b))return!1;return!0}function G(a,b){return m(a,b)}function H(a){return Nc(a)&&!Oc(parseFloat(a))}function I(a){return"function"==typeof a}function J(a){return!(!a||!uc[typeof a])}function K(a){return M(a)&&a!=+a}function L(a){return null===a}function M(a){return"number"==typeof a||a&&"object"==typeof a&&Ec.call(a)==qc||!1}function N(a){return a&&uc[typeof a]&&Ec.call(a)==sc||!1}function O(a){return"string"==typeof a||a&&"object"==typeof a&&Ec.call(a)==tc||!1}function P(a){return"undefined"==typeof a}function Q(a){var b=[];_c(a,function(a,c){b.push(c)}),b=k(b,l(arguments,!0,!1,1));for(var c=-1,d=b.length,e={};++c<d;){var f=b[c];e[f]=a[f]}return e}function R(a){for(var b=-1,c=Wc(a),d=c.length,e=Array(d);++b<d;){var f=c[b];e[b]=[f,a[f]]}return e}function S(a){for(var b=-1,c=l(arguments,!0,!1,1),d=c.length,e={};++b<d;){var f=c[b];f in a&&(e[f]=a[f])}return e}function T(a){for(var b=-1,c=Wc(a),d=c.length,e=Array(d);++b<d;)e[b]=a[c[b]];return e}function U(a,b){var c=s(),d=a?a.length:0,e=!1;return d&&"number"==typeof d?e=c(a,b)>-1:ad(a,function(a){return(e=a===b)&&gc}),e}function V(a,b,c){var d=!0;b=Qb(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f&&(d=!!b(a[e],e,a)););else ad(a,function(a,c,e){return!(d=!!b(a,c,e))&&gc});return d}function W(a,b,c){var d=[];b=Qb(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f;){var g=a[e];b(g,e,a)&&d.push(g)}else ad(a,function(a,c,e){b(a,c,e)&&d.push(a)});return d}function X(a,b,c){b=Qb(b,c,3);var d=-1,e=a?a.length:0;if("number"!=typeof e){var f;return ad(a,function(a,c,d){return b(a,c,d)?(f=a,gc):void 0}),f}for(;++d<e;){var g=a[d];if(b(g,d,a))return g}}function Y(a,b){return mb(a,b,!0)}function Z(a,b,c){var d=-1,e=a?a.length:0;if(b=b&&"undefined"==typeof c?b:i(b,c,3),"number"==typeof e)for(;++d<e&&b(a[d],d,a)!==gc;);else ad(a,b)}function $(a,b){var c=a?a.length:0;if("number"==typeof c)for(;c--&&b(a[c],c,a)!==!1;);else{var d=Wc(a);c=d.length,ad(a,function(a,e,f){return e=d?d[--c]:--c,b(f[e],e,f)===!1&&gc})}}function _(a,b){var c=d(arguments,2),e=-1,f="function"==typeof b,g=a?a.length:0,h=Array("number"==typeof g?g:0);return Z(a,function(a){h[++e]=(f?b:a[b]).apply(a,c)}),h}function ab(a,b,c){var d=-1,e=a?a.length:0;if(b=Qb(b,c,3),"number"==typeof e)for(var f=Array(e);++d<e;)f[d]=b(a[d],d,a);else f=[],ad(a,function(a,c,e){f[++d]=b(a,c,e)});return f}function bb(a,b,c){var d=-1/0,e=d;"function"!=typeof b&&c&&c[b]===a&&(b=null);var f=-1,g=a?a.length:0;if(null==b&&"number"==typeof g)for(;++f<g;){var h=a[f];h>e&&(e=h)}else b=Qb(b,c,3),Z(a,function(a,c,f){var g=b(a,c,f);g>d&&(d=g,e=a)});return e}function cb(a,b,c){var d=1/0,e=d;"function"!=typeof b&&c&&c[b]===a&&(b=null);var f=-1,g=a?a.length:0;if(null==b&&"number"==typeof g)for(;++f<g;){var h=a[f];e>h&&(e=h)}else b=Qb(b,c,3),Z(a,function(a,c,f){var g=b(a,c,f);d>g&&(d=g,e=a)});return e}function db(a,b,c,d){if(!a)return c;var e=arguments.length<3;b=Qb(b,d,4);var f=-1,g=a.length;if("number"==typeof g)for(e&&(c=a[++f]);++f<g;)c=b(c,a[f],f,a);else ad(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)});return c}function eb(a,b,c,d){var e=arguments.length<3;return b=Qb(b,d,4),$(a,function(a,d,f){c=e?(e=!1,a):b(c,a,d,f)}),c}function fb(a,b,c){return b=Qb(b,c,3),W(a,function(a,c,d){return!b(a,c,d)})}function gb(a,b,c){if(a&&"number"!=typeof a.length&&(a=T(a)),null==b||c)return a?a[n(0,a.length-1)]:ec;var d=hb(a);return d.length=Rc(Qc(0,b),d.length),d}function hb(a){var b=-1,c=a?a.length:0,d=Array("number"==typeof c?c:0);return Z(a,function(a){var c=n(0,++b);d[b]=d[c],d[c]=a}),d}function ib(a){var b=a?a.length:0;return"number"==typeof b?b:Wc(a).length}function jb(a,b,c){var d;b=Qb(b,c,3);var e=-1,f=a?a.length:0;if("number"==typeof f)for(;++e<f&&!(d=b(a[e],e,a)););else ad(a,function(a,c,e){return(d=b(a,c,e))&&gc});return!!d}function kb(a,c,d){var e=-1,f=a?a.length:0,g=Array("number"==typeof f?f:0);for(c=Qb(c,d,3),Z(a,function(a,b,d){g[++e]={criteria:[c(a,b,d)],index:e,value:a}}),f=g.length,g.sort(b);f--;)g[f]=g[f].value;return g}function lb(a){return Uc(a)?d(a):a&&"number"==typeof a.length?ab(a):T(a)}function mb(a,b,c){return c&&F(b)?ec:(c?X:W)(a,b)}function nb(a){for(var b=-1,c=a?a.length:0,d=[];++b<c;){var e=a[b];e&&d.push(e)}return d}function ob(a){return k(a,l(arguments,!0,!0,1))}function pb(a,b,c){var e=0,f=a?a.length:0;if("number"!=typeof b&&null!=b){var g=-1;for(b=Qb(b,c,3);++g<f&&b(a[g],g,a);)e++}else if(e=b,null==e||c)return a?a[0]:ec;return d(a,0,Rc(Qc(0,e),f))}function qb(a,b){return l(a,b)}function rb(b,c,d){if("number"==typeof d){var e=b?b.length:0;d=0>d?Qc(0,e+d):d||0}else if(d){var f=yb(b,c);return b[f]===c?f:-1}return a(b,c,d)}function sb(a,b,c){var e=0,f=a?a.length:0;if("number"!=typeof b&&null!=b){var g=f;for(b=Qb(b,c,3);g--&&b(a[g],g,a);)e++}else e=null==b||c?1:b||e;return d(a,0,Rc(Qc(0,f-e),f))}function tb(){for(var a=[],b=-1,c=arguments.length;++b<c;){var d=arguments[b];(Uc(d)||v(d))&&a.push(d)}var e=a[0],f=-1,g=s(),h=e?e.length:0,i=[];a:for(;++f<h;)if(d=e[f],g(i,d)<0){for(var b=c;--b;)if(g(a[b],d)<0)continue a;i.push(d)}return i}function ub(a,b,c){var e=0,f=a?a.length:0;if("number"!=typeof b&&null!=b){var g=f;for(b=Qb(b,c,3);g--&&b(a[g],g,a);)e++}else if(e=b,null==e||c)return a?a[f-1]:ec;return d(a,Qc(0,f-e))}function vb(a,b,c){var d=a?a.length:0;for("number"==typeof c&&(d=(0>c?Qc(0,d+c):Rc(c,d-1))+1);d--;)if(a[d]===b)return d;return-1}function wb(a,b,c){a=+a||0,c=+c||1,null==b&&(b=a,a=0);for(var d=-1,e=Qc(0,Gc((b-a)/c)),f=Array(e);++d<e;)f[d]=a,a+=c;return f}function xb(a,b,c){if("number"!=typeof b&&null!=b){var e=0,f=-1,g=a?a.length:0;for(b=Qb(b,c,3);++f<g&&b(a[f],f,a);)e++}else e=null==b||c?1:Qc(0,b);return d(a,e)}function yb(a,b,c,d){var e=0,f=a?a.length:e;for(c=c?Qb(c,d,1):Sb,b=c(b);f>e;){var g=e+f>>>1;c(a[g])<b?e=g+1:f=g}return e}function zb(){return o(l(arguments,!0,!0))}function Ab(a,b,c,d){return"boolean"!=typeof b&&null!=b&&(d=c,c="function"!=typeof b&&d&&d[b]===a?null:b,b=!1),null!=c&&(c=Qb(c,d,3)),o(a,b,c)}function Bb(a){return k(a,d(arguments,1))}function Cb(){for(var a=-1,b=bb(ed(arguments,"length")),c=Array(0>b?0:b);++a<b;)c[a]=ed(arguments,a);return c}function Db(a,b){var c=-1,d=a?a.length:0,e={};for(b||!d||Uc(a[0])||(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e}function Eb(a,b){if(!I(b))throw new TypeError;return function(){return--a<1?b.apply(this,arguments):void 0}}function Fb(a,b){return arguments.length>2?q(a,17,d(arguments,2),null,b):q(a,1,null,null,b)}function Gb(a){for(var b=arguments.length>1?l(arguments,!0,!1,1):z(a),c=-1,d=b.length;++c<d;){var e=b[c];a[e]=q(a[e],1,null,null,a)}return a}function Hb(){for(var a=arguments,b=a.length;b--;)if(!I(a[b]))throw new TypeError;return function(){for(var b=arguments,c=a.length;c--;)b=[a[c].apply(this,b)];return b[0]}}function Ib(a,b,c){var d,e,f,g,h,i,j,k=0,l=!1,m=!0;if(!I(a))throw new TypeError;if(b=Qc(0,b)||0,c===!0){var n=!0;m=!1}else J(c)&&(n=c.leading,l="maxWait"in c&&(Qc(b,c.maxWait)||0),m="trailing"in c?c.trailing:m);var o=function(){var c=b-(fd()-g);if(0>=c){e&&clearTimeout(e);var l=j;e=i=j=ec,l&&(k=fd(),f=a.apply(h,d),i||e||(d=h=null))}else i=setTimeout(o,c)},p=function(){i&&clearTimeout(i),e=i=j=ec,(m||l!==b)&&(k=fd(),f=a.apply(h,d),i||e||(d=h=null))};return function(){if(d=arguments,g=fd(),h=this,j=m&&(i||!n),l===!1)var c=n&&!i;else{e||n||(k=g);var q=l-(g-k),r=0>=q;r?(e&&(e=clearTimeout(e)),k=g,f=a.apply(h,d)):e||(e=setTimeout(p,q))}return r&&i?i=clearTimeout(i):i||b===l||(i=setTimeout(o,b)),c&&(r=!0,f=a.apply(h,d)),!r||i||e||(d=h=null),f}}function Jb(a){if(!I(a))throw new TypeError;var b=d(arguments,1);return setTimeout(function(){a.apply(ec,b)},1)}function Kb(a,b){if(!I(a))throw new TypeError;var c=d(arguments,2);return setTimeout(function(){a.apply(ec,c)},b)}function Lb(a,b){var c={};return function(){var d=b?b.apply(this,arguments):hc+arguments[0];return Ic.call(c,d)?c[d]:c[d]=a.apply(this,arguments)}}function Mb(a){var b,c;if(!I(a))throw new TypeError;return function(){return b?c:(b=!0,c=a.apply(this,arguments),a=null,c)}}function Nb(a){return q(a,16,d(arguments,1))}function Ob(a,b,c){var d=!0,e=!0;if(!I(a))throw new TypeError;return c===!1?d=!1:J(c)&&(d="leading"in c?c.leading:d,e="trailing"in c?c.trailing:e),c={},c.leading=d,c.maxWait=b,c.trailing=e,Ib(a,b,c)}function Pb(a,b){return q(b,16,[a])}function Qb(a,b,c){var d=typeof a;if(null==a||"function"==d)return i(a,b,c);if("object"!=d)return Vb(a);var e=Wc(a);return function(b){for(var c=e.length,d=!1;c--&&(d=b[e[c]]===a[e[c]]););return d}}function Rb(a){return null==a?"":String(a).replace($c,r)}function Sb(a){return a}function Tb(a){Z(z(a),function(b){var c=e[b]=a[b];e.prototype[b]=function(){var a=[this.__wrapped__];Jc.apply(a,arguments);var b=c.apply(e,a);return this.__chain__?new f(b,!0):b}})}function Ub(){return wc._=Dc,this}function Vb(a){return function(b){return b[a]}}function Wb(a,b){return null==a&&null==b&&(b=1),a=+a||0,null==b?(b=a,a=0):b=+b||0,a+Hc(Sc()*(b-a+1))}function Xb(a,b){if(a){var c=a[b];return I(c)?a[b]():c}}function Yb(a,b,d){var f=e,g=f.templateSettings;a=String(a||""),d=y({},d,g);var h=0,i="__p += '",j=d.variable,k=RegExp((d.escape||jc).source+"|"+(d.interpolate||jc).source+"|"+(d.evaluate||jc).source+"|$","g");a.replace(k,function(b,d,e,f,g){return i+=a.slice(h,g).replace(kc,c),d&&(i+="' +\n_.escape("+d+") +\n'"),f&&(i+="';\n"+f+";\n__p += '"),e&&(i+="' +\n((__t = ("+e+")) == null ? '' : __t) +\n'"),h=g+b.length,b}),i+="';\n",j||(j="obj",i="with ("+j+" || {}) {\n"+i+"\n}\n"),i="function("+j+") {\nvar __t, __p = '', __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n"+i+"return __p\n}";try{var l=Function("_","return "+i)(f)}catch(m){throw m.source=i,m}return b?l(b):(l.source=i,l)}function Zb(a,b,c){a=(a=+a)>-1?a:0;var d=-1,e=Array(a);for(b=i(b,c,1);++d<a;)e[d]=b(d);return e}function $b(a){return null==a?"":String(a).replace(Zc,u)}function _b(a){var b=++fc+"";return a?a+b:b}function ac(a){return a=new f(a),a.__chain__=!0,a}function bc(a,b){return b(a),a}function cc(){return this.__chain__=!0,this}function dc(){return this.__wrapped__}var ec,fc=0,gc={},hc=+new Date+"",ic=/<%=([\s\S]+?)%>/g,jc=/($^)/,kc=/['\n\r\t\u2028\u2029\\]/g,lc="[object Arguments]",mc="[object Array]",nc="[object Boolean]",oc="[object Date]",pc="[object Function]",qc="[object Number]",rc="[object Object]",sc="[object RegExp]",tc="[object String]",uc={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},vc={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},wc=uc[typeof window]&&window||this,xc=uc[typeof exports]&&exports&&!exports.nodeType&&exports,yc=uc[typeof module]&&module&&!module.nodeType&&module,zc=yc&&yc.exports===xc&&xc,Ac=uc[typeof global]&&global;!Ac||Ac.global!==Ac&&Ac.window!==Ac||(wc=Ac);var Bc=[],Cc=Object.prototype,Dc=wc._,Ec=Cc.toString,Fc=RegExp("^"+String(Ec).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),Gc=Math.ceil,Hc=Math.floor,Ic=Cc.hasOwnProperty,Jc=Bc.push,Kc=Cc.propertyIsEnumerable,Lc=t(Lc=Object.create)&&Lc,Mc=t(Mc=Array.isArray)&&Mc,Nc=wc.isFinite,Oc=wc.isNaN,Pc=t(Pc=Object.keys)&&Pc,Qc=Math.max,Rc=Math.min,Sc=Math.random;f.prototype=e.prototype;var Tc={};!function(){var a={0:1,length:1};Tc.spliceObjects=(Bc.splice.call(a,0,1),!a[0])}(1),e.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:ic,variable:""},Lc||(h=function(){function a(){}return function(b){if(J(b)){a.prototype=b;var c=new a;a.prototype=null}return c||wc.Object()}}()),v(arguments)||(v=function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ic.call(a,"callee")&&!Kc.call(a,"callee")||!1});var Uc=Mc||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&Ec.call(a)==mc||!1},Vc=function(a){var b,c=a,d=[];if(!c)return d;if(!uc[typeof a])return d;for(b in c)Ic.call(c,b)&&d.push(b);return d},Wc=Pc?function(a){return J(a)?Pc(a):[]}:Vc,Xc={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},Yc=B(Xc),Zc=RegExp("("+Wc(Yc).join("|")+")","g"),$c=RegExp("["+Wc(Xc).join("")+"]","g"),_c=function(a,b){var c,d=a,e=d;if(!d)return e;if(!uc[typeof d])return e;for(c in d)if(b(d[c],c,a)===gc)return e;return e},ad=function(a,b){var c,d=a,e=d;if(!d)return e;if(!uc[typeof d])return e;for(c in d)if(Ic.call(d,c)&&b(d[c],c,a)===gc)return e;return e};I(/x/)&&(I=function(a){return"function"==typeof a&&Ec.call(a)==pc});var bd=p(function(a,b,c){Ic.call(a,c)?a[c]++:a[c]=1}),cd=p(function(a,b,c){(Ic.call(a,c)?a[c]:a[c]=[]).push(b)}),dd=p(function(a,b,c){a[c]=b}),ed=ab,fd=t(fd=Date.now)&&fd||function(){return(new Date).getTime()};e.after=Eb,e.bind=Fb,e.bindAll=Gb,e.chain=ac,e.compact=nb,e.compose=Hb,e.countBy=bd,e.debounce=Ib,e.defaults=y,e.defer=Jb,e.delay=Kb,e.difference=ob,e.filter=W,e.flatten=qb,e.forEach=Z,e.functions=z,e.groupBy=cd,e.indexBy=dd,e.initial=sb,e.intersection=tb,e.invert=B,e.invoke=_,e.keys=Wc,e.map=ab,e.max=bb,e.memoize=Lb,e.min=cb,e.omit=Q,e.once=Mb,e.pairs=R,e.partial=Nb,e.pick=S,e.pluck=ed,e.range=wb,e.reject=fb,e.rest=xb,e.shuffle=hb,e.sortBy=kb,e.tap=bc,e.throttle=Ob,e.times=Zb,e.toArray=lb,e.union=zb,e.uniq=Ab,e.values=T,e.where=mb,e.without=Bb,e.wrap=Pb,e.zip=Cb,e.collect=ab,e.drop=xb,e.each=Z,e.extend=w,e.methods=z,e.object=Db,e.select=W,e.tail=xb,e.unique=Ab,e.clone=x,e.contains=U,e.escape=Rb,e.every=V,e.find=X,e.has=A,e.identity=Sb,e.indexOf=rb,e.isArguments=v,e.isArray=Uc,e.isBoolean=C,e.isDate=D,e.isElement=E,e.isEmpty=F,e.isEqual=G,e.isFinite=H,e.isFunction=I,e.isNaN=K,e.isNull=L,e.isNumber=M,e.isObject=J,e.isRegExp=N,e.isString=O,e.isUndefined=P,e.lastIndexOf=vb,e.mixin=Tb,e.noConflict=Ub,e.random=Wb,e.reduce=db,e.reduceRight=eb,e.result=Xb,e.size=ib,e.some=jb,e.sortedIndex=yb,e.template=Yb,e.unescape=$b,e.uniqueId=_b,e.all=V,e.any=jb,e.detect=X,e.findWhere=Y,e.foldl=db,e.foldr=eb,e.include=U,e.inject=db,e.first=pb,e.last=ub,e.sample=gb,e.take=pb,e.head=pb,Tb(e),e.VERSION="2.4.1",e.prototype.chain=cc,e.prototype.value=dc,Z(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=Bc[a];e.prototype[a]=function(){var a=this.__wrapped__;return b.apply(a,arguments),Tc.spliceObjects||0!==a.length||delete a[0],this}}),Z(["concat","join","slice"],function(a){var b=Bc[a];e.prototype[a]=function(){var a=this.__wrapped__,c=b.apply(a,arguments);return this.__chain__&&(c=new f(c),c.__chain__=!0),c}}),"function"==typeof define&&"object"==typeof define.amd&&define.amd?(wc._=e,define(function(){return e})):xc&&yc?zc?(yc.exports=e)._=e:xc._=e:wc._=e}.call(this),!function(a){"use strict";function b(a){a=a||{},this.phrases=a.phrases||{},this.currentLocale=a.locale||"en",this.allowMissing=!!a.allowMissing}function c(a){var b,c,d,e={};for(b in a)if(a.hasOwnProperty(b)){c=a[b];for(d in c)e[c[d]]=b}return e}function d(a){var b=/^\s+|\s+$/g;return a.replace(b,"")}function e(a,b,c){var e,f,h;return null!=c&&a?(f=a.split(k),h=f[g(b,c)]||f[0],e=d(h)):e=a,e}function f(a){var b=c(m);return b[a]||b.en}function g(a,b){return l[f(a)](b)}function h(a,b){for(var c in b)"_"!==c&&b.hasOwnProperty(c)&&(a=a.replace(new RegExp("%\\{"+c+"\\}","g"),b[c]));return a}function i(b){a.console&&a.console.warn&&a.console.warn("WARNING: "+b)}function j(a){var b={};for(var c in a)b[c]=a[c];return b}b.VERSION="0.2.0",b.prototype.locale=function(a){return a&&(this.currentLocale=a),this.currentLocale},b.prototype.extend=function(a){for(var b in a)a.hasOwnProperty(b)&&(this.phrases[b]=a[b])},b.prototype.clear=function(){this.phrases={}},b.prototype.replace=function(a){this.clear(),this.extend(a)},b.prototype.t=function(a,b){var c;b=null==b?{}:b,"number"==typeof b&&(b={smart_count:b});var d=this.phrases[a]||b._||(this.allowMissing?a:"");return""===d?(i('Missing translation for key: "'+a+'"'),c=a):(b=j(b),c=e(d,this.currentLocale,b.smart_count),c=h(c,b)),c};var k="||||",l={chinese:function(){return 0},german:function(a){return 1!==a?1:0},french:function(a){return a>1?1:0},russian:function(a){return a%10===1&&a%100!==11?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2},czech:function(a){return 1===a?0:a>=2&&4>=a?1:2},polish:function(a){return 1===a?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2},icelandic:function(a){return a%10!==1||a%100===11?1:0}},m={chinese:["id","ja","ko","ms","th","tr","zh"],german:["da","de","en","es","fi","el","he","hu","it","nl","no","pt","sv"],french:["fr","tl"],russian:["hr","ru"],czech:["cs"],polish:["pl"],icelandic:["is"]};"undefined"!=typeof module&&module.exports?module.exports=b:a.Polyglot=b}(this),function(){{var a,b=this,c=b.Backbone,d=[],e=(d.push,d.slice);d.splice}a="undefined"!=typeof exports?exports:b.Backbone={},a.VERSION="1.1.0";var f=b._;f||"undefined"==typeof require||(f=require("underscore")),a.$=b.jQuery||b.Zepto||b.ender||b.$,a.noConflict=function(){return b.Backbone=c,this},a.emulateHTTP=!1,a.emulateJSON=!1;var g=a.Events={on:function(a,b,c){if(!i(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!i(this,"once",a,[b,c])||!b)return this;var d=this,e=f.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,g,h,j,k,l,m;if(!this._events||!i(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(h=a?[a]:f.keys(this._events),j=0,k=h.length;k>j;j++)if(a=h[j],g=this._events[a]){if(this._events[a]=d=[],b||c)for(l=0,m=g.length;m>l;l++)e=g[l],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=e.call(arguments,1);if(!i(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&j(c,b),d&&j(d,arguments),this},stopListening:function(a,b,c){var d=this._listeningTo;if(!d)return this;var e=!b&&!c;c||"object"!=typeof b||(c=this),a&&((d={})[a._listenId]=a);for(var g in d)a=d[g],a.off(b,c,this),(e||f.isEmpty(a._events))&&delete this._listeningTo[g];return this}},h=/\s+/,i=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(h.test(c)){for(var f=c.split(h),g=0,i=f.length;i>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},j=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},k={listenTo:"on",listenToOnce:"once"};f.each(k,function(a,b){g[b]=function(b,c,d){var e=this._listeningTo||(this._listeningTo={}),g=b._listenId||(b._listenId=f.uniqueId("l"));return e[g]=b,d||"object"!=typeof c||(d=this),b[a](c,d,this),this}}),g.bind=g.on,g.unbind=g.off,f.extend(a,g);var l=a.Model=function(a,b){var c=a||{};b||(b={}),this.cid=f.uniqueId("c"),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(c=this.parse(c,b)||{}),c=f.defaults({},c,f.result(this,"defaults")),this.set(c,b),this.changed={},this.initialize.apply(this,arguments)};f.extend(l.prototype,g,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return f.clone(this.attributes)},sync:function(){return a.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return f.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,g,h,i,j,k,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;g=c.unset,i=c.silent,h=[],j=this._changing,this._changing=!0,j||(this._previousAttributes=f.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],f.isEqual(l[d],b)||h.push(d),f.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,g?delete l[d]:l[d]=b;if(!i){h.length&&(this._pending=!0);for(var m=0,n=h.length;n>m;m++)this.trigger("change:"+h[m],this,l[h[m]],c)}if(j)return this;if(!i)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,f.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,f.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!f.isEmpty(this.changed):f.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?f.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)f.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return f.clone(this._previousAttributes)},fetch:function(a){a=a?f.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){return b.set(b.parse(d,a),a)?(c&&c(b,d,a),void b.trigger("sync",b,d,a)):!1},K(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,g,h=this.attributes;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,c=f.extend({validate:!0},c),d&&!c.wait){if(!this.set(d,c))return!1}else if(!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=f.extend({},h,d)),void 0===c.parse&&(c.parse=!0);var i=this,j=c.success;return c.success=function(a){i.attributes=h;var b=i.parse(a,c);return c.wait&&(b=f.extend(d||{},b)),f.isObject(b)&&!i.set(b,c)?!1:(j&&j(i,a,c),void i.trigger("sync",i,a,c))},K(this,c),e=this.isNew()?"create":c.patch?"patch":"update","patch"===e&&(c.attrs=d),g=this.sync(e,this,c),d&&c.wait&&(this.attributes=h),g},destroy:function(a){a=a?f.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},this.isNew())return a.success(),!1;K(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=f.result(this,"urlRoot")||f.result(this.collection,"url")||J();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},f.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=f.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,f.extend(b,{validationError:c})),!1):!0}});var m=["keys","values","pairs","invert","pick","omit"];f.each(m,function(a){l.prototype[a]=function(){var b=e.call(arguments);return b.unshift(this.attributes),f[a].apply(f,b)}});var n=a.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,f.extend({silent:!0},b))},o={add:!0,remove:!0,merge:!0},p={add:!0,remove:!1};f.extend(n.prototype,g,{model:l,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return a.sync.apply(this,arguments)},add:function(a,b){return this.set(a,f.extend({merge:!1},b,p))},remove:function(a,b){var c=!f.isArray(a);a=c?[a]:f.clone(a),b||(b={});var d,e,g,h;for(d=0,e=a.length;e>d;d++)h=a[d]=this.get(a[d]),h&&(delete this._byId[h.id],delete this._byId[h.cid],g=this.indexOf(h),this.models.splice(g,1),this.length--,b.silent||(b.index=g,h.trigger("remove",h,this,b)),this._removeReference(h));return c?a[0]:a},set:function(a,b){b=f.defaults({},b,o),b.parse&&(a=this.parse(a,b));var c=!f.isArray(a);a=c?a?[a]:[]:f.clone(a);var d,e,g,h,i,j,k,m=b.at,n=this.model,p=this.comparator&&null==m&&b.sort!==!1,q=f.isString(this.comparator)?this.comparator:null,r=[],s=[],t={},u=b.add,v=b.merge,w=b.remove,x=!p&&u&&w?[]:!1;for(d=0,e=a.length;e>d;d++){if(i=a[d],g=i instanceof l?h=i:i[n.prototype.idAttribute],j=this.get(g))w&&(t[j.cid]=!0),v&&(i=i===h?h.attributes:i,b.parse&&(i=j.parse(i,b)),j.set(i,b),p&&!k&&j.hasChanged(q)&&(k=!0)),a[d]=j;else if(u){if(h=a[d]=this._prepareModel(i,b),!h)continue;r.push(h),h.on("all",this._onModelEvent,this),this._byId[h.cid]=h,null!=h.id&&(this._byId[h.id]=h)}x&&x.push(j||h)}if(w){for(d=0,e=this.length;e>d;++d)t[(h=this.models[d]).cid]||s.push(h);s.length&&this.remove(s,b)}if(r.length||x&&x.length)if(p&&(k=!0),this.length+=r.length,null!=m)for(d=0,e=r.length;e>d;d++)this.models.splice(m+d,0,r[d]);
else{x&&(this.models.length=0);var y=x||r;for(d=0,e=y.length;e>d;d++)this.models.push(y[d])}if(k&&this.sort({silent:!0}),!b.silent){for(d=0,e=r.length;e>d;d++)(h=r[d]).trigger("add",h,this,b);(k||x&&x.length)&&this.trigger("sort",this,b)}return c?a[0]:a},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),a=this.add(a,f.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),a},push:function(a,b){return this.add(a,f.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return this.add(a,f.extend({at:0},b))},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(){return e.apply(this.models,arguments)},get:function(a){return null==a?void 0:this._byId[a.id]||this._byId[a.cid]||this._byId[a]},at:function(a){return this.models[a]},where:function(a,b){return f.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),f.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(f.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},pluck:function(a){return f.invoke(this.models,"get",a)},fetch:function(a){a=a?f.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},K(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?f.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(a,b,e){e.wait&&c.add(a,e),d&&d(a,b,e)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof l)return a.collection||(a.collection=this),a;b=b?f.clone(b):{},b.collection=this;var c=new this.model(a,b);return c.validationError?(this.trigger("invalid",this,c.validationError,b),!1):c},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var q=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];f.each(q,function(a){n.prototype[a]=function(){var b=e.call(arguments);return b.unshift(this.models),f[a].apply(f,b)}});var r=["groupBy","countBy","sortBy"];f.each(r,function(a){n.prototype[a]=function(b,c){var d=f.isFunction(b)?b:function(a){return a.get(b)};return f[a](this.models,d,c)}});var s=a.View=function(a){this.cid=f.uniqueId("view"),a||(a={}),f.extend(this,f.pick(a,u)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},t=/^(\S+)\s*(.*)$/,u=["model","collection","el","id","attributes","className","tagName","events"];f.extend(s.prototype,g,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(b,c){return this.$el&&this.undelegateEvents(),this.$el=b instanceof a.$?b:a.$(b),this.el=this.$el[0],c!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=f.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];if(f.isFunction(c)||(c=this[a[b]]),c){var d=b.match(t),e=d[1],g=d[2];c=f.bind(c,this),e+=".delegateEvents"+this.cid,""===g?this.$el.on(e,c):this.$el.on(e,g,c)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(f.result(this,"el"),!1);else{var b=f.extend({},f.result(this,"attributes"));this.id&&(b.id=f.result(this,"id")),this.className&&(b["class"]=f.result(this,"className"));var c=a.$("<"+f.result(this,"tagName")+">").attr(b);this.setElement(c,!1)}}}),a.sync=function(b,c,d){var e=w[b];f.defaults(d||(d={}),{emulateHTTP:a.emulateHTTP,emulateJSON:a.emulateJSON});var g={type:e,dataType:"json"};if(d.url||(g.url=f.result(c,"url")||J()),null!=d.data||!c||"create"!==b&&"update"!==b&&"patch"!==b||(g.contentType="application/json",g.data=JSON.stringify(d.attrs||c.toJSON(d))),d.emulateJSON&&(g.contentType="application/x-www-form-urlencoded",g.data=g.data?{model:g.data}:{}),d.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){g.type="POST",d.emulateJSON&&(g.data._method=e);var h=d.beforeSend;d.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",e),h?h.apply(this,arguments):void 0}}"GET"===g.type||d.emulateJSON||(g.processData=!1),"PATCH"===g.type&&v&&(g.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var i=d.xhr=a.ajax(f.extend(g,d));return c.trigger("request",c,i,d),i};var v=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),w={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};a.ajax=function(){return a.$.ajax.apply(a.$,arguments)};var x=a.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},y=/\((.*?)\)/g,z=/(\(\?)?:\w+/g,A=/\*\w+/g,B=/[\-{}\[\]+?.,\\\^$|#\s]/g;f.extend(x.prototype,g,{initialize:function(){},route:function(b,c,d){f.isRegExp(b)||(b=this._routeToRegExp(b)),f.isFunction(c)&&(d=c,c=""),d||(d=this[c]);var e=this;return a.history.route(b,function(f){var g=e._extractParameters(b,f);d&&d.apply(e,g),e.trigger.apply(e,["route:"+c].concat(g)),e.trigger("route",c,g),a.history.trigger("route",e,c,g)}),this},navigate:function(b,c){return a.history.navigate(b,c),this},_bindRoutes:function(){if(this.routes){this.routes=f.result(this,"routes");for(var a,b=f.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(B,"\\$&").replace(y,"(?:$1)?").replace(z,function(a,b){return b?a:"([^/]+)"}).replace(A,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return f.map(c,function(a){return a?decodeURIComponent(a):null})}});var C=a.History=function(){this.handlers=[],f.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},D=/^[#\/]|\s+$/g,E=/^\/+|\/+$/g,F=/msie [\w.]+/,G=/\/$/,H=/[?#].*$/;C.started=!1,f.extend(C.prototype,g,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(G,"");a.indexOf(c)||(a=a.slice(c.length))}else a=this.getHash();return a.replace(D,"")},start:function(b){if(C.started)throw new Error("Backbone.history has already been started");C.started=!0,this.options=f.extend({root:"/"},this.options,b),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var c=this.getFragment(),d=document.documentMode,e=F.exec(navigator.userAgent.toLowerCase())&&(!d||7>=d);this.root=("/"+this.root+"/").replace(E,"/"),e&&this._wantsHashChange&&(this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(c)),this._hasPushState?a.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?a.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=c;var g=this.location,h=g.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!h)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&h&&g.hash&&(this.fragment=this.getHash().replace(D,""),this.history.replaceState({},document.title,this.root+this.fragment+g.search))}return this.options.silent?void 0:this.loadUrl()},stop:function(){a.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),C.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();return a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe))),a===this.fragment?!1:(this.iframe&&this.navigate(a),void this.loadUrl())},loadUrl:function(a){return a=this.fragment=this.getFragment(a),f.any(this.handlers,function(b){return b.route.test(a)?(b.callback(a),!0):void 0})},navigate:function(a,b){if(!C.started)return!1;b&&b!==!0||(b={trigger:!!b});var c=this.root+(a=this.getFragment(a||""));if(a=a.replace(H,""),this.fragment!==a){if(this.fragment=a,""===a&&"/"!==c&&(c=c.slice(0,-1)),this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}return b.trigger?this.loadUrl(a):void 0}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),a.history=new C;var I=function(a,b){var c,d=this;c=a&&f.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},f.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&f.extend(c.prototype,a),c.__super__=d.prototype,c};l.extend=n.extend=x.extend=s.extend=C.extend=I;var J=function(){throw new Error('A "url" property or function must be specified')},K=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}}.call(this),Backbone.Picky=function(a,b){var c={};c.SingleSelect=function(a){this.collection=a},b.extend(c.SingleSelect.prototype,{select:function(a){a&&this.selected===a||(this.deselect(),this.selected=a,this.selected.select(),this.trigger("select:one",a))},deselect:function(a){this.selected&&(a=a||this.selected,this.selected===a&&(this.selected.deselect(),this.trigger("deselect:one",this.selected),delete this.selected))}}),c.MultiSelect=function(a){this.collection=a,this.selected={}},b.extend(c.MultiSelect.prototype,{select:function(a){this.selected[a.cid]||(this.selected[a.cid]=a,a.select(),d(this))},deselect:function(a){this.selected[a.cid]&&(delete this.selected[a.cid],a.deselect(),d(this))},selectAll:function(){this.each(function(a){a.select()}),d(this)},selectNone:function(){0!==this.selectedLength&&(this.each(function(a){a.deselect()}),d(this))},toggleSelectAll:function(){this.selectedLength===this.length?this.selectNone():this.selectAll()}}),c.Selectable=function(a){this.model=a},b.extend(c.Selectable.prototype,{select:function(){this.selected||(this.selected=!0,this.trigger("selected",this),this.collection&&this.collection.select(this))},deselect:function(){this.selected&&(this.selected=!1,this.trigger("deselected",this),this.collection&&this.collection.deselect(this))},toggleSelected:function(){this.selected?this.deselect():this.select()}});var d=function(a){a.selectedLength=b.size(a.selected);var c=a.selectedLength,d=a.length;return c===d?void a.trigger("select:all",a):0===c?void a.trigger("select:none",a):c>0&&d>c?void a.trigger("select:some",a):void 0};return c}(Backbone,_),Backbone.PickThis=function(a,b){var c={};c.SingleSelect=function(a,b){this.namespace=b,this.collection=a,this.collection.on("remove",function(a){a===this.selected&&delete this.selected}),this.collection.on("reset",function(a){a.get(this.selected)||delete this.selected})},b.extend(c.SingleSelect.prototype,{select:function(a){a&&this.selected===a||(this.deselect(),this.selected=a,this.selected.trigger("selected:"+this.namespace),this.trigger("select:one",a))},deselect:function(a){if(this.selected&&(a=a||this.selected,this.selected===a)){var b=this.selected;delete this.selected,b.trigger("deselected:"+this.namespace),this.trigger("deselect:one",b)}}}),c.MultiSelect=function(a,b){this.selected={},this.namespace=b,this.collection=a},b.extend(c.MultiSelect.prototype,{select:function(a){this.selected[a.cid]||(this.selected[a.cid]=a,a.trigger("selected:"+this.namespace),d(this))},deselect:function(a){this.selected[a.cid]&&(delete this.selected[a.cid],a.trigger("deselected:"+this.namespace),d(this))},selectAll:function(){var a=this;this.each(function(b){a.select(b)}),d(this)},selectNone:function(){var a=this;0!==this.selectedLength&&(this.each(function(b){a.deselect(b)}),d(this))},toggleSelectAll:function(){this.selectedLength===this.length?this.selectNone():this.selectAll()}});var d=function(a){a.selectedLength=b.size(a.selected);var c=a.selectedLength,d=a.length;return c===d?void a.trigger("select:all",a):0===c?void a.trigger("select:none",a):c>0&&d>c?void a.trigger("select:some",a):void 0};return c}(Backbone,_),Backbone.ChildViewContainer=function(a,b){var c=function(a){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),b.each(a,this.add,this)};b.extend(c.prototype,{add:function(a,b){var c=a.cid;this._views[c]=a,a.model&&(this._indexByModel[a.model.cid]=c),b&&(this._indexByCustom[b]=c),this._updateLength()},findByModel:function(a){return this.findByModelCid(a.cid)},findByModelCid:function(a){var b=this._indexByModel[a];return this.findByCid(b)},findByCustom:function(a){var b=this._indexByCustom[a];return this.findByCid(b)},findByIndex:function(a){return b.values(this._views)[a]},findByCid:function(a){return this._views[a]},remove:function(a){var c=a.cid;a.model&&delete this._indexByModel[a.model.cid],b.any(this._indexByCustom,function(a,b){return a===c?(delete this._indexByCustom[b],!0):void 0},this),delete this._views[c],this._updateLength()},call:function(a){this.apply(a,b.tail(arguments))},apply:function(a,c){b.each(this._views,function(d){b.isFunction(d[a])&&d[a].apply(d,c||[])})},_updateLength:function(){this.length=b.size(this._views)}});var d=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return b.each(d,function(a){c.prototype[a]=function(){var c=b.values(this._views),d=[c].concat(b.toArray(arguments));return b[a].apply(b,d)}}),c}(Backbone,_),Backbone.Wreqr=function(a,b,c){"use strict";var d={};return d.Handlers=function(a,b){var c=function(a){this.options=a,this._wreqrHandlers={},b.isFunction(this.initialize)&&this.initialize(a)};return c.extend=a.Model.extend,b.extend(c.prototype,a.Events,{setHandlers:function(a){b.each(a,function(a,c){var d=null;b.isObject(a)&&!b.isFunction(a)&&(d=a.context,a=a.callback),this.setHandler(c,a,d)},this)},setHandler:function(a,b,c){var d={callback:b,context:c};this._wreqrHandlers[a]=d,this.trigger("handler:add",a,b,c)},hasHandler:function(a){return!!this._wreqrHandlers[a]},getHandler:function(a){var b=this._wreqrHandlers[a];if(!b)throw new Error("Handler not found for '"+a+"'");return function(){var a=Array.prototype.slice.apply(arguments);return b.callback.apply(b.context,a)}},removeHandler:function(a){delete this._wreqrHandlers[a]},removeAllHandlers:function(){this._wreqrHandlers={}}}),c}(a,c),d.CommandStorage=function(){var b=function(a){this.options=a,this._commands={},c.isFunction(this.initialize)&&this.initialize(a)};return c.extend(b.prototype,a.Events,{getCommands:function(a){var b=this._commands[a];return b||(b={command:a,instances:[]},this._commands[a]=b),b},addCommand:function(a,b){var c=this.getCommands(a);c.instances.push(b)},clearCommands:function(a){var b=this.getCommands(a);b.instances=[]}}),b}(),d.Commands=function(a){return a.Handlers.extend({storageType:a.CommandStorage,constructor:function(b){this.options=b||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this);var c=Array.prototype.slice.call(arguments);a.Handlers.prototype.constructor.apply(this,c)},execute:function(a,b){a=arguments[0],b=Array.prototype.slice.call(arguments,1),this.hasHandler(a)?this.getHandler(a).apply(this,b):this.storage.addCommand(a,b)},_executeCommands:function(a,b,d){var e=this.storage.getCommands(a);c.each(e.instances,function(a){b.apply(d,a)}),this.storage.clearCommands(a)},_initializeStorage:function(a){var b,d=a.storageType||this.storageType;b=c.isFunction(d)?new d:d,this.storage=b}})}(d),d.RequestResponse=function(a){return a.Handlers.extend({request:function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);return this.getHandler(a).apply(this,b)}})}(d),d.EventAggregator=function(a,b){var c=function(){};return c.extend=a.Model.extend,b.extend(c.prototype,a.Events),c}(a,c),d}(Backbone,Backbone.Marionette,_);var Marionette=function(a,b,c){"use strict";function d(a){return g.call(a)}function e(a,b){var c=new Error(a);throw c.name=b||"Error",c}var f={};b.Marionette=f,f.$=b.$;var g=Array.prototype.slice;return f.extend=b.Model.extend,f.getOption=function(a,b){if(a&&b){var c;return c=a.options&&b in a.options&&void 0!==a.options[b]?a.options[b]:a[b]}},f.triggerMethod=function(){function a(a,b,c){return c.toUpperCase()}var b=/(^|:)(\w)/gi,d=function(d){var e="on"+d.replace(b,a),f=this[e];return c.isFunction(this.trigger)&&this.trigger.apply(this,arguments),c.isFunction(f)?f.apply(this,c.tail(arguments)):void 0};return d}(),f.MonitorDOMRefresh=function(a){function b(a){a._isShown=!0,e(a)}function d(a){a._isRendered=!0,e(a)}function e(a){a._isShown&&a._isRendered&&f(a)&&c.isFunction(a.triggerMethod)&&a.triggerMethod("dom:refresh")}function f(b){return a.contains(b.el)}return function(a){a.listenTo(a,"show",function(){b(a)}),a.listenTo(a,"render",function(){d(a)})}}(document.documentElement),function(a){function b(a,b,d,f){var g=f.split(/\s+/);c.each(g,function(c){var f=a[c];f||e("Method '"+c+"' was configured as an event handler, but does not exist."),a.listenTo(b,d,f,a)})}function d(a,b,c,d){a.listenTo(b,c,d,a)}function f(a,b,d,e){var f=e.split(/\s+/);c.each(f,function(c){var e=a[c];a.stopListening(b,d,e,a)})}function g(a,b,c,d){a.stopListening(b,c,d,a)}function h(a,b,d,e,f){b&&d&&(c.isFunction(d)&&(d=d.call(a)),c.each(d,function(d,g){c.isFunction(d)?e(a,b,g,d):f(a,b,g,d)}))}a.bindEntityEvents=function(a,c,e){h(a,c,e,d,b)},a.unbindEntityEvents=function(a,b,c){h(a,b,c,g,f)}}(f),f.Callbacks=function(){this._deferred=f.$.Deferred(),this._callbacks=[]},c.extend(f.Callbacks.prototype,{add:function(a,b){this._callbacks.push({cb:a,ctx:b}),this._deferred.done(function(c,d){b&&(c=b),a.call(c,d)})},run:function(a,b){this._deferred.resolve(b,a)},reset:function(){var a=this._callbacks;this._deferred=f.$.Deferred(),this._callbacks=[],c.each(a,function(a){this.add(a.cb,a.ctx)},this)}}),f.Controller=function(a){this.triggerMethod=f.triggerMethod,this.options=a||{},c.isFunction(this.initialize)&&this.initialize(this.options)},f.Controller.extend=f.extend,c.extend(f.Controller.prototype,b.Events,{close:function(){this.stopListening(),this.triggerMethod("close"),this.unbind()}}),f.Region=function(a){if(this.options=a||{},this.el=f.getOption(this,"el"),!this.el){var b=new Error("An 'el' must be specified for a region.");throw b.name="NoElError",b}if(this.initialize){var c=Array.prototype.slice.apply(arguments);this.initialize.apply(this,c)}},c.extend(f.Region,{buildRegion:function(a,b){var d="string"==typeof a,e="string"==typeof a.selector,f="undefined"==typeof a.regionType,g="function"==typeof a;if(!g&&!d&&!e)throw new Error("Region must be specified as a Region type, a selector string or an object with selector property");var h,i;d&&(h=a),a.selector&&(h=a.selector,delete a.selector),g&&(i=a),!g&&f&&(i=b),a.regionType&&(i=a.regionType,delete a.regionType),(d||g)&&(a={}),a.el=h;var j=new i(a);return a.parentEl&&(j.getEl=function(b){var d=a.parentEl;return c.isFunction(d)&&(d=d()),d.find(b)}),j}}),c.extend(f.Region.prototype,b.Events,{show:function(a){this.ensureEl();var b=a.isClosed||c.isUndefined(a.$el),d=a!==this.currentView;d&&this.close(),a.render(),(d||b)&&this.open(a),this.currentView=a,f.triggerMethod.call(this,"show",a),f.triggerMethod.call(a,"show")},ensureEl:function(){this.$el&&0!==this.$el.length||(this.$el=this.getEl(this.el))},getEl:function(a){return f.$(a)},open:function(a){this.$el.empty().append(a.el)},close:function(){var a=this.currentView;a&&!a.isClosed&&(a.close?a.close():a.remove&&a.remove(),f.triggerMethod.call(this,"close",a),delete this.currentView)},attachView:function(a){this.currentView=a},reset:function(){this.close(),delete this.$el}}),f.Region.extend=f.extend,f.RegionManager=function(a){var b=a.Controller.extend({constructor:function(b){this._regions={},a.Controller.prototype.constructor.call(this,b)},addRegions:function(a,b){var d={};return c.each(a,function(a,e){"string"==typeof a&&(a={selector:a}),a.selector&&(a=c.defaults({},a,b));var f=this.addRegion(e,a);d[e]=f},this),d},addRegion:function(b,d){var e,f=c.isObject(d),g=c.isString(d),h=!!d.selector;return e=g||f&&h?a.Region.buildRegion(d,a.Region):c.isFunction(d)?a.Region.buildRegion(d,a.Region):d,this._store(b,e),this.triggerMethod("region:add",b,e),e},get:function(a){return this._regions[a]},removeRegion:function(a){var b=this._regions[a];this._remove(a,b)},removeRegions:function(){c.each(this._regions,function(a,b){this._remove(b,a)},this)},closeRegions:function(){c.each(this._regions,function(a){a.close()},this)},close:function(){this.removeRegions();var b=Array.prototype.slice.call(arguments);a.Controller.prototype.close.apply(this,b)},_store:function(a,b){this._regions[a]=b,this._setLength()},_remove:function(a,b){b.close(),delete this._regions[a],this._setLength(),this.triggerMethod("region:remove",a,b)},_setLength:function(){this.length=c.size(this._regions)}}),d=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];return c.each(d,function(a){b.prototype[a]=function(){var b=c.values(this._regions),d=[b].concat(c.toArray(arguments));return c[a].apply(c,d)}}),b}(f),f.TemplateCache=function(a){this.templateId=a},c.extend(f.TemplateCache,{templateCaches:{},get:function(a){var b=this.templateCaches[a];return b||(b=new f.TemplateCache(a),this.templateCaches[a]=b),b.load()},clear:function(){var a,b=d(arguments),c=b.length;if(c>0)for(a=0;c>a;a++)delete this.templateCaches[b[a]];else this.templateCaches={}}}),c.extend(f.TemplateCache.prototype,{load:function(){if(this.compiledTemplate)return this.compiledTemplate;var a=this.loadTemplate(this.templateId);return this.compiledTemplate=this.compileTemplate(a),this.compiledTemplate},loadTemplate:function(a){var b=f.$(a).html();return b&&0!==b.length||e("Could not find template: '"+a+"'","NoTemplateError"),b},compileTemplate:function(a){return c.template(a)}}),f.Renderer={render:function(a,b){if(!a){var c=new Error("Cannot render the template since it's false, null or undefined.");throw c.name="TemplateNotFoundError",c}var d;return(d="function"==typeof a?a:f.TemplateCache.get(a))(b)}},f.View=b.View.extend({constructor:function(a){c.bindAll(this,"render");var d=Array.prototype.slice.apply(arguments);this.options=c.extend({},c.result(this,"options"),c.isFunction(a)?a.call(this):a),this.events=this.normalizeUIKeys(c.result(this,"events")),b.View.prototype.constructor.apply(this,d),f.MonitorDOMRefresh(this),this.listenTo(this,"show",this.onShowCalled,this)},triggerMethod:f.triggerMethod,getTemplate:function(){return f.getOption(this,"template")},mixinTemplateHelpers:function(a){a=a||{};var b=f.getOption(this,"templateHelpers");return c.isFunction(b)&&(b=b.call(this)),c.extend(a,b)},normalizeUIKeys:function(a){return"undefined"!=typeof a?(c.each(c.keys(a),function(b){var c=b.split("@ui.");2===c.length&&(a[c[0]+this.ui[c[1]]]=a[b],delete a[b])},this),a):void 0},configureTriggers:function(){if(this.triggers){var a={},b=this.normalizeUIKeys(c.result(this,"triggers"));return c.each(b,function(b,d){var e=c.isObject(b),f=e?b.event:b;a[d]=function(a){if(a){var c=a.preventDefault,d=a.stopPropagation,g=e?b.preventDefault:c,h=e?b.stopPropagation:d;g&&c&&c.apply(a),h&&d&&d.apply(a)}var i={view:this,model:this.model,collection:this.collection};this.triggerMethod(f,i)}},this),a}},delegateEvents:function(a){this._delegateDOMEvents(a),f.bindEntityEvents(this,this.model,f.getOption(this,"modelEvents")),f.bindEntityEvents(this,this.collection,f.getOption(this,"collectionEvents"))},_delegateDOMEvents:function(a){a=a||this.events,c.isFunction(a)&&(a=a.call(this));var d={},e=this.configureTriggers();c.extend(d,a,e),b.View.prototype.delegateEvents.call(this,d)},undelegateEvents:function(){var a=Array.prototype.slice.call(arguments);b.View.prototype.undelegateEvents.apply(this,a),f.unbindEntityEvents(this,this.model,f.getOption(this,"modelEvents")),f.unbindEntityEvents(this,this.collection,f.getOption(this,"collectionEvents"))},onShowCalled:function(){},close:function(){if(!this.isClosed){var a=this.triggerMethod("before:close");a!==!1&&(this.isClosed=!0,this.triggerMethod("close"),this.unbindUIElements(),this.remove())}},bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var a=c.result(this,"_uiBindings");this.ui={},c.each(c.keys(a),function(b){var c=a[b];this.ui[b]=this.$(c)},this)}},unbindUIElements:function(){this.ui&&this._uiBindings&&(c.each(this.ui,function(a,b){delete this.ui[b]},this),this.ui=this._uiBindings,delete this._uiBindings)}}),f.ItemView=f.View.extend({constructor:function(){f.View.prototype.constructor.apply(this,d(arguments))},serializeData:function(){var a={};return this.model?a=this.model.toJSON():this.collection&&(a={items:this.collection.toJSON()}),a},render:function(){this.isClosed=!1,this.triggerMethod("before:render",this),this.triggerMethod("item:before:render",this);var a=this.serializeData();a=this.mixinTemplateHelpers(a);var b=this.getTemplate(),c=f.Renderer.render(b,a);return this.$el.html(c),this.bindUIElements(),this.triggerMethod("render",this),this.triggerMethod("item:rendered",this),this},close:function(){this.isClosed||(this.triggerMethod("item:before:close"),f.View.prototype.close.apply(this,d(arguments)),this.triggerMethod("item:closed"))}}),f.CollectionView=f.View.extend({itemViewEventPrefix:"itemview",constructor:function(){this._initChildViewStorage(),f.View.prototype.constructor.apply(this,d(arguments)),this._initialEvents(),this.initRenderBuffer()},initRenderBuffer:function(){this.elBuffer=document.createDocumentFragment(),this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){this.isBuffering=!1,this.appendBuffer(this,this.elBuffer),this._triggerShowBufferedChildren(),this.initRenderBuffer()},_triggerShowBufferedChildren:function(){this._isShown&&(c.each(this._bufferedChildren,function(a){f.triggerMethod.call(a,"show")}),this._bufferedChildren=[])},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView,this),this.listenTo(this.collection,"remove",this.removeItemView,this),this.listenTo(this.collection,"reset",this.render,this))},addChildView:function(a){this.closeEmptyView();var b=this.getItemView(a),c=this.collection.indexOf(a);this.addItemView(a,b,c)},onShowCalled:function(){this.children.each(function(a){f.triggerMethod.call(a,"show")})},triggerBeforeRender:function(){this.triggerMethod("before:render",this),this.triggerMethod("collection:before:render",this)},triggerRendered:function(){this.triggerMethod("render",this),this.triggerMethod("collection:rendered",this)},render:function(){return this.isClosed=!1,this.triggerBeforeRender(),this._renderChildren(),this.triggerRendered(),this},_renderChildren:function(){this.startBuffering(),this.closeEmptyView(),this.closeChildren(),this.collection&&this.collection.length>0?this.showCollection():this.showEmptyView(),this.endBuffering()},showCollection:function(){var a;this.collection.each(function(b,c){a=this.getItemView(b),this.addItemView(b,a,c)},this)},showEmptyView:function(){var a=this.getEmptyView();if(a&&!this._showingEmptyView){this._showingEmptyView=!0;var c=new b.Model;this.addItemView(c,a,0)}},closeEmptyView:function(){this._showingEmptyView&&(this.closeChildren(),delete this._showingEmptyView)},getEmptyView:function(){return f.getOption(this,"emptyView")},getItemView:function(){var a=f.getOption(this,"itemView");return a||e("An `itemView` must be specified","NoItemViewError"),a},addItemView:function(a,b,d){var e=f.getOption(this,"itemViewOptions");c.isFunction(e)&&(e=e.call(this,a,d));var g=this.buildItemView(a,b,e);return this.addChildViewEventForwarding(g),this.triggerMethod("before:item:added",g),this.children.add(g),this.renderItemView(g,d),this._isShown&&!this.isBuffering&&f.triggerMethod.call(g,"show"),this.triggerMethod("after:item:added",g),g},addChildViewEventForwarding:function(a){var b=f.getOption(this,"itemViewEventPrefix");this.listenTo(a,"all",function(){var e=d(arguments),g=e[0],h=this.getItemEvents();e[0]=b+":"+g,e.splice(1,0,a),"undefined"!=typeof h&&c.isFunction(h[g])&&h[g].apply(this,e),f.triggerMethod.apply(this,e)},this)},getItemEvents:function(){return c.isFunction(this.itemEvents)?this.itemEvents.call(this):this.itemEvents},renderItemView:function(a,b){a.render(),this.appendHtml(this,a,b)},buildItemView:function(a,b,d){var e=c.extend({model:a},d);return new b(e)},removeItemView:function(a){var b=this.children.findByModel(a);this.removeChildView(b),this.checkEmpty()},removeChildView:function(a){a&&(this.stopListening(a),a.close?a.close():a.remove&&a.remove(),this.children.remove(a)),this.triggerMethod("item:removed",a)},checkEmpty:function(){this.collection&&0!==this.collection.length||this.showEmptyView()},appendBuffer:function(a,b){a.$el.append(b)},appendHtml:function(a,b){a.isBuffering?(a.elBuffer.appendChild(b.el),a._bufferedChildren.push(b)):a.$el.append(b.el)},_initChildViewStorage:function(){this.children=new b.ChildViewContainer},close:function(){this.isClosed||(this.triggerMethod("collection:before:close"),this.closeChildren(),this.triggerMethod("collection:closed"),f.View.prototype.close.apply(this,d(arguments)))},closeChildren:function(){this.children.each(function(a){this.removeChildView(a)},this),this.checkEmpty()}}),f.CompositeView=f.CollectionView.extend({constructor:function(){f.CollectionView.prototype.constructor.apply(this,d(arguments))},_initialEvents:function(){this.once("render",function(){this.collection&&(this.listenTo(this.collection,"add",this.addChildView,this),this.listenTo(this.collection,"remove",this.removeItemView,this),this.listenTo(this.collection,"reset",this._renderChildren,this))})},getItemView:function(){var a=f.getOption(this,"itemView")||this.constructor;return a||e("An `itemView` must be specified","NoItemViewError"),a},serializeData:function(){var a={};return this.model&&(a=this.model.toJSON()),a},render:function(){this.isRendered=!0,this.isClosed=!1,this.resetItemViewContainer(),this.triggerBeforeRender();var a=this.renderModel();return this.$el.html(a),this.bindUIElements(),this.triggerMethod("composite:model:rendered"),this._renderChildren(),this.triggerMethod("composite:rendered"),this.triggerRendered(),this
},_renderChildren:function(){this.isRendered&&(f.CollectionView.prototype._renderChildren.call(this),this.triggerMethod("composite:collection:rendered"))},renderModel:function(){var a={};a=this.serializeData(),a=this.mixinTemplateHelpers(a);var b=this.getTemplate();return f.Renderer.render(b,a)},appendBuffer:function(a,b){var c=this.getItemViewContainer(a);c.append(b)},appendHtml:function(a,b){if(a.isBuffering)a.elBuffer.appendChild(b.el),a._bufferedChildren.push(b);else{var c=this.getItemViewContainer(a);c.append(b.el)}},getItemViewContainer:function(a){if("$itemViewContainer"in a)return a.$itemViewContainer;var b,d=f.getOption(a,"itemViewContainer");if(d){var g=c.isFunction(d)?d.call(this):d;b=a.$(g),b.length<=0&&e("The specified `itemViewContainer` was not found: "+a.itemViewContainer,"ItemViewContainerMissingError")}else b=a.$el;return a.$itemViewContainer=b,b},resetItemViewContainer:function(){this.$itemViewContainer&&delete this.$itemViewContainer}}),f.Layout=f.ItemView.extend({regionType:f.Region,constructor:function(a){a=a||{},this._firstRender=!0,this._initializeRegions(a),f.ItemView.prototype.constructor.call(this,a)},render:function(){this.isClosed&&this._initializeRegions(),this._firstRender?this._firstRender=!1:this.isClosed||this._reInitializeRegions();var a=Array.prototype.slice.apply(arguments),b=f.ItemView.prototype.render.apply(this,a);return b},close:function(){if(!this.isClosed){this.regionManager.close();var a=Array.prototype.slice.apply(arguments);f.ItemView.prototype.close.apply(this,a)}},addRegion:function(a,b){var c={};return c[a]=b,this._buildRegions(c)[a]},addRegions:function(a){return this.regions=c.extend({},this.regions,a),this._buildRegions(a)},removeRegion:function(a){return delete this.regions[a],this.regionManager.removeRegion(a)},_buildRegions:function(a){var b=this,c={regionType:f.getOption(this,"regionType"),parentEl:function(){return b.$el}};return this.regionManager.addRegions(a,c)},_initializeRegions:function(a){var b;this._initRegionManager(),b=c.isFunction(this.regions)?this.regions(a):this.regions||{},this.addRegions(b)},_reInitializeRegions:function(){this.regionManager.closeRegions(),this.regionManager.each(function(a){a.reset()})},_initRegionManager:function(){this.regionManager=new f.RegionManager,this.listenTo(this.regionManager,"region:add",function(a,b){this[a]=b,this.trigger("region:add",a,b)}),this.listenTo(this.regionManager,"region:remove",function(a,b){delete this[a],this.trigger("region:remove",a,b)})}}),f.AppRouter=b.Router.extend({constructor:function(a){b.Router.prototype.constructor.apply(this,d(arguments)),this.options=a||{};var c=f.getOption(this,"appRoutes"),e=this._getController();this.processAppRoutes(e,c)},appRoute:function(a,b){var c=this._getController();this._addAppRoute(c,a,b)},processAppRoutes:function(a,b){if(b){var d=c.keys(b).reverse();c.each(d,function(c){this._addAppRoute(a,c,b[c])},this)}},_getController:function(){return f.getOption(this,"controller")},_addAppRoute:function(a,b,d){var e=a[d];if(!e)throw new Error("Method '"+d+"' was not found on the controller");this.route(b,d,c.bind(e,a))}}),f.Application=function(a){this._initRegionManager(),this._initCallbacks=new f.Callbacks,this.vent=new b.Wreqr.EventAggregator,this.commands=new b.Wreqr.Commands,this.reqres=new b.Wreqr.RequestResponse,this.submodules={},c.extend(this,a),this.triggerMethod=f.triggerMethod},c.extend(f.Application.prototype,b.Events,{execute:function(){var a=Array.prototype.slice.apply(arguments);this.commands.execute.apply(this.commands,a)},request:function(){var a=Array.prototype.slice.apply(arguments);return this.reqres.request.apply(this.reqres,a)},addInitializer:function(a){this._initCallbacks.add(a)},start:function(a){this.triggerMethod("initialize:before",a),this._initCallbacks.run(a,this),this.triggerMethod("initialize:after",a),this.triggerMethod("start",a)},addRegions:function(a){return this._regionManager.addRegions(a)},closeRegions:function(){this._regionManager.closeRegions()},removeRegion:function(a){this._regionManager.removeRegion(a)},getRegion:function(a){return this._regionManager.get(a)},module:function(){var a=d(arguments);return a.unshift(this),f.Module.create.apply(f.Module,a)},_initRegionManager:function(){this._regionManager=new f.RegionManager,this.listenTo(this._regionManager,"region:add",function(a,b){this[a]=b}),this.listenTo(this._regionManager,"region:remove",function(a){delete this[a]})}}),f.Application.extend=f.extend,f.Module=function(a,b){this.moduleName=a,this.submodules={},this._setupInitializersAndFinalizers(),this.app=b,this.startWithParent=!0,this.triggerMethod=f.triggerMethod},c.extend(f.Module.prototype,b.Events,{addInitializer:function(a){this._initializerCallbacks.add(a)},addFinalizer:function(a){this._finalizerCallbacks.add(a)},start:function(a){this._isInitialized||(c.each(this.submodules,function(b){b.startWithParent&&b.start(a)}),this.triggerMethod("before:start",a),this._initializerCallbacks.run(a,this),this._isInitialized=!0,this.triggerMethod("start",a))},stop:function(){this._isInitialized&&(this._isInitialized=!1,f.triggerMethod.call(this,"before:stop"),c.each(this.submodules,function(a){a.stop()}),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),f.triggerMethod.call(this,"stop"))},addDefinition:function(a,b){this._runModuleDefinition(a,b)},_runModuleDefinition:function(a,d){if(a){var e=c.flatten([this,this.app,b,f,f.$,c,d]);a.apply(this,e)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new f.Callbacks,this._finalizerCallbacks=new f.Callbacks}}),c.extend(f.Module,{create:function(a,b,e){var f=a,g=d(arguments);g.splice(0,3),b=b.split(".");var h=b.length,i=[];return i[h-1]=e,c.each(b,function(b,c){var d=f;f=this._getModule(d,b,a),this._addModuleDefinition(d,f,i[c],g)},this),f},_getModule:function(a,b,c){var d=a[b];return d||(d=new f.Module(b,c),a[b]=d,a.submodules[b]=d),d},_addModuleDefinition:function(a,b,d,e){var f,g;c.isFunction(d)?(f=d,g=!0):c.isObject(d)?(f=d.define,g=d.startWithParent):g=!0,f&&b.addDefinition(f,e),b.startWithParent=b.startWithParent&&g,b.startWithParent&&!b.startWithParentIsConfigured&&(b.startWithParentIsConfigured=!0,a.addInitializer(function(a){b.startWithParent&&b.start(a)}))}}),f}(this,Backbone,_);!function(){"use strict";function a(a,b,c,d){var e=c.split(":");if(e.length){var f=$.Deferred(),g=Array.prototype.slice.call(d,1);return f.resolve(),_.forEach(e,function(b,c){var d=e.slice(0,c+1).join(":")+":*";a.hasHandler(d)&&(f=f.then(function(){return a.getHandler(d).apply(a,g)}))}),f=f.then(function(){return b.apply(a,d)}),f.promise()}return b.apply(a,d)}var b=Backbone.Wreqr.Commands.prototype.execute;Backbone.Wreqr.Commands.prototype.execute=function(c){return a(this,b,c,arguments)},Backbone.Wreqr.RequestResponse.prototype.asyncRequest=function(b){return a(this,Backbone.Wreqr.RequestResponse.prototype.request,b,arguments)}}(),Backbone.Validation=function(a){"use strict";var b={forceUpdate:!1,selector:"name",labelFormatter:"sentenceCase",valid:Function.prototype,invalid:Function.prototype},c={formatLabel:function(a,c){return i[b.labelFormatter](a,c)},format:function(){var a=Array.prototype.slice.call(arguments),b=a.shift();return b.replace(/\{(\d+)\}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})}},d=function(b,c,e){return c=c||{},e=e||"",a.each(b,function(a,f){b.hasOwnProperty(f)&&(a&&"object"==typeof a&&!(a instanceof Array||a instanceof Date||a instanceof RegExp||a instanceof Backbone.Model||a instanceof Backbone.Collection)?d(a,c,e+f+"."):c[e+f]=a)}),c},e=function(){var e=function(b){return a.reduce(a.keys(a.result(b,"validation")||{}),function(a,b){return a[b]=void 0,a},{})},g=function(b,c){var d=b.validation?a.result(b,"validation")[c]||{}:{};return(a.isFunction(d)||a.isString(d))&&(d={fn:d}),a.isArray(d)||(d=[d]),a.reduce(d,function(b,c){return a.each(a.without(a.keys(c),"msg"),function(a){b.push({fn:j[a],val:c[a],msg:c.msg})}),b},[])},h=function(b,d,e,f){return a.reduce(g(b,d),function(g,h){var i=a.extend({},c,j),k=h.fn.call(i,e,d,h.val,b,f);return k===!1||g===!1?!1:k&&!g?a.result(h,"msg")||k:g},"")},i=function(b,c){var e,f={},g=!0,i=a.clone(c),j=d(c);return a.each(j,function(a,c){e=h(b,c,a,i),e&&(f[c]=e,g=!1)}),{invalidAttrs:f,isValid:g}},k=function(b,c){return{preValidate:function(b,c){var d,e=this,f={};return a.isObject(b)?(a.each(b,function(a,b){d=e.preValidate(b,a),d&&(f[b]=d)}),a.isEmpty(f)?void 0:f):h(this,b,c,a.extend({},this.attributes))},isValid:function(b){var c=d(this.attributes);return a.isString(b)?!h(this,b,c[b],a.extend({},this.attributes)):a.isArray(b)?a.reduce(b,function(b,d){return b&&!h(this,d,c[d],a.extend({},this.attributes))},!0,this):(b===!0&&this.validate(),this.validation?this._isValid:!0)},validate:function(f,g){var h=this,j=!f,k=a.extend({},c,g),l=e(h),m=a.extend({},l,h.attributes,f),n=d(f||m),o=i(h,m);return h._isValid=o.isValid,a.each(l,function(a,c){var d=o.invalidAttrs.hasOwnProperty(c);d||k.valid(b,c,k.selector)}),a.each(l,function(a,c){var d=o.invalidAttrs.hasOwnProperty(c),e=n.hasOwnProperty(c);d&&(e||j)&&k.invalid(b,c,o.invalidAttrs[c],k.selector)}),a.defer(function(){h.trigger("validated",h._isValid,h,o.invalidAttrs),h.trigger("validated:"+(h._isValid?"valid":"invalid"),h,o.invalidAttrs)}),!k.forceUpdate&&a.intersection(a.keys(o.invalidAttrs),a.keys(n)).length>0?o.invalidAttrs:void 0}}},l=function(b,c,d){a.extend(c,k(b,d))},m=function(a){delete a.validate,delete a.preValidate,delete a.isValid},n=function(a){l(this.view,a,this.options)},o=function(a){m(a)};return{version:"0.8.2",configure:function(c){a.extend(b,c)},bind:function(c,d){d=a.extend({},b,f,d);var e=d.model||c.model,g=d.collection||c.collection;if("undefined"==typeof e&&"undefined"==typeof g)throw"Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.";e?l(c,e,d):g&&(g.each(function(a){l(c,a,d)}),g.bind("add",n,{view:c,options:d}),g.bind("remove",o))},unbind:function(b,c){c=a.extend({},c);var d=c.model||b.model,e=c.collection||b.collection;d&&m(d),e&&(e.each(function(a){m(a)}),e.unbind("add",n),e.unbind("remove",o))},mixin:k(null,b)}}(),f=e.callbacks={valid:function(a,b,c){a.$("["+c+'~="'+b+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(a,b,c,d){a.$("["+d+'~="'+b+'"]').addClass("invalid").attr("data-error",c)}},g=e.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},h=e.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",pattern:"{0} must be a valid {1}"},i=e.labelFormatters={none:function(a){return a},sentenceCase:function(a){return a.replace(/(?:^\w|[A-Z]|\b\w)/g,function(a,b){return 0===b?a.toUpperCase():" "+a.toLowerCase()}).replace(/_/g," ")},label:function(a,b){return b.labels&&b.labels[a]||i.sentenceCase(a,b)}},j=e.validators=function(){var b=String.prototype.trim?function(a){return null===a?"":String.prototype.trim.call(a)}:function(a){var b=/^\s+/,c=/\s+$/;return null===a?"":a.toString().replace(b,"").replace(c,"")},c=function(b){return a.isNumber(b)||a.isString(b)&&b.match(g.number)},d=function(c){return!(a.isNull(c)||a.isUndefined(c)||a.isString(c)&&""===b(c)||a.isArray(c)&&a.isEmpty(c))};return{fn:function(b,c,d,e,f){return a.isString(d)&&(d=e[d]),d.call(e,b,c,f)},required:function(b,c,e,f,g){var i=a.isFunction(e)?e.call(f,b,c,g):e;return i||d(b)?i&&!d(b)?this.format(h.required,this.formatLabel(c,f)):void 0:!1},acceptance:function(b,c,d,e){return"true"===b||a.isBoolean(b)&&b!==!1?void 0:this.format(h.acceptance,this.formatLabel(c,e))},min:function(a,b,d,e){return!c(a)||d>a?this.format(h.min,this.formatLabel(b,e),d):void 0},max:function(a,b,d,e){return!c(a)||a>d?this.format(h.max,this.formatLabel(b,e),d):void 0},range:function(a,b,d,e){return!c(a)||a<d[0]||a>d[1]?this.format(h.range,this.formatLabel(b,e),d[0],d[1]):void 0},length:function(a,c,e,f){return d(a)&&b(a).length===e?void 0:this.format(h.length,this.formatLabel(c,f),e)},minLength:function(a,c,e,f){return!d(a)||b(a).length<e?this.format(h.minLength,this.formatLabel(c,f),e):void 0},maxLength:function(a,c,e,f){return!d(a)||b(a).length>e?this.format(h.maxLength,this.formatLabel(c,f),e):void 0},rangeLength:function(a,c,e,f){return!d(a)||b(a).length<e[0]||b(a).length>e[1]?this.format(h.rangeLength,this.formatLabel(c,f),e[0],e[1]):void 0},oneOf:function(b,c,d,e){return a.include(d,b)?void 0:this.format(h.oneOf,this.formatLabel(c,e),d.join(", "))},equalTo:function(a,b,c,d,e){return a!==e[c]?this.format(h.equalTo,this.formatLabel(b,d),this.formatLabel(c,d)):void 0},pattern:function(a,b,c,e){return d(a)&&a.toString().match(g[c]||c)?void 0:this.format(h.pattern,this.formatLabel(b,e),c)}}}();return e}(_),function(a,b){"use strict";"function"==typeof define&&define.amd?define(["underscore","backbone"],b):a.Backbone.Poller=b(a._,a.Backbone)}(this,function(a,b){"use strict";function c(b){return a.find(j,function(a){return a.model===b})}function d(a,b){this.model=a,this.set(b)}function e(b){if(b.options.delayed)return void f(b);if(g(b)){var c=a.extend({},b.options,{success:function(){b.trigger("success",b.model),f(b)},error:function(){var a=b.xhr;b.stop({silent:!0}),b.trigger("error",b.model,a)}});b.trigger("fetch",b.model),b.xhr=b.model.fetch(c)}}function f(b){g(b)&&(b.options.delayed=!1,b.timeoutId=a.delay(e,b.options.delay,b))}function g(a){return a.options.condition(a.model)!==!0?(a.stop({silent:!0}),a.trigger("complete",a.model),!1):!0}var h={delay:1e3,condition:function(){return!0}},i=["start","stop","fetch","success","error","complete"],j=[],k={get:function(a,b){var e=c(a);return e?e.set(b):(e=new d(a,b),j.push(e)),b&&b.autostart===!0&&e.start({silent:!0}),e},size:function(){return j.length},reset:function(){for(;j.length;)j.pop().stop()}};return a.extend(d.prototype,b.Events,{getOptions:function(){return this.options},set:function(c){return this.off(),this.options=a.extend({},h,c||{}),a.each(i,function(b){var c=this.options[b];a.isFunction(c)&&this.on(b,c,this)},this),this.model instanceof b.Model&&this.model.on("destroy",this.stop,this),this.stop({silent:!0})},start:function(a){return this.active()||(a&&a.silent||this.trigger("start",this.model),this.options.active=!0,e(this)),this},stop:function(a){return a&&a.silent||this.trigger("stop",this.model),this.options.active=!1,this.xhr&&this.xhr.abort&&this.xhr.abort(),this.xhr=null,clearTimeout(this.timeoutId),this.timeoutId=null,this},active:function(){return this.options.active===!0}}),k}),function(a,b){"object"==typeof exports&&a.require?module.exports=b(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],function(c,d){return b(c||a._,d||a.Backbone)}):b(_,Backbone)}(this,function(a,b){function c(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(p,""),d=this.location.search;a.indexOf(c)||(a=a.substr(c.length)),d&&(a+=d)}else a=this.getHash();return a.replace(o,"")}function d(a){return decodeURIComponent(a.replace(/\+/g," "))}function e(b,c){var d=b.split("&");a.each(d,function(a){var b=a.split("=");c(b.shift(),b.join("="))})}var f=/^\?(.*)/,g=/\((.*?)\)/g,h=/(\(\?)?:\w+/g,i=/\*\w+/g,j=/[\-{}\[\]+?.,\\\^$|#\s]/g,k=/(\?.*)$/,l=/^([^\?]*)/,m=/(\?)[\w-]+/i,n=/[\:\*]([^\:\?\/]+)/g,o=/^[#\/]|\s+$/g,p=/\/$/;b.Router.arrayValueSplit="|",a.extend(b.History.prototype,{getFragment:function(a){var b=this._wantsHashChange&&this._wantsPushState&&!this._hasPushState,d=c.apply(this,arguments);return null!=a||null!=d||m.test(d)?b&&(d=d.replace(k,"")):d+=this.location.search,d},getQueryParameters:function(b){b=c.apply(this,arguments);var g=b.replace(l,""),h=g.match(f);if(h){g=h[1];var i={};return e(g,function(b,c){c=d(c),i[b]?a.isString(i[b])?i[b]=[i[b],c]:i[b].push(c):i[b]=c}),i}return{}}}),a.extend(b.Router.prototype,{initialize:function(a){this.encodedSplatParts=a&&a.encodedSplatParts},getFragment:function(a,b,d){return a=c.apply(this,arguments),d&&(a=a.replace(k,"")),a},_routeToRegExp:function(b){var c=i.exec(b)||{index:-1},d=h.exec(b)||{index:-1},e=b.match(n)||[];b=b.replace(j,"\\$&").replace(g,"(?:$1)?").replace(h,function(a,b){return b?a:"([^\\/\\?]+)"}).replace(i,"([^??]*?)"),b+="(\\?.*)?";var f=new RegExp("^"+b+"$");return c.index>=0&&(f.splatMatch=d>=0?c.index-d.index:-1),f.paramNames=a.map(e,function(a){return a.substring(1)}),f.namedParameters=this.namedParameters,f},_extractParameters:function(c,g){var h=c.exec(g).slice(1),i={};h.length>0&&a.isUndefined(h[h.length-1])&&h.splice(h.length-1,1);var j=h.length&&h[h.length-1]&&h[h.length-1].match(f);if(j){var k=j[1],l={};if(k){var m=this;e(k,function(a,b){m._setParamValue(a,b,l)})}h[h.length-1]=l,a.extend(i,l)}var n=h.length;if(c.splatMatch&&this.encodedSplatParts){if(c.splatMatch<0)return h;n-=1}for(var o=0;n>o;o++)a.isString(h[o])&&(h[o]=d(h[o]),c.paramNames&&c.paramNames.length>=o-1&&(i[c.paramNames[o]]=h[o]));return b.Router.namedParameters||c.namedParameters?[i]:h},_setParamValue:function(a,b,c){a=a.replace("[]",""),a=a.replace("%5B%5D","");for(var d=a.split("."),e=c,f=0;f<d.length;f++){var g=d[f];f===d.length-1?e[g]=this._decodeParamValue(b,e[g]):e=e[g]=e[g]||{}}},_decodeParamValue:function(c,e){var f=b.Router.arrayValueSplit;if(f&&c.indexOf(f)>=0){for(var g=c.split(f),h=g.length-1;h>=0;h--)g[h]?g[h]=d(g[h]):g.splice(h,1);return g}return c=d(c),e?a.isArray(e)?(e.push(c),e):[e,c]:c},toFragment:function(b,c){return c&&(a.isString(c)||(c=this._toQueryString(c)),c&&(b+="?"+c)),b},_toQueryString:function(c,d){function e(a){return String(a).replace(f,encodeURIComponent(f))}var f=b.Router.arrayValueSplit;if(!c)return"";d=d||"";var g="";for(var h in c){var i=c[h];if(a.isString(i)||a.isNumber(i)||a.isBoolean(i)||a.isDate(i))i=this._toQueryParam(i),(a.isBoolean(i)||a.isNumber(i)||a.isString(i)||i)&&(g+=(g?"&":"")+this._toQueryParamName(h,d)+"="+e(encodeURIComponent(i)));else if(a.isArray(i)){for(var j="",k=0;k<i.length;k++){var l=this._toQueryParam(i[k]);(a.isBoolean(l)||null!==l)&&(j+=f+e(l))}j&&(g+=(g?"&":"")+this._toQueryParamName(h,d)+"="+j)}else{var m=this._toQueryString(i,this._toQueryParamName(h,d,!0));m&&(g+=(g?"&":"")+m)}}return g},_toQueryParamName:function(a,b,c){return b+a+(c?".":"")},_toQueryParam:function(b){return a.isNull(b)||a.isUndefined(b)?null:b}})}),function(){var a,b,c,d,e,f,g=[].slice;c=function(a){var b,d;return!_.isObject(a)||_.isFunction(a)?a:a instanceof Backbone.Collection||a instanceof Backbone.Model?a:_.isDate(a)?new Date(a.getTime()):_.isRegExp(a)?new RegExp(a.source,a.toString().replace(/.*\//,"")):(d=_.isArray(a||_.isArguments(a)),b=function(a,b,e){return d?a.push(c(b)):a[e]=c(b),a},_.reduce(a,b,d?[]:{}))},f=function(a){return null==a?!1:!(a.prototype!=={}.prototype&&a.prototype!==Object.prototype||!_.isObject(a)||_.isArray(a)||_.isFunction(a)||_.isDate(a)||_.isRegExp(a)||_.isArguments(a))},b=function(a){return _.filter(_.keys(a),function(b){return f(a[b])})},a=function(a){return _.filter(_.keys(a),function(b){return _.isArray(a[b])})},e=function(c,d,f){var g,h,i,j,k,l,m,n,o,p;if(null==f&&(f=20),0>=f)return console.warn("_.deepExtend(): Maximum depth of recursion hit."),_.extend(c,d);for(l=_.intersection(b(c),b(d)),h=function(a){return d[a]=e(c[a],d[a],f-1)},m=0,o=l.length;o>m;m++)k=l[m],h(k);for(j=_.intersection(a(c),a(d)),g=function(a){return d[a]=_.union(c[a],d[a])},n=0,p=j.length;p>n;n++)i=j[n],g(i);return _.extend(c,d)},d=function(){var a,b,d,f;if(d=2<=arguments.length?g.call(arguments,0,f=arguments.length-1):(f=0,[]),b=arguments[f++],_.isNumber(b)||(d.push(b),b=20),d.length<=1)return d[0];if(0>=b)return _.extend.apply(this,d);for(a=d.shift();d.length>0;)a=e(a,c(d.shift()),b);return a},_.mixin({deepClone:c,isBasicObject:f,basicObjects:b,arrays:a,deepExtend:d})}.call(this),function(a){"function"==typeof define&&define.amd?define(["underscore","backbone"],a):a(_,Backbone)}(function(a,b){function c(b){var d={},e=g.keyPathSeparator;for(var f in b){var h=b[f];if(h&&h.constructor===Object&&!a.isEmpty(h)){var i=c(h);for(var j in i){var k=i[j];d[f+e+j]=k}}else d[f]=h}return d}function d(b,c,d){for(var e=g.keyPathSeparator,f=c.split(e),h=b,i=0,j=f.length;j>i;i++){if(d&&!a.has(h,f[i]))return!1;if(h=h[f[i]],null==h&&j-1>i&&(h={}),"undefined"==typeof h)return d?!0:h}return d?!0:h}function e(b,c,d,e){e=e||{};for(var f=g.keyPathSeparator,h=c.split(f),i=b,j=0,k=h.length;k>j&&void 0!==i;j++){var l=h[j];j===k-1?e.unset?delete i[l]:i[l]=d:("undefined"!=typeof i[l]&&a.isObject(i[l])||(i[l]={}),i=i[l])}}function f(a,b){e(a,b,null,{unset:!0})}var g=b.Model.extend({constructor:function(b,c){var d,e=b||{};this.cid=a.uniqueId("c"),this.attributes={},c&&c.collection&&(this.collection=c.collection),c&&c.parse&&(e=this.parse(e,c)||{}),(d=a.result(this,"defaults"))&&(e=a.deepExtend({},d,e)),this.set(e,c),this.changed={},this.initialize.apply(this,arguments)},toJSON:function(){return a.deepClone(this.attributes)},get:function(a){return d(this.attributes,a)},set:function(b,h,i){var j,k,l,m,n,o,p,q;if(null==b)return this;if("object"==typeof b?(k=b,i=h||{}):(k={})[b]=h,i||(i={}),!this._validate(k,i))return!1;l=i.unset,n=i.silent,m=[],o=this._changing,this._changing=!0,o||(this._previousAttributes=a.deepClone(this.attributes),this.changed={}),q=this.attributes,p=this._previousAttributes,this.idAttribute in k&&(this.id=k[this.idAttribute]),k=c(k);for(j in k)h=k[j],a.isEqual(d(q,j),h)||m.push(j),a.isEqual(d(p,j),h)?f(this.changed,j):e(this.changed,j,h),l?f(q,j):e(q,j,h);if(!n){m.length&&(this._pending=!0);for(var r=g.keyPathSeparator,s=0,t=m.length;t>s;s++){var b=m[s];this.trigger("change:"+b,this,d(q,b),i);for(var u=b.split(r),v=u.length-1;v>0;v--){var w=a.first(u,v).join(r),x=w+r+"*";this.trigger("change:"+x,this,d(q,w),i)}}}if(o)return this;if(!n)for(;this._pending;)this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},clear:function(b){var d={},e=c(this.attributes);for(var f in e)d[f]=void 0;return this.set(d,a.extend({},b,{unset:!0}))},hasChanged:function(b){return null==b?!a.isEmpty(this.changed):void 0!==d(this.changed,b)},changedAttributes:function(b){if(!b)return this.hasChanged()?c(this.changed):!1;var d=this._changing?this._previousAttributes:this.attributes;b=c(b),d=c(d);var e,f=!1;for(var g in b)a.isEqual(d[g],e=b[g])||((f||(f={}))[g]=e);return f},previous:function(a){return null!=a&&this._previousAttributes?d(this._previousAttributes,a):null},previousAttributes:function(){return a.deepClone(this._previousAttributes)}});return g.keyPathSeparator=".",b.DeepModel=g,"undefined"!=typeof module&&(module.exports=g),b}),!function(a,b){var c=a.clone(b.Model.prototype);a.extend(b.Model.prototype,{fileAttribute:"file",save:function(b,d,e){var f,g=this.attributes;if(null==b||"object"==typeof b?(f=b,e=d):(f={})[b]=d,e=a.extend({validate:!0},e),f&&!e.wait){if(!this.set(f,e))return!1}else if(!this._validate(f,e))return!1;if(f&&e.wait&&(this.attributes=a.extend({},g,f)),e.formData===!0||e.formData!==!1&&this.attributes[this.fileAttribute]&&this.attributes[this.fileAttribute]instanceof File){var h=a.clone(this.attributes),i=this.attributes[this.fileAttribute];h=this._flatten(h),i&&(h[this.fileAttribute]=i);var j=new FormData;a.each(h,function(a,b){j.append(b,a)}),e=e||{},e.data=j,e.processData=!1,e.contentType=!1;var k=this;e.xhr=function(){var a=$.ajaxSettings.xhr();return a.upload.addEventListener("progress",function(){k._progressHandler.apply(k,arguments)},!1),a}}return f&&e.wait&&(this.attributes=g),c.save.call(this,f,e)},_flatten:function(a){var b={};for(var c in a)if(a.hasOwnProperty(c))if("object"==typeof a[c]){var d=this._flatten(a[c]);for(var e in d)d.hasOwnProperty(e)&&(b[c+"."+e]=d[e])}else b[c]=a[c];return b},_progressHandler:function(a){if(a.lengthComputable){var b=a.loaded/a.total;this.trigger("progress",b)}}})}(_,Backbone),function(a,b){"use strict";"function"==typeof define&&define.amd?define(["marionette","jquery","underscore"],b):a.Marionette.FormView=b(a.Marionette,a.jQuery,a._)}(this,function(a,b,c){"use strict";var d=a.FormView=a.ItemView.extend({className:"formView",rules:{},fields:{},constructor:function(){if(a.ItemView.prototype.constructor.apply(this,arguments),!this.fields)throw new Error("Fields Must Be Provided");this.model||(this.model=new Backbone.Model),this.listenTo(this.model,"change",this.changeFieldVal,this),this.data&&this.model.set(this.data),this.template||this.runInitializers(),this.on("item:rendered",this.runInitializers,this)},changeFieldVal:function(a,b){if(!c.isEmpty(b)&&b.changes){var d=Object.keys(b.changes);this.inputVal(d,this.model.get(d))}else b.unset&&c(this.fields).each(function(a,b){var c=this.$('[data-field="'+b+'"]');this.inputVal(c,this.model.get(b))},this)},populateFields:function(){c(this.fields).each(function(a,b){var c=this.$('[data-field="'+b+'"]');this.inputVal(c,this.model.get(b)),a.autoFocus&&c.focus()},this)},serializeFormData:function(){var a={},b=this;return c(this.fields).each(function(c,d){a[d]=b.inputVal(d)}),a},beforeFormSubmit:function(a){var b=this.validate(),d=c.isEmpty(b);return d?c.isFunction(this.onSubmit)?this.onSubmit.apply(this,[a]):void 0:(c.isFunction(this.onSubmitFail)&&this.onSubmitFail.apply(this,[b]),a.stopImmediatePropagation(),!1)},onFieldEvent:function(a){this.handleFieldEvent(a,a.type)},handleFieldEvent:function(a,d){var e=a.target||a.srcElement,f=b(e).attr("data-field"),g=this.fields[f];if(g&&g.validateOn===d){var h=this.validateField(f);!c.isEmpty(h)&&c.isFunction(this.onValidationFail)&&this.onValidationFail(h)}},validate:function(){var a={},b=c(this.fields).keys();return c(b).each(function(b){var d=this.validateField(b);c.isEmpty(d)||(a[b]=d)},this),a},validateField:function(a){var b=this.fields[a],d=b&&b.validations?b.validations:{},e=[],f=!0,g=this.inputVal(a);if(b.required){f=this.validateRule(g,"required");var h="string"==typeof b.required?b.required:"This field is required";f||e.push(h)}if(f&&d&&c.each(d,function(a,b){f=this.validateRule(g,b),f||e.push(a)},this),!c.isEmpty(e)){var i={field:a,el:this.fields[a].el,error:e};return i}},inputVal:function(a,c){var d=a.jquery?a:this.$('[data-field="'+a+'"]'),e=this,f="undefined"==typeof c?"get":"set";if("object"===d.data("fieldtype"))"get"===f&&(c={}),d.find("[data-property]").each(function(){var a=b(this),d=a.attr("data-property");"get"===f?c[d]=e.inputVal(a):c&&e.inputVal(a,c[d])});else if("array"===d.data("fieldtype"))"get"===f&&(c=[]),d.find("[data-index]").each(function(){var a=b(this),d=a.data("index");"get"===f?c[d]=e.inputVal(a):c&&e.inputVal(a,c[d])});else if(d.is("input")){var g=d.attr("type").toLowerCase();switch(g){case"radio":d.each(function(){var a=b(this);if("get"===f){if(a.is(":checked"))return c=a.val(),!1}else if(a.val()===c)return a.prop("checked",!0),!1});break;case"checkbox":"get"===f?c=d.is(":checked"):d.prop("checked",!!c);break;case"password":"get"===f?c=d.val():d.val(c);break;default:"get"===f?c=b.trim(d.val()):d.val(c)}}else"get"===f?c=b.trim(d.val()):d.val(c);return c},validateRule:function(a,b){var d;if(!b)throw new Error("Not passed a validation to test");return"required"===b?e.required(a):(-1!==b.indexOf(":")&&(d=b.split(":"),b=d.shift()),this.rules&&this.rules[b]?c(this.rules[b]).bind(this)(a):c(e.validate).bind(this)(b,a,d))},submit:function(){this.form.submit()},bindFormEvents:function(){var a=this.$el.is("form")?this.$el:this.$("form").first();this.form=a,this.$("input").blur(c(this.onFieldEvent).bind(this)).keyup(c(this.onFieldEvent).bind(this)).keydown(c(this.onFieldEvent).bind(this)).change(c(this.onFieldEvent).bind(this)),a.submit(c(this.beforeFormSubmit).bind(this))},runInitializers:function(){this.populateFields(),this.bindFormEvents(),c.isFunction(this.onReady)&&this.onReady()}}),e={regex:{email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i,alpha:/^[a-zA-Z]+$/,alphanum:/^[a-zA-Z0-9]+$/},validate:function(a,b,d){if(c.isFunction(e[a]))return c(e[a]).bind(this)(b,d);throw new Error("Validator does not exist : "+a)},matches:function(a,b){return a==this.inputVal(b)},min:function(a,b){return a.length<b?!1:!0},max:function(a,b){return a.length>b?!1:!0},numeric:function(a){return c.isNumber(a)},alpha:function(a){return e.regex.alpha.test(a)},alphanum:function(a){return e.regex.alphanum.test(a)},email:function(a){return e.regex.email.test(a)},required:function(a){return a===!1||c.isNull(a)||c.isUndefined(a)||c.isString(a)&&0===a.length?!1:!0},"boolean":function(a){return c.isBoolean(a)}};return d}),function(a,b,c){function d(c,d,e){var f=b.createElement(c);return d&&(f.id=_+d),e&&(f.style.cssText=e),a(f)
}function e(){return c.innerHeight?c.innerHeight:a(c).height()}function f(a){var b=y.length,c=(Q+a)%b;return 0>c?b+c:c}function g(a,b){return Math.round((/%/.test(a)?("x"===b?z.width():e())/100:1)*parseInt(a,10))}function h(a,b){return a.photo||a.photoRegex.test(b)}function i(a,b){return a.retinaUrl&&c.devicePixelRatio>1?b.replace(a.photoRegex,a.retinaSuffix):b}function j(a){"contains"in r[0]&&!r[0].contains(a.target)&&(a.stopPropagation(),r.focus())}function k(){var b,c=a.data(P,$);null==c?(K=a.extend({},Z),console&&console.log&&console.log("Error: cboxElement missing settings object")):K=a.extend({},c);for(b in K)a.isFunction(K[b])&&"on"!==b.slice(0,2)&&(K[b]=K[b].call(P));K.rel=K.rel||P.rel||a(P).data("rel")||"nofollow",K.href=K.href||a(P).attr("href"),K.title=K.title||P.title,"string"==typeof K.href&&(K.href=a.trim(K.href))}function l(c,d){a(b).trigger(c),hb.trigger(c),a.isFunction(d)&&d.call(P)}function m(c){U||(P=c,k(),y=a(P),Q=0,"nofollow"!==K.rel&&(y=a("."+ab).filter(function(){var b,c=a.data(this,$);return c&&(b=a(this).data("rel")||c.rel||this.rel),b===K.rel}),Q=y.index(P),-1===Q&&(y=y.add(P),Q=y.length-1)),q.css({opacity:parseFloat(K.opacity),cursor:K.overlayClose?"pointer":"auto",visibility:"visible"}).show(),X&&r.add(q).removeClass(X),K.className&&r.add(q).addClass(K.className),X=K.className,K.closeButton?I.html(K.close).appendTo(t):I.appendTo("<div/>"),S||(S=T=!0,r.css({visibility:"hidden",display:"block"}),A=d(ib,"LoadedContent","width:0; height:0; overflow:hidden"),t.css({width:"",height:""}).append(A),L=u.height()+x.height()+t.outerHeight(!0)-t.height(),M=v.width()+w.width()+t.outerWidth(!0)-t.width(),N=A.outerHeight(!0),O=A.outerWidth(!0),K.w=g(K.initialWidth,"x"),K.h=g(K.initialHeight,"y"),A.css({width:"",height:K.h}),W.position(),l(bb,K.onOpen),J.add(D).hide(),r.focus(),K.trapFocus&&b.addEventListener&&(b.addEventListener("focus",j,!0),hb.one(fb,function(){b.removeEventListener("focus",j,!0)})),K.returnFocus&&hb.one(fb,function(){a(P).focus()})),p())}function n(){!r&&b.body&&(Y=!1,z=a(c),r=d(ib).attr({id:$,"class":a.support.opacity===!1?_+"IE":"",role:"dialog",tabindex:"-1"}).hide(),q=d(ib,"Overlay").hide(),C=a([d(ib,"LoadingOverlay")[0],d(ib,"LoadingGraphic")[0]]),s=d(ib,"Wrapper"),t=d(ib,"Content").append(D=d(ib,"Title"),E=d(ib,"Current"),H=a('<button type="button"/>').attr({id:_+"Previous"}),G=a('<button type="button"/>').attr({id:_+"Next"}),F=d("button","Slideshow"),C),I=a('<button type="button"/>').attr({id:_+"Close"}),s.append(d(ib).append(d(ib,"TopLeft"),u=d(ib,"TopCenter"),d(ib,"TopRight")),d(ib,!1,"clear:left").append(v=d(ib,"MiddleLeft"),t,w=d(ib,"MiddleRight")),d(ib,!1,"clear:left").append(d(ib,"BottomLeft"),x=d(ib,"BottomCenter"),d(ib,"BottomRight"))).find("div div").css({"float":"left"}),B=d(ib,!1,"position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;"),J=G.add(H).add(E).add(F),a(b.body).append(q,r.append(s,B)))}function o(){function c(a){a.which>1||a.shiftKey||a.altKey||a.metaKey||a.ctrlKey||(a.preventDefault(),m(this))}return r?(Y||(Y=!0,G.click(function(){W.next()}),H.click(function(){W.prev()}),I.click(function(){W.close()}),q.click(function(){K.overlayClose&&W.close()}),a(b).bind("keydown."+_,function(a){var b=a.keyCode;S&&K.escKey&&27===b&&(a.preventDefault(),W.close()),S&&K.arrowKey&&y[1]&&!a.altKey&&(37===b?(a.preventDefault(),H.click()):39===b&&(a.preventDefault(),G.click()))}),a.isFunction(a.fn.on)?a(b).on("click."+_,"."+ab,c):a("."+ab).live("click."+_,c)),!0):!1}function p(){var e,f,j,m=W.prep,n=++jb;T=!0,R=!1,P=y[Q],k(),l(gb),l(cb,K.onLoad),K.h=K.height?g(K.height,"y")-N-L:K.innerHeight&&g(K.innerHeight,"y"),K.w=K.width?g(K.width,"x")-O-M:K.innerWidth&&g(K.innerWidth,"x"),K.mw=K.w,K.mh=K.h,K.maxWidth&&(K.mw=g(K.maxWidth,"x")-O-M,K.mw=K.w&&K.w<K.mw?K.w:K.mw),K.maxHeight&&(K.mh=g(K.maxHeight,"y")-N-L,K.mh=K.h&&K.h<K.mh?K.h:K.mh),e=K.href,V=setTimeout(function(){C.show()},100),K.inline?(j=d(ib).hide().insertBefore(a(e)[0]),hb.one(gb,function(){j.replaceWith(A.children())}),m(a(e))):K.iframe?m(" "):K.html?m(K.html):h(K,e)?(e=i(K,e),R=b.createElement("img"),a(R).addClass(_+"Photo").bind("error",function(){K.title=!1,m(d(ib,"Error").html(K.imgError))}).one("load",function(){var b;n===jb&&(a.each(["alt","longdesc","aria-describedby"],function(b,c){var d=a(P).attr(c)||a(P).attr("data-"+c);d&&R.setAttribute(c,d)}),K.retinaImage&&c.devicePixelRatio>1&&(R.height=R.height/c.devicePixelRatio,R.width=R.width/c.devicePixelRatio),K.scalePhotos&&(f=function(){R.height-=R.height*b,R.width-=R.width*b},K.mw&&R.width>K.mw&&(b=(R.width-K.mw)/R.width,f()),K.mh&&R.height>K.mh&&(b=(R.height-K.mh)/R.height,f())),K.h&&(R.style.marginTop=Math.max(K.mh-R.height,0)/2+"px"),y[1]&&(K.loop||y[Q+1])&&(R.style.cursor="pointer",R.onclick=function(){W.next()}),R.style.width=R.width+"px",R.style.height=R.height+"px",setTimeout(function(){m(R)},1))}),setTimeout(function(){R.src=e},1)):e&&B.load(e,K.data,function(b,c){n===jb&&m("error"===c?d(ib,"Error").html(K.xhrError):a(this).contents())})}var q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z={html:!1,photo:!1,iframe:!1,inline:!1,transition:"elastic",speed:300,fadeOut:300,width:!1,initialWidth:"600",innerWidth:!1,maxWidth:!1,height:!1,initialHeight:"450",innerHeight:!1,maxHeight:!1,scalePhotos:!0,scrolling:!0,href:!1,title:!1,rel:!1,opacity:.9,preloading:!0,className:!1,overlayClose:!0,escKey:!0,arrowKey:!0,top:!1,bottom:!1,left:!1,right:!1,fixed:!1,data:void 0,closeButton:!0,fastIframe:!0,open:!1,reposition:!0,loop:!0,slideshow:!1,slideshowAuto:!0,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp)((#|\?).*)?$/i,retinaImage:!1,retinaUrl:!1,retinaSuffix:"@2x.$1",current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:"This content failed to load.",imgError:"This image failed to load.",returnFocus:!0,trapFocus:!0,onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1},$="colorbox",_="cbox",ab=_+"Element",bb=_+"_open",cb=_+"_load",db=_+"_complete",eb=_+"_cleanup",fb=_+"_closed",gb=_+"_purge",hb=a("<a/>"),ib="div",jb=0,kb={},lb=function(){function a(){clearTimeout(g)}function b(){(K.loop||y[Q+1])&&(a(),g=setTimeout(W.next,K.slideshowSpeed))}function c(){F.html(K.slideshowStop).unbind(i).one(i,d),hb.bind(db,b).bind(cb,a),r.removeClass(h+"off").addClass(h+"on")}function d(){a(),hb.unbind(db,b).unbind(cb,a),F.html(K.slideshowStart).unbind(i).one(i,function(){W.next(),c()}),r.removeClass(h+"on").addClass(h+"off")}function e(){f=!1,F.hide(),a(),hb.unbind(db,b).unbind(cb,a),r.removeClass(h+"off "+h+"on")}var f,g,h=_+"Slideshow_",i="click."+_;return function(){f?K.slideshow||(hb.unbind(eb,e),e()):K.slideshow&&y[1]&&(f=!0,hb.one(eb,e),K.slideshowAuto?c():d(),F.show())}}();a.colorbox||(a(n),W=a.fn[$]=a[$]=function(b,c){var d=this;if(b=b||{},n(),o()){if(a.isFunction(d))d=a("<a/>"),b.open=!0;else if(!d[0])return d;c&&(b.onComplete=c),d.each(function(){a.data(this,$,a.extend({},a.data(this,$)||Z,b))}).addClass(ab),(a.isFunction(b.open)&&b.open.call(d)||b.open)&&m(d[0])}return d},W.position=function(b,c){function d(){u[0].style.width=x[0].style.width=t[0].style.width=parseInt(r[0].style.width,10)-M+"px",t[0].style.height=v[0].style.height=w[0].style.height=parseInt(r[0].style.height,10)-L+"px"}var f,h,i,j=0,k=0,l=r.offset();if(z.unbind("resize."+_),r.css({top:-9e4,left:-9e4}),h=z.scrollTop(),i=z.scrollLeft(),K.fixed?(l.top-=h,l.left-=i,r.css({position:"fixed"})):(j=h,k=i,r.css({position:"absolute"})),k+=K.right!==!1?Math.max(z.width()-K.w-O-M-g(K.right,"x"),0):K.left!==!1?g(K.left,"x"):Math.round(Math.max(z.width()-K.w-O-M,0)/2),j+=K.bottom!==!1?Math.max(e()-K.h-N-L-g(K.bottom,"y"),0):K.top!==!1?g(K.top,"y"):Math.round(Math.max(e()-K.h-N-L,0)/2),r.css({top:l.top,left:l.left,visibility:"visible"}),s[0].style.width=s[0].style.height="9999px",f={width:K.w+O+M,height:K.h+N+L,top:j,left:k},b){var m=0;a.each(f,function(a){return f[a]!==kb[a]?void(m=b):void 0}),b=m}kb=f,b||r.css(f),r.dequeue().animate(f,{duration:b||0,complete:function(){d(),T=!1,s[0].style.width=K.w+O+M+"px",s[0].style.height=K.h+N+L+"px",K.reposition&&setTimeout(function(){z.bind("resize."+_,W.position)},1),c&&c()},step:d})},W.resize=function(a){var b;S&&(a=a||{},a.width&&(K.w=g(a.width,"x")-O-M),a.innerWidth&&(K.w=g(a.innerWidth,"x")),A.css({width:K.w}),a.height&&(K.h=g(a.height,"y")-N-L),a.innerHeight&&(K.h=g(a.innerHeight,"y")),a.innerHeight||a.height||(b=A.scrollTop(),A.css({height:"auto"}),K.h=A.height()),A.css({height:K.h}),b&&A.scrollTop(b),W.position("none"===K.transition?0:K.speed))},W.prep=function(c){function e(){return K.w=K.w||A.width(),K.w=K.mw&&K.mw<K.w?K.mw:K.w,K.w}function g(){return K.h=K.h||A.height(),K.h=K.mh&&K.mh<K.h?K.mh:K.h,K.h}if(S){var j,k="none"===K.transition?0:K.speed;A.empty().remove(),A=d(ib,"LoadedContent").append(c),A.hide().appendTo(B.show()).css({width:e(),overflow:K.scrolling?"auto":"hidden"}).css({height:g()}).prependTo(t),B.hide(),a(R).css({"float":"none"}),j=function(){function c(){a.support.opacity===!1&&r[0].style.removeAttribute("filter")}var e,g,j=y.length,m="frameBorder",n="allowTransparency";S&&(g=function(){clearTimeout(V),C.hide(),l(db,K.onComplete)},D.html(K.title).add(A).show(),j>1?("string"==typeof K.current&&E.html(K.current.replace("{current}",Q+1).replace("{total}",j)).show(),G[K.loop||j-1>Q?"show":"hide"]().html(K.next),H[K.loop||Q?"show":"hide"]().html(K.previous),lb(),K.preloading&&a.each([f(-1),f(1)],function(){var c,d,e=y[this],f=a.data(e,$);f&&f.href?(c=f.href,a.isFunction(c)&&(c=c.call(e))):c=a(e).attr("href"),c&&h(f,c)&&(c=i(f,c),d=b.createElement("img"),d.src=c)})):J.hide(),K.iframe?(e=d("iframe")[0],m in e&&(e[m]=0),n in e&&(e[n]="true"),K.scrolling||(e.scrolling="no"),a(e).attr({src:K.href,name:(new Date).getTime(),"class":_+"Iframe",allowFullScreen:!0,webkitAllowFullScreen:!0,mozallowfullscreen:!0}).one("load",g).appendTo(A),hb.one(gb,function(){e.src="//about:blank"}),K.fastIframe&&a(e).trigger("load")):g(),"fade"===K.transition?r.fadeTo(k,1,c):c())},"fade"===K.transition?r.fadeTo(k,0,function(){W.position(0,j)}):W.position(k,j)}},W.next=function(){!T&&y[1]&&(K.loop||y[Q+1])&&(Q=f(1),m(y[Q]))},W.prev=function(){!T&&y[1]&&(K.loop||Q)&&(Q=f(-1),m(y[Q]))},W.close=function(){S&&!U&&(U=!0,S=!1,l(eb,K.onCleanup),z.unbind("."+_),q.fadeTo(K.fadeOut||0,0),r.stop().fadeTo(K.fadeOut||0,0,function(){r.add(q).css({opacity:1,cursor:"auto"}).hide(),l(gb),A.empty().remove(),setTimeout(function(){U=!1,l(fb,K.onClosed)},1)}))},W.remove=function(){r&&(r.stop(),a.colorbox.close(),r.stop().remove(),q.remove(),U=!1,r=null,a("."+ab).removeData($).removeClass(ab),a(b).unbind("click."+_))},W.element=function(){return a(P)},W.settings=Z)}(jQuery,document,window),function(a){return jQuery.fn.insertAt=function(b,c){var d;return 0>=b?this.prepend(c):(d=this.children().size(),b>=d?this.append(c):a(this.children()[b-1]).after(c))}}(jQuery),+function(a){"use strict";var b=function(b,c){this.$element=a(b),this.$indicators=this.$element.find(".carousel-indicators"),this.options=c,this.paused=this.sliding=this.interval=this.$active=this.$items=null,"hover"==this.options.pause&&this.$element.on("mouseenter",a.proxy(this.pause,this)).on("mouseleave",a.proxy(this.cycle,this))};b.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},b.prototype.cycle=function(b){return b||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(a.proxy(this.next,this),this.options.interval)),this},b.prototype.getActiveIndex=function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},b.prototype.to=function(b){var c=this,d=this.getActiveIndex();return b>this.$items.length-1||0>b?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){c.to(b)}):d==b?this.pause().cycle():this.slide(b>d?"next":"prev",a(this.$items[b]))},b.prototype.pause=function(b){return b||(this.paused=!0),this.$element.find(".next, .prev").length&&a.support.transition&&(this.$element.trigger(a.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},b.prototype.next=function(){return this.sliding?void 0:this.slide("next")},b.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},b.prototype.slide=function(b,c){var d=this.$element.find(".item.active"),e=c||d[b](),f=this.interval,g="next"==b?"left":"right",h="next"==b?"first":"last",i=this;if(!e.length){if(!this.options.wrap)return;e=this.$element.find(".item")[h]()}if(e.hasClass("active"))return this.sliding=!1;var j=a.Event("slide.bs.carousel",{relatedTarget:e[0],direction:g});return this.$element.trigger(j),j.isDefaultPrevented()?void 0:(this.sliding=!0,f&&this.pause(),this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid.bs.carousel",function(){var b=a(i.$indicators.children()[i.getActiveIndex()]);b&&b.addClass("active")})),a.support.transition&&this.$element.hasClass("slide")?(e.addClass(b),e[0].offsetWidth,d.addClass(g),e.addClass(g),d.one(a.support.transition.end,function(){e.removeClass([b,g].join(" ")).addClass("active"),d.removeClass(["active",g].join(" ")),i.sliding=!1,setTimeout(function(){i.$element.trigger("slid.bs.carousel")},0)}).emulateTransitionEnd(1e3*d.css("transition-duration").slice(0,-1))):(d.removeClass("active"),e.addClass("active"),this.sliding=!1,this.$element.trigger("slid.bs.carousel")),f&&this.cycle(),this)};var c=a.fn.carousel;a.fn.carousel=function(c){return this.each(function(){var d=a(this),e=d.data("bs.carousel"),f=a.extend({},b.DEFAULTS,d.data(),"object"==typeof c&&c),g="string"==typeof c?c:f.slide;e||d.data("bs.carousel",e=new b(this,f)),"number"==typeof c?e.to(c):g?e[g]():f.interval&&e.pause().cycle()})},a.fn.carousel.Constructor=b,a.fn.carousel.noConflict=function(){return a.fn.carousel=c,this},a(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(b){var c,d=a(this),e=a(d.attr("data-target")||(c=d.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,"")),f=a.extend({},e.data(),d.data()),g=d.attr("data-slide-to");g&&(f.interval=!1),e.carousel(f),(g=d.attr("data-slide-to"))&&e.data("bs.carousel").to(g),b.preventDefault()}),a(window).on("load",function(){a('[data-ride="carousel"]').each(function(){var b=a(this);b.carousel(b.data())})})}(jQuery),+function(a){"use strict";var b=function(c,d){this.$element=a(c),this.options=a.extend({},b.DEFAULTS,d),this.transitioning=null,this.options.parent&&(this.$parent=a(this.options.parent)),this.options.toggle&&this.toggle()};b.DEFAULTS={toggle:!0},b.prototype.dimension=function(){var a=this.$element.hasClass("width");return a?"width":"height"},b.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var b=a.Event("show.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.$parent&&this.$parent.find("> .panel > .in");if(c&&c.length){var d=c.data("bs.collapse");if(d&&d.transitioning)return;c.collapse("hide"),d||c.data("bs.collapse",null)}var e=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[e](0),this.transitioning=1;var f=function(){this.$element.removeClass("collapsing").addClass("collapse in")[e]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!a.support.transition)return f.call(this);var g=a.camelCase(["scroll",e].join("-"));this.$element.one(a.support.transition.end,a.proxy(f,this)).emulateTransitionEnd(350)[e](this.$element[0][g])}}},b.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var b=a.Event("hide.bs.collapse");if(this.$element.trigger(b),!b.isDefaultPrevented()){var c=this.dimension();this.$element[c](this.$element[c]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var d=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};return a.support.transition?void this.$element[c](0).one(a.support.transition.end,a.proxy(d,this)).emulateTransitionEnd(350):d.call(this)}}},b.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var c=a.fn.collapse;a.fn.collapse=function(c){return this.each(function(){var d=a(this),e=d.data("bs.collapse"),f=a.extend({},b.DEFAULTS,d.data(),"object"==typeof c&&c);!e&&f.toggle&&"show"==c&&(c=!c),e||d.data("bs.collapse",e=new b(this,f)),"string"==typeof c&&e[c]()})},a.fn.collapse.Constructor=b,a.fn.collapse.noConflict=function(){return a.fn.collapse=c,this},a(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(b){var c,d=a(this),e=d.attr("data-target")||b.preventDefault()||(c=d.attr("href"))&&c.replace(/.*(?=#[^\s]+$)/,""),f=a(e),g=f.data("bs.collapse"),h=g?"toggle":d.data(),i=d.attr("data-parent"),j=i&&a(i);g&&g.transitioning||(j&&j.find('[data-toggle=collapse][data-parent="'+i+'"]').not(d).addClass("collapsed"),d[f.hasClass("in")?"addClass":"removeClass"]("collapsed")),f.collapse(h)})}(jQuery),+function(a){"use strict";function b(){var a=document.createElement("bootstrap"),b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var c in b)if(void 0!==a.style[c])return{end:b[c]};return!1}a.fn.emulateTransitionEnd=function(b){var c=!1,d=this;a(this).one(a.support.transition.end,function(){c=!0});var e=function(){c||a(d).trigger(a.support.transition.end)};return setTimeout(e,b),this},a(function(){a.support.transition=b()})}(jQuery),function(a){function b(a,b){return function(c){return i(a.call(this,c),b)}}function c(a){return function(b){return this.lang().ordinal(a.call(this,b))}}function d(){}function e(a){g(this,a)}function f(a){var b=this._data={},c=a.years||a.year||a.y||0,d=a.months||a.month||a.M||0,e=a.weeks||a.week||a.w||0,f=a.days||a.day||a.d||0,g=a.hours||a.hour||a.h||0,i=a.minutes||a.minute||a.m||0,j=a.seconds||a.second||a.s||0,k=a.milliseconds||a.millisecond||a.ms||0;this._milliseconds=k+1e3*j+6e4*i+36e5*g,this._days=f+7*e,this._months=d+12*c,b.milliseconds=k%1e3,j+=h(k/1e3),b.seconds=j%60,i+=h(j/60),b.minutes=i%60,g+=h(i/60),b.hours=g%24,f+=h(g/24),f+=7*e,b.days=f%30,d+=h(f/30),b.months=d%12,c+=h(d/12),b.years=c}function g(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function h(a){return 0>a?Math.ceil(a):Math.floor(a)}function i(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c}function j(a,b,c){var d,e=b._milliseconds,f=b._days,g=b._months;e&&a._d.setTime(+a+e*c),f&&a.date(a.date()+f*c),g&&(d=a.date(),a.date(1).month(a.month()+g*c).date(Math.min(d,a.daysInMonth())))}function k(a){return"[object Array]"===Object.prototype.toString.call(a)}function l(a,b){var c,d=Math.min(a.length,b.length),e=Math.abs(a.length-b.length),f=0;for(c=0;d>c;c++)~~a[c]!==~~b[c]&&f++;return f+e}function m(a,b){return b.abbr=a,J[a]||(J[a]=new d),J[a].set(b),J[a]}function n(a){return a?(!J[a]&&K&&require("./lang/"+a),J[a]):F.fn._lang}function o(a){return a.match(/\[.*\]/)?a.replace(/^\[|\]$/g,""):a.replace(/\\/g,"")}function p(a){var b,c,d=a.match(M);for(b=0,c=d.length;c>b;b++)d[b]=eb[d[b]]?eb[d[b]]:o(d[b]);return function(e){var f="";for(b=0;c>b;b++)f+="function"==typeof d[b].call?d[b].call(e,a):d[b];return f}}function q(a,b){function c(b){return a.lang().longDateFormat(b)||b}for(var d=5;d--&&N.test(b);)b=b.replace(N,c);return bb[b]||(bb[b]=p(b)),bb[b](a)}function r(a){switch(a){case"DDDD":return Q;case"YYYY":return R;case"YYYYY":return S;case"S":case"SS":case"SSS":case"DDD":return P;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return T;case"X":return W;case"Z":case"ZZ":return U;case"T":return V;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return O;default:return new RegExp(a.replace("\\",""))}}function s(a,b,c){var d,e=c._a;switch(a){case"M":case"MM":e[1]=null==b?0:~~b-1;break;case"MMM":case"MMMM":d=n(c._l).monthsParse(b),null!=d?e[1]=d:c._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":null!=b&&(e[2]=~~b);break;case"YY":e[0]=~~b+(~~b>68?1900:2e3);break;case"YYYY":case"YYYYY":e[0]=~~b;break;case"a":case"A":c._isPm="pm"===(b+"").toLowerCase();break;case"H":case"HH":case"h":case"hh":e[3]=~~b;break;case"m":case"mm":e[4]=~~b;break;case"s":case"ss":e[5]=~~b;break;case"S":case"SS":case"SSS":e[6]=~~(1e3*("0."+b));break;case"X":c._d=new Date(1e3*parseFloat(b));break;case"Z":case"ZZ":c._useUTC=!0,d=(b+"").match($),d&&d[1]&&(c._tzh=~~d[1]),d&&d[2]&&(c._tzm=~~d[2]),d&&"+"===d[0]&&(c._tzh=-c._tzh,c._tzm=-c._tzm)}null==b&&(c._isValid=!1)}function t(a){var b,c,d=[];if(!a._d){for(b=0;7>b;b++)a._a[b]=d[b]=null==a._a[b]?2===b?1:0:a._a[b];d[3]+=a._tzh||0,d[4]+=a._tzm||0,c=new Date(0),a._useUTC?(c.setUTCFullYear(d[0],d[1],d[2]),c.setUTCHours(d[3],d[4],d[5],d[6])):(c.setFullYear(d[0],d[1],d[2]),c.setHours(d[3],d[4],d[5],d[6])),a._d=c}}function u(a){var b,c,d=a._f.match(M),e=a._i;for(a._a=[],b=0;b<d.length;b++)c=(r(d[b]).exec(e)||[])[0],c&&(e=e.slice(e.indexOf(c)+c.length)),eb[d[b]]&&s(d[b],c,a);a._isPm&&a._a[3]<12&&(a._a[3]+=12),a._isPm===!1&&12===a._a[3]&&(a._a[3]=0),t(a)}function v(a){for(var b,c,d,f,h=99;a._f.length;){if(b=g({},a),b._f=a._f.pop(),u(b),c=new e(b),c.isValid()){d=c;break}f=l(b._a,c.toArray()),h>f&&(h=f,d=c)}g(a,d)}function w(a){var b,c=a._i;if(X.exec(c)){for(a._f="YYYY-MM-DDT",b=0;4>b;b++)if(Z[b][1].exec(c)){a._f+=Z[b][0];break}U.exec(c)&&(a._f+=" Z"),u(a)}else a._d=new Date(c)}function x(b){var c=b._i,d=L.exec(c);c===a?b._d=new Date:d?b._d=new Date(+d[1]):"string"==typeof c?w(b):k(c)?(b._a=c.slice(0),t(b)):b._d=new Date(c instanceof Date?+c:c)}function y(a,b,c,d,e){return e.relativeTime(b||1,!!c,a,d)}function z(a,b,c){var d=I(Math.abs(a)/1e3),e=I(d/60),f=I(e/60),g=I(f/24),h=I(g/365),i=45>d&&["s",d]||1===e&&["m"]||45>e&&["mm",e]||1===f&&["h"]||22>f&&["hh",f]||1===g&&["d"]||25>=g&&["dd",g]||45>=g&&["M"]||345>g&&["MM",I(g/30)]||1===h&&["y"]||["yy",h];return i[2]=b,i[3]=a>0,i[4]=c,y.apply({},i)}function A(a,b,c){var d=c-b,e=c-a.day();return e>d&&(e-=7),d-7>e&&(e+=7),Math.ceil(F(a).add("d",e).dayOfYear()/7)}function B(a){var b=a._i,c=a._f;return null===b||""===b?null:("string"==typeof b&&(a._i=b=n().preparse(b)),F.isMoment(b)?(a=g({},b),a._d=new Date(+b._d)):c?k(c)?v(a):u(a):x(a),new e(a))}function C(a,b){F.fn[a]=F.fn[a+"s"]=function(a){var c=this._isUTC?"UTC":"";return null!=a?(this._d["set"+c+b](a),this):this._d["get"+c+b]()}}function D(a){F.duration.fn[a]=function(){return this._data[a]}}function E(a,b){F.duration.fn["as"+a]=function(){return+this/b}}for(var F,G,H="2.0.0",I=Math.round,J={},K="undefined"!=typeof module&&module.exports,L=/^\/?Date\((\-?\d+)/i,M=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,N=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,O=/\d\d?/,P=/\d{1,3}/,Q=/\d{3}/,R=/\d{1,4}/,S=/[+\-]?\d{1,6}/,T=/[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF]+\s*?[\u0600-\u06FF]+/i,U=/Z|[\+\-]\d\d:?\d\d/i,V=/T/i,W=/[\+\-]?\d+(\.\d{1,3})?/,X=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,Y="YYYY-MM-DDTHH:mm:ssZ",Z=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],$=/([\+\-]|\d\d)/gi,_="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),ab={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},bb={},cb="DDD w W M D d".split(" "),db="M D H h m s w W".split(" "),eb={M:function(){return this.month()+1},MMM:function(a){return this.lang().monthsShort(this,a)},MMMM:function(a){return this.lang().months(this,a)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(a){return this.lang().weekdaysMin(this,a)},ddd:function(a){return this.lang().weekdaysShort(this,a)},dddd:function(a){return this.lang().weekdays(this,a)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return i(this.year()%100,2)},YYYY:function(){return i(this.year(),4)},YYYYY:function(){return i(this.year(),5)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return i(~~(this.milliseconds()/10),2)},SSS:function(){return i(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+i(~~(a/60),2)+":"+i(~~a%60,2)},ZZ:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+i(~~(10*a/6),4)},X:function(){return this.unix()}};cb.length;)G=cb.pop(),eb[G+"o"]=c(eb[G]);for(;db.length;)G=db.pop(),eb[G+G]=b(eb[G],2);for(eb.DDDD=b(eb.DDD,3),d.prototype={set:function(a){var b,c;for(c in a)b=a[c],"function"==typeof b?this[c]=b:this["_"+c]=b},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(a){return this._months[a.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(a){return this._monthsShort[a.month()]},monthsParse:function(a){var b,c,d;for(this._monthsParse||(this._monthsParse=[]),b=0;12>b;b++)if(this._monthsParse[b]||(c=F([2e3,b]),d="^"+this.months(c,"")+"|^"+this.monthsShort(c,""),this._monthsParse[b]=new RegExp(d.replace(".",""),"i")),this._monthsParse[b].test(a))return b},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(a){return this._weekdays[a.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(a){return this._weekdaysShort[a.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(a){return this._weekdaysMin[a.day()]},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(a){var b=this._longDateFormat[a];return!b&&this._longDateFormat[a.toUpperCase()]&&(b=this._longDateFormat[a.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(a){return a.slice(1)}),this._longDateFormat[a]=b),b},meridiem:function(a,b,c){return a>11?c?"pm":"PM":c?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},calendar:function(a,b){var c=this._calendar[a];return"function"==typeof c?c.apply(b):c},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(a,b,c,d){var e=this._relativeTime[c];return"function"==typeof e?e(a,b,c,d):e.replace(/%d/i,a)},pastFuture:function(a,b){var c=this._relativeTime[a>0?"future":"past"];return"function"==typeof c?c(b):c.replace(/%s/i,b)},ordinal:function(a){return this._ordinal.replace("%d",a)},_ordinal:"%d",preparse:function(a){return a},postformat:function(a){return a},week:function(a){return A(a,this._week.dow,this._week.doy)},_week:{dow:0,doy:6}},F=function(a,b,c){return B({_i:a,_f:b,_l:c,_isUTC:!1})},F.utc=function(a,b,c){return B({_useUTC:!0,_isUTC:!0,_l:c,_i:a,_f:b})},F.unix=function(a){return F(1e3*a)},F.duration=function(a,b){var c,d=F.isDuration(a),e="number"==typeof a,g=d?a._data:e?{}:a;return e&&(b?g[b]=a:g.milliseconds=a),c=new f(g),d&&a.hasOwnProperty("_lang")&&(c._lang=a._lang),c},F.version=H,F.defaultFormat=Y,F.lang=function(a,b){return a?(b?m(a,b):J[a]||n(a),void(F.duration.fn._lang=F.fn._lang=n(a))):F.fn._lang._abbr},F.langData=function(a){return a&&a._lang&&a._lang._abbr&&(a=a._lang._abbr),n(a)},F.isMoment=function(a){return a instanceof e},F.isDuration=function(a){return a instanceof f},F.fn=e.prototype={clone:function(){return F(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._d},toJSON:function(){return F.utc(this).format("YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var a=this;return[a.year(),a.month(),a.date(),a.hours(),a.minutes(),a.seconds(),a.milliseconds()]},isValid:function(){return null==this._isValid&&(this._isValid=this._a?!l(this._a,(this._isUTC?F.utc(this._a):F(this._a)).toArray()):!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(a){var b=q(this,a||F.defaultFormat);return this.lang().postformat(b)},add:function(a,b){var c;return c="string"==typeof a?F.duration(+b,a):F.duration(a,b),j(this,c,1),this},subtract:function(a,b){var c;return c="string"==typeof a?F.duration(+b,a):F.duration(a,b),j(this,c,-1),this},diff:function(a,b,c){var d,e,f=this._isUTC?F(a).utc():F(a).local(),g=6e4*(this.zone()-f.zone());return b&&(b=b.replace(/s$/,"")),"year"===b||"month"===b?(d=432e5*(this.daysInMonth()+f.daysInMonth()),e=12*(this.year()-f.year())+(this.month()-f.month()),e+=(this-F(this).startOf("month")-(f-F(f).startOf("month")))/d,"year"===b&&(e/=12)):(d=this-f-g,e="second"===b?d/1e3:"minute"===b?d/6e4:"hour"===b?d/36e5:"day"===b?d/864e5:"week"===b?d/6048e5:d),c?e:h(e)},from:function(a,b){return F.duration(this.diff(a)).lang(this.lang()._abbr).humanize(!b)},fromNow:function(a){return this.from(F(),a)},calendar:function(){var a=this.diff(F().startOf("day"),"days",!0),b=-6>a?"sameElse":-1>a?"lastWeek":0>a?"lastDay":1>a?"sameDay":2>a?"nextDay":7>a?"nextWeek":"sameElse";return this.format(this.lang().calendar(b,this))},isLeapYear:function(){var a=this.year();return a%4===0&&a%100!==0||a%400===0},isDST:function(){return this.zone()<F([this.year()]).zone()||this.zone()<F([this.year(),5]).zone()},day:function(a){var b=this._isUTC?this._d.getUTCDay():this._d.getDay();return null==a?b:this.add({d:a-b})},startOf:function(a){switch(a=a.replace(/s$/,"")){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===a&&this.day(0),this},endOf:function(a){return this.startOf(a).add(a.replace(/s?$/,"s"),1).subtract("ms",1)},isAfter:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)>+F(a).startOf(b)},isBefore:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)<+F(a).startOf(b)},isSame:function(a,b){return b="undefined"!=typeof b?b:"millisecond",+this.clone().startOf(b)===+F(a).startOf(b)},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return F.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(a){var b=I((F(this).startOf("day")-F(this).startOf("year"))/864e5)+1;return null==a?b:this.add("d",a-b)},isoWeek:function(a){var b=A(this,1,4);return null==a?b:this.add("d",7*(a-b))},week:function(a){var b=this.lang().week(this);return null==a?b:this.add("d",7*(a-b))},lang:function(b){return b===a?this._lang:(this._lang=n(b),this)}},G=0;G<_.length;G++)C(_[G].toLowerCase().replace(/s$/,""),_[G]);C("year","FullYear"),F.fn.days=F.fn.day,F.fn.weeks=F.fn.week,F.fn.isoWeeks=F.fn.isoWeek,F.duration.fn=f.prototype={weeks:function(){return h(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+2592e6*this._months},humanize:function(a){var b=+this,c=z(b,!a,this.lang());return a&&(c=this.lang().pastFuture(b,c)),this.lang().postformat(c)},lang:F.fn.lang};for(G in ab)ab.hasOwnProperty(G)&&(E(G,ab[G]),D(G.toLowerCase()));E("Weeks",6048e5),F.lang("en",{ordinal:function(a){var b=a%10,c=1===~~(a%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return a+c}}),K&&(module.exports=F),"undefined"==typeof ender&&(this.moment=F),"function"==typeof define&&define.amd&&define("moment",[],function(){return F
})}.call(this),function(a){"use strict";var b={i18n:{bg:{months:["Януари","Февруари","Март","Април","Май","Юни","Юли","Август","Септември","Октомври","Ноември","Декември"],dayOfWeek:["Нд","Пн","Вт","Ср","Чт","Пт","Сб"]},fa:{months:["فروردین","اردیبهشت","خرداد","تیر","مرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"],dayOfWeek:["یکشنبه","دوشنبه","سه شنبه","چهارشنبه","پنجشنبه","جمعه","شنبه"]},ru:{months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],dayOfWeek:["Вск","Пн","Вт","Ср","Чт","Пт","Сб"]},en:{months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayOfWeek:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},el:{months:["Ιανουάριος","Φεβρουάριος","Μάρτιος","Απρίλιος","Μάιος","Ιούνιος","Ιούλιος","Αύγουστος","Σεπτέμβριος","Οκτώβριος","Νοέμβριος","Δεκέμβριος"],dayOfWeek:["Κυρ","Δευ","Τρι","Τετ","Πεμ","Παρ","Σαβ"]},de:{months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],dayOfWeek:["So","Mo","Di","Mi","Do","Fr","Sa"]},nl:{months:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],dayOfWeek:["zo","ma","di","wo","do","vr","za"]},tr:{months:["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],dayOfWeek:["Paz","Pts","Sal","Çar","Per","Cum","Cts"]},fr:{months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],dayOfWeek:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"]},es:{months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],dayOfWeek:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"]},th:{months:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],dayOfWeek:["อา.","จ.","อ.","พ.","พฤ.","ศ.","ส."]},pl:{months:["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"],dayOfWeek:["nd","pn","wt","śr","cz","pt","sb"]},pt:{months:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],dayOfWeek:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"]},ch:{months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayOfWeek:["日","一","二","三","四","五","六"]},se:{months:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],dayOfWeek:["Sön","Mån","Tis","Ons","Tor","Fre","Lör"]},kr:{months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],dayOfWeek:["일","월","화","수","목","금","토"]},it:{months:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],dayOfWeek:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"]},da:{months:["January","Februar","Marts","April","Maj","Juni","July","August","September","Oktober","November","December"],dayOfWeek:["Søn","Man","Tir","ons","Tor","Fre","lør"]},no:{months:["Januar","Februar","Mars","April","Mai","Juni","Juli","August","September","Oktober","November","Desember"],dayOfWeek:["Søn","Man","Tir","Ons","Tor","Fre","Lør"]},ja:{months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayOfWeek:["日","月","火","水","木","金","土"]},vi:{months:["Tháng 1","Tháng 2","Tháng 3","Tháng 4","Tháng 5","Tháng 6","Tháng 7","Tháng 8","Tháng 9","Tháng 10","Tháng 11","Tháng 12"],dayOfWeek:["CN","T2","T3","T4","T5","T6","T7"]},sl:{months:["Januar","Februar","Marec","April","Maj","Junij","Julij","Avgust","September","Oktober","November","December"],dayOfWeek:["Ned","Pon","Tor","Sre","Čet","Pet","Sob"]},cs:{months:["Leden","Únor","Březen","Duben","Květen","Červen","Červenec","Srpen","Září","Říjen","Listopad","Prosinec"],dayOfWeek:["Ne","Po","Út","St","Čt","Pá","So"]},hu:{months:["Január","Február","Március","Április","Május","Június","Július","Augusztus","Szeptember","Október","November","December"],dayOfWeek:["Va","Hé","Ke","Sze","Cs","Pé","Szo"]}},value:"",lang:"en",format:"Y/m/d H:i",formatTime:"H:i",formatDate:"Y/m/d",startDate:!1,step:60,monthChangeSpinner:!0,closeOnDateSelect:!1,closeOnWithoutClick:!0,closeOnInputClick:!0,timepicker:!0,datepicker:!0,minDate:!1,maxDate:!1,minTime:!1,maxTime:!1,allowTimes:[],opened:!1,initTime:!0,inline:!1,onSelectDate:function(){},onSelectTime:function(){},onChangeMonth:function(){},onChangeDateTime:function(){},onShow:function(){},onClose:function(){},onGenerate:function(){},withoutCopyright:!0,inverseButton:!1,hours12:!1,next:"xdsoft_next",prev:"xdsoft_prev",dayOfWeekStart:0,timeHeightInTimePicker:25,timepickerScrollbar:!0,todayButton:!0,defaultSelect:!0,scrollMonth:!0,scrollTime:!0,scrollInput:!0,lazyInit:!1,mask:!1,validateOnBlur:!0,allowBlank:!0,yearStart:1950,yearEnd:2050,style:"",id:"",fixed:!1,roundTime:"round",className:"",weekends:[],yearOffset:0};Array.prototype.indexOf||(Array.prototype.indexOf=function(a,b){for(var c=b||0,d=this.length;d>c;c++)if(this[c]===a)return c;return-1}),Date.prototype.countDaysInMonth=function(){return new Date(this.getFullYear(),this.getMonth()+1,0).getDate()},a.fn.xdsoftScroller=function(b){return this.each(function(){var c=a(this);if(!a(this).hasClass("xdsoft_scroller_box")){var d=function(a){var b={x:0,y:0};if("touchstart"==a.type||"touchmove"==a.type||"touchend"==a.type||"touchcancel"==a.type){var c=a.originalEvent.touches[0]||a.originalEvent.changedTouches[0];b.x=c.pageX,b.y=c.pageY}else("mousedown"==a.type||"mouseup"==a.type||"mousemove"==a.type||"mouseover"==a.type||"mouseout"==a.type||"mouseenter"==a.type||"mouseleave"==a.type)&&(b.x=a.pageX,b.y=a.pageY);return b},e=0,f=c.children().eq(0),g=c[0].clientHeight,h=f[0].offsetHeight,i=a('<div class="xdsoft_scrollbar"></div>'),j=a('<div class="xdsoft_scroller"></div>'),k=100,l=!1;i.append(j),c.addClass("xdsoft_scroller_box").append(i),j.on("mousedown.xdsoft_scroller",function(d){g||c.trigger("resize_scroll.xdsoft_scroller",[b]);var f=d.pageY,h=parseInt(j.css("margin-top")),l=i[0].offsetHeight;a(document.body).addClass("xdsoft_noselect"),a([document.body,window]).on("mouseup.xdsoft_scroller",function m(){a([document.body,window]).off("mouseup.xdsoft_scroller",m).off("mousemove.xdsoft_scroller",e).removeClass("xdsoft_noselect")}),a(document.body).on("mousemove.xdsoft_scroller",e=function(a){var b=a.pageY-f+h;0>b&&(b=0),b+j[0].offsetHeight>l&&(b=l-j[0].offsetHeight),c.trigger("scroll_element.xdsoft_scroller",[k?b/k:0])})}),c.on("scroll_element.xdsoft_scroller",function(a,b){g||c.trigger("resize_scroll.xdsoft_scroller",[b,!0]),b=b>1?1:0>b||isNaN(b)?0:b,j.css("margin-top",k*b),f.css("marginTop",-parseInt((h-g)*b))}).on("resize_scroll.xdsoft_scroller",function(a,b,d){g=c[0].clientHeight,h=f[0].offsetHeight;var e=g/h,l=e*i[0].offsetHeight;e>1?j.hide():(j.show(),j.css("height",parseInt(l>10?l:10)),k=i[0].offsetHeight-j[0].offsetHeight,d!==!0&&c.trigger("scroll_element.xdsoft_scroller",[b?b:Math.abs(parseInt(f.css("marginTop")))/(h-g)]))}),c.mousewheel&&c.mousewheel(function(a,b){var d=Math.abs(parseInt(f.css("marginTop")));return c.trigger("scroll_element.xdsoft_scroller",[(d-20*b)/(h-g)]),a.stopPropagation(),!1}),c.on("touchstart",function(a){l=d(a)}),c.on("touchmove",function(a){if(l){var b=d(a),e=Math.abs(parseInt(f.css("marginTop")));c.trigger("scroll_element.xdsoft_scroller",[(e-(b.y-l.y))/(h-g)]),a.stopPropagation(),a.preventDefault()}}),c.on("touchend touchcancel",function(){l=!1})}c.trigger("resize_scroll.xdsoft_scroller",[b])})},a.fn.datetimepicker=function(c){var d=48,e=57,f=96,g=105,h=17,i=46,j=13,k=27,l=8,m=37,n=38,o=39,p=40,q=9,r=116,s=65,t=67,u=86,v=90,w=89,x=!1,y=a.isPlainObject(c)||!c?a.extend(!0,{},b,c):a.extend({},b),z=0,A=function(a){a.on("open.xdsoft focusin.xdsoft mousedown.xdsoft",function b(){a.is(":disabled")||a.is(":hidden")||!a.is(":visible")||a.data("xdsoft_datetimepicker")||(clearTimeout(z),z=setTimeout(function(){a.data("xdsoft_datetimepicker")||B(a),a.off("open.xdsoft focusin.xdsoft mousedown.xdsoft",b).trigger("open.xdsoft")},100))})},B=function(b){function c(){var a=y.value?y.value:b&&b.val&&b.val()?b.val():"";return a&&L.isValidDate(a=Date.parseDate(a,y.format))?z.data("changed",!0):a="",a||y.startDate===!1||(a=L.strToDateTime(y.startDate)),a?a:0}var z=a("<div "+(y.id?'id="'+y.id+'"':"")+" "+(y.style?'style="'+y.style+'"':"")+' class="xdsoft_datetimepicker xdsoft_noselect '+y.className+'"></div>'),A=a('<div class="xdsoft_copyright"><a target="_blank" href="http://xdsoft.net/jqplugins/datetimepicker/">xdsoft.net</a></div>'),B=a('<div class="xdsoft_datepicker active"></div>'),C=a('<div class="xdsoft_mounthpicker"><button type="button" class="xdsoft_prev"></button><button type="button" class="xdsoft_today_button"></button><div class="xdsoft_label xdsoft_month"><span></span></div><div class="xdsoft_label xdsoft_year"><span></span></div><button type="button" class="xdsoft_next"></button></div>'),D=a('<div class="xdsoft_calendar"></div>'),E=a('<div class="xdsoft_timepicker active"><button type="button" class="xdsoft_prev"></button><div class="xdsoft_time_box"></div><button type="button" class="xdsoft_next"></button></div>'),F=E.find(".xdsoft_time_box").eq(0),G=a('<div class="xdsoft_time_variant"></div>'),H=a('<div class="xdsoft_scrollbar"></div>'),I=(a('<div class="xdsoft_scroller"></div>'),a('<div class="xdsoft_select xdsoft_monthselect"><div></div></div>')),J=a('<div class="xdsoft_select xdsoft_yearselect"><div></div></div>');C.find(".xdsoft_month span").after(I),C.find(".xdsoft_year span").after(J),C.find(".xdsoft_month,.xdsoft_year").on("mousedown.xdsoft",function(b){C.find(".xdsoft_select").hide();var c=a(this).find(".xdsoft_select").eq(0),d=0,e=0;L.currentTime&&(d=L.currentTime[a(this).hasClass("xdsoft_month")?"getMonth":"getFullYear"]()),c.show();for(var f=c.find("div.xdsoft_option"),g=0;g<f.length&&f.eq(g).data("value")!=d;g++)e+=f[0].offsetHeight;return c.xdsoftScroller(e/(c.children()[0].offsetHeight-c[0].clientHeight)),b.stopPropagation(),!1}),C.find(".xdsoft_select").xdsoftScroller().on("mousedown.xdsoft",function(a){a.stopPropagation(),a.preventDefault()}).on("mousedown.xdsoft",".xdsoft_option",function(){L&&L.currentTime&&L.currentTime[a(this).parent().parent().hasClass("xdsoft_monthselect")?"setMonth":"setFullYear"](a(this).data("value")),a(this).parent().parent().hide(),z.trigger("xchange.xdsoft"),y.onChangeMonth&&y.onChangeMonth.call&&y.onChangeMonth.call(z,L.currentTime,z.data("input"))}),z.setOptions=function(c){if(y=a.extend(!0,{},y,c),c.allowTimes&&a.isArray(c.allowTimes)&&c.allowTimes.length&&(y.allowTimes=a.extend(!0,[],c.allowTimes)),c.weekends&&a.isArray(c.weekends)&&c.weekends.length&&(y.weekends=a.extend(!0,[],c.weekends)),!y.open&&!y.opened||y.inline||b.trigger("open.xdsoft"),y.inline&&(O=!0,z.addClass("xdsoft_inline"),b.after(z).hide()),y.inverseButton&&(y.next="xdsoft_prev",y.prev="xdsoft_next"),y.datepicker?B.addClass("active"):B.removeClass("active"),y.timepicker?E.addClass("active"):E.removeClass("active"),y.value&&(b&&b.val&&b.val(y.value),L.setCurrentTime(y.value)),y.dayOfWeekStart=isNaN(y.dayOfWeekStart)||parseInt(y.dayOfWeekStart)<0||parseInt(y.dayOfWeekStart)>6?0:parseInt(y.dayOfWeekStart),y.timepickerScrollbar||H.hide(),y.minDate&&/^-(.*)$/.test(y.minDate)&&(y.minDate=L.strToDateTime(y.minDate).dateFormat(y.formatDate)),y.maxDate&&/^\+(.*)$/.test(y.maxDate)&&(y.maxDate=L.strToDateTime(y.maxDate).dateFormat(y.formatDate)),C.find(".xdsoft_today_button").css("visibility",y.todayButton?"visible":"hidden"),y.mask){var A=function(a){try{if(document.selection&&document.selection.createRange){var b=document.selection.createRange();return b.getBookmark().charCodeAt(2)-2}if(a.setSelectionRange)return a.selectionStart}catch(c){return 0}},D=function(a,b){if(a="string"==typeof a||a instanceof String?document.getElementById(a):a,!a)return!1;if(a.createTextRange){var c=a.createTextRange();return c.collapse(!0),c.moveEnd(b),c.moveStart(b),c.select(),!0}return a.setSelectionRange?(a.setSelectionRange(b,b),!0):!1},F=function(a,b){var c=a.replace(/([\[\]\/\{\}\(\)\-\.\+]{1})/g,"\\$1").replace(/_/g,"{digit+}").replace(/([0-9]{1})/g,"{digit$1}").replace(/\{digit([0-9]{1})\}/g,"[0-$1_]{1}").replace(/\{digit[\+]\}/g,"[0-9_]{1}");return RegExp(c).test(b)};switch(b.off("keydown.xdsoft"),!0){case y.mask===!0:y.mask=y.format.replace(/Y/g,"9999").replace(/F/g,"9999").replace(/m/g,"19").replace(/d/g,"39").replace(/H/g,"29").replace(/i/g,"59").replace(/s/g,"59");case"string"==a.type(y.mask):F(y.mask,b.val())||b.val(y.mask.replace(/[0-9]/g,"_")),b.on("keydown.xdsoft",function(c){var z=this.value,B=c.which;switch(!0){case B>=d&&e>=B||B>=f&&g>=B||B==l||B==i:var C=A(this),E=B!=l&&B!=i?String.fromCharCode(B>=f&&g>=B?B-d:B):"_";for(B!=l&&B!=i||!C||(C--,E="_");/[^0-9_]/.test(y.mask.substr(C,1))&&C<y.mask.length&&C>0;)C+=B==l||B==i?-1:1;if(z=z.substr(0,C)+E+z.substr(C+1),""==a.trim(z))z=y.mask.replace(/[0-9]/g,"_");else if(C==y.mask.length)break;for(C+=B==l||B==i?0:1;/[^0-9_]/.test(y.mask.substr(C,1))&&C<y.mask.length&&C>0;)C+=B==l||B==i?-1:1;F(y.mask,z)?(this.value=z,D(this,C)):""==a.trim(z)?this.value=y.mask.replace(/[0-9]/g,"_"):b.trigger("error_input.xdsoft");break;case!!~[s,t,u,v,w].indexOf(B)&&x:case!!~[k,n,p,m,o,r,h,q,j].indexOf(B):return!0}return c.preventDefault(),!1})}}y.validateOnBlur&&b.off("blur.xdsoft").on("blur.xdsoft",function(){y.allowBlank&&!a.trim(a(this).val()).length?(a(this).val(null),z.data("xdsoft_datetime").empty()):Date.parseDate(a(this).val(),y.format)?z.data("xdsoft_datetime").setCurrentTime(a(this).val()):(a(this).val(L.now().dateFormat(y.format)),z.data("xdsoft_datetime").setCurrentTime(a(this).val())),z.trigger("changedatetime.xdsoft")}),y.dayOfWeekStartPrev=0==y.dayOfWeekStart?6:y.dayOfWeekStart-1,z.trigger("xchange.xdsoft").trigger("afterOpen.xdsoft")},z.data("options",y).on("mousedown.xdsoft",function(a){return a.stopPropagation(),a.preventDefault(),J.hide(),I.hide(),!1});var K=E.find(".xdsoft_time_box");K.append(G),K.xdsoftScroller(),z.on("afterOpen.xdsoft",function(){K.xdsoftScroller()}),z.append(B).append(E),y.withoutCopyright!==!0&&z.append(A),B.append(C).append(D),a("body").append(z);var L=new function(){var a=this;a.now=function(){var a=new Date;return y.yearOffset&&a.setFullYear(a.getFullYear()+y.yearOffset),a},a.currentTime=this.now(),a.isValidDate=function(a){return"[object Date]"!==Object.prototype.toString.call(a)?!1:!isNaN(a.getTime())},a.setCurrentTime=function(b){a.currentTime="string"==typeof b?a.strToDateTime(b):a.isValidDate(b)?b:a.now(),z.trigger("xchange.xdsoft")},a.empty=function(){a.currentTime=null},a.getCurrentTime=function(){return a.currentTime},a.nextMonth=function(){var b=a.currentTime.getMonth()+1;return 12==b&&(a.currentTime.setFullYear(a.currentTime.getFullYear()+1),b=0),a.currentTime.setDate(Math.min(Date.daysInMonth[b],a.currentTime.getDate())),a.currentTime.setMonth(b),y.onChangeMonth&&y.onChangeMonth.call&&y.onChangeMonth.call(z,L.currentTime,z.data("input")),z.trigger("xchange.xdsoft"),b},a.prevMonth=function(){var b=a.currentTime.getMonth()-1;return-1==b&&(a.currentTime.setFullYear(a.currentTime.getFullYear()-1),b=11),a.currentTime.setDate(Math.min(Date.daysInMonth[b],a.currentTime.getDate())),a.currentTime.setMonth(b),y.onChangeMonth&&y.onChangeMonth.call&&y.onChangeMonth.call(z,L.currentTime,z.data("input")),z.trigger("xchange.xdsoft"),b},a.strToDateTime=function(b){if(b&&b instanceof Date&&a.isValidDate(b))return b;var c,d,e=[];return(e=/^(\+|\-)(.*)$/.exec(b))&&(e[2]=Date.parseDate(e[2],y.formatDate))?(c=e[2].getTime()-6e4*e[2].getTimezoneOffset(),d=new Date(L.now().getTime()+parseInt(e[1]+"1")*c)):d=b?Date.parseDate(b,y.format):a.now(),a.isValidDate(d)||(d=a.now()),d},a.strtodate=function(b){if(b&&b instanceof Date&&a.isValidDate(b))return b;var c=b?Date.parseDate(b,y.formatDate):a.now();return a.isValidDate(c)||(c=a.now()),c},a.strtotime=function(b){if(b&&b instanceof Date&&a.isValidDate(b))return b;var c=b?Date.parseDate(b,y.formatTime):a.now();return a.isValidDate(c)||(c=a.now()),c},a.str=function(){return a.currentTime.dateFormat(y.format)}};C.find(".xdsoft_today_button").on("mousedown.xdsoft",function(){z.data("changed",!0),L.setCurrentTime(0),z.trigger("afterOpen.xdsoft")}).on("dblclick.xdsoft",function(){b.val(L.str()),z.trigger("close.xdsoft")}),C.find(".xdsoft_prev,.xdsoft_next").on("mousedown.xdsoft",function(){var b=a(this),c=0,d=!1;!function e(a){L.currentTime.getMonth();b.hasClass(y.next)?L.nextMonth():b.hasClass(y.prev)&&L.prevMonth(),y.monthChangeSpinner&&!d&&(c=setTimeout(e,a?a:100))}(500),a([document.body,window]).on("mouseup.xdsoft",function f(){clearTimeout(c),d=!0,a([document.body,window]).off("mouseup.xdsoft",f)})}),E.find(".xdsoft_prev,.xdsoft_next").on("mousedown.xdsoft",function(){var b=a(this),c=0,d=!1,e=110;!function f(a){var g=F[0].clientHeight,h=G[0].offsetHeight,i=Math.abs(parseInt(G.css("marginTop")));b.hasClass(y.next)&&h-g-y.timeHeightInTimePicker>=i?G.css("marginTop","-"+(i+y.timeHeightInTimePicker)+"px"):b.hasClass(y.prev)&&i-y.timeHeightInTimePicker>=0&&G.css("marginTop","-"+(i-y.timeHeightInTimePicker)+"px"),F.trigger("scroll_element.xdsoft_scroller",[Math.abs(parseInt(G.css("marginTop"))/(h-g))]),e=e>10?10:e-10,!d&&(c=setTimeout(f,a?a:e))}(500),a([document.body,window]).on("mouseup.xdsoft",function g(){clearTimeout(c),d=!0,a([document.body,window]).off("mouseup.xdsoft",g)})});var M=0;z.on("xchange.xdsoft",function(b){clearTimeout(M),M=setTimeout(function(){for(var b="",c=new Date(L.currentTime.getFullYear(),L.currentTime.getMonth(),1,12,0,0),d=0,e=L.now();c.getDay()!=y.dayOfWeekStart;)c.setDate(c.getDate()-1);b+="<table><thead><tr>";for(var f=0;7>f;f++)b+="<th>"+y.i18n[y.lang].dayOfWeek[f+y.dayOfWeekStart>6?0:f+y.dayOfWeekStart]+"</th>";b+="</tr></thead>",b+="<tbody><tr>";var g=!1,h=!1;y.maxDate!==!1&&(g=L.strtodate(y.maxDate),g=new Date(g.getFullYear(),g.getMonth(),g.getDate(),23,59,59,999)),y.minDate!==!1&&(h=L.strtodate(y.minDate),h=new Date(h.getFullYear(),h.getMonth(),h.getDate()));for(var i,j,k,l=[];d<L.currentTime.countDaysInMonth()||c.getDay()!=y.dayOfWeekStart||L.currentTime.getMonth()==c.getMonth();)l=[],d++,i=c.getDate(),j=c.getFullYear(),k=c.getMonth(),l.push("xdsoft_date"),(g!==!1&&c>g||h!==!1&&h>c)&&l.push("xdsoft_disabled"),L.currentTime.getMonth()!=k&&l.push("xdsoft_other_month"),(y.defaultSelect||z.data("changed"))&&L.currentTime.dateFormat(y.formatDate)==c.dateFormat(y.formatDate)&&l.push("xdsoft_current"),e.dateFormat(y.formatDate)==c.dateFormat(y.formatDate)&&l.push("xdsoft_today"),(0==c.getDay()||6==c.getDay()||~y.weekends.indexOf(c.dateFormat(y.formatDate)))&&l.push("xdsoft_weekend"),y.beforeShowDay&&"function"==typeof y.beforeShowDay&&l.push(y.beforeShowDay(c)),b+='<td data-date="'+i+'" data-month="'+k+'" data-year="'+j+'" class="xdsoft_date xdsoft_day_of_week'+c.getDay()+" "+l.join(" ")+'"><div>'+i+"</div></td>",c.getDay()==y.dayOfWeekStartPrev&&(b+="</tr>"),c.setDate(i+1);b+="</tbody></table>",D.html(b),C.find(".xdsoft_label span").eq(0).text(y.i18n[y.lang].months[L.currentTime.getMonth()]),C.find(".xdsoft_label span").eq(1).text(L.currentTime.getFullYear());var m="",n="",k="",o=function(a,b){var c=L.now();c.setHours(a),a=parseInt(c.getHours()),c.setMinutes(b),b=parseInt(c.getMinutes()),l=[],(y.maxTime!==!1&&L.strtotime(y.maxTime).getTime()<c.getTime()||y.minTime!==!1&&L.strtotime(y.minTime).getTime()>c.getTime())&&l.push("xdsoft_disabled"),(y.initTime||y.defaultSelect||z.data("changed"))&&parseInt(L.currentTime.getHours())==parseInt(a)&&(y.step>59||Math[y.roundTime](L.currentTime.getMinutes()/y.step)*y.step==parseInt(b))&&(y.defaultSelect||z.data("changed")?l.push("xdsoft_current"):y.initTime&&l.push("xdsoft_init_time")),parseInt(e.getHours())==parseInt(a)&&parseInt(e.getMinutes())==parseInt(b)&&l.push("xdsoft_today"),m+='<div class="xdsoft_time '+l.join(" ")+'" data-hour="'+a+'" data-minute="'+b+'">'+c.dateFormat(y.formatTime)+"</div>"};if(y.allowTimes&&a.isArray(y.allowTimes)&&y.allowTimes.length)for(var d=0;d<y.allowTimes.length;d++)n=L.strtotime(y.allowTimes[d]).getHours(),k=L.strtotime(y.allowTimes[d]).getMinutes(),o(n,k);else for(var d=0,f=0;d<(y.hours12?12:24);d++)for(f=0;60>f;f+=y.step)n=(10>d?"0":"")+d,k=(10>f?"0":"")+f,o(n,k);G.html(m);var p="",d=0;for(d=parseInt(y.yearStart,10)+y.yearOffset;d<=parseInt(y.yearEnd,10)+y.yearOffset;d++)p+='<div class="xdsoft_option '+(L.currentTime.getFullYear()==d?"xdsoft_current":"")+'" data-value="'+d+'">'+d+"</div>";for(J.children().eq(0).html(p),d=0,p="";11>=d;d++)p+='<div class="xdsoft_option '+(L.currentTime.getMonth()==d?"xdsoft_current":"")+'" data-value="'+d+'">'+y.i18n[y.lang].months[d]+"</div>";I.children().eq(0).html(p),a(z).trigger("generate.xdsoft")},10),b.stopPropagation()}).on("afterOpen.xdsoft",function(){if(y.timepicker){var a;if(G.find(".xdsoft_current").length?a=".xdsoft_current":G.find(".xdsoft_init_time").length&&(a=".xdsoft_init_time"),a){var b=F[0].clientHeight,c=G[0].offsetHeight,d=G.find(a).index()*y.timeHeightInTimePicker+1;d>c-b&&(d=c-b),F.trigger("scroll_element.xdsoft_scroller",[parseInt(d)/(c-b)])}else F.trigger("scroll_element.xdsoft_scroller",[0])}});var N=0;D.on("click.xdsoft","td",function(c){c.stopPropagation(),N++;var d=a(this),e=L.currentTime;return d.hasClass("xdsoft_disabled")?!1:(e.setDate(1),e.setFullYear(d.data("year")),e.setMonth(d.data("month")),e.setDate(d.data("date")),z.trigger("select.xdsoft",[e]),b.val(L.str()),(N>1||y.closeOnDateSelect===!0||0===y.closeOnDateSelect&&!y.timepicker)&&!y.inline&&z.trigger("close.xdsoft"),y.onSelectDate&&y.onSelectDate.call&&y.onSelectDate.call(z,L.currentTime,z.data("input")),z.data("changed",!0),z.trigger("xchange.xdsoft"),z.trigger("changedatetime.xdsoft"),void setTimeout(function(){N=0},200))}),G.on("click.xdsoft","div",function(b){b.stopPropagation();var c=a(this),d=L.currentTime;return c.hasClass("xdsoft_disabled")?!1:(d.setHours(c.data("hour")),d.setMinutes(c.data("minute")),z.trigger("select.xdsoft",[d]),z.data("input").val(L.str()),!y.inline&&z.trigger("close.xdsoft"),y.onSelectTime&&y.onSelectTime.call&&y.onSelectTime.call(z,L.currentTime,z.data("input")),z.data("changed",!0),z.trigger("xchange.xdsoft"),void z.trigger("changedatetime.xdsoft"))}),z.mousewheel&&B.mousewheel(function(a,b){return y.scrollMonth?(0>b?L.nextMonth():L.prevMonth(),!1):!0}),z.mousewheel&&F.unmousewheel().mousewheel(function(a,b){if(!y.scrollTime)return!0;var c=F[0].clientHeight,d=G[0].offsetHeight,e=Math.abs(parseInt(G.css("marginTop"))),f=!0;return 0>b&&d-c-y.timeHeightInTimePicker>=e?(G.css("marginTop","-"+(e+y.timeHeightInTimePicker)+"px"),f=!1):b>0&&e-y.timeHeightInTimePicker>=0&&(G.css("marginTop","-"+(e-y.timeHeightInTimePicker)+"px"),f=!1),F.trigger("scroll_element.xdsoft_scroller",[Math.abs(parseInt(G.css("marginTop"))/(d-c))]),a.stopPropagation(),f});var O=!1;z.on("changedatetime.xdsoft",function(){if(y.onChangeDateTime&&y.onChangeDateTime.call){var a=z.data("input");y.onChangeDateTime.call(z,L.currentTime,a),a.trigger("change")}}).on("generate.xdsoft",function(){y.onGenerate&&y.onGenerate.call&&y.onGenerate.call(z,L.currentTime,z.data("input")),O&&(z.trigger("afterOpen.xdsoft"),O=!1)}).on("click.xdsoft",function(a){a.stopPropagation()});var P=0;b.mousewheel&&b.mousewheel(function(a,c,d,e){return y.scrollInput?!y.datepicker&&y.timepicker?(P=G.find(".xdsoft_current").length?G.find(".xdsoft_current").eq(0).index():0,P+c>=0&&P+c<G.children().length&&(P+=c),G.children().eq(P).length&&G.children().eq(P).trigger("mousedown"),!1):y.datepicker&&!y.timepicker?(B.trigger(a,[c,d,e]),b.val&&b.val(L.str()),z.trigger("changedatetime.xdsoft"),!1):void 0:!0});var Q=function(){var b=z.data("input").offset(),c=b.top+z.data("input")[0].offsetHeight-1,d=b.left,e="absolute";y.fixed?(c-=a(window).scrollTop(),d-=a(window).scrollLeft(),e="fixed"):(c+z[0].offsetHeight>a(window).height()+a(window).scrollTop()&&(c=b.top-z[0].offsetHeight+1),0>c&&(c=0),d+z[0].offsetWidth>a(window).width()&&(d=b.left-z[0].offsetWidth+z.data("input")[0].offsetWidth)),z.css({left:d,top:c,position:e})};z.on("open.xdsoft",function(){var b=!0;y.onShow&&y.onShow.call&&(b=y.onShow.call(z,L.currentTime,z.data("input"))),b!==!1&&(z.show(),Q(),a(window).off("resize.xdsoft",Q).on("resize.xdsoft",Q),y.closeOnWithoutClick&&a([document.body,window]).on("mousedown.xdsoft",function c(){z.trigger("close.xdsoft"),a([document.body,window]).off("mousedown.xdsoft",c)}))}).on("close.xdsoft",function(a){var b=!0;y.onClose&&y.onClose.call&&(b=y.onClose.call(z,L.currentTime,z.data("input"))),b===!1||y.opened||y.inline||z.hide(),a.stopPropagation()}).data("input",b);var R=0;z.data("xdsoft_datetime",L),z.setOptions(y),L.setCurrentTime(c()),b.data("xdsoft_datetimepicker",z).on("open.xdsoft focusin.xdsoft mousedown.xdsoft",function(){b.is(":disabled")||b.is(":hidden")||!b.is(":visible")||b.data("xdsoft_datetimepicker").is(":visible")&&y.closeOnInputClick||(clearTimeout(R),R=setTimeout(function(){b.is(":disabled")||b.is(":hidden")||!b.is(":visible")||(O=!0,L.setCurrentTime(c()),z.trigger("open.xdsoft"))},100))}).on("keydown.xdsoft",function(b){var c=(this.value,b.which);switch(!0){case!!~[j].indexOf(c):var d=a("input:visible,textarea:visible");return z.trigger("close.xdsoft"),d.eq(d.index(this)+1).focus(),!1;case!!~[q].indexOf(c):return z.trigger("close.xdsoft"),!0}})},C=function(b){var c=b.data("xdsoft_datetimepicker");c&&(c.data("xdsoft_datetime",null),c.remove(),b.data("xdsoft_datetimepicker",null).off("open.xdsoft focusin.xdsoft focusout.xdsoft mousedown.xdsoft blur.xdsoft keydown.xdsoft"),a(window).off("resize.xdsoft"),a([window,document.body]).off("mousedown.xdsoft"),b.unmousewheel&&b.unmousewheel())};return a(document).off("keydown.xdsoftctrl keyup.xdsoftctrl").on("keydown.xdsoftctrl",function(a){a.keyCode==h&&(x=!0)}).on("keyup.xdsoftctrl",function(a){a.keyCode==h&&(x=!1)}),this.each(function(){var b;if(b=a(this).data("xdsoft_datetimepicker")){if("string"===a.type(c))switch(c){case"show":a(this).select().focus(),b.trigger("open.xdsoft");break;case"hide":b.trigger("close.xdsoft");break;case"destroy":C(a(this));break;case"reset":this.value=this.defaultValue,this.value&&b.data("xdsoft_datetime").isValidDate(Date.parseDate(this.value,y.format))||b.data("changed",!1),b.data("xdsoft_datetime").setCurrentTime(this.value)}else b.setOptions(c);return 0}"string"!==a.type(c)&&(!y.lazyInit||y.open||y.inline?B(a(this)):A(a(this)))})},a.fn.datetimepicker.defaults=b}(jQuery),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof exports?module.exports=a:a(jQuery)}(function(a){function b(b){var e,f=b||window.event,g=[].slice.call(arguments,1),h=0,i=0,j=0,k=0,l=0;return b=a.event.fix(f),b.type="mousewheel",f.wheelDelta&&(h=f.wheelDelta),f.detail&&(h=-1*f.detail),f.deltaY&&(j=-1*f.deltaY,h=j),f.deltaX&&(i=f.deltaX,h=-1*i),void 0!==f.wheelDeltaY&&(j=f.wheelDeltaY),void 0!==f.wheelDeltaX&&(i=-1*f.wheelDeltaX),k=Math.abs(h),(!c||c>k)&&(c=k),l=Math.max(Math.abs(j),Math.abs(i)),(!d||d>l)&&(d=l),e=h>0?"floor":"ceil",h=Math[e](h/c),i=Math[e](i/d),j=Math[e](j/d),g.unshift(b,h,i,j),(a.event.dispatch||a.event.handle).apply(this,g)}var c,d,e=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],f="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];if(a.event.fixHooks)for(var g=e.length;g;)a.event.fixHooks[e[--g]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=f.length;a;)this.addEventListener(f[--a],b,!1);else this.onmousewheel=b},teardown:function(){if(this.removeEventListener)for(var a=f.length;a;)this.removeEventListener(f[--a],b,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})}),Date.parseFunctions={count:0},Date.parseRegexes=[],Date.formatFunctions={count:0},Date.prototype.dateFormat=function(a){if("unixtime"==a)return parseInt(this.getTime()/1e3);null==Date.formatFunctions[a]&&Date.createNewFormat(a);var b=Date.formatFunctions[a];return this[b]()},Date.createNewFormat=function(format){var funcName="format"+Date.formatFunctions.count++;Date.formatFunctions[format]=funcName;for(var code="Date.prototype."+funcName+" = function() {return ",special=!1,ch="",i=0;i<format.length;++i)ch=format.charAt(i),special||"\\"!=ch?special?(special=!1,code+="'"+String.escape(ch)+"' + "):code+=Date.getFormatCode(ch):special=!0;eval(code.substring(0,code.length-3)+";}")},Date.getFormatCode=function(a){switch(a){case"d":return"String.leftPad(this.getDate(), 2, '0') + ";case"D":return"Date.dayNames[this.getDay()].substring(0, 3) + ";case"j":return"this.getDate() + ";case"l":return"Date.dayNames[this.getDay()] + ";case"S":return"this.getSuffix() + ";case"w":return"this.getDay() + ";case"z":return"this.getDayOfYear() + ";case"W":return"this.getWeekOfYear() + ";case"F":return"Date.monthNames[this.getMonth()] + ";case"m":return"String.leftPad(this.getMonth() + 1, 2, '0') + ";case"M":return"Date.monthNames[this.getMonth()].substring(0, 3) + ";case"n":return"(this.getMonth() + 1) + ";case"t":return"this.getDaysInMonth() + ";case"L":return"(this.isLeapYear() ? 1 : 0) + ";case"Y":return"this.getFullYear() + ";case"y":return"('' + this.getFullYear()).substring(2, 4) + ";case"a":return"(this.getHours() < 12 ? 'am' : 'pm') + ";case"A":return"(this.getHours() < 12 ? 'AM' : 'PM') + ";case"g":return"((this.getHours() %12) ? this.getHours() % 12 : 12) + ";case"G":return"this.getHours() + ";case"h":return"String.leftPad((this.getHours() %12) ? this.getHours() % 12 : 12, 2, '0') + ";case"H":return"String.leftPad(this.getHours(), 2, '0') + ";case"i":return"String.leftPad(this.getMinutes(), 2, '0') + ";case"s":return"String.leftPad(this.getSeconds(), 2, '0') + ";case"O":return"this.getGMTOffset() + ";case"T":return"this.getTimezone() + ";case"Z":return"(this.getTimezoneOffset() * -60) + ";default:return"'"+String.escape(a)+"' + "}},Date.parseDate=function(a,b){if("unixtime"==b)return new Date(isNaN(parseInt(a))?0:1e3*parseInt(a));null==Date.parseFunctions[b]&&Date.createParser(b);var c=Date.parseFunctions[b];return Date[c](a)},Date.createParser=function(format){var funcName="parse"+Date.parseFunctions.count++,regexNum=Date.parseRegexes.length,currentGroup=1;Date.parseFunctions[format]=funcName;for(var code="Date."+funcName+" = function(input) {\nvar y = -1, m = -1, d = -1, h = -1, i = -1, s = -1, z = -1;\nvar d = new Date();\ny = d.getFullYear();\nm = d.getMonth();\nd = d.getDate();\nvar results = input.match(Date.parseRegexes["+regexNum+"]);\nif (results && results.length > 0) {",regex="",special=!1,ch="",i=0;i<format.length;++i)ch=format.charAt(i),special||"\\"!=ch?special?(special=!1,regex+=String.escape(ch)):(obj=Date.formatCodeToRegex(ch,currentGroup),currentGroup+=obj.g,regex+=obj.s,obj.g&&obj.c&&(code+=obj.c)):special=!0;code+="if (y > 0 && z > 0){\nvar doyDate = new Date(y,0);\ndoyDate.setDate(z);\nm = doyDate.getMonth();\nd = doyDate.getDate();\n}",code+="if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0 && s >= 0)\n{return new Date(y, m, d, h, i, s);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0 && i >= 0)\n{return new Date(y, m, d, h, i);}\nelse if (y > 0 && m >= 0 && d > 0 && h >= 0)\n{return new Date(y, m, d, h);}\nelse if (y > 0 && m >= 0 && d > 0)\n{return new Date(y, m, d);}\nelse if (y > 0 && m >= 0)\n{return new Date(y, m);}\nelse if (y > 0)\n{return new Date(y);}\n}return null;}",Date.parseRegexes[regexNum]=new RegExp("^"+regex+"$"),eval(code)},Date.formatCodeToRegex=function(a,b){switch(a){case"D":return{g:0,c:null,s:"(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)"};case"j":case"d":return{g:1,c:"d = parseInt(results["+b+"], 10);\n",s:"(\\d{1,2})"};case"l":return{g:0,c:null,s:"(?:"+Date.dayNames.join("|")+")"};case"S":return{g:0,c:null,s:"(?:st|nd|rd|th)"};case"w":return{g:0,c:null,s:"\\d"};case"z":return{g:1,c:"z = parseInt(results["+b+"], 10);\n",s:"(\\d{1,3})"};
case"W":return{g:0,c:null,s:"(?:\\d{2})"};case"F":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+b+"].substring(0, 3)], 10);\n",s:"("+Date.monthNames.join("|")+")"};case"M":return{g:1,c:"m = parseInt(Date.monthNumbers[results["+b+"]], 10);\n",s:"(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)"};case"n":case"m":return{g:1,c:"m = parseInt(results["+b+"], 10) - 1;\n",s:"(\\d{1,2})"};case"t":return{g:0,c:null,s:"\\d{1,2}"};case"L":return{g:0,c:null,s:"(?:1|0)"};case"Y":return{g:1,c:"y = parseInt(results["+b+"], 10);\n",s:"(\\d{4})"};case"y":return{g:1,c:"var ty = parseInt(results["+b+"], 10);\ny = ty > Date.y2kYear ? 1900 + ty : 2000 + ty;\n",s:"(\\d{1,2})"};case"a":return{g:1,c:"if (results["+b+"] == 'am') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(am|pm)"};case"A":return{g:1,c:"if (results["+b+"] == 'AM') {\nif (h == 12) { h = 0; }\n} else { if (h < 12) { h += 12; }}",s:"(AM|PM)"};case"g":case"G":case"h":case"H":return{g:1,c:"h = parseInt(results["+b+"], 10);\n",s:"(\\d{1,2})"};case"i":return{g:1,c:"i = parseInt(results["+b+"], 10);\n",s:"(\\d{2})"};case"s":return{g:1,c:"s = parseInt(results["+b+"], 10);\n",s:"(\\d{2})"};case"O":return{g:0,c:null,s:"[+-]\\d{4}"};case"T":return{g:0,c:null,s:"[A-Z]{3}"};case"Z":return{g:0,c:null,s:"[+-]\\d{1,5}"};default:return{g:0,c:null,s:String.escape(a)}}},Date.prototype.getTimezone=function(){return this.toString().replace(/^.*? ([A-Z]{3}) [0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")},Date.prototype.getGMTOffset=function(){return(this.getTimezoneOffset()>0?"-":"+")+String.leftPad(Math.floor(Math.abs(this.getTimezoneOffset())/60),2,"0")+String.leftPad(Math.abs(this.getTimezoneOffset())%60,2,"0")},Date.prototype.getDayOfYear=function(){var a=0;Date.daysInMonth[1]=this.isLeapYear()?29:28;for(var b=0;b<this.getMonth();++b)a+=Date.daysInMonth[b];return a+this.getDate()},Date.prototype.getWeekOfYear=function(){var a=this.getDayOfYear()+(4-this.getDay()),b=new Date(this.getFullYear(),0,1),c=7-b.getDay()+4;return String.leftPad(Math.ceil((a-c)/7)+1,2,"0")},Date.prototype.isLeapYear=function(){var a=this.getFullYear();return 0==(3&a)&&(a%100||a%400==0&&a)},Date.prototype.getFirstDayOfMonth=function(){var a=(this.getDay()-(this.getDate()-1))%7;return 0>a?a+7:a},Date.prototype.getLastDayOfMonth=function(){var a=(this.getDay()+(Date.daysInMonth[this.getMonth()]-this.getDate()))%7;return 0>a?a+7:a},Date.prototype.getDaysInMonth=function(){return Date.daysInMonth[1]=this.isLeapYear()?29:28,Date.daysInMonth[this.getMonth()]},Date.prototype.getSuffix=function(){switch(this.getDate()){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},String.escape=function(a){return a.replace(/('|\\)/g,"\\$1")},String.leftPad=function(a,b,c){var d=new String(a);for(null==c&&(c=" ");d.length<b;)d=c+d;return d},Date.daysInMonth=[31,28,31,30,31,30,31,31,30,31,30,31],Date.monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],Date.dayNames=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Date.y2kYear=50,Date.monthNumbers={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},Date.patterns={ISO8601LongPattern:"Y-m-d H:i:s",ISO8601ShortPattern:"Y-m-d",ShortDatePattern:"n/j/Y",LongDatePattern:"l, F d, Y",FullDateTimePattern:"l, F d, Y g:i:s A",MonthDayPattern:"F d",ShortTimePattern:"g:i A",LongTimePattern:"g:i:s A",SortableDateTimePattern:"Y-m-d\\TH:i:s",UniversalSortableDateTimePattern:"Y-m-d H:i:sO",YearMonthPattern:"F, Y"};var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("TweenMax",["core.Animation","core.SimpleTimeline","TweenLite"],function(a,b,c){var d=function(a){var b,c=[],d=a.length;for(b=0;b!==d;c.push(a[b++]));return c},e=function(a,b,d){c.call(this,a,b,d),this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._dirty=!0,this.render=e.prototype.render},f=1e-10,g=c._internals,h=g.isSelector,i=g.isArray,j=e.prototype=c.to({},.1,{}),k=[];e.version="1.15.1",j.constructor=e,j.kill()._gc=!1,e.killTweensOf=e.killDelayedCallsTo=c.killTweensOf,e.getTweensOf=c.getTweensOf,e.lagSmoothing=c.lagSmoothing,e.ticker=c.ticker,e.render=c.render,j.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),c.prototype.invalidate.call(this)},j.updateTo=function(a,b){var d,e=this.ratio,f=this.vars.immediateRender||a.immediateRender;b&&this._startTime<this._timeline._time&&(this._startTime=this._timeline._time,this._uncache(!1),this._gc?this._enabled(!0,!1):this._timeline.insert(this,this._startTime-this._delay));for(d in a)this.vars[d]=a[d];if(this._initted||f)if(b)this._initted=!1,f&&this.render(0,!0,!0);else if(this._gc&&this._enabled(!0,!1),this._notifyPluginsOfEnabled&&this._firstPT&&c._onPluginEvent("_onDisable",this),this._time/this._duration>.998){var g=this._time;this.render(0,!0,!1),this._initted=!1,this.render(g,!0,!1)}else if(this._time>0||f){this._initted=!1,this._init();for(var h,i=1/(1-e),j=this._firstPT;j;)h=j.s+j.c,j.c*=i,j.s=h-j.c,j=j._next}return this},j.render=function(a,b,c){this._initted||0===this._duration&&this.vars.repeat&&this.invalidate();var d,e,h,i,j,l,m,n,o=this._dirty?this.totalDuration():this._totalDuration,p=this._time,q=this._totalTime,r=this._cycle,s=this._duration,t=this._rawPrevTime;if(a>=o?(this._totalTime=o,this._cycle=this._repeat,this._yoyo&&0!==(1&this._cycle)?(this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0):(this._time=s,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1),this._reversed||(d=!0,e="onComplete"),0===s&&(this._initted||!this.vars.lazy||c)&&(this._startTime===this._timeline._duration&&(a=0),(0===a||0>t||t===f)&&t!==a&&(c=!0,t>f&&(e="onReverseComplete")),this._rawPrevTime=n=!b||a||t===a?a:f)):1e-7>a?(this._totalTime=this._time=this._cycle=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==q||0===s&&t>0&&t!==f)&&(e="onReverseComplete",d=this._reversed),0>a&&(this._active=!1,0===s&&(this._initted||!this.vars.lazy||c)&&(t>=0&&(c=!0),this._rawPrevTime=n=!b||a||t===a?a:f)),this._initted||(c=!0)):(this._totalTime=this._time=a,0!==this._repeat&&(i=s+this._repeatDelay,this._cycle=this._totalTime/i>>0,0!==this._cycle&&this._cycle===this._totalTime/i&&this._cycle--,this._time=this._totalTime-this._cycle*i,this._yoyo&&0!==(1&this._cycle)&&(this._time=s-this._time),this._time>s?this._time=s:this._time<0&&(this._time=0)),this._easeType?(j=this._time/s,l=this._easeType,m=this._easePower,(1===l||3===l&&j>=.5)&&(j=1-j),3===l&&(j*=2),1===m?j*=j:2===m?j*=j*j:3===m?j*=j*j*j:4===m&&(j*=j*j*j*j),this.ratio=1===l?1-j:2===l?j:this._time/s<.5?j/2:1-j/2):this.ratio=this._ease.getRatio(this._time/s)),p===this._time&&!c&&r===this._cycle)return void(q!==this._totalTime&&this._onUpdate&&(b||this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||k)));if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!c&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=p,this._totalTime=q,this._rawPrevTime=t,this._cycle=r,g.lazyTweens.push(this),void(this._lazy=[a,b]);this._time&&!d?this.ratio=this._ease.getRatio(this._time/s):d&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==p&&a>=0&&(this._active=!0),0===q&&(2===this._initted&&a>0&&this._init(),this._startAt&&(a>=0?this._startAt.render(a,b,c):e||(e="_dummyGS")),this.vars.onStart&&(0!==this._totalTime||0===s)&&(b||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||k))),h=this._firstPT;h;)h.f?h.t[h.p](h.c*this.ratio+h.s):h.t[h.p]=h.c*this.ratio+h.s,h=h._next;this._onUpdate&&(0>a&&this._startAt&&this._startTime&&this._startAt.render(a,b,c),b||(this._totalTime!==q||d)&&this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||k)),this._cycle!==r&&(b||this._gc||this.vars.onRepeat&&this.vars.onRepeat.apply(this.vars.onRepeatScope||this,this.vars.onRepeatParams||k)),e&&(!this._gc||c)&&(0>a&&this._startAt&&!this._onUpdate&&this._startTime&&this._startAt.render(a,b,c),d&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[e]&&this.vars[e].apply(this.vars[e+"Scope"]||this,this.vars[e+"Params"]||k),0===s&&this._rawPrevTime===f&&n!==f&&(this._rawPrevTime=0))},e.to=function(a,b,c){return new e(a,b,c)},e.from=function(a,b,c){return c.runBackwards=!0,c.immediateRender=0!=c.immediateRender,new e(a,b,c)},e.fromTo=function(a,b,c,d){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,new e(a,b,d)},e.staggerTo=e.allTo=function(a,b,f,g,j,l,m){g=g||0;var n,o,p,q,r=f.delay||0,s=[],t=function(){f.onComplete&&f.onComplete.apply(f.onCompleteScope||this,arguments),j.apply(m||this,l||k)};for(i(a)||("string"==typeof a&&(a=c.selector(a)||a),h(a)&&(a=d(a))),a=a||[],0>g&&(a=d(a),a.reverse(),g*=-1),n=a.length-1,p=0;n>=p;p++){o={};for(q in f)o[q]=f[q];o.delay=r,p===n&&j&&(o.onComplete=t),s[p]=new e(a[p],b,o),r+=g}return s},e.staggerFrom=e.allFrom=function(a,b,c,d,f,g,h){return c.runBackwards=!0,c.immediateRender=0!=c.immediateRender,e.staggerTo(a,b,c,d,f,g,h)},e.staggerFromTo=e.allFromTo=function(a,b,c,d,f,g,h,i){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,e.staggerTo(a,b,d,f,g,h,i)},e.delayedCall=function(a,b,c,d,f){return new e(b,0,{delay:a,onComplete:b,onCompleteParams:c,onCompleteScope:d,onReverseComplete:b,onReverseCompleteParams:c,onReverseCompleteScope:d,immediateRender:!1,useFrames:f,overwrite:0})},e.set=function(a,b){return new e(a,0,b)},e.isTweening=function(a){return c.getTweensOf(a,!0).length>0};var l=function(a,b){for(var d=[],e=0,f=a._first;f;)f instanceof c?d[e++]=f:(b&&(d[e++]=f),d=d.concat(l(f,b)),e=d.length),f=f._next;return d},m=e.getAllTweens=function(b){return l(a._rootTimeline,b).concat(l(a._rootFramesTimeline,b))};e.killAll=function(a,c,d,e){null==c&&(c=!0),null==d&&(d=!0);var f,g,h,i=m(0!=e),j=i.length,k=c&&d&&e;for(h=0;j>h;h++)g=i[h],(k||g instanceof b||(f=g.target===g.vars.onComplete)&&d||c&&!f)&&(a?g.totalTime(g._reversed?0:g.totalDuration()):g._enabled(!1,!1))},e.killChildTweensOf=function(a,b){if(null!=a){var f,j,k,l,m,n=g.tweenLookup;if("string"==typeof a&&(a=c.selector(a)||a),h(a)&&(a=d(a)),i(a))for(l=a.length;--l>-1;)e.killChildTweensOf(a[l],b);else{f=[];for(k in n)for(j=n[k].target.parentNode;j;)j===a&&(f=f.concat(n[k].tweens)),j=j.parentNode;for(m=f.length,l=0;m>l;l++)b&&f[l].totalTime(f[l].totalDuration()),f[l]._enabled(!1,!1)}}};var n=function(a,c,d,e){c=c!==!1,d=d!==!1,e=e!==!1;for(var f,g,h=m(e),i=c&&d&&e,j=h.length;--j>-1;)g=h[j],(i||g instanceof b||(f=g.target===g.vars.onComplete)&&d||c&&!f)&&g.paused(a)};return e.pauseAll=function(a,b,c){n(!0,a,b,c)},e.resumeAll=function(a,b,c){n(!1,a,b,c)},e.globalTimeScale=function(b){var d=a._rootTimeline,e=c.ticker.time;return arguments.length?(b=b||f,d._startTime=e-(e-d._startTime)*d._timeScale/b,d=a._rootFramesTimeline,e=c.ticker.frame,d._startTime=e-(e-d._startTime)*d._timeScale/b,d._timeScale=a._rootTimeline._timeScale=b,b):d._timeScale},j.progress=function(a){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!==(1&this._cycle)?1-a:a)+this._cycle*(this._duration+this._repeatDelay),!1):this._time/this.duration()},j.totalProgress=function(a){return arguments.length?this.totalTime(this.totalDuration()*a,!1):this._totalTime/this.totalDuration()},j.time=function(a,b){return arguments.length?(this._dirty&&this.totalDuration(),a>this._duration&&(a=this._duration),this._yoyo&&0!==(1&this._cycle)?a=this._duration-a+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(a+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(a,b)):this._time},j.duration=function(b){return arguments.length?a.prototype.duration.call(this,b):this._duration},j.totalDuration=function(a){return arguments.length?-1===this._repeat?this:this.duration((a-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat,this._dirty=!1),this._totalDuration)},j.repeat=function(a){return arguments.length?(this._repeat=a,this._uncache(!0)):this._repeat},j.repeatDelay=function(a){return arguments.length?(this._repeatDelay=a,this._uncache(!0)):this._repeatDelay},j.yoyo=function(a){return arguments.length?(this._yoyo=a,this):this._yoyo},e},!0),_gsScope._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(a,b,c){var d=function(a){b.call(this,a),this._labels={},this.autoRemoveChildren=this.vars.autoRemoveChildren===!0,this.smoothChildTiming=this.vars.smoothChildTiming===!0,this._sortChildren=!0,this._onUpdate=this.vars.onUpdate;var c,d,e=this.vars;for(d in e)c=e[d],i(c)&&-1!==c.join("").indexOf("{self}")&&(e[d]=this._swapSelfInParams(c));i(e.tweens)&&this.add(e.tweens,0,e.align,e.stagger)},e=1e-10,f=c._internals,g=d._internals={},h=f.isSelector,i=f.isArray,j=f.lazyTweens,k=f.lazyRender,l=[],m=_gsScope._gsDefine.globals,n=function(a){var b,c={};for(b in a)c[b]=a[b];return c},o=g.pauseCallback=function(a,b,c,d){var e=a._timeline,f=e._totalTime;!b&&this._forcingPlayhead||e._rawPrevTime===a._startTime||(e.pause(a._startTime),b&&b.apply(d||e,c||l),this._forcingPlayhead&&e.seek(f))},p=function(a){var b,c=[],d=a.length;for(b=0;b!==d;c.push(a[b++]));return c},q=d.prototype=new b;return d.version="1.15.1",q.constructor=d,q.kill()._gc=q._forcingPlayhead=!1,q.to=function(a,b,d,e){var f=d.repeat&&m.TweenMax||c;return b?this.add(new f(a,b,d),e):this.set(a,d,e)},q.from=function(a,b,d,e){return this.add((d.repeat&&m.TweenMax||c).from(a,b,d),e)},q.fromTo=function(a,b,d,e,f){var g=e.repeat&&m.TweenMax||c;return b?this.add(g.fromTo(a,b,d,e),f):this.set(a,e,f)},q.staggerTo=function(a,b,e,f,g,i,j,k){var l,m=new d({onComplete:i,onCompleteParams:j,onCompleteScope:k,smoothChildTiming:this.smoothChildTiming});for("string"==typeof a&&(a=c.selector(a)||a),a=a||[],h(a)&&(a=p(a)),f=f||0,0>f&&(a=p(a),a.reverse(),f*=-1),l=0;l<a.length;l++)e.startAt&&(e.startAt=n(e.startAt)),m.to(a[l],b,n(e),l*f);return this.add(m,g)},q.staggerFrom=function(a,b,c,d,e,f,g,h){return c.immediateRender=0!=c.immediateRender,c.runBackwards=!0,this.staggerTo(a,b,c,d,e,f,g,h)},q.staggerFromTo=function(a,b,c,d,e,f,g,h,i){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,this.staggerTo(a,b,d,e,f,g,h,i)},q.call=function(a,b,d,e){return this.add(c.delayedCall(0,a,b,d),e)},q.set=function(a,b,d){return d=this._parseTimeOrLabel(d,0,!0),null==b.immediateRender&&(b.immediateRender=d===this._time&&!this._paused),this.add(new c(a,0,b),d)},d.exportRoot=function(a,b){a=a||{},null==a.smoothChildTiming&&(a.smoothChildTiming=!0);var e,f,g=new d(a),h=g._timeline;for(null==b&&(b=!0),h._remove(g,!0),g._startTime=0,g._rawPrevTime=g._time=g._totalTime=h._time,e=h._first;e;)f=e._next,b&&e instanceof c&&e.target===e.vars.onComplete||g.add(e,e._startTime-e._delay),e=f;return h.add(g,0),g},q.add=function(e,f,g,h){var j,k,l,m,n,o;if("number"!=typeof f&&(f=this._parseTimeOrLabel(f,0,!0,e)),!(e instanceof a)){if(e instanceof Array||e&&e.push&&i(e)){for(g=g||"normal",h=h||0,j=f,k=e.length,l=0;k>l;l++)i(m=e[l])&&(m=new d({tweens:m})),this.add(m,j),"string"!=typeof m&&"function"!=typeof m&&("sequence"===g?j=m._startTime+m.totalDuration()/m._timeScale:"start"===g&&(m._startTime-=m.delay())),j+=h;return this._uncache(!0)}if("string"==typeof e)return this.addLabel(e,f);if("function"!=typeof e)throw"Cannot add "+e+" into the timeline; it is not a tween, timeline, function, or string.";e=c.delayedCall(0,e)}if(b.prototype.add.call(this,e,f),(this._gc||this._time===this._duration)&&!this._paused&&this._duration<this.duration())for(n=this,o=n.rawTime()>e._startTime;n._timeline;)o&&n._timeline.smoothChildTiming?n.totalTime(n._totalTime,!0):n._gc&&n._enabled(!0,!1),n=n._timeline;return this},q.remove=function(b){if(b instanceof a)return this._remove(b,!1);if(b instanceof Array||b&&b.push&&i(b)){for(var c=b.length;--c>-1;)this.remove(b[c]);return this}return"string"==typeof b?this.removeLabel(b):this.kill(null,b)},q._remove=function(a,c){b.prototype._remove.call(this,a,c);var d=this._last;return d?this._time>d._startTime+d._totalDuration/d._timeScale&&(this._time=this.duration(),this._totalTime=this._totalDuration):this._time=this._totalTime=this._duration=this._totalDuration=0,this},q.append=function(a,b){return this.add(a,this._parseTimeOrLabel(null,b,!0,a))},q.insert=q.insertMultiple=function(a,b,c,d){return this.add(a,b||0,c,d)},q.appendMultiple=function(a,b,c,d){return this.add(a,this._parseTimeOrLabel(null,b,!0,a),c,d)},q.addLabel=function(a,b){return this._labels[a]=this._parseTimeOrLabel(b),this},q.addPause=function(a,b,d,e){var f=c.delayedCall(0,o,["{self}",b,d,e],this);return f.data="isPause",this.add(f,a)},q.removeLabel=function(a){return delete this._labels[a],this},q.getLabelTime=function(a){return null!=this._labels[a]?this._labels[a]:-1},q._parseTimeOrLabel=function(b,c,d,e){var f;if(e instanceof a&&e.timeline===this)this.remove(e);else if(e&&(e instanceof Array||e.push&&i(e)))for(f=e.length;--f>-1;)e[f]instanceof a&&e[f].timeline===this&&this.remove(e[f]);if("string"==typeof c)return this._parseTimeOrLabel(c,d&&"number"==typeof b&&null==this._labels[c]?b-this.duration():0,d);if(c=c||0,"string"!=typeof b||!isNaN(b)&&null==this._labels[b])null==b&&(b=this.duration());else{if(f=b.indexOf("="),-1===f)return null==this._labels[b]?d?this._labels[b]=this.duration()+c:c:this._labels[b]+c;c=parseInt(b.charAt(f-1)+"1",10)*Number(b.substr(f+1)),b=f>1?this._parseTimeOrLabel(b.substr(0,f-1),0,d):this.duration()}return Number(b)+c},q.seek=function(a,b){return this.totalTime("number"==typeof a?a:this._parseTimeOrLabel(a),b!==!1)},q.stop=function(){return this.paused(!0)},q.gotoAndPlay=function(a,b){return this.play(a,b)},q.gotoAndStop=function(a,b){return this.pause(a,b)},q.render=function(a,b,c){this._gc&&this._enabled(!0,!1);var d,f,g,h,i,m=this._dirty?this.totalDuration():this._totalDuration,n=this._time,o=this._startTime,p=this._timeScale,q=this._paused;if(a>=m?(this._totalTime=this._time=m,this._reversed||this._hasPausedChild()||(f=!0,h="onComplete",0===this._duration&&(0===a||this._rawPrevTime<0||this._rawPrevTime===e)&&this._rawPrevTime!==a&&this._first&&(i=!0,this._rawPrevTime>e&&(h="onReverseComplete"))),this._rawPrevTime=this._duration||!b||a||this._rawPrevTime===a?a:e,a=m+1e-4):1e-7>a?(this._totalTime=this._time=0,(0!==n||0===this._duration&&this._rawPrevTime!==e&&(this._rawPrevTime>0||0>a&&this._rawPrevTime>=0))&&(h="onReverseComplete",f=this._reversed),0>a?(this._active=!1,this._rawPrevTime>=0&&this._first&&(i=!0),this._rawPrevTime=a):(this._rawPrevTime=this._duration||!b||a||this._rawPrevTime===a?a:e,a=0,this._initted||(i=!0))):this._totalTime=this._time=this._rawPrevTime=a,this._time!==n&&this._first||c||i){if(this._initted||(this._initted=!0),this._active||!this._paused&&this._time!==n&&a>0&&(this._active=!0),0===n&&this.vars.onStart&&0!==this._time&&(b||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||l)),this._time>=n)for(d=this._first;d&&(g=d._next,!this._paused||q);)(d._active||d._startTime<=this._time&&!d._paused&&!d._gc)&&(d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)),d=g;else for(d=this._last;d&&(g=d._prev,!this._paused||q);)(d._active||d._startTime<=n&&!d._paused&&!d._gc)&&(d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)),d=g;this._onUpdate&&(b||(j.length&&k(),this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||l))),h&&(this._gc||(o===this._startTime||p!==this._timeScale)&&(0===this._time||m>=this.totalDuration())&&(f&&(j.length&&k(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[h]&&this.vars[h].apply(this.vars[h+"Scope"]||this,this.vars[h+"Params"]||l)))}},q._hasPausedChild=function(){for(var a=this._first;a;){if(a._paused||a instanceof d&&a._hasPausedChild())return!0;a=a._next}return!1},q.getChildren=function(a,b,d,e){e=e||-9999999999;for(var f=[],g=this._first,h=0;g;)g._startTime<e||(g instanceof c?b!==!1&&(f[h++]=g):(d!==!1&&(f[h++]=g),a!==!1&&(f=f.concat(g.getChildren(!0,b,d)),h=f.length))),g=g._next;return f},q.getTweensOf=function(a,b){var d,e,f=this._gc,g=[],h=0;for(f&&this._enabled(!0,!0),d=c.getTweensOf(a),e=d.length;--e>-1;)(d[e].timeline===this||b&&this._contains(d[e]))&&(g[h++]=d[e]);return f&&this._enabled(!1,!0),g},q.recent=function(){return this._recent},q._contains=function(a){for(var b=a.timeline;b;){if(b===this)return!0;b=b.timeline}return!1},q.shiftChildren=function(a,b,c){c=c||0;for(var d,e=this._first,f=this._labels;e;)e._startTime>=c&&(e._startTime+=a),e=e._next;if(b)for(d in f)f[d]>=c&&(f[d]+=a);return this._uncache(!0)},q._kill=function(a,b){if(!a&&!b)return this._enabled(!1,!1);for(var c=b?this.getTweensOf(b):this.getChildren(!0,!0,!1),d=c.length,e=!1;--d>-1;)c[d]._kill(a,b)&&(e=!0);return e},q.clear=function(a){var b=this.getChildren(!1,!0,!0),c=b.length;for(this._time=this._totalTime=0;--c>-1;)b[c]._enabled(!1,!1);return a!==!1&&(this._labels={}),this._uncache(!0)},q.invalidate=function(){for(var b=this._first;b;)b.invalidate(),b=b._next;return a.prototype.invalidate.call(this)},q._enabled=function(a,c){if(a===this._gc)for(var d=this._first;d;)d._enabled(a,!0),d=d._next;return b.prototype._enabled.call(this,a,c)},q.totalTime=function(){this._forcingPlayhead=!0;var b=a.prototype.totalTime.apply(this,arguments);return this._forcingPlayhead=!1,b},q.duration=function(a){return arguments.length?(0!==this.duration()&&0!==a&&this.timeScale(this._duration/a),this):(this._dirty&&this.totalDuration(),this._duration)},q.totalDuration=function(a){if(!arguments.length){if(this._dirty){for(var b,c,d=0,e=this._last,f=999999999999;e;)b=e._prev,e._dirty&&e.totalDuration(),e._startTime>f&&this._sortChildren&&!e._paused?this.add(e,e._startTime-e._delay):f=e._startTime,e._startTime<0&&!e._paused&&(d-=e._startTime,this._timeline.smoothChildTiming&&(this._startTime+=e._startTime/this._timeScale),this.shiftChildren(-e._startTime,!1,-9999999999),f=0),c=e._startTime+e._totalDuration/e._timeScale,c>d&&(d=c),e=b;this._duration=this._totalDuration=d,this._dirty=!1}return this._totalDuration}return 0!==this.totalDuration()&&0!==a&&this.timeScale(this._totalDuration/a),this},q.usesFrames=function(){for(var b=this._timeline;b._timeline;)b=b._timeline;return b===a._rootFramesTimeline},q.rawTime=function(){return this._paused?this._totalTime:(this._timeline.rawTime()-this._startTime)*this._timeScale},d},!0),_gsScope._gsDefine("TimelineMax",["TimelineLite","TweenLite","easing.Ease"],function(a,b,c){var d=function(b){a.call(this,b),this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._dirty=!0},e=1e-10,f=[],g=b._internals,h=g.lazyTweens,i=g.lazyRender,j=new c(null,null,1,0),k=d.prototype=new a;return k.constructor=d,k.kill()._gc=!1,d.version="1.15.1",k.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),a.prototype.invalidate.call(this)},k.addCallback=function(a,c,d,e){return this.add(b.delayedCall(0,a,d,e),c)},k.removeCallback=function(a,b){if(a)if(null==b)this._kill(null,a);else for(var c=this.getTweensOf(a,!1),d=c.length,e=this._parseTimeOrLabel(b);--d>-1;)c[d]._startTime===e&&c[d]._enabled(!1,!1);return this},k.removePause=function(b){return this.removeCallback(a._internals.pauseCallback,b)},k.tweenTo=function(a,c){c=c||{};var d,e,g,h={ease:j,useFrames:this.usesFrames(),immediateRender:!1};for(e in c)h[e]=c[e];return h.time=this._parseTimeOrLabel(a),d=Math.abs(Number(h.time)-this._time)/this._timeScale||.001,g=new b(this,d,h),h.onStart=function(){g.target.paused(!0),g.vars.time!==g.target.time()&&d===g.duration()&&g.duration(Math.abs(g.vars.time-g.target.time())/g.target._timeScale),c.onStart&&c.onStart.apply(c.onStartScope||g,c.onStartParams||f)},g},k.tweenFromTo=function(a,b,c){c=c||{},a=this._parseTimeOrLabel(a),c.startAt={onComplete:this.seek,onCompleteParams:[a],onCompleteScope:this},c.immediateRender=c.immediateRender!==!1;var d=this.tweenTo(b,c);return d.duration(Math.abs(d.vars.time-a)/this._timeScale||.001)},k.render=function(a,b,c){this._gc&&this._enabled(!0,!1);var d,g,j,k,l,m,n=this._dirty?this.totalDuration():this._totalDuration,o=this._duration,p=this._time,q=this._totalTime,r=this._startTime,s=this._timeScale,t=this._rawPrevTime,u=this._paused,v=this._cycle;if(a>=n?(this._locked||(this._totalTime=n,this._cycle=this._repeat),this._reversed||this._hasPausedChild()||(g=!0,k="onComplete",0===this._duration&&(0===a||0>t||t===e)&&t!==a&&this._first&&(l=!0,t>e&&(k="onReverseComplete"))),this._rawPrevTime=this._duration||!b||a||this._rawPrevTime===a?a:e,this._yoyo&&0!==(1&this._cycle)?this._time=a=0:(this._time=o,a=o+1e-4)):1e-7>a?(this._locked||(this._totalTime=this._cycle=0),this._time=0,(0!==p||0===o&&t!==e&&(t>0||0>a&&t>=0)&&!this._locked)&&(k="onReverseComplete",g=this._reversed),0>a?(this._active=!1,t>=0&&this._first&&(l=!0),this._rawPrevTime=a):(this._rawPrevTime=o||!b||a||this._rawPrevTime===a?a:e,a=0,this._initted||(l=!0))):(0===o&&0>t&&(l=!0),this._time=this._rawPrevTime=a,this._locked||(this._totalTime=a,0!==this._repeat&&(m=o+this._repeatDelay,this._cycle=this._totalTime/m>>0,0!==this._cycle&&this._cycle===this._totalTime/m&&this._cycle--,this._time=this._totalTime-this._cycle*m,this._yoyo&&0!==(1&this._cycle)&&(this._time=o-this._time),this._time>o?(this._time=o,a=o+1e-4):this._time<0?this._time=a=0:a=this._time))),this._cycle!==v&&!this._locked){var w=this._yoyo&&0!==(1&v),x=w===(this._yoyo&&0!==(1&this._cycle)),y=this._totalTime,z=this._cycle,A=this._rawPrevTime,B=this._time;if(this._totalTime=v*o,this._cycle<v?w=!w:this._totalTime+=o,this._time=p,this._rawPrevTime=0===o?t-1e-4:t,this._cycle=v,this._locked=!0,p=w?0:o,this.render(p,b,0===o),b||this._gc||this.vars.onRepeat&&this.vars.onRepeat.apply(this.vars.onRepeatScope||this,this.vars.onRepeatParams||f),x&&(p=w?o+1e-4:-1e-4,this.render(p,!0,!1)),this._locked=!1,this._paused&&!u)return;this._time=B,this._totalTime=y,this._cycle=z,this._rawPrevTime=A}if(!(this._time!==p&&this._first||c||l))return void(q!==this._totalTime&&this._onUpdate&&(b||this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||f)));if(this._initted||(this._initted=!0),this._active||!this._paused&&this._totalTime!==q&&a>0&&(this._active=!0),0===q&&this.vars.onStart&&0!==this._totalTime&&(b||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||f)),this._time>=p)for(d=this._first;d&&(j=d._next,!this._paused||u);)(d._active||d._startTime<=this._time&&!d._paused&&!d._gc)&&(d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)),d=j;else for(d=this._last;d&&(j=d._prev,!this._paused||u);)(d._active||d._startTime<=p&&!d._paused&&!d._gc)&&(d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)),d=j;this._onUpdate&&(b||(h.length&&i(),this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||f))),k&&(this._locked||this._gc||(r===this._startTime||s!==this._timeScale)&&(0===this._time||n>=this.totalDuration())&&(g&&(h.length&&i(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[k]&&this.vars[k].apply(this.vars[k+"Scope"]||this,this.vars[k+"Params"]||f)))},k.getActive=function(a,b,c){null==a&&(a=!0),null==b&&(b=!0),null==c&&(c=!1);var d,e,f=[],g=this.getChildren(a,b,c),h=0,i=g.length;for(d=0;i>d;d++)e=g[d],e.isActive()&&(f[h++]=e);return f},k.getLabelAfter=function(a){a||0!==a&&(a=this._time);var b,c=this.getLabelsArray(),d=c.length;for(b=0;d>b;b++)if(c[b].time>a)return c[b].name;return null},k.getLabelBefore=function(a){null==a&&(a=this._time);for(var b=this.getLabelsArray(),c=b.length;--c>-1;)if(b[c].time<a)return b[c].name;return null},k.getLabelsArray=function(){var a,b=[],c=0;for(a in this._labels)b[c++]={time:this._labels[a],name:a};return b.sort(function(a,b){return a.time-b.time}),b},k.progress=function(a,b){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!==(1&this._cycle)?1-a:a)+this._cycle*(this._duration+this._repeatDelay),b):this._time/this.duration()},k.totalProgress=function(a,b){return arguments.length?this.totalTime(this.totalDuration()*a,b):this._totalTime/this.totalDuration()},k.totalDuration=function(b){return arguments.length?-1===this._repeat?this:this.duration((b-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(a.prototype.totalDuration.call(this),this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat),this._totalDuration)},k.time=function(a,b){return arguments.length?(this._dirty&&this.totalDuration(),a>this._duration&&(a=this._duration),this._yoyo&&0!==(1&this._cycle)?a=this._duration-a+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(a+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(a,b)):this._time},k.repeat=function(a){return arguments.length?(this._repeat=a,this._uncache(!0)):this._repeat},k.repeatDelay=function(a){return arguments.length?(this._repeatDelay=a,this._uncache(!0)):this._repeatDelay},k.yoyo=function(a){return arguments.length?(this._yoyo=a,this):this._yoyo},k.currentLabel=function(a){return arguments.length?this.seek(a,!0):this.getLabelBefore(this._time+1e-8)},d},!0),function(){var a=180/Math.PI,b=[],c=[],d=[],e={},f=_gsScope._gsDefine.globals,g=function(a,b,c,d){this.a=a,this.b=b,this.c=c,this.d=d,this.da=d-a,this.ca=c-a,this.ba=b-a},h=",x,y,z,left,top,right,bottom,marginTop,marginLeft,marginRight,marginBottom,paddingLeft,paddingTop,paddingRight,paddingBottom,backgroundPosition,backgroundPosition_y,",i=function(a,b,c,d){var e={a:a},f={},g={},h={c:d},i=(a+b)/2,j=(b+c)/2,k=(c+d)/2,l=(i+j)/2,m=(j+k)/2,n=(m-l)/8;return e.b=i+(a-i)/4,f.b=l+n,e.c=f.a=(e.b+f.b)/2,f.c=g.a=(l+m)/2,g.b=m-n,h.b=k+(d-k)/4,g.c=h.a=(g.b+h.b)/2,[e,f,g,h]},j=function(a,e,f,g,h){var j,k,l,m,n,o,p,q,r,s,t,u,v,w=a.length-1,x=0,y=a[0].a;for(j=0;w>j;j++)n=a[x],k=n.a,l=n.d,m=a[x+1].d,h?(t=b[j],u=c[j],v=(u+t)*e*.25/(g?.5:d[j]||.5),o=l-(l-k)*(g?.5*e:0!==t?v/t:0),p=l+(m-l)*(g?.5*e:0!==u?v/u:0),q=l-(o+((p-o)*(3*t/(t+u)+.5)/4||0))):(o=l-(l-k)*e*.5,p=l+(m-l)*e*.5,q=l-(o+p)/2),o+=q,p+=q,n.c=r=o,n.b=0!==j?y:y=n.a+.6*(n.c-n.a),n.da=l-k,n.ca=r-k,n.ba=y-k,f?(s=i(k,y,r,l),a.splice(x,1,s[0],s[1],s[2],s[3]),x+=4):x++,y=p;n=a[x],n.b=y,n.c=y+.4*(n.d-y),n.da=n.d-n.a,n.ca=n.c-n.a,n.ba=y-n.a,f&&(s=i(n.a,y,n.c,n.d),a.splice(x,1,s[0],s[1],s[2],s[3]))},k=function(a,d,e,f){var h,i,j,k,l,m,n=[];if(f)for(a=[f].concat(a),i=a.length;--i>-1;)"string"==typeof(m=a[i][d])&&"="===m.charAt(1)&&(a[i][d]=f[d]+Number(m.charAt(0)+m.substr(2)));if(h=a.length-2,0>h)return n[0]=new g(a[0][d],0,0,a[-1>h?0:1][d]),n;for(i=0;h>i;i++)j=a[i][d],k=a[i+1][d],n[i]=new g(j,0,0,k),e&&(l=a[i+2][d],b[i]=(b[i]||0)+(k-j)*(k-j),c[i]=(c[i]||0)+(l-k)*(l-k));return n[i]=new g(a[i][d],0,0,a[i+1][d]),n},l=function(a,f,g,i,l,m){var n,o,p,q,r,s,t,u,v={},w=[],x=m||a[0];l="string"==typeof l?","+l+",":h,null==f&&(f=1);for(o in a[0])w.push(o);if(a.length>1){for(u=a[a.length-1],t=!0,n=w.length;--n>-1;)if(o=w[n],Math.abs(x[o]-u[o])>.05){t=!1;
break}t&&(a=a.concat(),m&&a.unshift(m),a.push(a[1]),m=a[a.length-3])}for(b.length=c.length=d.length=0,n=w.length;--n>-1;)o=w[n],e[o]=-1!==l.indexOf(","+o+","),v[o]=k(a,o,e[o],m);for(n=b.length;--n>-1;)b[n]=Math.sqrt(b[n]),c[n]=Math.sqrt(c[n]);if(!i){for(n=w.length;--n>-1;)if(e[o])for(p=v[w[n]],s=p.length-1,q=0;s>q;q++)r=p[q+1].da/c[q]+p[q].da/b[q],d[q]=(d[q]||0)+r*r;for(n=d.length;--n>-1;)d[n]=Math.sqrt(d[n])}for(n=w.length,q=g?4:1;--n>-1;)o=w[n],p=v[o],j(p,f,g,i,e[o]),t&&(p.splice(0,q),p.splice(p.length-q,q));return v},m=function(a,b,c){b=b||"soft";var d,e,f,h,i,j,k,l,m,n,o,p={},q="cubic"===b?3:2,r="soft"===b,s=[];if(r&&c&&(a=[c].concat(a)),null==a||a.length<q+1)throw"invalid Bezier data";for(m in a[0])s.push(m);for(j=s.length;--j>-1;){for(m=s[j],p[m]=i=[],n=0,l=a.length,k=0;l>k;k++)d=null==c?a[k][m]:"string"==typeof(o=a[k][m])&&"="===o.charAt(1)?c[m]+Number(o.charAt(0)+o.substr(2)):Number(o),r&&k>1&&l-1>k&&(i[n++]=(d+i[n-2])/2),i[n++]=d;for(l=n-q+1,n=0,k=0;l>k;k+=q)d=i[k],e=i[k+1],f=i[k+2],h=2===q?0:i[k+3],i[n++]=o=3===q?new g(d,e,f,h):new g(d,(2*e+d)/3,(2*e+f)/3,f);i.length=n}return p},n=function(a,b,c){for(var d,e,f,g,h,i,j,k,l,m,n,o=1/c,p=a.length;--p>-1;)for(m=a[p],f=m.a,g=m.d-f,h=m.c-f,i=m.b-f,d=e=0,k=1;c>=k;k++)j=o*k,l=1-j,d=e-(e=(j*j*g+3*l*(j*h+l*i))*j),n=p*c+k-1,b[n]=(b[n]||0)+d*d},o=function(a,b){b=b>>0||6;var c,d,e,f,g=[],h=[],i=0,j=0,k=b-1,l=[],m=[];for(c in a)n(a[c],g,b);for(e=g.length,d=0;e>d;d++)i+=Math.sqrt(g[d]),f=d%b,m[f]=i,f===k&&(j+=i,f=d/b>>0,l[f]=m,h[f]=j,i=0,m=[]);return{length:j,lengths:h,segments:l}},p=_gsScope._gsDefine.plugin({propName:"bezier",priority:-1,version:"1.3.4",API:2,global:!0,init:function(a,b,c){this._target=a,b instanceof Array&&(b={values:b}),this._func={},this._round={},this._props=[],this._timeRes=null==b.timeResolution?6:parseInt(b.timeResolution,10);var d,e,f,g,h,i=b.values||[],j={},k=i[0],n=b.autoRotate||c.vars.orientToBezier;this._autoRotate=n?n instanceof Array?n:[["x","y","rotation",n===!0?0:Number(n)||0]]:null;for(d in k)this._props.push(d);for(f=this._props.length;--f>-1;)d=this._props[f],this._overwriteProps.push(d),e=this._func[d]="function"==typeof a[d],j[d]=e?a[d.indexOf("set")||"function"!=typeof a["get"+d.substr(3)]?d:"get"+d.substr(3)]():parseFloat(a[d]),h||j[d]!==i[0][d]&&(h=j);if(this._beziers="cubic"!==b.type&&"quadratic"!==b.type&&"soft"!==b.type?l(i,isNaN(b.curviness)?1:b.curviness,!1,"thruBasic"===b.type,b.correlate,h):m(i,b.type,j),this._segCount=this._beziers[d].length,this._timeRes){var p=o(this._beziers,this._timeRes);this._length=p.length,this._lengths=p.lengths,this._segments=p.segments,this._l1=this._li=this._s1=this._si=0,this._l2=this._lengths[0],this._curSeg=this._segments[0],this._s2=this._curSeg[0],this._prec=1/this._curSeg.length}if(n=this._autoRotate)for(this._initialRotations=[],n[0]instanceof Array||(this._autoRotate=n=[n]),f=n.length;--f>-1;){for(g=0;3>g;g++)d=n[f][g],this._func[d]="function"==typeof a[d]?a[d.indexOf("set")||"function"!=typeof a["get"+d.substr(3)]?d:"get"+d.substr(3)]:!1;d=n[f][2],this._initialRotations[f]=this._func[d]?this._func[d].call(this._target):this._target[d]}return this._startRatio=c.vars.runBackwards?1:0,!0},set:function(b){var c,d,e,f,g,h,i,j,k,l,m=this._segCount,n=this._func,o=this._target,p=b!==this._startRatio;if(this._timeRes){if(k=this._lengths,l=this._curSeg,b*=this._length,e=this._li,b>this._l2&&m-1>e){for(j=m-1;j>e&&(this._l2=k[++e])<=b;);this._l1=k[e-1],this._li=e,this._curSeg=l=this._segments[e],this._s2=l[this._s1=this._si=0]}else if(b<this._l1&&e>0){for(;e>0&&(this._l1=k[--e])>=b;);0===e&&b<this._l1?this._l1=0:e++,this._l2=k[e],this._li=e,this._curSeg=l=this._segments[e],this._s1=l[(this._si=l.length-1)-1]||0,this._s2=l[this._si]}if(c=e,b-=this._l1,e=this._si,b>this._s2&&e<l.length-1){for(j=l.length-1;j>e&&(this._s2=l[++e])<=b;);this._s1=l[e-1],this._si=e}else if(b<this._s1&&e>0){for(;e>0&&(this._s1=l[--e])>=b;);0===e&&b<this._s1?this._s1=0:e++,this._s2=l[e],this._si=e}h=(e+(b-this._s1)/(this._s2-this._s1))*this._prec}else c=0>b?0:b>=1?m-1:m*b>>0,h=(b-c*(1/m))*m;for(d=1-h,e=this._props.length;--e>-1;)f=this._props[e],g=this._beziers[f][c],i=(h*h*g.da+3*d*(h*g.ca+d*g.ba))*h+g.a,this._round[f]&&(i=Math.round(i)),n[f]?o[f](i):o[f]=i;if(this._autoRotate){var q,r,s,t,u,v,w,x=this._autoRotate;for(e=x.length;--e>-1;)f=x[e][2],v=x[e][3]||0,w=x[e][4]===!0?1:a,g=this._beziers[x[e][0]],q=this._beziers[x[e][1]],g&&q&&(g=g[c],q=q[c],r=g.a+(g.b-g.a)*h,t=g.b+(g.c-g.b)*h,r+=(t-r)*h,t+=(g.c+(g.d-g.c)*h-t)*h,s=q.a+(q.b-q.a)*h,u=q.b+(q.c-q.b)*h,s+=(u-s)*h,u+=(q.c+(q.d-q.c)*h-u)*h,i=p?Math.atan2(u-s,t-r)*w+v:this._initialRotations[e],n[f]?o[f](i):o[f]=i)}}}),q=p.prototype;p.bezierThrough=l,p.cubicToQuadratic=i,p._autoCSS=!0,p.quadraticToCubic=function(a,b,c){return new g(a,(2*b+a)/3,(2*b+c)/3,c)},p._cssRegister=function(){var a=f.CSSPlugin;if(a){var b=a._internals,c=b._parseToProxy,d=b._setPluginRatio,e=b.CSSPropTween;b._registerComplexSpecialProp("bezier",{parser:function(a,b,f,g,h,i){b instanceof Array&&(b={values:b}),i=new p;var j,k,l,m=b.values,n=m.length-1,o=[],q={};if(0>n)return h;for(j=0;n>=j;j++)l=c(a,m[j],g,h,i,n!==j),o[j]=l.end;for(k in b)q[k]=b[k];return q.values=o,h=new e(a,"bezier",0,0,l.pt,2),h.data=l,h.plugin=i,h.setRatio=d,0===q.autoRotate&&(q.autoRotate=!0),!q.autoRotate||q.autoRotate instanceof Array||(j=q.autoRotate===!0?0:Number(q.autoRotate),q.autoRotate=null!=l.end.left?[["left","top","rotation",j,!1]]:null!=l.end.x?[["x","y","rotation",j,!1]]:!1),q.autoRotate&&(g._transform||g._enableTransforms(!1),l.autoRotate=g._target._gsTransform),i._onInitTween(l.proxy,q,g._tween),h}})}},q._roundProps=function(a,b){for(var c=this._overwriteProps,d=c.length;--d>-1;)(a[c[d]]||a.bezier||a.bezierThrough)&&(this._round[c[d]]=b)},q._kill=function(a){var b,c,d=this._props;for(b in this._beziers)if(b in a)for(delete this._beziers[b],delete this._func[b],c=d.length;--c>-1;)d[c]===b&&d.splice(c,1);return this._super._kill.call(this,a)}}(),_gsScope._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(a,b){var c,d,e,f,g=function(){a.call(this,"css"),this._overwriteProps.length=0,this.setRatio=g.prototype.setRatio},h=_gsScope._gsDefine.globals,i={},j=g.prototype=new a("css");j.constructor=g,g.version="1.15.1",g.API=2,g.defaultTransformPerspective=0,g.defaultSkewType="compensated",j="px",g.suffixMap={top:j,right:j,bottom:j,left:j,width:j,height:j,fontSize:j,padding:j,margin:j,perspective:j,lineHeight:""};var k,l,m,n,o,p,q=/(?:\d|\-\d|\.\d|\-\.\d)+/g,r=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,s=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,t=/(?![+-]?\d*\.?\d+|[+-]|e[+-]\d+)[^0-9]/g,u=/(?:\d|\-|\+|=|#|\.)*/g,v=/opacity *= *([^)]*)/i,w=/opacity:([^;]*)/i,x=/alpha\(opacity *=.+?\)/i,y=/^(rgb|hsl)/,z=/([A-Z])/g,A=/-([a-z])/gi,B=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,C=function(a,b){return b.toUpperCase()},D=/(?:Left|Right|Width)/i,E=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,F=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,G=/,(?=[^\)]*(?:\(|$))/gi,H=Math.PI/180,I=180/Math.PI,J={},K=document,L=function(a){return K.createElementNS?K.createElementNS("http://www.w3.org/1999/xhtml",a):K.createElement(a)},M=L("div"),N=L("img"),O=g._internals={_specialProps:i},P=navigator.userAgent,Q=function(){var a=P.indexOf("Android"),b=L("a");return m=-1!==P.indexOf("Safari")&&-1===P.indexOf("Chrome")&&(-1===a||Number(P.substr(a+8,1))>3),o=m&&Number(P.substr(P.indexOf("Version/")+8,1))<6,n=-1!==P.indexOf("Firefox"),(/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(P)||/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(P))&&(p=parseFloat(RegExp.$1)),b?(b.style.cssText="top:1px;opacity:.55;",/^0.55/.test(b.style.opacity)):!1}(),R=function(a){return v.test("string"==typeof a?a:(a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100:1},S=function(a){window.console&&console.log(a)},T="",U="",V=function(a,b){b=b||M;var c,d,e=b.style;if(void 0!==e[a])return a;for(a=a.charAt(0).toUpperCase()+a.substr(1),c=["O","Moz","ms","Ms","Webkit"],d=5;--d>-1&&void 0===e[c[d]+a];);return d>=0?(U=3===d?"ms":c[d],T="-"+U.toLowerCase()+"-",U+a):null},W=K.defaultView?K.defaultView.getComputedStyle:function(){},X=g.getStyle=function(a,b,c,d,e){var f;return Q||"opacity"!==b?(!d&&a.style[b]?f=a.style[b]:(c=c||W(a))?f=c[b]||c.getPropertyValue(b)||c.getPropertyValue(b.replace(z,"-$1").toLowerCase()):a.currentStyle&&(f=a.currentStyle[b]),null==e||f&&"none"!==f&&"auto"!==f&&"auto auto"!==f?f:e):R(a)},Y=O.convertToPixels=function(a,c,d,e,f){if("px"===e||!e)return d;if("auto"===e||!d)return 0;var h,i,j,k=D.test(c),l=a,m=M.style,n=0>d;if(n&&(d=-d),"%"===e&&-1!==c.indexOf("border"))h=d/100*(k?a.clientWidth:a.clientHeight);else{if(m.cssText="border:0 solid red;position:"+X(a,"position")+";line-height:0;","%"!==e&&l.appendChild)m[k?"borderLeftWidth":"borderTopWidth"]=d+e;else{if(l=a.parentNode||K.body,i=l._gsCache,j=b.ticker.frame,i&&k&&i.time===j)return i.width*d/100;m[k?"width":"height"]=d+e}l.appendChild(M),h=parseFloat(M[k?"offsetWidth":"offsetHeight"]),l.removeChild(M),k&&"%"===e&&g.cacheWidths!==!1&&(i=l._gsCache=l._gsCache||{},i.time=j,i.width=h/d*100),0!==h||f||(h=Y(a,c,d,e,!0))}return n?-h:h},Z=O.calculateOffset=function(a,b,c){if("absolute"!==X(a,"position",c))return 0;var d="left"===b?"Left":"Top",e=X(a,"margin"+d,c);return a["offset"+d]-(Y(a,b,parseFloat(e),e.replace(u,""))||0)},$=function(a,b){var c,d,e={};if(b=b||W(a,null))for(c in b)(-1===c.indexOf("Transform")||wb===c)&&(e[c]=b[c]);else if(b=a.currentStyle||a.style)for(c in b)"string"==typeof c&&void 0===e[c]&&(e[c.replace(A,C)]=b[c]);return Q||(e.opacity=R(a)),d=Gb(a,b,!1),e.rotation=d.rotation,e.skewX=d.skewX,e.scaleX=d.scaleX,e.scaleY=d.scaleY,e.x=d.x,e.y=d.y,zb&&(e.z=d.z,e.rotationX=d.rotationX,e.rotationY=d.rotationY,e.scaleZ=d.scaleZ),e.filters&&delete e.filters,e},_=function(a,b,c,d,e){var f,g,h,i={},j=a.style;for(g in c)"cssText"!==g&&"length"!==g&&isNaN(g)&&(b[g]!==(f=c[g])||e&&e[g])&&-1===g.indexOf("Origin")&&("number"==typeof f||"string"==typeof f)&&(i[g]="auto"!==f||"left"!==g&&"top"!==g?""!==f&&"auto"!==f&&"none"!==f||"string"!=typeof b[g]||""===b[g].replace(t,"")?f:0:Z(a,g),void 0!==j[g]&&(h=new nb(j,g,j[g],h)));if(d)for(g in d)"className"!==g&&(i[g]=d[g]);return{difs:i,firstMPT:h}},ab={width:["Left","Right"],height:["Top","Bottom"]},bb=["marginLeft","marginRight","marginTop","marginBottom"],cb=function(a,b,c){var d=parseFloat("width"===b?a.offsetWidth:a.offsetHeight),e=ab[b],f=e.length;for(c=c||W(a,null);--f>-1;)d-=parseFloat(X(a,"padding"+e[f],c,!0))||0,d-=parseFloat(X(a,"border"+e[f]+"Width",c,!0))||0;return d},db=function(a,b){(null==a||""===a||"auto"===a||"auto auto"===a)&&(a="0 0");var c=a.split(" "),d=-1!==a.indexOf("left")?"0%":-1!==a.indexOf("right")?"100%":c[0],e=-1!==a.indexOf("top")?"0%":-1!==a.indexOf("bottom")?"100%":c[1];return null==e?e="center"===d?"50%":"0":"center"===e&&(e="50%"),("center"===d||isNaN(parseFloat(d))&&-1===(d+"").indexOf("="))&&(d="50%"),b&&(b.oxp=-1!==d.indexOf("%"),b.oyp=-1!==e.indexOf("%"),b.oxr="="===d.charAt(1),b.oyr="="===e.charAt(1),b.ox=parseFloat(d.replace(t,"")),b.oy=parseFloat(e.replace(t,""))),d+" "+e+(c.length>2?" "+c[2]:"")},eb=function(a,b){return"string"==typeof a&&"="===a.charAt(1)?parseInt(a.charAt(0)+"1",10)*parseFloat(a.substr(2)):parseFloat(a)-parseFloat(b)},fb=function(a,b){return null==a?b:"string"==typeof a&&"="===a.charAt(1)?parseInt(a.charAt(0)+"1",10)*parseFloat(a.substr(2))+b:parseFloat(a)},gb=function(a,b,c,d){var e,f,g,h,i,j=1e-6;return null==a?h=b:"number"==typeof a?h=a:(e=360,f=a.split("_"),i="="===a.charAt(1),g=(i?parseInt(a.charAt(0)+"1",10)*parseFloat(f[0].substr(2)):parseFloat(f[0]))*(-1===a.indexOf("rad")?1:I)-(i?0:b),f.length&&(d&&(d[c]=b+g),-1!==a.indexOf("short")&&(g%=e,g!==g%(e/2)&&(g=0>g?g+e:g-e)),-1!==a.indexOf("_cw")&&0>g?g=(g+9999999999*e)%e-(g/e|0)*e:-1!==a.indexOf("ccw")&&g>0&&(g=(g-9999999999*e)%e-(g/e|0)*e)),h=b+g),j>h&&h>-j&&(h=0),h},hb={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},ib=function(a,b,c){return a=0>a?a+1:a>1?a-1:a,255*(1>6*a?b+(c-b)*a*6:.5>a?c:2>3*a?b+(c-b)*(2/3-a)*6:b)+.5|0},jb=g.parseColor=function(a){var b,c,d,e,f,g;return a&&""!==a?"number"==typeof a?[a>>16,a>>8&255,255&a]:(","===a.charAt(a.length-1)&&(a=a.substr(0,a.length-1)),hb[a]?hb[a]:"#"===a.charAt(0)?(4===a.length&&(b=a.charAt(1),c=a.charAt(2),d=a.charAt(3),a="#"+b+b+c+c+d+d),a=parseInt(a.substr(1),16),[a>>16,a>>8&255,255&a]):"hsl"===a.substr(0,3)?(a=a.match(q),e=Number(a[0])%360/360,f=Number(a[1])/100,g=Number(a[2])/100,c=.5>=g?g*(f+1):g+f-g*f,b=2*g-c,a.length>3&&(a[3]=Number(a[3])),a[0]=ib(e+1/3,b,c),a[1]=ib(e,b,c),a[2]=ib(e-1/3,b,c),a):(a=a.match(q)||hb.transparent,a[0]=Number(a[0]),a[1]=Number(a[1]),a[2]=Number(a[2]),a.length>3&&(a[3]=Number(a[3])),a)):hb.black},kb="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#.+?\\b";for(j in hb)kb+="|"+j+"\\b";kb=new RegExp(kb+")","gi");var lb=function(a,b,c,d){if(null==a)return function(a){return a};var e,f=b?(a.match(kb)||[""])[0]:"",g=a.split(f).join("").match(s)||[],h=a.substr(0,a.indexOf(g[0])),i=")"===a.charAt(a.length-1)?")":"",j=-1!==a.indexOf(" ")?" ":",",k=g.length,l=k>0?g[0].replace(q,""):"";return k?e=b?function(a){var b,m,n,o;if("number"==typeof a)a+=l;else if(d&&G.test(a)){for(o=a.replace(G,"|").split("|"),n=0;n<o.length;n++)o[n]=e(o[n]);return o.join(",")}if(b=(a.match(kb)||[f])[0],m=a.split(b).join("").match(s)||[],n=m.length,k>n--)for(;++n<k;)m[n]=c?m[(n-1)/2|0]:g[n];return h+m.join(j)+j+b+i+(-1!==a.indexOf("inset")?" inset":"")}:function(a){var b,f,m;if("number"==typeof a)a+=l;else if(d&&G.test(a)){for(f=a.replace(G,"|").split("|"),m=0;m<f.length;m++)f[m]=e(f[m]);return f.join(",")}if(b=a.match(s)||[],m=b.length,k>m--)for(;++m<k;)b[m]=c?b[(m-1)/2|0]:g[m];return h+b.join(j)+i}:function(a){return a}},mb=function(a){return a=a.split(","),function(b,c,d,e,f,g,h){var i,j=(c+"").split(" ");for(h={},i=0;4>i;i++)h[a[i]]=j[i]=j[i]||j[(i-1)/2>>0];return e.parse(b,h,f,g)}},nb=(O._setPluginRatio=function(a){this.plugin.setRatio(a);for(var b,c,d,e,f=this.data,g=f.proxy,h=f.firstMPT,i=1e-6;h;)b=g[h.v],h.r?b=Math.round(b):i>b&&b>-i&&(b=0),h.t[h.p]=b,h=h._next;if(f.autoRotate&&(f.autoRotate.rotation=g.rotation),1===a)for(h=f.firstMPT;h;){if(c=h.t,c.type){if(1===c.type){for(e=c.xs0+c.s+c.xs1,d=1;d<c.l;d++)e+=c["xn"+d]+c["xs"+(d+1)];c.e=e}}else c.e=c.s+c.xs0;h=h._next}},function(a,b,c,d,e){this.t=a,this.p=b,this.v=c,this.r=e,d&&(d._prev=this,this._next=d)}),ob=(O._parseToProxy=function(a,b,c,d,e,f){var g,h,i,j,k,l=d,m={},n={},o=c._transform,p=J;for(c._transform=null,J=b,d=k=c.parse(a,b,d,e),J=p,f&&(c._transform=o,l&&(l._prev=null,l._prev&&(l._prev._next=null)));d&&d!==l;){if(d.type<=1&&(h=d.p,n[h]=d.s+d.c,m[h]=d.s,f||(j=new nb(d,"s",h,j,d.r),d.c=0),1===d.type))for(g=d.l;--g>0;)i="xn"+g,h=d.p+"_"+i,n[h]=d.data[i],m[h]=d[i],f||(j=new nb(d,i,h,j,d.rxp[i]));d=d._next}return{proxy:m,end:n,firstMPT:j,pt:k}},O.CSSPropTween=function(a,b,d,e,g,h,i,j,k,l,m){this.t=a,this.p=b,this.s=d,this.c=e,this.n=i||b,a instanceof ob||f.push(this.n),this.r=j,this.type=h||0,k&&(this.pr=k,c=!0),this.b=void 0===l?d:l,this.e=void 0===m?d+e:m,g&&(this._next=g,g._prev=this)}),pb=g.parseComplex=function(a,b,c,d,e,f,g,h,i,j){c=c||f||"",g=new ob(a,b,0,0,g,j?2:1,null,!1,h,c,d),d+="";var l,m,n,o,p,s,t,u,v,w,x,z,A=c.split(", ").join(",").split(" "),B=d.split(", ").join(",").split(" "),C=A.length,D=k!==!1;for((-1!==d.indexOf(",")||-1!==c.indexOf(","))&&(A=A.join(" ").replace(G,", ").split(" "),B=B.join(" ").replace(G,", ").split(" "),C=A.length),C!==B.length&&(A=(f||"").split(" "),C=A.length),g.plugin=i,g.setRatio=j,l=0;C>l;l++)if(o=A[l],p=B[l],u=parseFloat(o),u||0===u)g.appendXtra("",u,eb(p,u),p.replace(r,""),D&&-1!==p.indexOf("px"),!0);else if(e&&("#"===o.charAt(0)||hb[o]||y.test(o)))z=","===p.charAt(p.length-1)?"),":")",o=jb(o),p=jb(p),v=o.length+p.length>6,v&&!Q&&0===p[3]?(g["xs"+g.l]+=g.l?" transparent":"transparent",g.e=g.e.split(B[l]).join("transparent")):(Q||(v=!1),g.appendXtra(v?"rgba(":"rgb(",o[0],p[0]-o[0],",",!0,!0).appendXtra("",o[1],p[1]-o[1],",",!0).appendXtra("",o[2],p[2]-o[2],v?",":z,!0),v&&(o=o.length<4?1:o[3],g.appendXtra("",o,(p.length<4?1:p[3])-o,z,!1)));else if(s=o.match(q)){if(t=p.match(r),!t||t.length!==s.length)return g;for(n=0,m=0;m<s.length;m++)x=s[m],w=o.indexOf(x,n),g.appendXtra(o.substr(n,w-n),Number(x),eb(t[m],x),"",D&&"px"===o.substr(w+x.length,2),0===m),n=w+x.length;g["xs"+g.l]+=o.substr(n)}else g["xs"+g.l]+=g.l?" "+o:o;if(-1!==d.indexOf("=")&&g.data){for(z=g.xs0+g.data.s,l=1;l<g.l;l++)z+=g["xs"+l]+g.data["xn"+l];g.e=z+g["xs"+l]}return g.l||(g.type=-1,g.xs0=g.e),g.xfirst||g},qb=9;for(j=ob.prototype,j.l=j.pr=0;--qb>0;)j["xn"+qb]=0,j["xs"+qb]="";j.xs0="",j._next=j._prev=j.xfirst=j.data=j.plugin=j.setRatio=j.rxp=null,j.appendXtra=function(a,b,c,d,e,f){var g=this,h=g.l;return g["xs"+h]+=f&&h?" "+a:a||"",c||0===h||g.plugin?(g.l++,g.type=g.setRatio?2:1,g["xs"+g.l]=d||"",h>0?(g.data["xn"+h]=b+c,g.rxp["xn"+h]=e,g["xn"+h]=b,g.plugin||(g.xfirst=new ob(g,"xn"+h,b,c,g.xfirst||g,0,g.n,e,g.pr),g.xfirst.xs0=0),g):(g.data={s:b+c},g.rxp={},g.s=b,g.c=c,g.r=e,g)):(g["xs"+h]+=b+(d||""),g)};var rb=function(a,b){b=b||{},this.p=b.prefix?V(a)||a:a,i[a]=i[this.p]=this,this.format=b.formatter||lb(b.defaultValue,b.color,b.collapsible,b.multi),b.parser&&(this.parse=b.parser),this.clrs=b.color,this.multi=b.multi,this.keyword=b.keyword,this.dflt=b.defaultValue,this.pr=b.priority||0},sb=O._registerComplexSpecialProp=function(a,b,c){"object"!=typeof b&&(b={parser:c});var d,e,f=a.split(","),g=b.defaultValue;for(c=c||[g],d=0;d<f.length;d++)b.prefix=0===d&&b.prefix,b.defaultValue=c[d]||g,e=new rb(f[d],b)},tb=function(a){if(!i[a]){var b=a.charAt(0).toUpperCase()+a.substr(1)+"Plugin";sb(a,{parser:function(a,c,d,e,f,g,j){var k=h.com.greensock.plugins[b];return k?(k._cssRegister(),i[d].parse(a,c,d,e,f,g,j)):(S("Error: "+b+" js file not loaded."),f)}})}};j=rb.prototype,j.parseComplex=function(a,b,c,d,e,f){var g,h,i,j,k,l,m=this.keyword;if(this.multi&&(G.test(c)||G.test(b)?(h=b.replace(G,"|").split("|"),i=c.replace(G,"|").split("|")):m&&(h=[b],i=[c])),i){for(j=i.length>h.length?i.length:h.length,g=0;j>g;g++)b=h[g]=h[g]||this.dflt,c=i[g]=i[g]||this.dflt,m&&(k=b.indexOf(m),l=c.indexOf(m),k!==l&&(c=-1===l?i:h,c[g]+=" "+m));b=h.join(", "),c=i.join(", ")}return pb(a,this.p,b,c,this.clrs,this.dflt,d,this.pr,e,f)},j.parse=function(a,b,c,d,f,g){return this.parseComplex(a.style,this.format(X(a,this.p,e,!1,this.dflt)),this.format(b),f,g)},g.registerSpecialProp=function(a,b,c){sb(a,{parser:function(a,d,e,f,g,h){var i=new ob(a,e,0,0,g,2,e,!1,c);return i.plugin=h,i.setRatio=b(a,d,f._tween,e),i},priority:c})};var ub,vb="scaleX,scaleY,scaleZ,x,y,z,skewX,skewY,rotation,rotationX,rotationY,perspective,xPercent,yPercent".split(","),wb=V("transform"),xb=T+"transform",yb=V("transformOrigin"),zb=null!==V("perspective"),Ab=O.Transform=function(){this.perspective=parseFloat(g.defaultTransformPerspective)||0,this.force3D=g.defaultForce3D!==!1&&zb?g.defaultForce3D||"auto":!1},Bb=window.SVGElement,Cb=function(a,b,c){var d,e=K.createElementNS("http://www.w3.org/2000/svg",a),f=/([a-z])([A-Z])/g;for(d in c)e.setAttributeNS(null,d.replace(f,"$1-$2").toLowerCase(),c[d]);return b.appendChild(e),e},Db=document.documentElement,Eb=function(){var a,b,c,d=p||/Android/i.test(P)&&!window.chrome;return K.createElementNS&&!d&&(a=Cb("svg",Db),b=Cb("rect",a,{width:100,height:50,x:100}),c=b.getBoundingClientRect().width,b.style[yb]="50% 50%",b.style[wb]="scaleX(0.5)",d=c===b.getBoundingClientRect().width&&!(n&&zb),Db.removeChild(a)),d}(),Fb=function(a,b,c){var d=a.getBBox();b=db(b).split(" "),c.xOrigin=(-1!==b[0].indexOf("%")?parseFloat(b[0])/100*d.width:parseFloat(b[0]))+d.x,c.yOrigin=(-1!==b[1].indexOf("%")?parseFloat(b[1])/100*d.height:parseFloat(b[1]))+d.y},Gb=O.getTransform=function(a,b,c,d){if(a._gsTransform&&c&&!d)return a._gsTransform;var f,h,i,j,k,l,m,n,o,p,q=c?a._gsTransform||new Ab:new Ab,r=q.scaleX<0,s=2e-5,t=1e5,u=zb?parseFloat(X(a,yb,b,!1,"0 0 0").split(" ")[2])||q.zOrigin||0:0,v=parseFloat(g.defaultTransformPerspective)||0;if(wb?h=X(a,xb,b,!0):a.currentStyle&&(h=a.currentStyle.filter.match(E),h=h&&4===h.length?[h[0].substr(4),Number(h[2].substr(4)),Number(h[1].substr(4)),h[3].substr(4),q.x||0,q.y||0].join(","):""),f=!h||"none"===h||"matrix(1, 0, 0, 1, 0, 0)"===h,q.svg=!!(Bb&&"function"==typeof a.getBBox&&a.getCTM&&(!a.parentNode||a.parentNode.getBBox&&a.parentNode.getCTM)),q.svg&&(Fb(a,X(a,yb,e,!1,"50% 50%")+"",q),ub=g.useSVGTransformAttr||Eb,i=a.getAttribute("transform"),f&&i&&-1!==i.indexOf("matrix")&&(h=i,f=0)),!f){for(i=(h||"").match(/(?:\-|\b)[\d\-\.e]+\b/gi)||[],j=i.length;--j>-1;)k=Number(i[j]),i[j]=(l=k-(k|=0))?(l*t+(0>l?-.5:.5)|0)/t+k:k;if(16===i.length){var w,x,y,z,A,B=i[0],C=i[1],D=i[2],F=i[3],G=i[4],H=i[5],J=i[6],K=i[7],L=i[8],M=i[9],N=i[10],O=i[12],P=i[13],Q=i[14],R=i[11],S=Math.atan2(J,N);q.zOrigin&&(Q=-q.zOrigin,O=L*Q-i[12],P=M*Q-i[13],Q=N*Q+q.zOrigin-i[14]),q.rotationX=S*I,S&&(z=Math.cos(-S),A=Math.sin(-S),w=G*z+L*A,x=H*z+M*A,y=J*z+N*A,L=G*-A+L*z,M=H*-A+M*z,N=J*-A+N*z,R=K*-A+R*z,G=w,H=x,J=y),S=Math.atan2(L,N),q.rotationY=S*I,S&&(z=Math.cos(-S),A=Math.sin(-S),w=B*z-L*A,x=C*z-M*A,y=D*z-N*A,M=C*A+M*z,N=D*A+N*z,R=F*A+R*z,B=w,C=x,D=y),S=Math.atan2(C,B),q.rotation=S*I,S&&(z=Math.cos(-S),A=Math.sin(-S),B=B*z+G*A,x=C*z+H*A,H=C*-A+H*z,J=D*-A+J*z,C=x),q.rotationX&&Math.abs(q.rotationX)+Math.abs(q.rotation)>359.9&&(q.rotationX=q.rotation=0,q.rotationY+=180),q.scaleX=(Math.sqrt(B*B+C*C)*t+.5|0)/t,q.scaleY=(Math.sqrt(H*H+M*M)*t+.5|0)/t,q.scaleZ=(Math.sqrt(J*J+N*N)*t+.5|0)/t,q.skewX=0,q.perspective=R?1/(0>R?-R:R):0,q.x=O,q.y=P,q.z=Q}else if(!(zb&&!d&&i.length&&q.x===i[4]&&q.y===i[5]&&(q.rotationX||q.rotationY)||void 0!==q.x&&"none"===X(a,"display",b))){var T=i.length>=6,U=T?i[0]:1,V=i[1]||0,W=i[2]||0,Y=T?i[3]:1;q.x=i[4]||0,q.y=i[5]||0,m=Math.sqrt(U*U+V*V),n=Math.sqrt(Y*Y+W*W),o=U||V?Math.atan2(V,U)*I:q.rotation||0,p=W||Y?Math.atan2(W,Y)*I+o:q.skewX||0,Math.abs(p)>90&&Math.abs(p)<270&&(r?(m*=-1,p+=0>=o?180:-180,o+=0>=o?180:-180):(n*=-1,p+=0>=p?180:-180)),q.scaleX=m,q.scaleY=n,q.rotation=o,q.skewX=p,zb&&(q.rotationX=q.rotationY=q.z=0,q.perspective=v,q.scaleZ=1)}q.zOrigin=u;for(j in q)q[j]<s&&q[j]>-s&&(q[j]=0)}return c&&(a._gsTransform=q),q},Hb=function(a){var b,c,d=this.data,e=-d.rotation*H,f=e+d.skewX*H,g=1e5,h=(Math.cos(e)*d.scaleX*g|0)/g,i=(Math.sin(e)*d.scaleX*g|0)/g,j=(Math.sin(f)*-d.scaleY*g|0)/g,k=(Math.cos(f)*d.scaleY*g|0)/g,l=this.t.style,m=this.t.currentStyle;if(m){c=i,i=-j,j=-c,b=m.filter,l.filter="";var n,o,q=this.t.offsetWidth,r=this.t.offsetHeight,s="absolute"!==m.position,t="progid:DXImageTransform.Microsoft.Matrix(M11="+h+", M12="+i+", M21="+j+", M22="+k,w=d.x+q*d.xPercent/100,x=d.y+r*d.yPercent/100;if(null!=d.ox&&(n=(d.oxp?q*d.ox*.01:d.ox)-q/2,o=(d.oyp?r*d.oy*.01:d.oy)-r/2,w+=n-(n*h+o*i),x+=o-(n*j+o*k)),s?(n=q/2,o=r/2,t+=", Dx="+(n-(n*h+o*i)+w)+", Dy="+(o-(n*j+o*k)+x)+")"):t+=", sizingMethod='auto expand')",l.filter=-1!==b.indexOf("DXImageTransform.Microsoft.Matrix(")?b.replace(F,t):t+" "+b,(0===a||1===a)&&1===h&&0===i&&0===j&&1===k&&(s&&-1===t.indexOf("Dx=0, Dy=0")||v.test(b)&&100!==parseFloat(RegExp.$1)||-1===b.indexOf("gradient("&&b.indexOf("Alpha"))&&l.removeAttribute("filter")),!s){var y,z,A,B=8>p?1:-1;for(n=d.ieOffsetX||0,o=d.ieOffsetY||0,d.ieOffsetX=Math.round((q-((0>h?-h:h)*q+(0>i?-i:i)*r))/2+w),d.ieOffsetY=Math.round((r-((0>k?-k:k)*r+(0>j?-j:j)*q))/2+x),qb=0;4>qb;qb++)z=bb[qb],y=m[z],c=-1!==y.indexOf("px")?parseFloat(y):Y(this.t,z,parseFloat(y),y.replace(u,""))||0,A=c!==d[z]?2>qb?-d.ieOffsetX:-d.ieOffsetY:2>qb?n-d.ieOffsetX:o-d.ieOffsetY,l[z]=(d[z]=Math.round(c-A*(0===qb||2===qb?1:B)))+"px"}}},Ib=O.set3DTransformRatio=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,o,p,q,r,s,t,u,v,w,x=this.data,y=this.t.style,z=x.rotation*H,A=x.scaleX,B=x.scaleY,C=x.scaleZ,D=x.x,E=x.y,F=x.z,G=x.perspective;if(!(1!==a&&0!==a&&x.force3D||x.force3D===!0||x.rotationY||x.rotationX||1!==C||G||F))return void Jb.call(this,a);if(n&&(p=1e-4,p>A&&A>-p&&(A=C=2e-5),p>B&&B>-p&&(B=C=2e-5),!G||x.z||x.rotationX||x.rotationY||(G=0)),z||x.skewX)q=b=Math.cos(z),r=e=Math.sin(z),x.skewX&&(z-=x.skewX*H,q=Math.cos(z),r=Math.sin(z),"simple"===x.skewType&&(s=Math.tan(x.skewX*H),s=Math.sqrt(1+s*s),q*=s,r*=s)),c=-r,f=q;else{if(!(x.rotationY||x.rotationX||1!==C||G||x.svg))return void(y[wb]=(x.xPercent||x.yPercent?"translate("+x.xPercent+"%,"+x.yPercent+"%) translate3d(":"translate3d(")+D+"px,"+E+"px,"+F+"px)"+(1!==A||1!==B?" scale("+A+","+B+")":""));b=f=1,c=e=0}j=1,d=g=h=i=k=l=0,m=G?-1/G:0,o=x.zOrigin,p=1e-6,v=",",w="0",z=x.rotationY*H,z&&(q=Math.cos(z),r=Math.sin(z),h=-r,k=m*-r,d=b*r,g=e*r,j=q,m*=q,b*=q,e*=q),z=x.rotationX*H,z&&(q=Math.cos(z),r=Math.sin(z),s=c*q+d*r,t=f*q+g*r,i=j*r,l=m*r,d=c*-r+d*q,g=f*-r+g*q,j*=q,m*=q,c=s,f=t),1!==C&&(d*=C,g*=C,j*=C,m*=C),1!==B&&(c*=B,f*=B,i*=B,l*=B),1!==A&&(b*=A,e*=A,h*=A,k*=A),(o||x.svg)&&(o&&(D+=d*-o,E+=g*-o,F+=j*-o+o),x.svg&&(D+=x.xOrigin-(x.xOrigin*b+x.yOrigin*c),E+=x.yOrigin-(x.xOrigin*e+x.yOrigin*f)),p>D&&D>-p&&(D=w),p>E&&E>-p&&(E=w),p>F&&F>-p&&(F=0)),u=x.xPercent||x.yPercent?"translate("+x.xPercent+"%,"+x.yPercent+"%) matrix3d(":"matrix3d(",u+=(p>b&&b>-p?w:b)+v+(p>e&&e>-p?w:e)+v+(p>h&&h>-p?w:h),u+=v+(p>k&&k>-p?w:k)+v+(p>c&&c>-p?w:c)+v+(p>f&&f>-p?w:f),x.rotationX||x.rotationY?(u+=v+(p>i&&i>-p?w:i)+v+(p>l&&l>-p?w:l)+v+(p>d&&d>-p?w:d),u+=v+(p>g&&g>-p?w:g)+v+(p>j&&j>-p?w:j)+v+(p>m&&m>-p?w:m)+v):u+=",0,0,0,0,1,0,",u+=D+v+E+v+F+v+(G?1+-F/G:1)+")",y[wb]=u},Jb=O.set2DTransformRatio=function(a){var b,c,d,e,f,g,h,i,j,k,l,m=this.data,n=this.t,o=n.style,p=m.x,q=m.y;return!(m.rotationX||m.rotationY||m.z||m.force3D===!0||"auto"===m.force3D&&1!==a&&0!==a)||m.svg&&ub||!zb?(e=m.scaleX,f=m.scaleY,void(m.rotation||m.skewX||m.svg?(b=m.rotation*H,c=b-m.skewX*H,d=1e5,g=Math.cos(b)*e,h=Math.sin(b)*e,i=Math.sin(c)*-f,j=Math.cos(c)*f,m.svg&&(p+=m.xOrigin-(m.xOrigin*g+m.yOrigin*i),q+=m.yOrigin-(m.xOrigin*h+m.yOrigin*j),l=1e-6,l>p&&p>-l&&(p=0),l>q&&q>-l&&(q=0)),k=(g*d|0)/d+","+(h*d|0)/d+","+(i*d|0)/d+","+(j*d|0)/d+","+p+","+q+")",m.svg&&ub?n.setAttribute("transform","matrix("+k):o[wb]=(m.xPercent||m.yPercent?"translate("+m.xPercent+"%,"+m.yPercent+"%) matrix(":"matrix(")+k):o[wb]=(m.xPercent||m.yPercent?"translate("+m.xPercent+"%,"+m.yPercent+"%) matrix(":"matrix(")+e+",0,0,"+f+","+p+","+q+")")):(this.setRatio=Ib,void Ib.call(this,a))};j=Ab.prototype,j.x=j.y=j.z=j.skewX=j.skewY=j.rotation=j.rotationX=j.rotationY=j.zOrigin=j.xPercent=j.yPercent=0,j.scaleX=j.scaleY=j.scaleZ=1,sb("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,transformPerspective,directionalRotation,parseTransform,force3D,skewType,xPercent,yPercent",{parser:function(a,b,c,d,f,h,i){if(d._lastParsedTransform===i)return f;d._lastParsedTransform=i;var j,k,l,m,n,o,p,q=d._transform=Gb(a,e,!0,i.parseTransform),r=a.style,s=1e-6,t=vb.length,u=i,v={};if("string"==typeof u.transform&&wb)l=M.style,l[wb]=u.transform,l.display="block",l.position="absolute",K.body.appendChild(M),j=Gb(M,null,!1),K.body.removeChild(M);else if("object"==typeof u){if(j={scaleX:fb(null!=u.scaleX?u.scaleX:u.scale,q.scaleX),scaleY:fb(null!=u.scaleY?u.scaleY:u.scale,q.scaleY),scaleZ:fb(u.scaleZ,q.scaleZ),x:fb(u.x,q.x),y:fb(u.y,q.y),z:fb(u.z,q.z),xPercent:fb(u.xPercent,q.xPercent),yPercent:fb(u.yPercent,q.yPercent),perspective:fb(u.transformPerspective,q.perspective)},p=u.directionalRotation,null!=p)if("object"==typeof p)for(l in p)u[l]=p[l];else u.rotation=p;"string"==typeof u.x&&-1!==u.x.indexOf("%")&&(j.x=0,j.xPercent=fb(u.x,q.xPercent)),"string"==typeof u.y&&-1!==u.y.indexOf("%")&&(j.y=0,j.yPercent=fb(u.y,q.yPercent)),j.rotation=gb("rotation"in u?u.rotation:"shortRotation"in u?u.shortRotation+"_short":"rotationZ"in u?u.rotationZ:q.rotation,q.rotation,"rotation",v),zb&&(j.rotationX=gb("rotationX"in u?u.rotationX:"shortRotationX"in u?u.shortRotationX+"_short":q.rotationX||0,q.rotationX,"rotationX",v),j.rotationY=gb("rotationY"in u?u.rotationY:"shortRotationY"in u?u.shortRotationY+"_short":q.rotationY||0,q.rotationY,"rotationY",v)),j.skewX=null==u.skewX?q.skewX:gb(u.skewX,q.skewX),j.skewY=null==u.skewY?q.skewY:gb(u.skewY,q.skewY),(k=j.skewY-q.skewY)&&(j.skewX+=k,j.rotation+=k)}for(zb&&null!=u.force3D&&(q.force3D=u.force3D,o=!0),q.skewType=u.skewType||q.skewType||g.defaultSkewType,n=q.force3D||q.z||q.rotationX||q.rotationY||j.z||j.rotationX||j.rotationY||j.perspective,n||null==u.scale||(j.scaleZ=1);--t>-1;)c=vb[t],m=j[c]-q[c],(m>s||-s>m||null!=u[c]||null!=J[c])&&(o=!0,f=new ob(q,c,q[c],m,f),c in v&&(f.e=v[c]),f.xs0=0,f.plugin=h,d._overwriteProps.push(f.n));return m=u.transformOrigin,m&&q.svg&&(Fb(a,db(m),j),f=new ob(q,"xOrigin",q.xOrigin,j.xOrigin-q.xOrigin,f,-1,"transformOrigin"),f.b=q.xOrigin,f.e=f.xs0=j.xOrigin,f=new ob(q,"yOrigin",q.yOrigin,j.yOrigin-q.yOrigin,f,-1,"transformOrigin"),f.b=q.yOrigin,f.e=f.xs0=j.yOrigin,m="0px 0px"),(m||zb&&n&&q.zOrigin)&&(wb?(o=!0,c=yb,m=(m||X(a,c,e,!1,"50% 50%"))+"",f=new ob(r,c,0,0,f,-1,"transformOrigin"),f.b=r[c],f.plugin=h,zb?(l=q.zOrigin,m=m.split(" "),q.zOrigin=(m.length>2&&(0===l||"0px"!==m[2])?parseFloat(m[2]):l)||0,f.xs0=f.e=m[0]+" "+(m[1]||"50%")+" 0px",f=new ob(q,"zOrigin",0,0,f,-1,f.n),f.b=l,f.xs0=f.e=q.zOrigin):f.xs0=f.e=m):db(m+"",q)),o&&(d._transformType=q.svg&&ub||!n&&3!==this._transformType?2:3),f},prefix:!0}),sb("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:!0,color:!0,multi:!0,keyword:"inset"}),sb("borderRadius",{defaultValue:"0px",parser:function(a,b,c,f,g){b=this.format(b);var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],y=a.style;for(p=parseFloat(a.offsetWidth),q=parseFloat(a.offsetHeight),h=b.split(" "),i=0;i<x.length;i++)this.p.indexOf("border")&&(x[i]=V(x[i])),l=k=X(a,x[i],e,!1,"0px"),-1!==l.indexOf(" ")&&(k=l.split(" "),l=k[0],k=k[1]),m=j=h[i],n=parseFloat(l),s=l.substr((n+"").length),t="="===m.charAt(1),t?(o=parseInt(m.charAt(0)+"1",10),m=m.substr(2),o*=parseFloat(m),r=m.substr((o+"").length-(0>o?1:0))||""):(o=parseFloat(m),r=m.substr((o+"").length)),""===r&&(r=d[c]||s),r!==s&&(u=Y(a,"borderLeft",n,s),v=Y(a,"borderTop",n,s),"%"===r?(l=u/p*100+"%",k=v/q*100+"%"):"em"===r?(w=Y(a,"borderLeft",1,"em"),l=u/w+"em",k=v/w+"em"):(l=u+"px",k=v+"px"),t&&(m=parseFloat(l)+o+r,j=parseFloat(k)+o+r)),g=pb(y,x[i],l+" "+k,m+" "+j,!1,"0px",g);return g},prefix:!0,formatter:lb("0px 0px 0px 0px",!1,!0)}),sb("backgroundPosition",{defaultValue:"0 0",parser:function(a,b,c,d,f,g){var h,i,j,k,l,m,n="background-position",o=e||W(a,null),q=this.format((o?p?o.getPropertyValue(n+"-x")+" "+o.getPropertyValue(n+"-y"):o.getPropertyValue(n):a.currentStyle.backgroundPositionX+" "+a.currentStyle.backgroundPositionY)||"0 0"),r=this.format(b);if(-1!==q.indexOf("%")!=(-1!==r.indexOf("%"))&&(m=X(a,"backgroundImage").replace(B,""),m&&"none"!==m)){for(h=q.split(" "),i=r.split(" "),N.setAttribute("src",m),j=2;--j>-1;)q=h[j],k=-1!==q.indexOf("%"),k!==(-1!==i[j].indexOf("%"))&&(l=0===j?a.offsetWidth-N.width:a.offsetHeight-N.height,h[j]=k?parseFloat(q)/100*l+"px":parseFloat(q)/l*100+"%");q=h.join(" ")}return this.parseComplex(a.style,q,r,f,g)},formatter:db}),sb("backgroundSize",{defaultValue:"0 0",formatter:db}),sb("perspective",{defaultValue:"0px",prefix:!0}),sb("perspectiveOrigin",{defaultValue:"50% 50%",prefix:!0}),sb("transformStyle",{prefix:!0}),sb("backfaceVisibility",{prefix:!0}),sb("userSelect",{prefix:!0}),sb("margin",{parser:mb("marginTop,marginRight,marginBottom,marginLeft")}),sb("padding",{parser:mb("paddingTop,paddingRight,paddingBottom,paddingLeft")}),sb("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(a,b,c,d,f,g){var h,i,j;return 9>p?(i=a.currentStyle,j=8>p?" ":",",h="rect("+i.clipTop+j+i.clipRight+j+i.clipBottom+j+i.clipLeft+")",b=this.format(b).split(",").join(j)):(h=this.format(X(a,this.p,e,!1,this.dflt)),b=this.format(b)),this.parseComplex(a.style,h,b,f,g)
}}),sb("textShadow",{defaultValue:"0px 0px 0px #999",color:!0,multi:!0}),sb("autoRound,strictUnits",{parser:function(a,b,c,d,e){return e}}),sb("border",{defaultValue:"0px solid #000",parser:function(a,b,c,d,f,g){return this.parseComplex(a.style,this.format(X(a,"borderTopWidth",e,!1,"0px")+" "+X(a,"borderTopStyle",e,!1,"solid")+" "+X(a,"borderTopColor",e,!1,"#000")),this.format(b),f,g)},color:!0,formatter:function(a){var b=a.split(" ");return b[0]+" "+(b[1]||"solid")+" "+(a.match(kb)||["#000"])[0]}}),sb("borderWidth",{parser:mb("borderTopWidth,borderRightWidth,borderBottomWidth,borderLeftWidth")}),sb("float,cssFloat,styleFloat",{parser:function(a,b,c,d,e){var f=a.style,g="cssFloat"in f?"cssFloat":"styleFloat";return new ob(f,g,0,0,e,-1,c,!1,0,f[g],b)}});var Kb=function(a){var b,c=this.t,d=c.filter||X(this.data,"filter")||"",e=this.s+this.c*a|0;100===e&&(-1===d.indexOf("atrix(")&&-1===d.indexOf("radient(")&&-1===d.indexOf("oader(")?(c.removeAttribute("filter"),b=!X(this.data,"filter")):(c.filter=d.replace(x,""),b=!0)),b||(this.xn1&&(c.filter=d=d||"alpha(opacity="+e+")"),-1===d.indexOf("pacity")?0===e&&this.xn1||(c.filter=d+" alpha(opacity="+e+")"):c.filter=d.replace(v,"opacity="+e))};sb("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(a,b,c,d,f,g){var h=parseFloat(X(a,"opacity",e,!1,"1")),i=a.style,j="autoAlpha"===c;return"string"==typeof b&&"="===b.charAt(1)&&(b=("-"===b.charAt(0)?-1:1)*parseFloat(b.substr(2))+h),j&&1===h&&"hidden"===X(a,"visibility",e)&&0!==b&&(h=0),Q?f=new ob(i,"opacity",h,b-h,f):(f=new ob(i,"opacity",100*h,100*(b-h),f),f.xn1=j?1:0,i.zoom=1,f.type=2,f.b="alpha(opacity="+f.s+")",f.e="alpha(opacity="+(f.s+f.c)+")",f.data=a,f.plugin=g,f.setRatio=Kb),j&&(f=new ob(i,"visibility",0,0,f,-1,null,!1,0,0!==h?"inherit":"hidden",0===b?"hidden":"inherit"),f.xs0="inherit",d._overwriteProps.push(f.n),d._overwriteProps.push(c)),f}});var Lb=function(a,b){b&&(a.removeProperty?("ms"===b.substr(0,2)&&(b="M"+b.substr(1)),a.removeProperty(b.replace(z,"-$1").toLowerCase())):a.removeAttribute(b))},Mb=function(a){if(this.t._gsClassPT=this,1===a||0===a){this.t.setAttribute("class",0===a?this.b:this.e);for(var b=this.data,c=this.t.style;b;)b.v?c[b.p]=b.v:Lb(c,b.p),b=b._next;1===a&&this.t._gsClassPT===this&&(this.t._gsClassPT=null)}else this.t.getAttribute("class")!==this.e&&this.t.setAttribute("class",this.e)};sb("className",{parser:function(a,b,d,f,g,h,i){var j,k,l,m,n,o=a.getAttribute("class")||"",p=a.style.cssText;if(g=f._classNamePT=new ob(a,d,0,0,g,2),g.setRatio=Mb,g.pr=-11,c=!0,g.b=o,k=$(a,e),l=a._gsClassPT){for(m={},n=l.data;n;)m[n.p]=1,n=n._next;l.setRatio(1)}return a._gsClassPT=g,g.e="="!==b.charAt(1)?b:o.replace(new RegExp("\\s*\\b"+b.substr(2)+"\\b"),"")+("+"===b.charAt(0)?" "+b.substr(2):""),f._tween._duration&&(a.setAttribute("class",g.e),j=_(a,k,$(a),i,m),a.setAttribute("class",o),g.data=j.firstMPT,a.style.cssText=p,g=g.xfirst=f.parse(a,j.difs,g,h)),g}});var Nb=function(a){if((1===a||0===a)&&this.data._totalTime===this.data._totalDuration&&"isFromStart"!==this.data.data){var b,c,d,e,f=this.t.style,g=i.transform.parse;if("all"===this.e)f.cssText="",e=!0;else for(b=this.e.split(" ").join("").split(","),d=b.length;--d>-1;)c=b[d],i[c]&&(i[c].parse===g?e=!0:c="transformOrigin"===c?yb:i[c].p),Lb(f,c);e&&(Lb(f,wb),this.t._gsTransform&&delete this.t._gsTransform)}};for(sb("clearProps",{parser:function(a,b,d,e,f){return f=new ob(a,d,0,0,f,2),f.setRatio=Nb,f.e=b,f.pr=-10,f.data=e._tween,c=!0,f}}),j="bezier,throwProps,physicsProps,physics2D".split(","),qb=j.length;qb--;)tb(j[qb]);j=g.prototype,j._firstPT=j._lastParsedTransform=j._transform=null,j._onInitTween=function(a,b,h){if(!a.nodeType)return!1;this._target=a,this._tween=h,this._vars=b,k=b.autoRound,c=!1,d=b.suffixMap||g.suffixMap,e=W(a,""),f=this._overwriteProps;var i,j,n,p,q,r,s,t,u,v=a.style;if(l&&""===v.zIndex&&(i=X(a,"zIndex",e),("auto"===i||""===i)&&this._addLazySet(v,"zIndex",0)),"string"==typeof b&&(p=v.cssText,i=$(a,e),v.cssText=p+";"+b,i=_(a,i,$(a)).difs,!Q&&w.test(b)&&(i.opacity=parseFloat(RegExp.$1)),b=i,v.cssText=p),this._firstPT=j=this.parse(a,b,null),this._transformType){for(u=3===this._transformType,wb?m&&(l=!0,""===v.zIndex&&(s=X(a,"zIndex",e),("auto"===s||""===s)&&this._addLazySet(v,"zIndex",0)),o&&this._addLazySet(v,"WebkitBackfaceVisibility",this._vars.WebkitBackfaceVisibility||(u?"visible":"hidden"))):v.zoom=1,n=j;n&&n._next;)n=n._next;t=new ob(a,"transform",0,0,null,2),this._linkCSSP(t,null,n),t.setRatio=u&&zb?Ib:wb?Jb:Hb,t.data=this._transform||Gb(a,e,!0),f.pop()}if(c){for(;j;){for(r=j._next,n=p;n&&n.pr>j.pr;)n=n._next;(j._prev=n?n._prev:q)?j._prev._next=j:p=j,(j._next=n)?n._prev=j:q=j,j=r}this._firstPT=p}return!0},j.parse=function(a,b,c,f){var g,h,j,l,m,n,o,p,q,r,s=a.style;for(g in b)n=b[g],h=i[g],h?c=h.parse(a,n,g,this,c,f,b):(m=X(a,g,e)+"",q="string"==typeof n,"color"===g||"fill"===g||"stroke"===g||-1!==g.indexOf("Color")||q&&y.test(n)?(q||(n=jb(n),n=(n.length>3?"rgba(":"rgb(")+n.join(",")+")"),c=pb(s,g,m,n,!0,"transparent",c,0,f)):!q||-1===n.indexOf(" ")&&-1===n.indexOf(",")?(j=parseFloat(m),o=j||0===j?m.substr((j+"").length):"",(""===m||"auto"===m)&&("width"===g||"height"===g?(j=cb(a,g,e),o="px"):"left"===g||"top"===g?(j=Z(a,g,e),o="px"):(j="opacity"!==g?0:1,o="")),r=q&&"="===n.charAt(1),r?(l=parseInt(n.charAt(0)+"1",10),n=n.substr(2),l*=parseFloat(n),p=n.replace(u,"")):(l=parseFloat(n),p=q?n.replace(u,""):""),""===p&&(p=g in d?d[g]:o),n=l||0===l?(r?l+j:l)+p:b[g],o!==p&&""!==p&&(l||0===l)&&j&&(j=Y(a,g,j,o),"%"===p?(j/=Y(a,g,100,"%")/100,b.strictUnits!==!0&&(m=j+"%")):"em"===p?j/=Y(a,g,1,"em"):"px"!==p&&(l=Y(a,g,l,p),p="px"),r&&(l||0===l)&&(n=l+j+p)),r&&(l+=j),!j&&0!==j||!l&&0!==l?void 0!==s[g]&&(n||n+""!="NaN"&&null!=n)?(c=new ob(s,g,l||j||0,0,c,-1,g,!1,0,m,n),c.xs0="none"!==n||"display"!==g&&-1===g.indexOf("Style")?n:m):S("invalid "+g+" tween value: "+b[g]):(c=new ob(s,g,j,l-j,c,0,g,k!==!1&&("px"===p||"zIndex"===g),0,m,n),c.xs0=p)):c=pb(s,g,m,n,!0,null,c,0,f)),f&&c&&!c.plugin&&(c.plugin=f);return c},j.setRatio=function(a){var b,c,d,e=this._firstPT,f=1e-6;if(1!==a||this._tween._time!==this._tween._duration&&0!==this._tween._time)if(a||this._tween._time!==this._tween._duration&&0!==this._tween._time||this._tween._rawPrevTime===-1e-6)for(;e;){if(b=e.c*a+e.s,e.r?b=Math.round(b):f>b&&b>-f&&(b=0),e.type)if(1===e.type)if(d=e.l,2===d)e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2;else if(3===d)e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2+e.xn2+e.xs3;else if(4===d)e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2+e.xn2+e.xs3+e.xn3+e.xs4;else if(5===d)e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2+e.xn2+e.xs3+e.xn3+e.xs4+e.xn4+e.xs5;else{for(c=e.xs0+b+e.xs1,d=1;d<e.l;d++)c+=e["xn"+d]+e["xs"+(d+1)];e.t[e.p]=c}else-1===e.type?e.t[e.p]=e.xs0:e.setRatio&&e.setRatio(a);else e.t[e.p]=b+e.xs0;e=e._next}else for(;e;)2!==e.type?e.t[e.p]=e.b:e.setRatio(a),e=e._next;else for(;e;)2!==e.type?e.t[e.p]=e.e:e.setRatio(a),e=e._next},j._enableTransforms=function(a){this._transform=this._transform||Gb(this._target,e,!0),this._transformType=this._transform.svg&&ub||!a&&3!==this._transformType?2:3};var Ob=function(){this.t[this.p]=this.e,this.data._linkCSSP(this,this._next,null,!0)};j._addLazySet=function(a,b,c){var d=this._firstPT=new ob(a,b,0,0,this._firstPT,2);d.e=c,d.setRatio=Ob,d.data=this},j._linkCSSP=function(a,b,c,d){return a&&(b&&(b._prev=a),a._next&&(a._next._prev=a._prev),a._prev?a._prev._next=a._next:this._firstPT===a&&(this._firstPT=a._next,d=!0),c?c._next=a:d||null!==this._firstPT||(this._firstPT=a),a._next=b,a._prev=c),a},j._kill=function(b){var c,d,e,f=b;if(b.autoAlpha||b.alpha){f={};for(d in b)f[d]=b[d];f.opacity=1,f.autoAlpha&&(f.visibility=1)}return b.className&&(c=this._classNamePT)&&(e=c.xfirst,e&&e._prev?this._linkCSSP(e._prev,c._next,e._prev._prev):e===this._firstPT&&(this._firstPT=c._next),c._next&&this._linkCSSP(c._next,c._next._next,e._prev),this._classNamePT=null),a.prototype._kill.call(this,f)};var Pb=function(a,b,c){var d,e,f,g;if(a.slice)for(e=a.length;--e>-1;)Pb(a[e],b,c);else for(d=a.childNodes,e=d.length;--e>-1;)f=d[e],g=f.type,f.style&&(b.push($(f)),c&&c.push(f)),1!==g&&9!==g&&11!==g||!f.childNodes.length||Pb(f,b,c)};return g.cascadeTo=function(a,c,d){var e,f,g,h=b.to(a,c,d),i=[h],j=[],k=[],l=[],m=b._internals.reservedProps;for(a=h._targets||h.target,Pb(a,j,l),h.render(c,!0),Pb(a,k),h.render(0,!0),h._enabled(!0),e=l.length;--e>-1;)if(f=_(l[e],j[e],k[e]),f.firstMPT){f=f.difs;for(g in d)m[g]&&(f[g]=d[g]);i.push(b.to(l[e],c,f))}return i},a.activate([g]),g},!0),function(){var a=_gsScope._gsDefine.plugin({propName:"roundProps",priority:-1,API:2,init:function(a,b,c){return this._tween=c,!0}}),b=a.prototype;b._onInitAllProps=function(){for(var a,b,c,d=this._tween,e=d.vars.roundProps instanceof Array?d.vars.roundProps:d.vars.roundProps.split(","),f=e.length,g={},h=d._propLookup.roundProps;--f>-1;)g[e[f]]=1;for(f=e.length;--f>-1;)for(a=e[f],b=d._firstPT;b;)c=b._next,b.pg?b.t._roundProps(g,!0):b.n===a&&(this._add(b.t,a,b.s,b.c),c&&(c._prev=b._prev),b._prev?b._prev._next=c:d._firstPT===b&&(d._firstPT=c),b._next=b._prev=null,d._propLookup[a]=h),b=c;return!1},b._add=function(a,b,c,d){this._addTween(a,b,c,c+d,b,!0),this._overwriteProps.push(b)}}(),_gsScope._gsDefine.plugin({propName:"attr",API:2,version:"0.3.3",init:function(a,b){var c,d,e;if("function"!=typeof a.setAttribute)return!1;this._target=a,this._proxy={},this._start={},this._end={};for(c in b)this._start[c]=this._proxy[c]=d=a.getAttribute(c),e=this._addTween(this._proxy,c,parseFloat(d),b[c],c),this._end[c]=e?e.s+e.c:b[c],this._overwriteProps.push(c);return!0},set:function(a){this._super.setRatio.call(this,a);for(var b,c=this._overwriteProps,d=c.length,e=1===a?this._end:a?this._proxy:this._start;--d>-1;)b=c[d],this._target.setAttribute(b,e[b]+"")}}),_gsScope._gsDefine.plugin({propName:"directionalRotation",version:"0.2.1",API:2,init:function(a,b){"object"!=typeof b&&(b={rotation:b}),this.finals={};var c,d,e,f,g,h,i=b.useRadians===!0?2*Math.PI:360,j=1e-6;for(c in b)"useRadians"!==c&&(h=(b[c]+"").split("_"),d=h[0],e=parseFloat("function"!=typeof a[c]?a[c]:a[c.indexOf("set")||"function"!=typeof a["get"+c.substr(3)]?c:"get"+c.substr(3)]()),f=this.finals[c]="string"==typeof d&&"="===d.charAt(1)?e+parseInt(d.charAt(0)+"1",10)*Number(d.substr(2)):Number(d)||0,g=f-e,h.length&&(d=h.join("_"),-1!==d.indexOf("short")&&(g%=i,g!==g%(i/2)&&(g=0>g?g+i:g-i)),-1!==d.indexOf("_cw")&&0>g?g=(g+9999999999*i)%i-(g/i|0)*i:-1!==d.indexOf("ccw")&&g>0&&(g=(g-9999999999*i)%i-(g/i|0)*i)),(g>j||-j>g)&&(this._addTween(a,c,e,e+g,c),this._overwriteProps.push(c)));return!0},set:function(a){var b;if(1!==a)this._super.setRatio.call(this,a);else for(b=this._firstPT;b;)b.f?b.t[b.p](this.finals[b.p]):b.t[b.p]=this.finals[b.p],b=b._next}})._autoCSS=!0,_gsScope._gsDefine("easing.Back",["easing.Ease"],function(a){var b,c,d,e=_gsScope.GreenSockGlobals||_gsScope,f=e.com.greensock,g=2*Math.PI,h=Math.PI/2,i=f._class,j=function(b,c){var d=i("easing."+b,function(){},!0),e=d.prototype=new a;return e.constructor=d,e.getRatio=c,d},k=a.register||function(){},l=function(a,b,c,d){var e=i("easing."+a,{easeOut:new b,easeIn:new c,easeInOut:new d},!0);return k(e,a),e},m=function(a,b,c){this.t=a,this.v=b,c&&(this.next=c,c.prev=this,this.c=c.v-b,this.gap=c.t-a)},n=function(b,c){var d=i("easing."+b,function(a){this._p1=a||0===a?a:1.70158,this._p2=1.525*this._p1},!0),e=d.prototype=new a;return e.constructor=d,e.getRatio=c,e.config=function(a){return new d(a)},d},o=l("Back",n("BackOut",function(a){return(a-=1)*a*((this._p1+1)*a+this._p1)+1}),n("BackIn",function(a){return a*a*((this._p1+1)*a-this._p1)}),n("BackInOut",function(a){return(a*=2)<1?.5*a*a*((this._p2+1)*a-this._p2):.5*((a-=2)*a*((this._p2+1)*a+this._p2)+2)})),p=i("easing.SlowMo",function(a,b,c){b=b||0===b?b:.7,null==a?a=.7:a>1&&(a=1),this._p=1!==a?b:0,this._p1=(1-a)/2,this._p2=a,this._p3=this._p1+this._p2,this._calcEnd=c===!0},!0),q=p.prototype=new a;return q.constructor=p,q.getRatio=function(a){var b=a+(.5-a)*this._p;return a<this._p1?this._calcEnd?1-(a=1-a/this._p1)*a:b-(a=1-a/this._p1)*a*a*a*b:a>this._p3?this._calcEnd?1-(a=(a-this._p3)/this._p1)*a:b+(a-b)*(a=(a-this._p3)/this._p1)*a*a*a:this._calcEnd?1:b},p.ease=new p(.7,.7),q.config=p.config=function(a,b,c){return new p(a,b,c)},b=i("easing.SteppedEase",function(a){a=a||1,this._p1=1/a,this._p2=a+1},!0),q=b.prototype=new a,q.constructor=b,q.getRatio=function(a){return 0>a?a=0:a>=1&&(a=.999999999),(this._p2*a>>0)*this._p1},q.config=b.config=function(a){return new b(a)},c=i("easing.RoughEase",function(b){b=b||{};for(var c,d,e,f,g,h,i=b.taper||"none",j=[],k=0,l=0|(b.points||20),n=l,o=b.randomize!==!1,p=b.clamp===!0,q=b.template instanceof a?b.template:null,r="number"==typeof b.strength?.4*b.strength:.4;--n>-1;)c=o?Math.random():1/l*n,d=q?q.getRatio(c):c,"none"===i?e=r:"out"===i?(f=1-c,e=f*f*r):"in"===i?e=c*c*r:.5>c?(f=2*c,e=f*f*.5*r):(f=2*(1-c),e=f*f*.5*r),o?d+=Math.random()*e-.5*e:n%2?d+=.5*e:d-=.5*e,p&&(d>1?d=1:0>d&&(d=0)),j[k++]={x:c,y:d};for(j.sort(function(a,b){return a.x-b.x}),h=new m(1,1,null),n=l;--n>-1;)g=j[n],h=new m(g.x,g.y,h);this._prev=new m(0,0,0!==h.t?h:h.next)},!0),q=c.prototype=new a,q.constructor=c,q.getRatio=function(a){var b=this._prev;if(a>b.t){for(;b.next&&a>=b.t;)b=b.next;b=b.prev}else for(;b.prev&&a<=b.t;)b=b.prev;return this._prev=b,b.v+(a-b.t)/b.gap*b.c},q.config=function(a){return new c(a)},c.ease=new c,l("Bounce",j("BounceOut",function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}),j("BounceIn",function(a){return(a=1-a)<1/2.75?1-7.5625*a*a:2/2.75>a?1-(7.5625*(a-=1.5/2.75)*a+.75):2.5/2.75>a?1-(7.5625*(a-=2.25/2.75)*a+.9375):1-(7.5625*(a-=2.625/2.75)*a+.984375)}),j("BounceInOut",function(a){var b=.5>a;return a=b?1-2*a:2*a-1,a=1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375,b?.5*(1-a):.5*a+.5})),l("Circ",j("CircOut",function(a){return Math.sqrt(1-(a-=1)*a)}),j("CircIn",function(a){return-(Math.sqrt(1-a*a)-1)}),j("CircInOut",function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)})),d=function(b,c,d){var e=i("easing."+b,function(a,b){this._p1=a||1,this._p2=b||d,this._p3=this._p2/g*(Math.asin(1/this._p1)||0)},!0),f=e.prototype=new a;return f.constructor=e,f.getRatio=c,f.config=function(a,b){return new e(a,b)},e},l("Elastic",d("ElasticOut",function(a){return this._p1*Math.pow(2,-10*a)*Math.sin((a-this._p3)*g/this._p2)+1},.3),d("ElasticIn",function(a){return-(this._p1*Math.pow(2,10*(a-=1))*Math.sin((a-this._p3)*g/this._p2))},.3),d("ElasticInOut",function(a){return(a*=2)<1?-.5*this._p1*Math.pow(2,10*(a-=1))*Math.sin((a-this._p3)*g/this._p2):this._p1*Math.pow(2,-10*(a-=1))*Math.sin((a-this._p3)*g/this._p2)*.5+1},.45)),l("Expo",j("ExpoOut",function(a){return 1-Math.pow(2,-10*a)}),j("ExpoIn",function(a){return Math.pow(2,10*(a-1))-.001}),j("ExpoInOut",function(a){return(a*=2)<1?.5*Math.pow(2,10*(a-1)):.5*(2-Math.pow(2,-10*(a-1)))})),l("Sine",j("SineOut",function(a){return Math.sin(a*h)}),j("SineIn",function(a){return-Math.cos(a*h)+1}),j("SineInOut",function(a){return-.5*(Math.cos(Math.PI*a)-1)})),i("easing.EaseLookup",{find:function(b){return a.map[b]}},!0),k(e.SlowMo,"SlowMo","ease,"),k(c,"RoughEase","ease,"),k(b,"SteppedEase","ease,"),o},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),function(a,b){"use strict";var c=a.GreenSockGlobals=a.GreenSockGlobals||a;if(!c.TweenLite){var d,e,f,g,h,i=function(a){var b,d=a.split("."),e=c;for(b=0;b<d.length;b++)e[d[b]]=e=e[d[b]]||{};return e},j=i("com.greensock"),k=1e-10,l=function(a){var b,c=[],d=a.length;for(b=0;b!==d;c.push(a[b++]));return c},m=function(){},n=function(){var a=Object.prototype.toString,b=a.call([]);return function(c){return null!=c&&(c instanceof Array||"object"==typeof c&&!!c.push&&a.call(c)===b)}}(),o={},p=function(d,e,f,g){this.sc=o[d]?o[d].sc:[],o[d]=this,this.gsClass=null,this.func=f;var h=[];this.check=function(j){for(var k,l,m,n,q=e.length,r=q;--q>-1;)(k=o[e[q]]||new p(e[q],[])).gsClass?(h[q]=k.gsClass,r--):j&&k.sc.push(this);if(0===r&&f)for(l=("com.greensock."+d).split("."),m=l.pop(),n=i(l.join("."))[m]=this.gsClass=f.apply(f,h),g&&(c[m]=n,"function"==typeof define&&define.amd?define((a.GreenSockAMDPath?a.GreenSockAMDPath+"/":"")+d.split(".").pop(),[],function(){return n}):d===b&&"undefined"!=typeof module&&module.exports&&(module.exports=n)),q=0;q<this.sc.length;q++)this.sc[q].check()},this.check(!0)},q=a._gsDefine=function(a,b,c,d){return new p(a,b,c,d)},r=j._class=function(a,b,c){return b=b||function(){},q(a,[],function(){return b},c),b};q.globals=c;var s=[0,0,1,1],t=[],u=r("easing.Ease",function(a,b,c,d){this._func=a,this._type=c||0,this._power=d||0,this._params=b?s.concat(b):s},!0),v=u.map={},w=u.register=function(a,b,c,d){for(var e,f,g,h,i=b.split(","),k=i.length,l=(c||"easeIn,easeOut,easeInOut").split(",");--k>-1;)for(f=i[k],e=d?r("easing."+f,null,!0):j.easing[f]||{},g=l.length;--g>-1;)h=l[g],v[f+"."+h]=v[h+f]=e[h]=a.getRatio?a:a[h]||new a};for(f=u.prototype,f._calcEnd=!1,f.getRatio=function(a){if(this._func)return this._params[0]=a,this._func.apply(null,this._params);var b=this._type,c=this._power,d=1===b?1-a:2===b?a:.5>a?2*a:2*(1-a);return 1===c?d*=d:2===c?d*=d*d:3===c?d*=d*d*d:4===c&&(d*=d*d*d*d),1===b?1-d:2===b?d:.5>a?d/2:1-d/2},d=["Linear","Quad","Cubic","Quart","Quint,Strong"],e=d.length;--e>-1;)f=d[e]+",Power"+e,w(new u(null,null,1,e),f,"easeOut",!0),w(new u(null,null,2,e),f,"easeIn"+(0===e?",easeNone":"")),w(new u(null,null,3,e),f,"easeInOut");v.linear=j.easing.Linear.easeIn,v.swing=j.easing.Quad.easeInOut;var x=r("events.EventDispatcher",function(a){this._listeners={},this._eventTarget=a||this});f=x.prototype,f.addEventListener=function(a,b,c,d,e){e=e||0;var f,i,j=this._listeners[a],k=0;for(null==j&&(this._listeners[a]=j=[]),i=j.length;--i>-1;)f=j[i],f.c===b&&f.s===c?j.splice(i,1):0===k&&f.pr<e&&(k=i+1);j.splice(k,0,{c:b,s:c,up:d,pr:e}),this!==g||h||g.wake()},f.removeEventListener=function(a,b){var c,d=this._listeners[a];if(d)for(c=d.length;--c>-1;)if(d[c].c===b)return void d.splice(c,1)},f.dispatchEvent=function(a){var b,c,d,e=this._listeners[a];if(e)for(b=e.length,c=this._eventTarget;--b>-1;)d=e[b],d&&(d.up?d.c.call(d.s||c,{type:a,target:c}):d.c.call(d.s||c))};var y=a.requestAnimationFrame,z=a.cancelAnimationFrame,A=Date.now||function(){return(new Date).getTime()},B=A();for(d=["ms","moz","webkit","o"],e=d.length;--e>-1&&!y;)y=a[d[e]+"RequestAnimationFrame"],z=a[d[e]+"CancelAnimationFrame"]||a[d[e]+"CancelRequestAnimationFrame"];r("Ticker",function(a,b){var c,d,e,f,i,j=this,l=A(),n=b!==!1&&y,o=500,p=33,q="tick",r=function(a){var b,g,h=A()-B;h>o&&(l+=h-p),B+=h,j.time=(B-l)/1e3,b=j.time-i,(!c||b>0||a===!0)&&(j.frame++,i+=b+(b>=f?.004:f-b),g=!0),a!==!0&&(e=d(r)),g&&j.dispatchEvent(q)};x.call(j),j.time=j.frame=0,j.tick=function(){r(!0)},j.lagSmoothing=function(a,b){o=a||1/k,p=Math.min(b,o,0)},j.sleep=function(){null!=e&&(n&&z?z(e):clearTimeout(e),d=m,e=null,j===g&&(h=!1))},j.wake=function(){null!==e?j.sleep():j.frame>10&&(B=A()-o+5),d=0===c?m:n&&y?y:function(a){return setTimeout(a,1e3*(i-j.time)+1|0)},j===g&&(h=!0),r(2)},j.fps=function(a){return arguments.length?(c=a,f=1/(c||60),i=this.time+f,void j.wake()):c},j.useRAF=function(a){return arguments.length?(j.sleep(),n=a,void j.fps(c)):n},j.fps(a),setTimeout(function(){n&&(!e||j.frame<5)&&j.useRAF(!1)},1500)}),f=j.Ticker.prototype=new j.events.EventDispatcher,f.constructor=j.Ticker;var C=r("core.Animation",function(a,b){if(this.vars=b=b||{},this._duration=this._totalDuration=a||0,this._delay=Number(b.delay)||0,this._timeScale=1,this._active=b.immediateRender===!0,this.data=b.data,this._reversed=b.reversed===!0,R){h||g.wake();var c=this.vars.useFrames?Q:R;c.add(this,c._time),this.vars.paused&&this.paused(!0)}});g=C.ticker=new j.Ticker,f=C.prototype,f._dirty=f._gc=f._initted=f._paused=!1,f._totalTime=f._time=0,f._rawPrevTime=-1,f._next=f._last=f._onUpdate=f._timeline=f.timeline=null,f._paused=!1;var D=function(){h&&A()-B>2e3&&g.wake(),setTimeout(D,2e3)};D(),f.play=function(a,b){return null!=a&&this.seek(a,b),this.reversed(!1).paused(!1)},f.pause=function(a,b){return null!=a&&this.seek(a,b),this.paused(!0)},f.resume=function(a,b){return null!=a&&this.seek(a,b),this.paused(!1)},f.seek=function(a,b){return this.totalTime(Number(a),b!==!1)},f.restart=function(a,b){return this.reversed(!1).paused(!1).totalTime(a?-this._delay:0,b!==!1,!0)},f.reverse=function(a,b){return null!=a&&this.seek(a||this.totalDuration(),b),this.reversed(!0).paused(!1)},f.render=function(){},f.invalidate=function(){return this._time=this._totalTime=0,this._initted=this._gc=!1,this._rawPrevTime=-1,(this._gc||!this.timeline)&&this._enabled(!0),this},f.isActive=function(){var a,b=this._timeline,c=this._startTime;return!b||!this._gc&&!this._paused&&b.isActive()&&(a=b.rawTime())>=c&&a<c+this.totalDuration()/this._timeScale},f._enabled=function(a,b){return h||g.wake(),this._gc=!a,this._active=this.isActive(),b!==!0&&(a&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!a&&this.timeline&&this._timeline._remove(this,!0)),!1},f._kill=function(){return this._enabled(!1,!1)},f.kill=function(a,b){return this._kill(a,b),this},f._uncache=function(a){for(var b=a?this:this.timeline;b;)b._dirty=!0,b=b.timeline;return this},f._swapSelfInParams=function(a){for(var b=a.length,c=a.concat();--b>-1;)"{self}"===a[b]&&(c[b]=this);return c},f.eventCallback=function(a,b,c,d){if("on"===(a||"").substr(0,2)){var e=this.vars;if(1===arguments.length)return e[a];null==b?delete e[a]:(e[a]=b,e[a+"Params"]=n(c)&&-1!==c.join("").indexOf("{self}")?this._swapSelfInParams(c):c,e[a+"Scope"]=d),"onUpdate"===a&&(this._onUpdate=b)}return this},f.delay=function(a){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+a-this._delay),this._delay=a,this):this._delay},f.duration=function(a){return arguments.length?(this._duration=this._totalDuration=a,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==a&&this.totalTime(this._totalTime*(a/this._duration),!0),this):(this._dirty=!1,this._duration)},f.totalDuration=function(a){return this._dirty=!1,arguments.length?this.duration(a):this._totalDuration},f.time=function(a,b){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(a>this._duration?this._duration:a,b)):this._time},f.totalTime=function(a,b,c){if(h||g.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(0>a&&!c&&(a+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var d=this._totalDuration,e=this._timeline;if(a>d&&!c&&(a=d),this._startTime=(this._paused?this._pauseTime:e._time)-(this._reversed?d-a:a)/this._timeScale,e._dirty||this._uncache(!1),e._timeline)for(;e._timeline;)e._timeline._time!==(e._startTime+e._totalTime)/e._timeScale&&e.totalTime(e._totalTime,!0),e=e._timeline}this._gc&&this._enabled(!0,!1),(this._totalTime!==a||0===this._duration)&&(this.render(a,b,!1),I.length&&S())}return this},f.progress=f.totalProgress=function(a,b){return arguments.length?this.totalTime(this.duration()*a,b):this._time/this.duration()},f.startTime=function(a){return arguments.length?(a!==this._startTime&&(this._startTime=a,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,a-this._delay)),this):this._startTime},f.endTime=function(a){return this._startTime+(0!=a?this.totalDuration():this.duration())/this._timeScale},f.timeScale=function(a){if(!arguments.length)return this._timeScale;if(a=a||k,this._timeline&&this._timeline.smoothChildTiming){var b=this._pauseTime,c=b||0===b?b:this._timeline.totalTime();this._startTime=c-(c-this._startTime)*this._timeScale/a}return this._timeScale=a,this._uncache(!1)},f.reversed=function(a){return arguments.length?(a!=this._reversed&&(this._reversed=a,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},f.paused=function(a){if(!arguments.length)return this._paused;if(a!=this._paused&&this._timeline){h||a||g.wake();var b=this._timeline,c=b.rawTime(),d=c-this._pauseTime;!a&&b.smoothChildTiming&&(this._startTime+=d,this._uncache(!1)),this._pauseTime=a?c:null,this._paused=a,this._active=this.isActive(),!a&&0!==d&&this._initted&&this.duration()&&this.render(b.smoothChildTiming?this._totalTime:(c-this._startTime)/this._timeScale,!0,!0)}return this._gc&&!a&&this._enabled(!0,!1),this};var E=r("core.SimpleTimeline",function(a){C.call(this,0,a),this.autoRemoveChildren=this.smoothChildTiming=!0});f=E.prototype=new C,f.constructor=E,f.kill()._gc=!1,f._first=f._last=f._recent=null,f._sortChildren=!1,f.add=f.insert=function(a,b){var c,d;if(a._startTime=Number(b||0)+a._delay,a._paused&&this!==a._timeline&&(a._pauseTime=a._startTime+(this.rawTime()-a._startTime)/a._timeScale),a.timeline&&a.timeline._remove(a,!0),a.timeline=a._timeline=this,a._gc&&a._enabled(!0,!0),c=this._last,this._sortChildren)for(d=a._startTime;c&&c._startTime>d;)c=c._prev;return c?(a._next=c._next,c._next=a):(a._next=this._first,this._first=a),a._next?a._next._prev=a:this._last=a,a._prev=c,this._recent=a,this._timeline&&this._uncache(!0),this},f._remove=function(a,b){return a.timeline===this&&(b||a._enabled(!1,!0),a._prev?a._prev._next=a._next:this._first===a&&(this._first=a._next),a._next?a._next._prev=a._prev:this._last===a&&(this._last=a._prev),a._next=a._prev=a.timeline=null,a===this._recent&&(this._recent=this._last),this._timeline&&this._uncache(!0)),this},f.render=function(a,b,c){var d,e=this._first;for(this._totalTime=this._time=this._rawPrevTime=a;e;)d=e._next,(e._active||a>=e._startTime&&!e._paused)&&(e._reversed?e.render((e._dirty?e.totalDuration():e._totalDuration)-(a-e._startTime)*e._timeScale,b,c):e.render((a-e._startTime)*e._timeScale,b,c)),e=d},f.rawTime=function(){return h||g.wake(),this._totalTime};var F=r("TweenLite",function(b,c,d){if(C.call(this,c,d),this.render=F.prototype.render,null==b)throw"Cannot tween a null target.";this.target=b="string"!=typeof b?b:F.selector(b)||b;var e,f,g,h=b.jquery||b.length&&b!==a&&b[0]&&(b[0]===a||b[0].nodeType&&b[0].style&&!b.nodeType),i=this.vars.overwrite;if(this._overwrite=i=null==i?P[F.defaultOverwrite]:"number"==typeof i?i>>0:P[i],(h||b instanceof Array||b.push&&n(b))&&"number"!=typeof b[0])for(this._targets=g=l(b),this._propLookup=[],this._siblings=[],e=0;e<g.length;e++)f=g[e],f?"string"!=typeof f?f.length&&f!==a&&f[0]&&(f[0]===a||f[0].nodeType&&f[0].style&&!f.nodeType)?(g.splice(e--,1),this._targets=g=g.concat(l(f))):(this._siblings[e]=T(f,this,!1),1===i&&this._siblings[e].length>1&&V(f,this,null,1,this._siblings[e])):(f=g[e--]=F.selector(f),"string"==typeof f&&g.splice(e+1,1)):g.splice(e--,1);else this._propLookup={},this._siblings=T(b,this,!1),1===i&&this._siblings.length>1&&V(b,this,null,1,this._siblings);(this.vars.immediateRender||0===c&&0===this._delay&&this.vars.immediateRender!==!1)&&(this._time=-k,this.render(-this._delay))},!0),G=function(b){return b&&b.length&&b!==a&&b[0]&&(b[0]===a||b[0].nodeType&&b[0].style&&!b.nodeType)},H=function(a,b){var c,d={};for(c in a)O[c]||c in b&&"transform"!==c&&"x"!==c&&"y"!==c&&"width"!==c&&"height"!==c&&"className"!==c&&"border"!==c||!(!L[c]||L[c]&&L[c]._autoCSS)||(d[c]=a[c],delete a[c]);a.css=d};f=F.prototype=new C,f.constructor=F,f.kill()._gc=!1,f.ratio=0,f._firstPT=f._targets=f._overwrittenProps=f._startAt=null,f._notifyPluginsOfEnabled=f._lazy=!1,F.version="1.15.1",F.defaultEase=f._ease=new u(null,null,1,1),F.defaultOverwrite="auto",F.ticker=g,F.autoSleep=!0,F.lagSmoothing=function(a,b){g.lagSmoothing(a,b)},F.selector=a.$||a.jQuery||function(b){var c=a.$||a.jQuery;return c?(F.selector=c,c(b)):"undefined"==typeof document?b:document.querySelectorAll?document.querySelectorAll(b):document.getElementById("#"===b.charAt(0)?b.substr(1):b)};var I=[],J={},K=F._internals={isArray:n,isSelector:G,lazyTweens:I},L=F._plugins={},M=K.tweenLookup={},N=0,O=K.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1},P={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},Q=C._rootFramesTimeline=new E,R=C._rootTimeline=new E,S=K.lazyRender=function(){var a,b=I.length;for(J={};--b>-1;)a=I[b],a&&a._lazy!==!1&&(a.render(a._lazy[0],a._lazy[1],!0),a._lazy=!1);I.length=0};R._startTime=g.time,Q._startTime=g.frame,R._active=Q._active=!0,setTimeout(S,1),C._updateRoot=F.render=function(){var a,b,c;if(I.length&&S(),R.render((g.time-R._startTime)*R._timeScale,!1,!1),Q.render((g.frame-Q._startTime)*Q._timeScale,!1,!1),I.length&&S(),!(g.frame%120)){for(c in M){for(b=M[c].tweens,a=b.length;--a>-1;)b[a]._gc&&b.splice(a,1);0===b.length&&delete M[c]}if(c=R._first,(!c||c._paused)&&F.autoSleep&&!Q._first&&1===g._listeners.tick.length){for(;c&&c._paused;)c=c._next;c||g.sleep()}}},g.addEventListener("tick",C._updateRoot);var T=function(a,b,c){var d,e,f=a._gsTweenID;if(M[f||(a._gsTweenID=f="t"+N++)]||(M[f]={target:a,tweens:[]}),b&&(d=M[f].tweens,d[e=d.length]=b,c))for(;--e>-1;)d[e]===b&&d.splice(e,1);return M[f].tweens},U=function(a,b,c,d){var e,f,g=a.vars.onOverwrite;return g&&(e=g(a,b,c,d)),g=F.onOverwrite,g&&(f=g(a,b,c,d)),e!==!1&&f!==!1},V=function(a,b,c,d,e){var f,g,h,i;if(1===d||d>=4){for(i=e.length,f=0;i>f;f++)if((h=e[f])!==b)h._gc||U(h,b)&&h._enabled(!1,!1)&&(g=!0);else if(5===d)break;return g}var j,l=b._startTime+k,m=[],n=0,o=0===b._duration;for(f=e.length;--f>-1;)(h=e[f])===b||h._gc||h._paused||(h._timeline!==b._timeline?(j=j||W(b,0,o),0===W(h,j,o)&&(m[n++]=h)):h._startTime<=l&&h._startTime+h.totalDuration()/h._timeScale>l&&((o||!h._initted)&&l-h._startTime<=2e-10||(m[n++]=h)));for(f=n;--f>-1;)if(h=m[f],2===d&&h._kill(c,a,b)&&(g=!0),2!==d||!h._firstPT&&h._initted){if(2!==d&&!U(h,b))continue;h._enabled(!1,!1)&&(g=!0)}return g},W=function(a,b,c){for(var d=a._timeline,e=d._timeScale,f=a._startTime;d._timeline;){if(f+=d._startTime,e*=d._timeScale,d._paused)return-100;d=d._timeline}return f/=e,f>b?f-b:c&&f===b||!a._initted&&2*k>f-b?k:(f+=a.totalDuration()/a._timeScale/e)>b+k?0:f-b-k};f._init=function(){var a,b,c,d,e,f=this.vars,g=this._overwrittenProps,h=this._duration,i=!!f.immediateRender,j=f.ease;if(f.startAt){this._startAt&&(this._startAt.render(-1,!0),this._startAt.kill()),e={};for(d in f.startAt)e[d]=f.startAt[d];if(e.overwrite=!1,e.immediateRender=!0,e.lazy=i&&f.lazy!==!1,e.startAt=e.delay=null,this._startAt=F.to(this.target,0,e),i)if(this._time>0)this._startAt=null;else if(0!==h)return}else if(f.runBackwards&&0!==h)if(this._startAt)this._startAt.render(-1,!0),this._startAt.kill(),this._startAt=null;else{0!==this._time&&(i=!1),c={};for(d in f)O[d]&&"autoCSS"!==d||(c[d]=f[d]);if(c.overwrite=0,c.data="isFromStart",c.lazy=i&&f.lazy!==!1,c.immediateRender=i,this._startAt=F.to(this.target,0,c),i){if(0===this._time)return}else this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null)}if(this._ease=j=j?j instanceof u?j:"function"==typeof j?new u(j,f.easeParams):v[j]||F.defaultEase:F.defaultEase,f.easeParams instanceof Array&&j.config&&(this._ease=j.config.apply(j,f.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(a=this._targets.length;--a>-1;)this._initProps(this._targets[a],this._propLookup[a]={},this._siblings[a],g?g[a]:null)&&(b=!0);else b=this._initProps(this.target,this._propLookup,this._siblings,g);if(b&&F._onPluginEvent("_onInitAllProps",this),g&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),f.runBackwards)for(c=this._firstPT;c;)c.s+=c.c,c.c=-c.c,c=c._next;this._onUpdate=f.onUpdate,this._initted=!0},f._initProps=function(b,c,d,e){var f,g,h,i,j,k;
if(null==b)return!1;J[b._gsTweenID]&&S(),this.vars.css||b.style&&b!==a&&b.nodeType&&L.css&&this.vars.autoCSS!==!1&&H(this.vars,b);for(f in this.vars){if(k=this.vars[f],O[f])k&&(k instanceof Array||k.push&&n(k))&&-1!==k.join("").indexOf("{self}")&&(this.vars[f]=k=this._swapSelfInParams(k,this));else if(L[f]&&(i=new L[f])._onInitTween(b,this.vars[f],this)){for(this._firstPT=j={_next:this._firstPT,t:i,p:"setRatio",s:0,c:1,f:!0,n:f,pg:!0,pr:i._priority},g=i._overwriteProps.length;--g>-1;)c[i._overwriteProps[g]]=this._firstPT;(i._priority||i._onInitAllProps)&&(h=!0),(i._onDisable||i._onEnable)&&(this._notifyPluginsOfEnabled=!0)}else this._firstPT=c[f]=j={_next:this._firstPT,t:b,p:f,f:"function"==typeof b[f],n:f,pg:!1,pr:0},j.s=j.f?b[f.indexOf("set")||"function"!=typeof b["get"+f.substr(3)]?f:"get"+f.substr(3)]():parseFloat(b[f]),j.c="string"==typeof k&&"="===k.charAt(1)?parseInt(k.charAt(0)+"1",10)*Number(k.substr(2)):Number(k)-j.s||0;j&&j._next&&(j._next._prev=j)}return e&&this._kill(e,b)?this._initProps(b,c,d,e):this._overwrite>1&&this._firstPT&&d.length>1&&V(b,this,c,this._overwrite,d)?(this._kill(c,b),this._initProps(b,c,d,e)):(this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)&&(J[b._gsTweenID]=!0),h)},f.render=function(a,b,c){var d,e,f,g,h=this._time,i=this._duration,j=this._rawPrevTime;if(a>=i)this._totalTime=this._time=i,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(d=!0,e="onComplete"),0===i&&(this._initted||!this.vars.lazy||c)&&(this._startTime===this._timeline._duration&&(a=0),(0===a||0>j||j===k&&"isPause"!==this.data)&&j!==a&&(c=!0,j>k&&(e="onReverseComplete")),this._rawPrevTime=g=!b||a||j===a?a:k);else if(1e-7>a)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==h||0===i&&j>0&&j!==k)&&(e="onReverseComplete",d=this._reversed),0>a&&(this._active=!1,0===i&&(this._initted||!this.vars.lazy||c)&&(j>=0&&(j!==k||"isPause"!==this.data)&&(c=!0),this._rawPrevTime=g=!b||a||j===a?a:k)),this._initted||(c=!0);else if(this._totalTime=this._time=a,this._easeType){var l=a/i,m=this._easeType,n=this._easePower;(1===m||3===m&&l>=.5)&&(l=1-l),3===m&&(l*=2),1===n?l*=l:2===n?l*=l*l:3===n?l*=l*l*l:4===n&&(l*=l*l*l*l),this.ratio=1===m?1-l:2===m?l:.5>a/i?l/2:1-l/2}else this.ratio=this._ease.getRatio(a/i);if(this._time!==h||c){if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!c&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=this._totalTime=h,this._rawPrevTime=j,I.push(this),void(this._lazy=[a,b]);this._time&&!d?this.ratio=this._ease.getRatio(this._time/i):d&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==h&&a>=0&&(this._active=!0),0===h&&(this._startAt&&(a>=0?this._startAt.render(a,b,c):e||(e="_dummyGS")),this.vars.onStart&&(0!==this._time||0===i)&&(b||this.vars.onStart.apply(this.vars.onStartScope||this,this.vars.onStartParams||t))),f=this._firstPT;f;)f.f?f.t[f.p](f.c*this.ratio+f.s):f.t[f.p]=f.c*this.ratio+f.s,f=f._next;this._onUpdate&&(0>a&&this._startAt&&a!==-1e-4&&this._startAt.render(a,b,c),b||(this._time!==h||d)&&this._onUpdate.apply(this.vars.onUpdateScope||this,this.vars.onUpdateParams||t)),e&&(!this._gc||c)&&(0>a&&this._startAt&&!this._onUpdate&&a!==-1e-4&&this._startAt.render(a,b,c),d&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[e]&&this.vars[e].apply(this.vars[e+"Scope"]||this,this.vars[e+"Params"]||t),0===i&&this._rawPrevTime===k&&g!==k&&(this._rawPrevTime=0))}},f._kill=function(a,b,c){if("all"===a&&(a=null),null==a&&(null==b||b===this.target))return this._lazy=!1,this._enabled(!1,!1);b="string"!=typeof b?b||this._targets||this.target:F.selector(b)||b;var d,e,f,g,h,i,j,k,l;if((n(b)||G(b))&&"number"!=typeof b[0])for(d=b.length;--d>-1;)this._kill(a,b[d])&&(i=!0);else{if(this._targets){for(d=this._targets.length;--d>-1;)if(b===this._targets[d]){h=this._propLookup[d]||{},this._overwrittenProps=this._overwrittenProps||[],e=this._overwrittenProps[d]=a?this._overwrittenProps[d]||{}:"all";break}}else{if(b!==this.target)return!1;h=this._propLookup,e=this._overwrittenProps=a?this._overwrittenProps||{}:"all"}if(h){if(j=a||h,k=a!==e&&"all"!==e&&a!==h&&("object"!=typeof a||!a._tempKill),c&&(F.onOverwrite||this.vars.onOverwrite)){for(f in j)h[f]&&(l||(l=[]),l.push(f));if(!U(this,c,b,l))return!1}for(f in j)(g=h[f])&&(g.pg&&g.t._kill(j)&&(i=!0),g.pg&&0!==g.t._overwriteProps.length||(g._prev?g._prev._next=g._next:g===this._firstPT&&(this._firstPT=g._next),g._next&&(g._next._prev=g._prev),g._next=g._prev=null),delete h[f]),k&&(e[f]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return i},f.invalidate=function(){return this._notifyPluginsOfEnabled&&F._onPluginEvent("_onDisable",this),this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],C.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-k,this.render(-this._delay)),this},f._enabled=function(a,b){if(h||g.wake(),a&&this._gc){var c,d=this._targets;if(d)for(c=d.length;--c>-1;)this._siblings[c]=T(d[c],this,!0);else this._siblings=T(this.target,this,!0)}return C.prototype._enabled.call(this,a,b),this._notifyPluginsOfEnabled&&this._firstPT?F._onPluginEvent(a?"_onEnable":"_onDisable",this):!1},F.to=function(a,b,c){return new F(a,b,c)},F.from=function(a,b,c){return c.runBackwards=!0,c.immediateRender=0!=c.immediateRender,new F(a,b,c)},F.fromTo=function(a,b,c,d){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,new F(a,b,d)},F.delayedCall=function(a,b,c,d,e){return new F(b,0,{delay:a,onComplete:b,onCompleteParams:c,onCompleteScope:d,onReverseComplete:b,onReverseCompleteParams:c,onReverseCompleteScope:d,immediateRender:!1,lazy:!1,useFrames:e,overwrite:0})},F.set=function(a,b){return new F(a,0,b)},F.getTweensOf=function(a,b){if(null==a)return[];a="string"!=typeof a?a:F.selector(a)||a;var c,d,e,f;if((n(a)||G(a))&&"number"!=typeof a[0]){for(c=a.length,d=[];--c>-1;)d=d.concat(F.getTweensOf(a[c],b));for(c=d.length;--c>-1;)for(f=d[c],e=c;--e>-1;)f===d[e]&&d.splice(c,1)}else for(d=T(a).concat(),c=d.length;--c>-1;)(d[c]._gc||b&&!d[c].isActive())&&d.splice(c,1);return d},F.killTweensOf=F.killDelayedCallsTo=function(a,b,c){"object"==typeof b&&(c=b,b=!1);for(var d=F.getTweensOf(a,b),e=d.length;--e>-1;)d[e]._kill(c,a)};var X=r("plugins.TweenPlugin",function(a,b){this._overwriteProps=(a||"").split(","),this._propName=this._overwriteProps[0],this._priority=b||0,this._super=X.prototype},!0);if(f=X.prototype,X.version="1.10.1",X.API=2,f._firstPT=null,f._addTween=function(a,b,c,d,e,f){var g,h;return null!=d&&(g="number"==typeof d||"="!==d.charAt(1)?Number(d)-c:parseInt(d.charAt(0)+"1",10)*Number(d.substr(2)))?(this._firstPT=h={_next:this._firstPT,t:a,p:b,s:c,c:g,f:"function"==typeof a[b],n:e||b,r:f},h._next&&(h._next._prev=h),h):void 0},f.setRatio=function(a){for(var b,c=this._firstPT,d=1e-6;c;)b=c.c*a+c.s,c.r?b=Math.round(b):d>b&&b>-d&&(b=0),c.f?c.t[c.p](b):c.t[c.p]=b,c=c._next},f._kill=function(a){var b,c=this._overwriteProps,d=this._firstPT;if(null!=a[this._propName])this._overwriteProps=[];else for(b=c.length;--b>-1;)null!=a[c[b]]&&c.splice(b,1);for(;d;)null!=a[d.n]&&(d._next&&(d._next._prev=d._prev),d._prev?(d._prev._next=d._next,d._prev=null):this._firstPT===d&&(this._firstPT=d._next)),d=d._next;return!1},f._roundProps=function(a,b){for(var c=this._firstPT;c;)(a[this._propName]||null!=c.n&&a[c.n.split(this._propName+"_").join("")])&&(c.r=b),c=c._next},F._onPluginEvent=function(a,b){var c,d,e,f,g,h=b._firstPT;if("_onInitAllProps"===a){for(;h;){for(g=h._next,d=e;d&&d.pr>h.pr;)d=d._next;(h._prev=d?d._prev:f)?h._prev._next=h:e=h,(h._next=d)?d._prev=h:f=h,h=g}h=b._firstPT=e}for(;h;)h.pg&&"function"==typeof h.t[a]&&h.t[a]()&&(c=!0),h=h._next;return c},X.activate=function(a){for(var b=a.length;--b>-1;)a[b].API===X.API&&(L[(new a[b])._propName]=a[b]);return!0},q.plugin=function(a){if(!(a&&a.propName&&a.init&&a.API))throw"illegal plugin definition.";var b,c=a.propName,d=a.priority||0,e=a.overwriteProps,f={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_roundProps",initAll:"_onInitAllProps"},g=r("plugins."+c.charAt(0).toUpperCase()+c.substr(1)+"Plugin",function(){X.call(this,c,d),this._overwriteProps=e||[]},a.global===!0),h=g.prototype=new X(c);h.constructor=g,g.API=a.API;for(b in f)"function"==typeof a[b]&&(h[f[b]]=a[b]);return g.version=a.version,X.activate([g]),g},d=a._gsQueue){for(e=0;e<d.length;e++)d[e]();for(f in o)o[f].func||a.console.log("GSAP encountered missing dependency: com.greensock."+f)}h=!1}}("undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window,"TweenMax"),function(a){function b(a){a=a||{},this.settings=a,null==a.statusInterval&&(a.statusInterval=5e3),null==a.loggingDelay&&(a.loggingDelay=2e4),null==a.noProgressTimeout&&(a.noProgressTimeout=1/0);var b,d=[],e=[],f=Date.now(),g={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},h=function(a){return null==a?[]:Array.isArray(a)?a:[a]};this.add=function(a){a.tags=new c(a.tags),null==a.priority&&(a.priority=1/0),d.push({resource:a,status:g.QUEUED})},this.addProgressListener=function(a,b){e.push({callback:a,tags:new c(b)})},this.addCompletionListener=function(a,b){e.push({tags:new c(b),callback:function(b){b.completedCount===b.totalCount&&a(b)}})};var i=function(a){a=h(a);var b=function(b){for(var c=b.resource,d=1/0,e=0;e<c.tags.length;e++)for(var f=0;f<Math.min(a.length,d)&&!(c.tags.all[e]===a[f]&&d>f&&(d=f,0===d))&&0!==d;f++);return d};return function(a,c){var d=b(a),e=b(c);return e>d?-1:d>e?1:a.priority<c.priority?-1:a.priority>c.priority?1:0}};this.start=function(a){b=Date.now();var c=i(a);d.sort(c);for(var e=0,f=d.length;f>e;e++){var h=d[e];h.status=g.WAITING,h.resource.start(this)}setTimeout(j,100)};var j=function(){for(var b=!1,c=Date.now()-f,e=c>=a.noProgressTimeout,h=c>=a.loggingDelay,i=0,k=d.length;k>i;i++){var l=d[i];l.status===g.WAITING&&(l.resource.checkStatus&&l.resource.checkStatus(),l.status===g.WAITING&&(e?l.resource.onTimeout():b=!0))}h&&b&&m(),b&&setTimeout(j,a.statusInterval)};this.isBusy=function(){for(var a=0,b=d.length;b>a;a++)if(d[a].status===g.QUEUED||d[a].status===g.WAITING)return!0;return!1};var k=function(a,b){var c,h,i,j,k,m=null;for(c=0,h=d.length;h>c;c++)if(d[c].resource===a){m=d[c];break}if(null!=m&&m.status===g.WAITING)for(m.status=b,f=Date.now(),i=a.tags.length,c=0,h=e.length;h>c;c++)j=e[c],k=0===j.tags.length?!0:a.tags.intersects(j.tags),k&&l(m,j)};this.onLoad=function(a){k(a,g.LOADED)},this.onError=function(a){k(a,g.ERROR)},this.onTimeout=function(a){k(a,g.TIMEOUT)};var l=function(a,b){var c,e,f,h,i=0,j=0;for(c=0,e=d.length;e>c;c++)f=d[c],h=!1,h=0===b.tags.length?!0:f.resource.tags.intersects(b.tags),h&&(j++,(f.status===g.LOADED||f.status===g.ERROR||f.status===g.TIMEOUT)&&i++);b.callback({resource:a.resource,loaded:a.status===g.LOADED,error:a.status===g.ERROR,timeout:a.status===g.TIMEOUT,completedCount:i,totalCount:j})},m=this.log=function(a){if(window.console){var c=Math.round((Date.now()-b)/1e3);window.console.log("PxLoader elapsed: "+c+" sec");for(var e=0,f=d.length;f>e;e++){var h=d[e];if(a||h.status===g.WAITING){var i="PxLoader: #"+e+" "+h.resource.getName();switch(h.status){case g.QUEUED:i+=" (Not Started)";break;case g.WAITING:i+=" (Waiting)";break;case g.LOADED:i+=" (Loaded)";break;case g.ERROR:i+=" (Error)";break;case g.TIMEOUT:i+=" (Timeout)"}h.resource.tags.length>0&&(i+=" Tags: ["+h.resource.tags.all.join(",")+"]"),window.console.log(i)}}}}}function c(a){if(this.all=[],this.first=null,this.length=0,this.lookup={},a){if(Array.isArray(a))this.all=a.slice(0);else if("object"==typeof a)for(var b in a)a.hasOwnProperty(b)&&this.all.push(b);else this.all.push(a);this.length=this.all.length,this.length>0&&(this.first=this.all[0]);for(var c=0;c<this.length;c++)this.lookup[this.all[c]]=!0}}c.prototype.intersects=function(a){if(0===this.length||0===a.length)return!1;if(1===this.length&&1===a.length)return this.first===a.first;if(a.length<this.length)return a.intersects(this);for(var b in this.lookup)if(a.lookup[b])return!0;return!1},"function"==typeof define&&define.amd&&define("PxLoader",[],function(){return b}),a.PxLoader=b}(this),Date.now||(Date.now=function(){return(new Date).getTime()}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),PxLoader.prototype.addImage=function(a,b,c){var d=new PxLoaderImage(a,b,c);return this.add(d),d.img},"function"==typeof define&&define.amd&&define("PxLoaderImage",[],function(){return PxLoaderImage}),!function(a){var b=function(a){function b(a){var b=a.replace(d,function(a){return'<a target="_blank" href="'+a+'">'+a+"</a>"});return b.replace(e,function(a,b){return'href="http://'+b+'"'})}var c="biz|cat|com|edu|gov|int|mil|net|org|pro|tel|xxx|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw",d=new RegExp("(?:(?:http|ftp)s?://)?(?:(?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\\.)+(?:("+c+")(?!\\w)\\.?)|localhost|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}?)(?::\\d+)?(?:[/?]?\\S+)?","gi"),e=new RegExp('href="((?!https?://).*?)"',"gi");a.fn.urlize=function(c){return"string"==typeof c?b(c):this.each(function(){$this=a(this),$this.html(b($this.html()))})}};"function"==typeof define&&define.amd?define("jquery-urlize",["jquery"],b):b(a.jQuery)}(this),function(jQuery){jQuery.ajaxSettings.xdr=function(){return window.XDomainRequest?new window.XDomainRequest:null},function(a){jQuery.extend(jQuery.support,{iecors:!!a})}(jQuery.ajaxSettings.xdr()),jQuery.support.iecors&&jQuery.ajaxTransport(function(a){return{send:function(b,c){var d=a.xdr();d.onload=function(){var a={"Content-Type":d.contentType};c(200,"OK",{text:d.responseText},a)},a.xhrFields&&(xhr.onerror=a.xhrFields.error,xhr.ontimeout=a.xhrFields.timeout),d.open(a.type,a.url),d.send(a.hasContent&&a.data||null)},abort:function(){xdr.abort()}}})}(jQuery),function(a,b){var c=function(){return!0};b.FilteredCollection=b.Collection.extend({collectionFilter:null,defaultFilter:c,initialize:function(a,b){if(a)throw"models cannot be set directly, unfortunately first argument is the models.";this.collection=b.collection,this.setFilter(b.collectionFilter),this.collection.on("add",this.addModel,this),this.collection.on("remove",this.removeModel,this),this.collection.on("reset",this.resetCollection,this),this.collection.on("sort",this.resortCollection,this),this.collection.on("change",this._modelChanged,this),this.collection.on("filter-complete",this._filterComplete,this)},_reset:function(a){b.Collection.prototype._reset.call(this,a),this._mapping=[]},add:function(){throw"Do not invoke directly"},remove:function(){throw"Do not invoke directly"},reset:function(){throw"Do not invoke directly"},_modelChanged:function(a,b,c){c||(c={});var d=this.indexOf(a);if(this.collectionFilter(a)){if(0>d){var e=this.collection.indexOf(a);this._forceAddModel(a,{index:e})}}else d>-1&&this._forceRemoveModel(a,{index:d});c.silent||this._filterComplete()},resortCollection:function(){this._mapping=[],this._reset(),this.setFilter(void 0,{silent:!0}),this.trigger("sort",this)},resetCollection:function(){this._mapping=[],this._reset(),this.setFilter(void 0,{silent:!0}),this.trigger("reset",this)},renumberMappings:function(){this._mapping=[];var b=this.collection,c=this._mapping;a(this.models).each(function(a){c.push(b.indexOf(a))})},removeModel:function(b,c,d){var e=this._mapping.indexOf(d.index);e>-1&&this._forceRemoveModel(b,a.extend({index:e},d)),this.renumberMappings()},_forceRemoveModel:function(a,c){this._mapping.splice(c.index,1),b.Collection.prototype.remove.call(this,a,{silent:c.silent}),c.silent||this.trigger("remove",a,this,{index:c.index})},addModel:function(b,c,d){this.collectionFilter(b)&&this._forceAddModel(b,a.extend(d||{},{index:d&&d.at||c.indexOf(b)})),this.renumberMappings()},_forceAddModel:function(c,d){var e=d.index,f=a.sortedIndex(this._mapping,e,function(a){return a});b.Collection.prototype.add.call(this,c,{at:f,silent:d.silent}),this._mapping.splice(f,0,e),d.silent||this.trigger("add",c,this,{index:f})},setFilter:function(b,c){c||(c={}),b===!1&&(b=this.defaultFilter),this.collectionFilter=b||this.collectionFilter||this.defaultFilter;var d=this.collectionFilter,e=this._mapping,f=a.extend({},c);this.collection.each(function(a,b){var c=e.indexOf(b);d(a,b)?-1==c&&(f.index=b,this._forceAddModel(a,f)):c>-1&&(f.index=-1==c?this.length:c,this._forceRemoveModel(a,f))},this),c.silent||this._filterComplete()},_onModelEvent:function(){},_filterComplete:function(){this.trigger("filter-complete",this)}})}(_,Backbone),function(a,b){"object"==typeof exports?module.exports=b(require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["underscore","backbone"],b):a.Backbone.Obscura=b(a._,a.Backbone)}(this,function(a,b){function c(c){return{underscore:a,backbone:b}[c]}var d=function(){function a(b){var c=a.cache[b];if(!c){var d={};c=a.cache[b]={id:b,exports:d},a.modules[b].call(d,c,d)}return c.exports}return a.cache=[],a.modules=[function(b){function d(a,b){this._superset=a,this._filtered=new g(a,b),this._sorted=new h(this._filtered,b),this._paginated=new i(this._sorted,b),j(this._paginated,this),k.call(this,this._filtered,n),k.call(this,this._sorted,p),k.call(this,this._paginated,r),this.initialize(b)}var e=c("underscore"),f=c("backbone"),g=a(2),h=a(5),i=a(4),j=a(1),k=a(7),l={superset:function(){return this._superset},getFilteredLength:function(){return this._filtered.length},removeTransforms:function(){return this._filtered.resetFilters(),this._sorted.removeSort(),this._paginated.removePagination(),this},destroy:function(){this.stopListening(),this._filtered.destroy(),this._sorted.destroy(),this._paginated.destroy(),this.length=0,this.trigger("obscura:destroy")}},m=["filterBy","removeFilter","resetFilters","refilter","hasFilter","getFilters"],n=["filtered:add","filtered:remove","filtered:reset"],o=["setSort","reverseSort","removeSort"],p=["sorted:add","sorted:remove"],q=["setPerPage","setPage","getPerPage","getNumPages","getPage","hasNextPage","hasPrevPage","nextPage","prevPage","movePage","removePagination","firstPage","lastPage"],r=["paginated:change:perPage","paginated:change:page","paginated:change:numPages"],s=["add","create","remove","set","reset","sort","parse","sync","fetch","push","pop","shift","unshift"];e.each(m,function(a){l[a]=function(){var b=g.prototype[a].apply(this._filtered,arguments);return b===this._filtered?this:b}}),e.each(q,function(a){l[a]=function(){var b=i.prototype[a].apply(this._paginated,arguments);return b===this._paginated?this:b}}),e.each(o,function(a){l[a]=function(){var b=h.prototype[a].apply(this._sorted,arguments);return b===this._sorted?this:b}}),e.each(s,function(a){l[a]=function(){throw new Error("Backbone.Obscura: Unsupported method: "+a+"called on read-only proxy")}}),e.extend(d.prototype,l,f.Events),d=f.Collection.extend(d.prototype),d.FilteredCollection=g,d.SortedCollection=h,d.PaginatedCollection=i,b.exports=d},function(a){function b(a,b){function c(){b.length=a.length}function h(c){var e=d.toArray(arguments),f="change"===c||"change:"===c.slice(0,7);"reset"===c&&(b.models=a.models),d.contains(g,c)?(d.contains(["add","remove","destroy"],c)?e[2]=b:d.contains(["reset","sort"],c)&&(e[1]=b),b.trigger.apply(this,e)):f&&b.contains(e[1])&&b.trigger.apply(this,e)}var i={};return d.each(d.functions(e.Collection.prototype),function(b){d.contains(f,b)||(i[b]=function(){return a[b].apply(a,arguments)})}),d.extend(b,e.Events,i),b.listenTo(a,"all",c),b.listenTo(a,"all",h),b.models=a.models,c(),b}var d=c("underscore"),e=c("backbone"),f=["_onModelEvent","_prepareModel","_removeReference","_reset","add","initialize","sync","remove","reset","set","push","pop","unshift","shift","sort","parse","fetch","create","model","off","on","listenTo","listenToOnce","bind","trigger","once","stopListening"],g=["add","remove","reset","sort","destroy","sync","request","error"];a.exports=b},function(b){function d(){this._filterResultCache={}}function e(a){for(var b in this._filterResultCache)this._filterResultCache.hasOwnProperty(b)&&delete this._filterResultCache[b][a]}function f(a,b){this._filters[a]&&e.call(this,a),this._filters[a]=b,this.trigger("filtered:add",a)}function g(a){delete this._filters[a],e.call(this,a),this.trigger("filtered:remove",a)}function h(a){this._filterResultCache[a.cid]||(this._filterResultCache[a.cid]={});var b=this._filterResultCache[a.cid];for(var c in this._filters)if(this._filters.hasOwnProperty(c)&&(b.hasOwnProperty(c)||(b[c]=this._filters[c].fn(a)),!b[c]))return!1;return!0}function i(){var a=[];this._superset&&(a=this._superset.filter(o.bind(h,this))),this._collection.reset(a),this.length=this._collection.length}function j(a){if(this._filterResultCache[a.cid]={},h.call(this,a)){if(!this._collection.get(a.cid)){for(var b=this.superset().indexOf(a),c=null,d=b-1;d>=0;d-=1)if(this.contains(this.superset().at(d))){c=this.indexOf(this.superset().at(d))+1;break}c=c||0,this._collection.add(a,{at:c})}}else this._collection.get(a.cid)&&this._collection.remove(a);this.length=this._collection.length}function k(a){this._filterResultCache[a.cid]={},h.call(this,a)||this._collection.get(a.cid)&&this._collection.remove(a)}function l(a){"change:"===a.slice(0,7)&&k.call(this,arguments[1])}function m(a){this.contains(a)&&this._collection.remove(a),this.length=this._collection.length}function n(a){this._superset=a,this._collection=new p.Collection(a.toArray()),q(this._collection,this),this.resetFilters(),this.listenTo(this._superset,"reset sort",i),this.listenTo(this._superset,"add change",j),this.listenTo(this._superset,"remove",m),this.listenTo(this._superset,"all",l)}var o=c("underscore"),p=c("backbone"),q=a(1),r=a(3),s={defaultFilterName:"__default",filterBy:function(a,b){return b||(b=a,a=this.defaultFilterName),f.call(this,a,r(b)),i.call(this),this},removeFilter:function(a){return a||(a=this.defaultFilterName),g.call(this,a),i.call(this),this},resetFilters:function(){return this._filters={},d.call(this),this.trigger("filtered:reset"),i.call(this),this},superset:function(){return this._superset},refilter:function(a){return"object"==typeof a&&a.cid?j.call(this,a):(d.call(this),i.call(this)),this},getFilters:function(){return o.keys(this._filters)},hasFilter:function(a){return o.contains(this.getFilters(),a)},destroy:function(){this.stopListening(),this._collection.reset([]),this._superset=this._collection,this.length=0,this.trigger("filtered:destroy")}};o.extend(n.prototype,s,p.Events),b.exports=n},function(a){function b(a,b){return function(c){return c.get(a)===b}}function d(a,b){return function(c){return b(c.get(a))}}function e(a,b){return h.isArray(b)||(b=null),{fn:a,keys:b}}function f(a){var c=h.keys(a),f=h.map(c,function(c){var e=a[c];return h.isFunction(e)?d(c,e):b(c,e)}),g=function(a){for(var b=0;b<f.length;b++)if(!f[b](a))return!1;return!0};return e(g,c)}function g(a,b){return h.isFunction(a)?e(a,b):h.isObject(a)?f(a):void 0}var h=c("underscore");a.exports=g},function(b){function d(){var a=this.getPage()*this.getPerPage(),b=a+this.getPerPage();return[a,b]}function e(){var a=d.call(this);this._collection.reset(this.superset().slice(a[0],a[1]))}function f(){var a=(this._totalPages,this.superset().length),b=this.getPerPage(),c=a%b===0?a/b:Math.floor(a/b)+1,d=this._totalPages!==c;return this._totalPages=c,d&&this.trigger("paginated:change:numPages",{numPages:c}),this.getPage()>=c?(this.setPage(c-1),!0):void 0}function g(){f.call(this)||e.call(this)}function h(a,b){for(var c=k.max([a.length,b.length]),d=0,e=0;c>d;d+=1,e+=1)if(a[d]!==b[e])if(b[d-1]===a[d])e-=1;else{if(b[d+1]!==a[d])return a[d];e+=1}}function i(){if(!f.call(this)){var a=d.call(this),b=a[0],c=a[1],e=h(this.superset().slice(b,c),this._collection.toArray()),g=h(this._collection.toArray(),this.superset().slice(b,c));g&&this._collection.remove(g),e&&this._collection.add(e,{at:this.superset().indexOf(e)-b})}}function j(a,b){this._superset=a,this._collection=new l.Collection(a.toArray()),this._page=0,this.setPerPage(b&&b.perPage?b.perPage:null),m(this._collection,this),this.listenTo(this._superset,"add remove",i),this.listenTo(this._superset,"reset sort",g)}var k=c("underscore"),l=c("backbone"),m=a(1),n={removePagination:function(){return this.setPerPage(null),this},setPerPage:function(a){return this._perPage=a,g.call(this),this.setPage(0),this.trigger("paginated:change:perPage",{perPage:a,numPages:this.getNumPages()}),this},setPage:function(a){var b=0,c=this.getNumPages()-1;return a=a>b?a:b,a=c>a?a:c,a=0>a?0:a,this._page=a,e.call(this),this.trigger("paginated:change:page",{page:a}),this},getPerPage:function(){return this._perPage||this.superset().length||1},getNumPages:function(){return this._totalPages},getPage:function(){return this._page},hasNextPage:function(){return this.getPage()<this.getNumPages()-1},hasPrevPage:function(){return this.getPage()>0},nextPage:function(){return this.movePage(1),this},prevPage:function(){return this.movePage(-1),this},firstPage:function(){this.setPage(0)},lastPage:function(){this.setPage(this.getNumPages()-1)},movePage:function(a){return this.setPage(this.getPage()+a),this},superset:function(){return this._superset},destroy:function(){this.stopListening(),this._collection.reset([]),this._superset=this._collection,this._page=0,this._totalPages=0,this.length=0,this.trigger("paginated:destroy")}};k.extend(j.prototype,n,l.Events),b.exports=j},function(b){function d(a){return k.isFunction(a)?a:function(b){return b.get(a)}}function e(a){return this._comparator?this._reverse?n(this._collection.toArray(),a,d(this._comparator)):k.sortedIndex(this._collection.toArray(),a,d(this._comparator)):this._superset.indexOf(a)}function f(a){var b=e.call(this,a);this._collection.add(a,{at:b})}function g(a){this.contains(a)&&this._collection.remove(a)}function h(a){this.contains(a)&&this._collection.indexOf(a)!==e.call(this,a)&&(this._collection.remove(a),f.call(this,a))}function i(){if(!this._comparator)return void this._collection.reset(this._superset.toArray());var a=this._superset.sortBy(this._comparator);this._collection.reset(this._reverse?a.reverse():a)}function j(a){this._superset=a,this._reverse=!1,this._comparator=null,this._collection=new l.Collection(a.toArray()),m(this._collection,this),this.listenTo(this._superset,"add",f),this.listenTo(this._superset,"remove",g),this.listenTo(this._superset,"change",h),this.listenTo(this._superset,"reset",i)}var k=c("underscore"),l=c("backbone"),m=a(1),n=a(6),o={setSort:function(a,b){return this._reverse="desc"===b?!0:!1,this._comparator=a,i.call(this),this.trigger(a?"sorted:add":"sorted:remove"),this},reverseSort:function(){return this._reverse=!this._reverse,i.call(this),this},removeSort:function(){return this.setSort(),this},superset:function(){return this._superset},destroy:function(){this.stopListening(),this._collection.reset([]),this._superset=this._collection,this.length=0,this.trigger("sorted:destroy")}};k.extend(j.prototype,o,l.Events),b.exports=j},function(a){function b(a){return e.isFunction(a)?a:function(b){return b[a]}}function d(a,c,d,f){d=null==d?e.identity:b(d);for(var g=d.call(f,c),h=0,i=a.length;i>h;){var j=h+i>>>1;d.call(f,a[j])<g?i=j:h=j+1}return h}var e=c("underscore");a.exports=d},function(a){function b(a,b){d.each(b,function(b){this.listenTo(a,b,function(){var a=d.toArray(arguments);a.unshift(b),this.trigger.apply(this,a)})},this)}var d=c("underscore");a.exports=b}],a(0)}();return d});var swfobject=function(){function a(){if(!R){try{var a=K.getElementsByTagName("body")[0].appendChild(q("span"));a.parentNode.removeChild(a)}catch(b){return}R=!0;for(var c=N.length,d=0;c>d;d++)N[d]()}}function b(a){R?a():N[N.length]=a}function c(a){if(typeof J.addEventListener!=C)J.addEventListener("load",a,!1);else if(typeof K.addEventListener!=C)K.addEventListener("load",a,!1);else if(typeof J.attachEvent!=C)r(J,"onload",a);else if("function"==typeof J.onload){var b=J.onload;J.onload=function(){b(),a()}}else J.onload=a}function d(){M?e():f()}function e(){var a=K.getElementsByTagName("body")[0],b=q(D);b.setAttribute("type",G);var c=a.appendChild(b);if(c){var d=0;!function(){if(typeof c.GetVariable!=C){var e=c.GetVariable("$version");e&&(e=e.split(" ")[1].split(","),U.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)])}else if(10>d)return d++,void setTimeout(arguments.callee,10);a.removeChild(b),c=null,f()}()}else f()}function f(){var a=O.length;if(a>0)for(var b=0;a>b;b++){var c=O[b].id,d=O[b].callbackFn,e={success:!1,id:c};if(U.pv[0]>0){var f=p(c);if(f)if(!s(O[b].swfVersion)||U.wk&&U.wk<312)if(O[b].expressInstall&&h()){var k={};k.data=O[b].expressInstall,k.width=f.getAttribute("width")||"0",k.height=f.getAttribute("height")||"0",f.getAttribute("class")&&(k.styleclass=f.getAttribute("class")),f.getAttribute("align")&&(k.align=f.getAttribute("align"));for(var l={},m=f.getElementsByTagName("param"),n=m.length,o=0;n>o;o++)"movie"!=m[o].getAttribute("name").toLowerCase()&&(l[m[o].getAttribute("name")]=m[o].getAttribute("value"));i(k,l,c,d)}else j(f),d&&d(e);else u(c,!0),d&&(e.success=!0,e.ref=g(c),d(e))}else if(u(c,!0),d){var q=g(c);q&&typeof q.SetVariable!=C&&(e.success=!0,e.ref=q),d(e)}}}function g(a){var b=null,c=p(a);if(c&&"OBJECT"==c.nodeName)if(typeof c.SetVariable!=C)b=c;else{var d=c.getElementsByTagName(D)[0];d&&(b=d)}return b}function h(){return!S&&s("6.0.65")&&(U.win||U.mac)&&!(U.wk&&U.wk<312)}function i(a,b,c,d){S=!0,y=d||null,z={success:!1,id:c};var e=p(c);if(e){"OBJECT"==e.nodeName?(w=k(e),x=null):(w=e,x=c),a.id=H,(typeof a.width==C||!/%$/.test(a.width)&&parseInt(a.width,10)<310)&&(a.width="310"),(typeof a.height==C||!/%$/.test(a.height)&&parseInt(a.height,10)<137)&&(a.height="137"),K.title=K.title.slice(0,47)+" - Flash Player Installation";var f=U.ie&&U.win?"ActiveX":"PlugIn",g="MMredirectURL="+J.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+K.title;if(typeof b.flashvars!=C?b.flashvars+="&"+g:b.flashvars=g,U.ie&&U.win&&4!=e.readyState){var h=q("div");c+="SWFObjectNew",h.setAttribute("id",c),e.parentNode.insertBefore(h,e),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}l(a,b,c)}}function j(a){if(U.ie&&U.win&&4!=a.readyState){var b=q("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(k(a),b),a.style.display="none",function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}else a.parentNode.replaceChild(k(a),a)}function k(a){var b=q("div");if(U.win&&U.ie)b.innerHTML=a.innerHTML;else{var c=a.getElementsByTagName(D)[0];if(c){var d=c.childNodes;if(d)for(var e=d.length,f=0;e>f;f++)1==d[f].nodeType&&"PARAM"==d[f].nodeName||8==d[f].nodeType||b.appendChild(d[f].cloneNode(!0))}}return b}function l(a,b,c){var d,e=p(c);if(U.wk&&U.wk<312)return d;if(e)if(typeof a.id==C&&(a.id=c),U.ie&&U.win){var f="";for(var g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?f+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(f+=" "+g+'="'+a[g]+'"'));var h="";for(var i in b)b[i]!=Object.prototype[i]&&(h+='<param name="'+i+'" value="'+b[i]+'" />');
e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+h+"</object>",P[P.length]=a.id,d=p(a.id)}else{var j=q(D);j.setAttribute("type",G);for(var k in a)a[k]!=Object.prototype[k]&&("styleclass"==k.toLowerCase()?j.setAttribute("class",a[k]):"classid"!=k.toLowerCase()&&j.setAttribute(k,a[k]));for(var l in b)b[l]!=Object.prototype[l]&&"movie"!=l.toLowerCase()&&m(j,l,b[l]);e.parentNode.replaceChild(j,e),d=j}return d}function m(a,b,c){var d=q("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function n(a){var b=p(a);b&&"OBJECT"==b.nodeName&&(U.ie&&U.win?(b.style.display="none",function(){4==b.readyState?o(a):setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function o(a){var b=p(a);if(b){for(var c in b)"function"==typeof b[c]&&(b[c]=null);b.parentNode.removeChild(b)}}function p(a){var b=null;try{b=K.getElementById(a)}catch(c){}return b}function q(a){return K.createElement(a)}function r(a,b,c){a.attachEvent(b,c),Q[Q.length]=[a,b,c]}function s(a){var b=U.pv,c=a.split(".");return c[0]=parseInt(c[0],10),c[1]=parseInt(c[1],10)||0,c[2]=parseInt(c[2],10)||0,b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function t(a,b,c,d){if(!U.ie||!U.mac){var e=K.getElementsByTagName("head")[0];if(e){var f=c&&"string"==typeof c?c:"screen";if(d&&(A=null,B=null),!A||B!=f){var g=q("style");g.setAttribute("type","text/css"),g.setAttribute("media",f),A=e.appendChild(g),U.ie&&U.win&&typeof K.styleSheets!=C&&K.styleSheets.length>0&&(A=K.styleSheets[K.styleSheets.length-1]),B=f}U.ie&&U.win?A&&typeof A.addRule==D&&A.addRule(a,b):A&&typeof K.createTextNode!=C&&A.appendChild(K.createTextNode(a+" {"+b+"}"))}}}function u(a,b){if(T){var c=b?"visible":"hidden";R&&p(a)?p(a).style.visibility=c:t("#"+a,"visibility:"+c)}}function v(a){var b=/[\\\"<>\.;]/,c=null!=b.exec(a);return c&&typeof encodeURIComponent!=C?encodeURIComponent(a):a}{var w,x,y,z,A,B,C="undefined",D="object",E="Shockwave Flash",F="ShockwaveFlash.ShockwaveFlash",G="application/x-shockwave-flash",H="SWFObjectExprInst",I="onreadystatechange",J=window,K=document,L=navigator,M=!1,N=[d],O=[],P=[],Q=[],R=!1,S=!1,T=!0,U=function(){var a=typeof K.getElementById!=C&&typeof K.getElementsByTagName!=C&&typeof K.createElement!=C,b=L.userAgent.toLowerCase(),c=L.platform.toLowerCase(),d=/win/.test(c?c:b),e=/mac/.test(c?c:b),f=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,g=!1,h=[0,0,0],i=null;if(typeof L.plugins!=C&&typeof L.plugins[E]==D)i=L.plugins[E].description,!i||typeof L.mimeTypes!=C&&L.mimeTypes[G]&&!L.mimeTypes[G].enabledPlugin||(M=!0,g=!1,i=i.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),h[0]=parseInt(i.replace(/^(.*)\..*$/,"$1"),10),h[1]=parseInt(i.replace(/^.*\.(.*)\s.*$/,"$1"),10),h[2]=/[a-zA-Z]/.test(i)?parseInt(i.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof J.ActiveXObject!=C)try{var j=new ActiveXObject(F);j&&(i=j.GetVariable("$version"),i&&(g=!0,i=i.split(" ")[1].split(","),h=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]))}catch(k){}return{w3:a,pv:h,wk:f,ie:g,win:d,mac:e}}();!function(){U.w3&&((typeof K.readyState!=C&&"complete"==K.readyState||typeof K.readyState==C&&(K.getElementsByTagName("body")[0]||K.body))&&a(),R||(typeof K.addEventListener!=C&&K.addEventListener("DOMContentLoaded",a,!1),U.ie&&U.win&&(K.attachEvent(I,function(){"complete"==K.readyState&&(K.detachEvent(I,arguments.callee),a())}),J==top&&!function(){if(!R){try{K.documentElement.doScroll("left")}catch(b){return void setTimeout(arguments.callee,0)}a()}}()),U.wk&&!function(){return R?void 0:/loaded|complete/.test(K.readyState)?void a():void setTimeout(arguments.callee,0)}(),c(a)))}(),function(){U.ie&&U.win&&window.attachEvent("onunload",function(){for(var a=Q.length,b=0;a>b;b++)Q[b][0].detachEvent(Q[b][1],Q[b][2]);for(var c=P.length,d=0;c>d;d++)n(P[d]);for(var e in U)U[e]=null;U=null;for(var f in swfobject)swfobject[f]=null;swfobject=null})}()}return{registerObject:function(a,b,c,d){if(U.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,O[O.length]=e,u(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){return U.w3?g(a):void 0},embedSWF:function(a,c,d,e,f,g,j,k,m,n){var o={success:!1,id:c};U.w3&&!(U.wk&&U.wk<312)&&a&&c&&d&&e&&f?(u(c,!1),b(function(){d+="",e+="";var b={};if(m&&typeof m===D)for(var p in m)b[p]=m[p];b.data=a,b.width=d,b.height=e;var q={};if(k&&typeof k===D)for(var r in k)q[r]=k[r];if(j&&typeof j===D)for(var t in j)typeof q.flashvars!=C?q.flashvars+="&"+t+"="+j[t]:q.flashvars=t+"="+j[t];if(s(f)){var v=l(b,q,c);b.id==c&&u(c,!0),o.success=!0,o.ref=v}else{if(g&&h())return b.data=g,void i(b,q,c,n);u(c,!0)}n&&n(o)})):n&&n(o)},switchOffAutoHideShow:function(){T=!1},ua:U,getFlashPlayerVersion:function(){return{major:U.pv[0],minor:U.pv[1],release:U.pv[2]}},hasFlashPlayerVersion:s,createSWF:function(a,b,c){return U.w3?l(a,b,c):void 0},showExpressInstall:function(a,b,c,d){U.w3&&h()&&i(a,b,c,d)},removeSWF:function(a){U.w3&&n(a)},createCSS:function(a,b,c,d){U.w3&&t(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=K.location.search||K.location.hash;if(b){if(/\?/.test(b)&&(b=b.split("?")[1]),null==a)return v(b);for(var c=b.split("&"),d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return v(c[d].substring(c[d].indexOf("=")+1))}return""},expressInstallCallback:function(){if(S){var a=p(H);a&&w&&(a.parentNode.replaceChild(w,a),x&&(u(x,!0),U.ie&&U.win&&(w.style.display="block")),y&&y(z)),S=!1}}}}();!function(a,b,c,d,e,f){function g(a,b){var c=typeof a[b];return"function"==c||!("object"!=c||!a[b])||"unknown"==c}function h(a,b){return!("object"!=typeof a[b]||!a[b])}function i(a){return"[object Array]"===Object.prototype.toString.call(a)}function j(){var a="Shockwave Flash",b="application/x-shockwave-flash";if(!t(navigator.plugins)&&"object"==typeof navigator.plugins[a]){var c=navigator.plugins[a].description;c&&!t(navigator.mimeTypes)&&navigator.mimeTypes[b]&&navigator.mimeTypes[b].enabledPlugin&&(C=c.match(/\d+/g))}if(!C){var d;try{d=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),C=Array.prototype.slice.call(d.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),d=null}catch(e){}}if(!C)return!1;var f=parseInt(C[0],10),g=parseInt(C[1],10);return D=f>9&&g>0,!0}function k(){if(!S){S=!0;for(var a=0;a<T.length;a++)T[a]();T.length=0}}function l(a,b){return S?void a.call(b):void T.push(function(){a.call(b)})}function m(){var a=parent;if(""!==M)for(var b=0,c=M.split(".");b<c.length;b++)a=a[c[b]];return a.easyXDM}function n(b){return a.easyXDM=O,M=b,M&&(P="easyXDM_"+M.replace(".","_")+"_"),N}function o(a){return a.match(J)[3]}function p(a){return a.match(J)[4]||""}function q(a){var b=a.toLowerCase().match(J),c=b[2],d=b[3],e=b[4]||"";return("http:"==c&&":80"==e||"https:"==c&&":443"==e)&&(e=""),c+"//"+d+e}function r(a){if(a=a.replace(L,"$1/"),!a.match(/^(http||https):\/\//)){var b="/"===a.substring(0,1)?"":c.pathname;"/"!==b.substring(b.length-1)&&(b=b.substring(0,b.lastIndexOf("/")+1)),a=c.protocol+"//"+c.host+b+a}for(;K.test(a);)a=a.replace(K,"");return a}function s(a,b){var c="",d=a.indexOf("#");-1!==d&&(c=a.substring(d),a=a.substring(0,d));var e=[];for(var g in b)b.hasOwnProperty(g)&&e.push(g+"="+f(b[g]));return a+(Q?"#":-1==a.indexOf("?")?"?":"&")+e.join("&")+c}function t(a){return"undefined"==typeof a}function u(a,b,c){var d;for(var e in b)b.hasOwnProperty(e)&&(e in a?(d=b[e],"object"==typeof d?u(a[e],d,c):c||(a[e]=b[e])):a[e]=b[e]);return a}function v(){var a=b.body.appendChild(b.createElement("form")),c=a.appendChild(b.createElement("input"));c.name=P+"TEST"+H,B=c!==a.elements[c.name],b.body.removeChild(a)}function w(a){t(B)&&v();var c;B?c=b.createElement('<iframe name="'+a.props.name+'"/>'):(c=b.createElement("IFRAME"),c.name=a.props.name),c.id=c.name=a.props.name,delete a.props.name,"string"==typeof a.container&&(a.container=b.getElementById(a.container)),a.container||(u(c.style,{position:"absolute",top:"-2000px",left:"0px"}),a.container=b.body);var d=a.props.src;if(a.props.src="javascript:false",u(c,a.props),c.border=c.frameBorder=0,c.allowTransparency=!0,a.container.appendChild(c),a.onLoad&&E(c,"load",a.onLoad),a.usePost){var e,f=a.container.appendChild(b.createElement("form"));if(f.target=c.name,f.action=d,f.method="POST","object"==typeof a.usePost)for(var g in a.usePost)a.usePost.hasOwnProperty(g)&&(B?e=b.createElement('<input name="'+g+'"/>'):(e=b.createElement("INPUT"),e.name=g),e.value=a.usePost[g],f.appendChild(e));f.submit(),f.parentNode.removeChild(f)}else c.src=d;return a.props.src=d,c}function x(a,b){"string"==typeof a&&(a=[a]);for(var c,d=a.length;d--;)if(c=a[d],c=new RegExp("^"==c.substr(0,1)?c:"^"+c.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),c.test(b))return!0;return!1}function y(d){var e,f=d.protocol;if(d.isHost=d.isHost||t(V.xdm_p),Q=d.hash||!1,d.props||(d.props={}),d.isHost)d.remote=r(d.remote),d.channel=d.channel||"default"+H++,d.secret=Math.random().toString(16).substring(2),t(f)&&(f=q(c.href)==q(d.remote)?"4":g(a,"postMessage")||g(b,"postMessage")?"1":d.swf&&g(a,"ActiveXObject")&&j()?"6":"Gecko"===navigator.product&&"frameElement"in a&&-1==navigator.userAgent.indexOf("WebKit")?"5":d.remoteHelper?"2":"0");else if(d.channel=V.xdm_c.replace(/["'<>\\]/g,""),d.secret=V.xdm_s,d.remote=V.xdm_e.replace(/["'<>\\]/g,""),f=V.xdm_p,d.acl&&!x(d.acl,d.remote))throw new Error("Access denied for "+d.remote);switch(d.protocol=f,f){case"0":if(u(d,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),d.isHost){if(!d.local){for(var h,i=c.protocol+"//"+c.host,k=b.body.getElementsByTagName("img"),l=k.length;l--;)if(h=k[l],h.src.substring(0,i.length)===i){d.local=h.src;break}d.local||(d.local=a)}var m={xdm_c:d.channel,xdm_p:0};d.local===a?(d.usePolling=!0,d.useParent=!0,d.local=c.protocol+"//"+c.host+c.pathname+c.search,m.xdm_e=d.local,m.xdm_pa=1):m.xdm_e=r(d.local),d.container&&(d.useResize=!1,m.xdm_po=1),d.remote=s(d.remote,m)}else u(d,{channel:V.xdm_c,remote:V.xdm_e,useParent:!t(V.xdm_pa),usePolling:!t(V.xdm_po),useResize:d.useParent?!1:d.useResize});e=[new N.stack.HashTransport(d),new N.stack.ReliableBehavior({}),new N.stack.QueueBehavior({encode:!0,maxLength:4e3-d.remote.length}),new N.stack.VerifyBehavior({initiate:d.isHost})];break;case"1":e=[new N.stack.PostMessageTransport(d)];break;case"2":d.isHost&&(d.remoteHelper=r(d.remoteHelper)),e=[new N.stack.NameTransport(d),new N.stack.QueueBehavior,new N.stack.VerifyBehavior({initiate:d.isHost})];break;case"3":e=[new N.stack.NixTransport(d)];break;case"4":e=[new N.stack.SameOriginTransport(d)];break;case"5":e=[new N.stack.FrameElementTransport(d)];break;case"6":C||j(),e=[new N.stack.FlashTransport(d)]}return e.push(new N.stack.QueueBehavior({lazy:d.lazy,remove:!0})),e}function z(a){for(var b,c={incoming:function(a,b){this.up.incoming(a,b)},outgoing:function(a,b){this.down.outgoing(a,b)},callback:function(a){this.up.callback(a)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},d=0,e=a.length;e>d;d++)b=a[d],u(b,c,!0),0!==d&&(b.down=a[d-1]),d!==e-1&&(b.up=a[d+1]);return b}function A(a){a.up.down=a.down,a.down.up=a.up,a.up=a.down=null}var B,C,D,E,F,G=this,H=Math.floor(1e4*Math.random()),I=Function.prototype,J=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,K=/[\-\w]+\/\.\.\//,L=/([^:])\/\//g,M="",N={},O=a.easyXDM,P="easyXDM_",Q=!1;if(g(a,"addEventListener"))E=function(a,b,c){a.addEventListener(b,c,!1)},F=function(a,b,c){a.removeEventListener(b,c,!1)};else{if(!g(a,"attachEvent"))throw new Error("Browser not supported");E=function(a,b,c){a.attachEvent("on"+b,c)},F=function(a,b,c){a.detachEvent("on"+b,c)}}var R,S=!1,T=[];if("readyState"in b?(R=b.readyState,S="complete"==R||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==R||"interactive"==R)):S=!!b.body,!S){if(g(a,"addEventListener"))E(b,"DOMContentLoaded",k);else if(E(b,"readystatechange",function(){"complete"==b.readyState&&k()}),b.documentElement.doScroll&&a===top){var U=function(){if(!S){try{b.documentElement.doScroll("left")}catch(a){return void d(U,1)}k()}};U()}E(a,"load",k)}var V=function(a){a=a.substring(1).split("&");for(var b,c={},d=a.length;d--;)b=a[d].split("="),c[b[0]]=e(b[1]);return c}(/xdm_e=/.test(c.search)?c.search:c.hash),W=function(){var a={},b={a:[1,2,3]},c='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(b).replace(/\s/g,"")===c?JSON:(Object.toJSON&&Object.toJSON(b).replace(/\s/g,"")===c&&(a.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(b=c.evalJSON(),b.a&&3===b.a.length&&3===b.a[2]&&(a.parse=function(a){return a.evalJSON()})),a.stringify&&a.parse?(W=function(){return a},a):null)};u(N,{version:"2.4.19.3",query:V,stack:{},apply:u,getJSONObject:W,whenReady:l,noConflict:n}),N.DomHelper={on:E,un:F,requiresJSON:function(c){h(a,"JSON")||b.write('<script type="text/javascript" src="'+c+'"></script>')}},function(){var a={};N.Fn={set:function(b,c){a[b]=c},get:function(b,c){if(a.hasOwnProperty(b)){var d=a[b];return c&&delete a[b],d}}}}(),N.Socket=function(a){var b=z(y(a).concat([{incoming:function(b,c){a.onMessage(b,c)},callback:function(b){a.onReady&&a.onReady(b)}}])),c=q(a.remote);this.origin=q(a.remote),this.destroy=function(){b.destroy()},this.postMessage=function(a){b.outgoing(a,c)},b.init()},N.Rpc=function(a,b){if(b.local)for(var c in b.local)if(b.local.hasOwnProperty(c)){var d=b.local[c];"function"==typeof d&&(b.local[c]={method:d})}var e=z(y(a).concat([new N.stack.RpcBehavior(this,b),{callback:function(b){a.onReady&&a.onReady(b)}}]));this.origin=q(a.remote),this.destroy=function(){e.destroy()},e.init()},N.stack.SameOriginTransport=function(a){var b,e,f,g;return b={outgoing:function(a,b,c){f(a),c&&c()},destroy:function(){e&&(e.parentNode.removeChild(e),e=null)},onDOMReady:function(){g=q(a.remote),a.isHost?(u(a.props,{src:s(a.remote,{xdm_e:c.protocol+"//"+c.host+c.pathname,xdm_c:a.channel,xdm_p:4}),name:P+a.channel+"_provider"}),e=w(a),N.Fn.set(a.channel,function(a){return f=a,d(function(){b.up.callback(!0)},0),function(a){b.up.incoming(a,g)}})):(f=m().Fn.get(a.channel,!0)(function(a){b.up.incoming(a,g)}),d(function(){b.up.callback(!0)},0))},init:function(){l(b.onDOMReady,b)}}},N.stack.FlashTransport=function(a){function e(a){d(function(){h.up.incoming(a,j)},0)}function g(c){var d=a.swf+"?host="+a.isHost,e="easyXDM_swf_"+Math.floor(1e4*Math.random());N.Fn.set("flash_loaded"+c.replace(/[\-.]/g,"_"),function(){N.stack.FlashTransport[c].swf=k=m.firstChild;for(var a=N.stack.FlashTransport[c].queue,b=0;b<a.length;b++)a[b]();a.length=0}),a.swfContainer?m="string"==typeof a.swfContainer?b.getElementById(a.swfContainer):a.swfContainer:(m=b.createElement("div"),u(m.style,D&&a.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),b.body.appendChild(m));var g="callback=flash_loaded"+f(c.replace(/[\-.]/g,"_"))+"&proto="+G.location.protocol+"&domain="+f(o(G.location.href))+"&port="+f(p(G.location.href))+"&ns="+f(M);m.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+e+"' data='"+d+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+d+"'></param><param name='flashvars' value='"+g+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+g+"' allowScriptAccess='always' wmode='transparent' src='"+d+"' height='1' width='1'></embed></object>"}var h,i,j,k,m;return h={outgoing:function(b,c,d){k.postMessage(a.channel,b.toString()),d&&d()},destroy:function(){try{k.destroyChannel(a.channel)}catch(b){}k=null,i&&(i.parentNode.removeChild(i),i=null)},onDOMReady:function(){j=a.remote,N.Fn.set("flash_"+a.channel+"_init",function(){d(function(){h.up.callback(!0)})}),N.Fn.set("flash_"+a.channel+"_onMessage",e),a.swf=r(a.swf);var b=o(a.swf),f=function(){N.stack.FlashTransport[b].init=!0,k=N.stack.FlashTransport[b].swf,k.createChannel(a.channel,a.secret,q(a.remote),a.isHost),a.isHost&&(D&&a.swfNoThrottle&&u(a.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),u(a.props,{src:s(a.remote,{xdm_e:q(c.href),xdm_c:a.channel,xdm_p:6,xdm_s:a.secret}),name:P+a.channel+"_provider"}),i=w(a))};N.stack.FlashTransport[b]&&N.stack.FlashTransport[b].init?f():N.stack.FlashTransport[b]?N.stack.FlashTransport[b].queue.push(f):(N.stack.FlashTransport[b]={queue:[f]},g(b))},init:function(){l(h.onDOMReady,h)}}},N.stack.PostMessageTransport=function(b){function e(a){if(a.origin)return q(a.origin);if(a.uri)return q(a.uri);if(a.domain)return c.protocol+"//"+a.domain;throw"Unable to retrieve the origin of the event"}function f(a){var c=e(a);c==j&&a.data.substring(0,b.channel.length+1)==b.channel+" "&&g.up.incoming(a.data.substring(b.channel.length+1),c)}var g,h,i,j;return g={outgoing:function(a,c,d){i.postMessage(b.channel+" "+a,c||j),d&&d()},destroy:function(){F(a,"message",f),h&&(i=null,h.parentNode.removeChild(h),h=null)},onDOMReady:function(){if(j=q(b.remote),b.isHost){var e=function(c){c.data==b.channel+"-ready"&&(i="postMessage"in h.contentWindow?h.contentWindow:h.contentWindow.document,F(a,"message",e),E(a,"message",f),d(function(){g.up.callback(!0)},0))};E(a,"message",e),u(b.props,{src:s(b.remote,{xdm_e:q(c.href),xdm_c:b.channel,xdm_p:1}),name:P+b.channel+"_provider"}),h=w(b)}else E(a,"message",f),i="postMessage"in a.parent?a.parent:a.parent.document,i.postMessage(b.channel+"-ready",j),d(function(){g.up.callback(!0)},0)},init:function(){l(g.onDOMReady,g)}}},N.stack.FrameElementTransport=function(e){var f,g,h,i;return f={outgoing:function(a,b,c){h.call(this,a),c&&c()},destroy:function(){g&&(g.parentNode.removeChild(g),g=null)},onDOMReady:function(){i=q(e.remote),e.isHost?(u(e.props,{src:s(e.remote,{xdm_e:q(c.href),xdm_c:e.channel,xdm_p:5}),name:P+e.channel+"_provider"}),g=w(e),g.fn=function(a){return delete g.fn,h=a,d(function(){f.up.callback(!0)},0),function(a){f.up.incoming(a,i)}}):(b.referrer&&q(b.referrer)!=V.xdm_e&&(a.top.location=V.xdm_e),h=a.frameElement.fn(function(a){f.up.incoming(a,i)}),f.up.callback(!0))},init:function(){l(f.onDOMReady,f)}}},N.stack.NameTransport=function(a){function b(b){var c=a.remoteHelper+(h?"#_3":"#_2")+a.channel;i.contentWindow.sendMessage(b,c)}function c(){h?2!==++k&&h||g.up.callback(!0):(b("ready"),g.up.callback(!0))}function e(a){g.up.incoming(a,n)}function f(){m&&d(function(){m(!0)},0)}var g,h,i,j,k,m,n,o;return g={outgoing:function(a,c,d){m=d,b(a)},destroy:function(){i.parentNode.removeChild(i),i=null,h&&(j.parentNode.removeChild(j),j=null)},onDOMReady:function(){h=a.isHost,k=0,n=q(a.remote),a.local=r(a.local),h?(N.Fn.set(a.channel,function(b){h&&"ready"===b&&(N.Fn.set(a.channel,e),c())}),o=s(a.remote,{xdm_e:a.local,xdm_c:a.channel,xdm_p:2}),u(a.props,{src:o+"#"+a.channel,name:P+a.channel+"_provider"}),j=w(a)):(a.remoteHelper=a.remote,N.Fn.set(a.channel,e));var b=function(){var e=i||this;F(e,"load",b),N.Fn.set(a.channel+"_load",f),function g(){"function"==typeof e.contentWindow.sendMessage?c():d(g,50)}()};i=w({props:{src:a.local+"#_4"+a.channel},onLoad:b})},init:function(){l(g.onDOMReady,g)}}},N.stack.HashTransport=function(b){function c(a){if(p){var c=b.remote+"#"+n++ +"_"+a;(i||!r?p.contentWindow:p).location=c}}function e(a){m=a,h.up.incoming(m.substring(m.indexOf("_")+1),s)}function f(){if(o){var a=o.location.href,b="",c=a.indexOf("#");-1!=c&&(b=a.substring(c)),b&&b!=m&&e(b)}}function g(){j=setInterval(f,k)}var h,i,j,k,m,n,o,p,r,s;return h={outgoing:function(a){c(a)},destroy:function(){a.clearInterval(j),(i||!r)&&p.parentNode.removeChild(p),p=null},onDOMReady:function(){if(i=b.isHost,k=b.interval,m="#"+b.channel,n=0,r=b.useParent,s=q(b.remote),i){if(u(b.props,{src:b.remote,name:P+b.channel+"_provider"}),r)b.onLoad=function(){o=a,g(),h.up.callback(!0)};else{var c=0,e=b.delay/50;!function f(){if(++c>e)throw new Error("Unable to reference listenerwindow");try{o=p.contentWindow.frames[P+b.channel+"_consumer"]}catch(a){}o?(g(),h.up.callback(!0)):d(f,50)}()}p=w(b)}else o=a,g(),r?(p=parent,h.up.callback(!0)):(u(b,{props:{src:b.remote+"#"+b.channel+new Date,name:P+b.channel+"_consumer"},onLoad:function(){h.up.callback(!0)}}),p=w(b))},init:function(){l(h.onDOMReady,h)}}},N.stack.ReliableBehavior=function(){var a,b,c=0,d=0,e="";return a={incoming:function(f,g){var h=f.indexOf("_"),i=f.substring(0,h).split(",");f=f.substring(h+1),i[0]==c&&(e="",b&&b(!0)),f.length>0&&(a.down.outgoing(i[1]+","+c+"_"+e,g),d!=i[1]&&(d=i[1],a.up.incoming(f,g)))},outgoing:function(f,g,h){e=f,b=h,a.down.outgoing(d+","+ ++c+"_"+f,g)}}},N.stack.QueueBehavior=function(a){function b(){if(a.remove&&0===h.length)return void A(c);if(!i&&0!==h.length&&!g){i=!0;var e=h.shift();c.down.outgoing(e.data,e.origin,function(a){i=!1,e.callback&&d(function(){e.callback(a)},0),b()})}}var c,g,h=[],i=!0,j="",k=0,l=!1,m=!1;return c={init:function(){t(a)&&(a={}),a.maxLength&&(k=a.maxLength,m=!0),a.lazy?l=!0:c.down.init()},callback:function(a){i=!1;var d=c.up;b(),d.callback(a)},incoming:function(b,d){if(m){var f=b.indexOf("_"),g=parseInt(b.substring(0,f),10);j+=b.substring(f+1),0===g&&(a.encode&&(j=e(j)),c.up.incoming(j,d),j="")}else c.up.incoming(b,d)},outgoing:function(d,e,g){a.encode&&(d=f(d));var i,j=[];if(m){for(;0!==d.length;)i=d.substring(0,k),d=d.substring(i.length),j.push(i);for(;i=j.shift();)h.push({data:j.length+"_"+i,origin:e,callback:0===j.length?g:null})}else h.push({data:d,origin:e,callback:g});l?c.down.init():b()},destroy:function(){g=!0,c.down.destroy()}}},N.stack.VerifyBehavior=function(a){function b(){d=Math.random().toString(16).substring(2),c.down.outgoing(d)}var c,d,e;return c={incoming:function(f,g){var h=f.indexOf("_");-1===h?f===d?c.up.callback(!0):e||(e=f,a.initiate||b(),c.down.outgoing(f)):f.substring(0,h)===e&&c.up.incoming(f.substring(h+1),g)},outgoing:function(a,b,e){c.down.outgoing(d+"_"+a,b,e)},callback:function(){a.initiate&&b()}}},N.stack.RpcBehavior=function(a,b){function c(a){a.jsonrpc="2.0",f.down.outgoing(g.stringify(a))}function d(a,b){var d=Array.prototype.slice;return function(){var e,f=arguments.length,g={method:b};f>0&&"function"==typeof arguments[f-1]?(f>1&&"function"==typeof arguments[f-2]?(e={success:arguments[f-2],error:arguments[f-1]},g.params=d.call(arguments,0,f-2)):(e={success:arguments[f-1]},g.params=d.call(arguments,0,f-1)),j[""+ ++h]=e,g.id=h):g.params=d.call(arguments,0),a.namedParams&&1===g.params.length&&(g.params=g.params[0]),c(g)}}function e(a,b,d,e){if(!d)return void(b&&c({id:b,error:{code:-32601,message:"Procedure not found."}}));var f,g;b?(f=function(a){f=I,c({id:b,result:a})},g=function(a,d){g=I;var e={id:b,error:{code:-32099,message:a}};d&&(e.error.data=d),c(e)}):f=g=I,i(e)||(e=[e]);try{var h=d.method.apply(d.scope,e.concat([f,g]));t(h)||f(h)}catch(j){g(j.message)}}var f,g=b.serializer||W(),h=0,j={};return f={incoming:function(a){var d=g.parse(a);if(d.method)b.handle?b.handle(d,c):e(d.method,d.id,b.local[d.method],d.params);else{var f=j[d.id];d.error?f.error&&f.error(d.error):f.success&&f.success(d.result),delete j[d.id]}},init:function(){if(b.remote)for(var c in b.remote)b.remote.hasOwnProperty(c)&&(a[c]=d(b.remote[c],c));f.down.init()},destroy:function(){for(var c in b.remote)b.remote.hasOwnProperty(c)&&a.hasOwnProperty(c)&&delete a[c];f.down.destroy()}}},G.easyXDM=N}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent),function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=k.substring(0,k.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return m[e]||(n.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",n.cssRules.length),m[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<l.length;d++)if(c=l[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a){for(var b={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}function h(a,b){return"string"==typeof a?a:a[b%a.length]}function i(a){return"undefined"==typeof this?new i(a):void(this.opts=f(a||{},i.defaults,o))}function j(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}n.addRule(".spin-vml","behavior:url(#default#VML)"),i.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function g(a,g,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~g}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:h(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)g(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)g(i);return b(a,m)},i.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var k,l=["webkit","Moz","ms","O"],m={},n=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),o={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};i.defaults={},f(i.prototype,{spin:function(b){this.stop();var c,d,f=this,h=f.opts,i=f.el=e(a(0,{className:h.className}),{position:h.position,width:0,zIndex:h.zIndex}),j=h.radius+h.length+h.width;if(b&&(b.insertBefore(i,b.firstChild||null),d=g(b),c=g(i),e(i,{left:("auto"==h.left?d.x-c.x+(b.offsetWidth>>1):parseInt(h.left,10)+j)+"px",top:("auto"==h.top?d.y-c.y+(b.offsetHeight>>1):parseInt(h.top,10)+j)+"px"})),i.setAttribute("role","progressbar"),f.lines(i,f.opts),!k){var l,m=0,n=(h.lines-1)*(1-h.direction)/2,o=h.fps,p=o/h.speed,q=(1-h.opacity)/(p*h.trail/100),r=p/h.lines;!function s(){m++;for(var a=0;a<h.lines;a++)l=Math.max(1-(m+(h.lines-a)*r)%p*q,h.opacity),f.opacity(i,a*h.direction+n,l,h);f.timeout=f.el&&setTimeout(s,~~(1e3/o))}()}return f},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function g(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*j+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,j=0,l=(f.lines-1)*(1-f.direction)/2;j<f.lines;j++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:k&&c(f.opacity,f.trail,l+j*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(g("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,g(h(f.color,j),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var p=e(a("group"),{behavior:"url(#default#VML)"});return!d(p,"transform")&&p.adj?j():k=d(p,"animation"),i}),function(a){if("object"==typeof exports)a(require("jquery"),require("spin"));else if("function"==typeof define&&define.amd)define(["jquery","spin"],a);else{if(!window.Spinner)throw new Error("Spin.js not present");a(window.jQuery,window.Spinner)}}(function(a,b){a.fn.spin=function(c,d){return this.each(function(){var e=a(this),f=e.data();f.spinner&&(f.spinner.stop(),delete f.spinner),c!==!1&&(c=a.extend({color:d||e.css("color")},a.fn.spin.presets[c]||c),f.spinner=new b(c).spin(this))})},a.fn.spin.presets={tiny:{lines:8,length:2,width:2,radius:3},small:{lines:8,length:4,width:3,radius:5},large:{lines:10,length:8,width:4,radius:8}}});var Base64=function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b={encode:function(b){var c,d,e,f,g,h,i,j="",k=0;do c=b.charCodeAt(k++),d=b.charCodeAt(k++),e=b.charCodeAt(k++),f=c>>2,g=(3&c)<<4|d>>4,h=(15&d)<<2|e>>6,i=63&e,isNaN(d)?h=i=64:isNaN(e)&&(i=64),j=j+a.charAt(f)+a.charAt(g)+a.charAt(h)+a.charAt(i);while(k<b.length);return j},decode:function(b){var c,d,e,f,g,h,i,j="",k=0;b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");do f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),h=a.indexOf(b.charAt(k++)),i=a.indexOf(b.charAt(k++)),c=f<<2|g>>4,d=(15&g)<<4|h>>2,e=(3&h)<<6|i,j+=String.fromCharCode(c),64!=h&&(j+=String.fromCharCode(d)),64!=i&&(j+=String.fromCharCode(e));while(k<b.length);return j}};return b}(),MD5=function(){var a=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c},b=function(a,b){return a<<b|a>>>32-b},c=function(a){for(var b=[],c=0;c<8*a.length;c+=8)b[c>>5]|=(255&a.charCodeAt(c/8))<<c%32;return b},d=function(a){for(var b="",c=0;c<32*a.length;c+=8)b+=String.fromCharCode(a[c>>5]>>>c%32&255);return b},e=function(a){for(var b="0123456789abcdef",c="",d=0;d<4*a.length;d++)c+=b.charAt(a[d>>2]>>d%4*8+4&15)+b.charAt(a[d>>2]>>d%4*8&15);return c},f=function(c,d,e,f,g,h){return a(b(a(a(d,c),a(f,h)),g),e)},g=function(a,b,c,d,e,g,h){return f(b&c|~b&d,a,b,e,g,h)},h=function(a,b,c,d,e,g,h){return f(b&d|c&~d,a,b,e,g,h)},i=function(a,b,c,d,e,g,h){return f(b^c^d,a,b,e,g,h)},j=function(a,b,c,d,e,g,h){return f(c^(b|~d),a,b,e,g,h)},k=function(b,c){b[c>>5]|=128<<c%32,b[(c+64>>>9<<4)+14]=c;for(var d,e,f,k,l=1732584193,m=-271733879,n=-1732584194,o=271733878,p=0;p<b.length;p+=16)d=l,e=m,f=n,k=o,l=g(l,m,n,o,b[p+0],7,-680876936),o=g(o,l,m,n,b[p+1],12,-389564586),n=g(n,o,l,m,b[p+2],17,606105819),m=g(m,n,o,l,b[p+3],22,-1044525330),l=g(l,m,n,o,b[p+4],7,-176418897),o=g(o,l,m,n,b[p+5],12,1200080426),n=g(n,o,l,m,b[p+6],17,-1473231341),m=g(m,n,o,l,b[p+7],22,-45705983),l=g(l,m,n,o,b[p+8],7,1770035416),o=g(o,l,m,n,b[p+9],12,-1958414417),n=g(n,o,l,m,b[p+10],17,-42063),m=g(m,n,o,l,b[p+11],22,-1990404162),l=g(l,m,n,o,b[p+12],7,1804603682),o=g(o,l,m,n,b[p+13],12,-40341101),n=g(n,o,l,m,b[p+14],17,-1502002290),m=g(m,n,o,l,b[p+15],22,1236535329),l=h(l,m,n,o,b[p+1],5,-165796510),o=h(o,l,m,n,b[p+6],9,-1069501632),n=h(n,o,l,m,b[p+11],14,643717713),m=h(m,n,o,l,b[p+0],20,-373897302),l=h(l,m,n,o,b[p+5],5,-701558691),o=h(o,l,m,n,b[p+10],9,38016083),n=h(n,o,l,m,b[p+15],14,-660478335),m=h(m,n,o,l,b[p+4],20,-405537848),l=h(l,m,n,o,b[p+9],5,568446438),o=h(o,l,m,n,b[p+14],9,-1019803690),n=h(n,o,l,m,b[p+3],14,-187363961),m=h(m,n,o,l,b[p+8],20,1163531501),l=h(l,m,n,o,b[p+13],5,-1444681467),o=h(o,l,m,n,b[p+2],9,-51403784),n=h(n,o,l,m,b[p+7],14,1735328473),m=h(m,n,o,l,b[p+12],20,-1926607734),l=i(l,m,n,o,b[p+5],4,-378558),o=i(o,l,m,n,b[p+8],11,-2022574463),n=i(n,o,l,m,b[p+11],16,1839030562),m=i(m,n,o,l,b[p+14],23,-35309556),l=i(l,m,n,o,b[p+1],4,-1530992060),o=i(o,l,m,n,b[p+4],11,1272893353),n=i(n,o,l,m,b[p+7],16,-155497632),m=i(m,n,o,l,b[p+10],23,-1094730640),l=i(l,m,n,o,b[p+13],4,681279174),o=i(o,l,m,n,b[p+0],11,-358537222),n=i(n,o,l,m,b[p+3],16,-722521979),m=i(m,n,o,l,b[p+6],23,76029189),l=i(l,m,n,o,b[p+9],4,-640364487),o=i(o,l,m,n,b[p+12],11,-421815835),n=i(n,o,l,m,b[p+15],16,530742520),m=i(m,n,o,l,b[p+2],23,-995338651),l=j(l,m,n,o,b[p+0],6,-198630844),o=j(o,l,m,n,b[p+7],10,1126891415),n=j(n,o,l,m,b[p+14],15,-1416354905),m=j(m,n,o,l,b[p+5],21,-57434055),l=j(l,m,n,o,b[p+12],6,1700485571),o=j(o,l,m,n,b[p+3],10,-1894986606),n=j(n,o,l,m,b[p+10],15,-1051523),m=j(m,n,o,l,b[p+1],21,-2054922799),l=j(l,m,n,o,b[p+8],6,1873313359),o=j(o,l,m,n,b[p+15],10,-30611744),n=j(n,o,l,m,b[p+6],15,-1560198380),m=j(m,n,o,l,b[p+13],21,1309151649),l=j(l,m,n,o,b[p+4],6,-145523070),o=j(o,l,m,n,b[p+11],10,-1120210379),n=j(n,o,l,m,b[p+2],15,718787259),m=j(m,n,o,l,b[p+9],21,-343485551),l=a(l,d),m=a(m,e),n=a(n,f),o=a(o,k);
return[l,m,n,o]},l={hexdigest:function(a){return e(k(c(a),8*a.length))},hash:function(a){return d(k(c(a),8*a.length))}};return l}();Function.prototype.bind||(Function.prototype.bind=function(a){var b=this,c=Array.prototype.slice,d=Array.prototype.concat,e=c.call(arguments,1);return function(){return b.apply(a?a:this,d.call(e,c.call(arguments,0)))}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b);b>c;c++)if(c in this&&this[c]===a)return c;return-1}),function(a){function b(a,b){return new f.Builder(a,b)}function c(a){return new f.Builder("message",a)}function d(a){return new f.Builder("iq",a)}function e(a){return new f.Builder("presence",a)}var f;f={VERSION:"1.1.3",NS:{HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},XHTML:{tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"],validTag:function(a){for(var b=0;b<f.XHTML.tags.length;b++)if(a==f.XHTML.tags[b])return!0;return!1},validAttribute:function(a,b){if("undefined"!=typeof f.XHTML.attributes[a]&&f.XHTML.attributes[a].length>0)for(var c=0;c<f.XHTML.attributes[a].length;c++)if(b==f.XHTML.attributes[a][c])return!0;return!1},validCSS:function(a){for(var b=0;b<f.XHTML.css.length;b++)if(a==f.XHTML.css[b])return!0;return!1}},Status:{ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8},LogLevel:{DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},ElementType:{NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11},TIMEOUT:1.1,SECONDARY_TIMEOUT:.1,addNamespace:function(a,b){f.NS[a]=b},forEachChild:function(a,b,c){var d,e;for(d=0;d<a.childNodes.length;d++)e=a.childNodes[d],e.nodeType!=f.ElementType.NORMAL||b&&!this.isTagEqual(e,b)||c(e)},isTagEqual:function(a,b){return a.tagName.toLowerCase()==b.toLowerCase()},_xmlGenerator:null,_makeGenerator:function(){var a;return void 0===document.implementation.createDocument||document.implementation.createDocument&&document.documentMode&&document.documentMode<10?(a=this._getIEXmlDom(),a.appendChild(a.createElement("strophe"))):a=document.implementation.createDocument("jabber:client","strophe",null),a},xmlGenerator:function(){return f._xmlGenerator||(f._xmlGenerator=f._makeGenerator()),f._xmlGenerator},_getIEXmlDom:function(){for(var a=null,b=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.5.0","Msxml2.DOMDocument.4.0","MSXML2.DOMDocument.3.0","MSXML2.DOMDocument","MSXML.DOMDocument","Microsoft.XMLDOM"],c=0;c<b.length&&null===a;c++)try{a=new ActiveXObject(b[c])}catch(d){a=null}return a},xmlElement:function(a){if(!a)return null;var b,c,d,e=f.xmlGenerator().createElement(a);for(b=1;b<arguments.length;b++)if(arguments[b])if("string"==typeof arguments[b]||"number"==typeof arguments[b])e.appendChild(f.xmlTextNode(arguments[b]));else if("object"==typeof arguments[b]&&"function"==typeof arguments[b].sort)for(c=0;c<arguments[b].length;c++)"object"==typeof arguments[b][c]&&"function"==typeof arguments[b][c].sort&&e.setAttribute(arguments[b][c][0],arguments[b][c][1]);else if("object"==typeof arguments[b])for(d in arguments[b])arguments[b].hasOwnProperty(d)&&e.setAttribute(d,arguments[b][d]);return e},xmlescape:function(a){return a=a.replace(/\&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/'/g,"&apos;"),a=a.replace(/"/g,"&quot;")},xmlTextNode:function(a){return f.xmlGenerator().createTextNode(a)},xmlHtmlNode:function(a){var b;if(window.DOMParser){var c=new DOMParser;b=c.parseFromString(a,"text/xml")}else b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},getText:function(a){if(!a)return null;var b="";0===a.childNodes.length&&a.nodeType==f.ElementType.TEXT&&(b+=a.nodeValue);for(var c=0;c<a.childNodes.length;c++)a.childNodes[c].nodeType==f.ElementType.TEXT&&(b+=a.childNodes[c].nodeValue);return f.xmlescape(b)},copyElement:function(a){var b,c;if(a.nodeType==f.ElementType.NORMAL){for(c=f.xmlElement(a.tagName),b=0;b<a.attributes.length;b++)c.setAttribute(a.attributes[b].nodeName.toLowerCase(),a.attributes[b].value);for(b=0;b<a.childNodes.length;b++)c.appendChild(f.copyElement(a.childNodes[b]))}else a.nodeType==f.ElementType.TEXT&&(c=f.xmlGenerator().createTextNode(a.nodeValue));return c},createHtml:function(a){var b,c,d,e,g,h,i,j,k,l,m;if(a.nodeType==f.ElementType.NORMAL)if(e=a.nodeName.toLowerCase(),f.XHTML.validTag(e))try{for(c=f.xmlElement(e),b=0;b<f.XHTML.attributes[e].length;b++)if(g=f.XHTML.attributes[e][b],h=a.getAttribute(g),"undefined"!=typeof h&&null!==h&&""!==h&&h!==!1&&0!==h)if("style"==g&&"object"==typeof h&&"undefined"!=typeof h.cssText&&(h=h.cssText),"style"==g){for(i=[],j=h.split(";"),d=0;d<j.length;d++)k=j[d].split(":"),l=k[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase(),f.XHTML.validCSS(l)&&(m=k[1].replace(/^\s*/,"").replace(/\s*$/,""),i.push(l+": "+m));i.length>0&&(h=i.join("; "),c.setAttribute(g,h))}else c.setAttribute(g,h);for(b=0;b<a.childNodes.length;b++)c.appendChild(f.createHtml(a.childNodes[b]))}catch(n){c=f.xmlTextNode("")}else for(c=f.xmlGenerator().createDocumentFragment(),b=0;b<a.childNodes.length;b++)c.appendChild(f.createHtml(a.childNodes[b]));else if(a.nodeType==f.ElementType.FRAGMENT)for(c=f.xmlGenerator().createDocumentFragment(),b=0;b<a.childNodes.length;b++)c.appendChild(f.createHtml(a.childNodes[b]));else a.nodeType==f.ElementType.TEXT&&(c=f.xmlTextNode(a.nodeValue));return c},escapeNode:function(a){return a.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},unescapeNode:function(a){return a.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")},getNodeFromJid:function(a){return a.indexOf("@")<0?null:a.split("@")[0]},getDomainFromJid:function(a){var b=f.getBareJidFromJid(a);if(b.indexOf("@")<0)return b;var c=b.split("@");return c.splice(0,1),c.join("@")},getResourceFromJid:function(a){var b=a.split("/");return b.length<2?null:(b.splice(0,1),b.join("/"))},getBareJidFromJid:function(a){return a?a.split("/")[0]:null},log:function(){},debug:function(a){this.log(this.LogLevel.DEBUG,a)},info:function(a){this.log(this.LogLevel.INFO,a)},warn:function(a){this.log(this.LogLevel.WARN,a)},error:function(a){this.log(this.LogLevel.ERROR,a)},fatal:function(a){this.log(this.LogLevel.FATAL,a)},serialize:function(a){var b;if(!a)return null;"function"==typeof a.tree&&(a=a.tree());var c,d,e=a.nodeName;for(a.getAttribute("_realname")&&(e=a.getAttribute("_realname")),b="<"+e,c=0;c<a.attributes.length;c++)"_realname"!=a.attributes[c].nodeName&&(b+=" "+a.attributes[c].nodeName.toLowerCase()+"='"+a.attributes[c].value.replace(/&/g,"&amp;").replace(/\'/g,"&apos;").replace(/>/g,"&gt;").replace(/</g,"&lt;")+"'");if(a.childNodes.length>0){for(b+=">",c=0;c<a.childNodes.length;c++)switch(d=a.childNodes[c],d.nodeType){case f.ElementType.NORMAL:b+=f.serialize(d);break;case f.ElementType.TEXT:b+=f.xmlescape(d.nodeValue);break;case f.ElementType.CDATA:b+="<![CDATA["+d.nodeValue+"]]>"}b+="</"+e+">"}else b+="/>";return b},_requestId:0,_connectionPlugins:{},addConnectionPlugin:function(a,b){f._connectionPlugins[a]=b}},f.Builder=function(a,b){("presence"==a||"message"==a||"iq"==a)&&(b&&!b.xmlns?b.xmlns=f.NS.CLIENT:b||(b={xmlns:f.NS.CLIENT})),this.nodeTree=f.xmlElement(a,b),this.node=this.nodeTree},f.Builder.prototype={tree:function(){return this.nodeTree},toString:function(){return f.serialize(this.nodeTree)},up:function(){return this.node=this.node.parentNode,this},attrs:function(a){for(var b in a)a.hasOwnProperty(b)&&this.node.setAttribute(b,a[b]);return this},c:function(a,b,c){var d=f.xmlElement(a,b,c);return this.node.appendChild(d),c||(this.node=d),this},cnode:function(a){var b,c=f.xmlGenerator();try{b=void 0!==c.importNode}catch(d){b=!1}var e=b?c.importNode(a,!0):f.copyElement(a);return this.node.appendChild(e),this.node=e,this},t:function(a){var b=f.xmlTextNode(a);return this.node.appendChild(b),this},h:function(a){var b=document.createElement("body");b.innerHTML=a;for(var c=f.createHtml(b);c.childNodes.length>0;)this.node.appendChild(c.childNodes[0]);return this}},f.Handler=function(a,b,c,d,e,g,h){this.handler=a,this.ns=b,this.name=c,this.type=d,this.id=e,this.options=h||{matchBare:!1},this.options.matchBare||(this.options.matchBare=!1),this.from=this.options.matchBare?g?f.getBareJidFromJid(g):null:g,this.user=!0},f.Handler.prototype={isMatch:function(a){var b,c=null;if(c=this.options.matchBare?f.getBareJidFromJid(a.getAttribute("from")):a.getAttribute("from"),b=!1,this.ns){var d=this;f.forEachChild(a,null,function(a){a.getAttribute("xmlns")==d.ns&&(b=!0)}),b=b||a.getAttribute("xmlns")==this.ns}else b=!0;return!b||this.name&&!f.isTagEqual(a,this.name)||this.type&&a.getAttribute("type")!=this.type||this.id&&a.getAttribute("id")!=this.id||this.from&&c!=this.from?!1:!0},run:function(a){var b=null;try{b=this.handler(a)}catch(c){throw c.sourceURL?f.fatal("error: "+this.handler+" "+c.sourceURL+":"+c.line+" - "+c.name+": "+c.message):c.fileName?("undefined"!=typeof console&&(console.trace(),console.error(this.handler," - error - ",c,c.message)),f.fatal("error: "+this.handler+" "+c.fileName+":"+c.lineNumber+" - "+c.name+": "+c.message)):f.fatal("error: "+c.message+"\n"+c.stack),c}return b},toString:function(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}},f.TimedHandler=function(a,b){this.period=a,this.handler=b,this.lastCalled=(new Date).getTime(),this.user=!0},f.TimedHandler.prototype={run:function(){return this.lastCalled=(new Date).getTime(),this.handler()},reset:function(){this.lastCalled=(new Date).getTime()},toString:function(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}},f.Connection=function(a,b){this.service=a,this.options=b||{};var c=this.options.protocol||"";this._proto=0===a.indexOf("ws:")||0===a.indexOf("wss:")||0===c.indexOf("ws")?new f.Websocket(this):new f.Bosh(this),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this._idleTimeout=null,this._disconnectTimeout=null,this.do_authentication=!0,this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this.paused=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout(this._onIdle.bind(this),100);for(var d in f._connectionPlugins)if(f._connectionPlugins.hasOwnProperty(d)){var e=f._connectionPlugins[d],g=function(){};g.prototype=e,this[d]=new g,this[d].init(this)}},f.Connection.prototype={reset:function(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._authentication={},this.authenticated=!1,this.disconnecting=!1,this.connected=!1,this.errors=0,this._requests=[],this._uniqueId=0},pause:function(){this.paused=!0},resume:function(){this.paused=!1},getUniqueId:function(a){return"string"==typeof a||"number"==typeof a?++this._uniqueId+":"+a:++this._uniqueId+""},connect:function(a,b,c,d,e,g){this.jid=a,this.authzid=f.getBareJidFromJid(this.jid),this.authcid=f.getNodeFromJid(this.jid),this.pass=b,this.servtype="xmpp",this.connect_callback=c,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.errors=0,this.domain=f.getDomainFromJid(this.jid),this._changeConnectStatus(f.Status.CONNECTING,null),this._proto._connect(d,e,g)},attach:function(a,b,c,d,e,f,g){this._proto._attach(a,b,c,d,e,f,g)},xmlInput:function(){},xmlOutput:function(){},rawInput:function(){},rawOutput:function(){},send:function(a){if(null!==a){if("function"==typeof a.sort)for(var b=0;b<a.length;b++)this._queueData(a[b]);else this._queueData("function"==typeof a.tree?a.tree():a);this._proto._send()}},flush:function(){clearTimeout(this._idleTimeout),this._onIdle()},sendIQ:function(a,b,c,d){var e=null,f=this;"function"==typeof a.tree&&(a=a.tree());var g=a.getAttribute("id");g||(g=this.getUniqueId("sendIQ"),a.setAttribute("id",g));var h=this.addHandler(function(a){e&&f.deleteTimedHandler(e);var d=a.getAttribute("type");if("result"==d)b&&b(a);else{if("error"!=d)throw{name:"StropheError",message:"Got bad IQ type of "+d};c&&c(a)}},null,"iq",null,g);return d&&(e=this.addTimedHandler(d,function(){return f.deleteHandler(h),c&&c(null),!1})),this.send(a),g},_queueData:function(a){if(null===a||!a.tagName||!a.childNodes)throw{name:"StropheError",message:"Cannot queue non-DOMElement."};this._data.push(a)},_sendRestart:function(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout(this._onIdle.bind(this),100)},addTimedHandler:function(a,b){var c=new f.TimedHandler(a,b);return this.addTimeds.push(c),c},deleteTimedHandler:function(a){this.removeTimeds.push(a)},addHandler:function(a,b,c,d,e,g,h){var i=new f.Handler(a,b,c,d,e,g,h);return this.addHandlers.push(i),i},deleteHandler:function(a){this.removeHandlers.push(a)},disconnect:function(a){if(this._changeConnectStatus(f.Status.DISCONNECTING,a),f.info("Disconnect was called because: "+a),this.connected){var b=!1;this.disconnecting=!0,this.authenticated&&(b=e({xmlns:f.NS.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(3e3,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(b)}},_changeConnectStatus:function(a,b){for(var c in f._connectionPlugins)if(f._connectionPlugins.hasOwnProperty(c)){var d=this[c];if(d.statusChanged)try{d.statusChanged(a,b)}catch(e){f.error(""+c+" plugin caused an exception changing status: "+e)}}if(this.connect_callback)try{this.connect_callback(a,b)}catch(g){f.error("User connection callback caused an exception: "+g)}},_doDisconnect:function(){null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),f.info("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(f.Status.DISCONNECTED,null),this.connected=!1},_dataRecv:function(a,b){f.info("_dataRecv called");var c=this._proto._reqToData(a);if(null!==c){this.xmlInput!==f.Connection.prototype.xmlInput&&this.xmlInput(c.nodeName===this._proto.strip&&c.childNodes.length?c.childNodes[0]:c),this.rawInput!==f.Connection.prototype.rawInput&&this.rawInput(b?b:f.serialize(c));for(var d,e;this.removeHandlers.length>0;)e=this.removeHandlers.pop(),d=this.handlers.indexOf(e),d>=0&&this.handlers.splice(d,1);for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();var g,h,i=c.getAttribute("type");if(null!==i&&"terminate"==i){if(this.disconnecting)return;return g=c.getAttribute("condition"),h=c.getElementsByTagName("conflict"),null!==g?("remote-stream-error"==g&&h.length>0&&(g="conflict"),this._changeConnectStatus(f.Status.CONNFAIL,g)):this._changeConnectStatus(f.Status.CONNFAIL,"unknown"),void this.disconnect("unknown stream-error")}var j=this;f.forEachChild(c,null,function(a){var b,c;for(c=j.handlers,j.handlers=[],b=0;b<c.length;b++){var d=c[b];try{!d.isMatch(a)||!j.authenticated&&d.user?j.handlers.push(d):d.run(a)&&j.handlers.push(d)}catch(e){f.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}}})}},mechanisms:{},_connect_cb:function(a,b,c){f.info("_connect_cb was called"),this.connected=!0;var d=this._proto._reqToData(a);if(d){this.xmlInput!==f.Connection.prototype.xmlInput&&this.xmlInput(d.nodeName===this._proto.strip&&d.childNodes.length?d.childNodes[0]:d),this.rawInput!==f.Connection.prototype.rawInput&&this.rawInput(c?c:f.serialize(d));var e=this._proto._connect_cb(d);if(e!==f.Status.CONNFAIL){this._authentication.sasl_scram_sha1=!1,this._authentication.sasl_plain=!1,this._authentication.sasl_digest_md5=!1,this._authentication.sasl_anonymous=!1,this._authentication.legacy_auth=!1;var g=d.getElementsByTagName("stream:features").length>0;g||(g=d.getElementsByTagName("features").length>0);var h,i,j=d.getElementsByTagName("mechanism"),k=[],l=!1;if(!g)return void this._proto._no_auth_received(b);if(j.length>0)for(h=0;h<j.length;h++)i=f.getText(j[h]),this.mechanisms[i]&&k.push(this.mechanisms[i]);return this._authentication.legacy_auth=d.getElementsByTagName("auth").length>0,(l=this._authentication.legacy_auth||k.length>0)?void(this.do_authentication!==!1&&this.authenticate(k)):void this._proto._no_auth_received(b)}}},authenticate:function(a){var c;for(c=0;c<a.length-1;++c){for(var e=c,g=c+1;g<a.length;++g)a[g].prototype.priority>a[e].prototype.priority&&(e=g);if(e!=c){var h=a[c];a[c]=a[e],a[e]=h}}var i=!1;for(c=0;c<a.length;++c)if(a[c].test(this)){this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=new a[c],this._sasl_mechanism.onStart(this);var j=b("auth",{xmlns:f.NS.SASL,mechanism:this._sasl_mechanism.name});if(this._sasl_mechanism.isClientFirst){var k=this._sasl_mechanism.onChallenge(this,null);j.t(Base64.encode(k))}this.send(j.tree()),i=!0;break}i||(null===f.getNodeFromJid(this.jid)?(this._changeConnectStatus(f.Status.CONNFAIL,"x-strophe-bad-non-anon-jid"),this.disconnect("x-strophe-bad-non-anon-jid")):(this._changeConnectStatus(f.Status.AUTHENTICATING,null),this._addSysHandler(this._auth1_cb.bind(this),null,null,null,"_auth_1"),this.send(d({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:f.NS.AUTH}).c("username",{}).t(f.getNodeFromJid(this.jid)).tree())))},_sasl_challenge_cb:function(a){var c=Base64.decode(f.getText(a)),d=this._sasl_mechanism.onChallenge(this,c),e=b("response",{xmlns:f.NS.SASL});return""!==d&&e.t(Base64.encode(d)),this.send(e.tree()),!0},_auth1_cb:function(){var a=d({type:"set",id:"_auth_2"}).c("query",{xmlns:f.NS.AUTH}).c("username",{}).t(f.getNodeFromJid(this.jid)).up().c("password").t(this.pass);return f.getResourceFromJid(this.jid)||(this.jid=f.getBareJidFromJid(this.jid)+"/strophe"),a.up().c("resource",{}).t(f.getResourceFromJid(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(a.tree()),!1},_sasl_success_cb:function(a){if(this._sasl_data["server-signature"]){var b,c=Base64.decode(f.getText(a)),d=/([a-z]+)=([^,]+)(,|$)/,e=c.match(d);if("v"==e[1]&&(b=e[2]),b!=this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}return f.info("SASL authentication succeeded."),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._addSysHandler(this._sasl_auth1_cb.bind(this),null,"stream:features",null,null),this._sendRestart(),!1},_sasl_auth1_cb:function(a){this.features=a;var b,c;for(b=0;b<a.childNodes.length;b++)c=a.childNodes[b],"bind"==c.nodeName&&(this.do_bind=!0),"session"==c.nodeName&&(this.do_session=!0);if(!this.do_bind)return this._changeConnectStatus(f.Status.AUTHFAIL,null),!1;this._addSysHandler(this._sasl_bind_cb.bind(this),null,null,null,"_bind_auth_2");var e=f.getResourceFromJid(this.jid);return this.send(e?d({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:f.NS.BIND}).c("resource",{}).t(e).tree():d({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:f.NS.BIND}).tree()),!1},_sasl_bind_cb:function(a){if("error"==a.getAttribute("type")){f.info("SASL binding failed.");var b,c=a.getElementsByTagName("conflict");return c.length>0&&(b="conflict"),this._changeConnectStatus(f.Status.AUTHFAIL,b),!1}var e,g=a.getElementsByTagName("bind");return g.length>0?(e=g[0].getElementsByTagName("jid"),void(e.length>0&&(this.jid=f.getText(e[0]),this.do_session?(this._addSysHandler(this._sasl_session_cb.bind(this),null,null,null,"_session_auth_2"),this.send(d({type:"set",id:"_session_auth_2"}).c("session",{xmlns:f.NS.SESSION}).tree())):(this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null))))):(f.info("SASL binding failed."),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1)},_sasl_session_cb:function(a){if("result"==a.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null);else if("error"==a.getAttribute("type"))return f.info("Session creation failed."),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1;return!1},_sasl_failure_cb:function(){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(f.Status.AUTHFAIL,null),!1},_auth2_cb:function(a){return"result"==a.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(f.Status.CONNECTED,null)):"error"==a.getAttribute("type")&&(this._changeConnectStatus(f.Status.AUTHFAIL,null),this.disconnect("authentication failed")),!1},_addSysTimedHandler:function(a,b){var c=new f.TimedHandler(a,b);return c.user=!1,this.addTimeds.push(c),c},_addSysHandler:function(a,b,c,d,e){var g=new f.Handler(a,b,c,d,e);return g.user=!1,this.addHandlers.push(g),g},_onDisconnectTimeout:function(){return f.info("_onDisconnectTimeout was called"),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1},_onIdle:function(){for(var a,b,c,d;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;)b=this.removeTimeds.pop(),a=this.timedHandlers.indexOf(b),a>=0&&this.timedHandlers.splice(a,1);var e=(new Date).getTime();for(d=[],a=0;a<this.timedHandlers.length;a++)b=this.timedHandlers[a],(this.authenticated||!b.user)&&(c=b.lastCalled+b.period,0>=c-e?b.run()&&d.push(b):d.push(b));this.timedHandlers=d,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout(this._onIdle.bind(this),100))}},a&&a(f,b,c,d,e),f.SASLMechanism=function(a,b,c){this.name=a,this.isClientFirst=b,this.priority=c},f.SASLMechanism.prototype={test:function(){return!0},onStart:function(a){this._connection=a},onChallenge:function(){throw new Error("You should implement challenge handling!")},onFailure:function(){this._connection=null},onSuccess:function(){this._connection=null}},f.SASLAnonymous=function(){},f.SASLAnonymous.prototype=new f.SASLMechanism("ANONYMOUS",!1,10),f.SASLAnonymous.test=function(a){return null===a.authcid},f.Connection.prototype.mechanisms[f.SASLAnonymous.prototype.name]=f.SASLAnonymous,f.SASLPlain=function(){},f.SASLPlain.prototype=new f.SASLMechanism("PLAIN",!0,20),f.SASLPlain.test=function(a){return null!==a.authcid},f.SASLPlain.prototype.onChallenge=function(a){var b=a.authzid;return b+="\x00",b+=a.authcid,b+="\x00",b+=a.pass},f.Connection.prototype.mechanisms[f.SASLPlain.prototype.name]=f.SASLPlain,f.SASLSHA1=function(){},f.SASLSHA1.prototype=new f.SASLMechanism("SCRAM-SHA-1",!0,40),f.SASLSHA1.test=function(a){return null!==a.authcid},f.SASLSHA1.prototype.onChallenge=function(a,b,c){var d=c||MD5.hexdigest(1234567890*Math.random()),e="n="+a.authcid;return e+=",r=",e+=d,a._sasl_data.cnonce=d,a._sasl_data["client-first-message-bare"]=e,e="n,,"+e,this.onChallenge=function(a,b){for(var c,d,e,f,g,h,i,j,k,l,m,n="c=biws,",o=a._sasl_data["client-first-message-bare"]+","+b+",",p=a._sasl_data.cnonce,q=/([a-z]+)=([^,]+)(,|$)/;b.match(q);){var r=b.match(q);switch(b=b.replace(r[0],""),r[1]){case"r":c=r[2];break;case"s":d=r[2];break;case"i":e=r[2]}}if(c.substr(0,p.length)!==p)return a._sasl_data={},a._sasl_failure_cb();for(n+="r="+c,o+=n,d=Base64.decode(d),d+="\x00\x00\x00",f=h=core_hmac_sha1(a.pass,d),i=1;e>i;i++){for(g=core_hmac_sha1(a.pass,binb2str(h)),j=0;5>j;j++)f[j]^=g[j];h=g}for(f=binb2str(f),k=core_hmac_sha1(f,"Client Key"),l=str_hmac_sha1(f,"Server Key"),m=core_hmac_sha1(str_sha1(binb2str(k)),o),a._sasl_data["server-signature"]=b64_hmac_sha1(l,o),j=0;5>j;j++)k[j]^=m[j];return n+=",p="+Base64.encode(binb2str(k))}.bind(this),e},f.Connection.prototype.mechanisms[f.SASLSHA1.prototype.name]=f.SASLSHA1,f.SASLMD5=function(){},f.SASLMD5.prototype=new f.SASLMechanism("DIGEST-MD5",!1,30),f.SASLMD5.test=function(a){return null!==a.authcid},f.SASLMD5.prototype._quote=function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'},f.SASLMD5.prototype.onChallenge=function(a,b,c){for(var d,e=/([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/,f=c||MD5.hexdigest(""+1234567890*Math.random()),g="",h=null,i="",j="";b.match(e);)switch(d=b.match(e),b=b.replace(d[0],""),d[2]=d[2].replace(/^"(.+)"$/,"$1"),d[1]){case"realm":g=d[2];break;case"nonce":i=d[2];break;case"qop":j=d[2];break;case"host":h=d[2]}var k=a.servtype+"/"+a.domain;null!==h&&(k=k+"/"+h);var l=MD5.hash(a.authcid+":"+g+":"+this._connection.pass)+":"+i+":"+f,m="AUTHENTICATE:"+k,n="";return n+="charset=utf-8,",n+="username="+this._quote(a.authcid)+",",n+="realm="+this._quote(g)+",",n+="nonce="+this._quote(i)+",",n+="nc=00000001,",n+="cnonce="+this._quote(f)+",",n+="digest-uri="+this._quote(k)+",",n+="response="+MD5.hexdigest(MD5.hexdigest(l)+":"+i+":00000001:"+f+":auth:"+MD5.hexdigest(m))+",",n+="qop=auth",this.onChallenge=function(){return""}.bind(this),n},f.Connection.prototype.mechanisms[f.SASLMD5.prototype.name]=f.SASLMD5}(function(){window.Strophe=arguments[0],window.$build=arguments[1],window.$msg=arguments[2],window.$iq=arguments[3],window.$pres=arguments[4]}),Strophe.Request=function(a,b,c,d){this.id=++Strophe._requestId,this.xmlData=a,this.data=Strophe.serialize(a),this.origFunc=b,this.func=b,this.rid=c,this.date=0/0,this.sends=d||0,this.abort=!1,this.dead=null,this.age=function(){if(!this.date)return 0;var a=new Date;return(a-this.date)/1e3},this.timeDead=function(){if(!this.dead)return 0;var a=new Date;return(a-this.dead)/1e3},this.xhr=this._newXHR()},Strophe.Request.prototype={getResponse:function(){var a=null;if(this.xhr.responseXML&&this.xhr.responseXML.documentElement){if(a=this.xhr.responseXML.documentElement,"parsererror"==a.tagName)throw Strophe.error("invalid response received"),Strophe.error("responseText: "+this.xhr.responseText),Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML)),"parsererror"}else this.xhr.responseText&&(Strophe.error("invalid response received"),Strophe.error("responseText: "+this.xhr.responseText),Strophe.error("responseXML: "+Strophe.serialize(this.xhr.responseXML)));return a},_newXHR:function(){var a=null;return window.XMLHttpRequest?(a=new XMLHttpRequest,a.overrideMimeType&&a.overrideMimeType("text/xml")):window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLHTTP")),a.onreadystatechange=this.func.bind(null,this),a}},Strophe.Bosh=function(a){this._conn=a,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this._requests=[]},Strophe.Bosh.prototype={strip:null,_buildBody:function(){var a=$build("body",{rid:this.rid++,xmlns:Strophe.NS.HTTPBIND});return null!==this.sid&&a.attrs({sid:this.sid}),a},_reset:function(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null},_connect:function(a,b,c){this.wait=a||this.wait,this.hold=b||this.hold;var d=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":Strophe.NS.BOSH});c&&d.attrs({route:c});var e=this._conn._connect_cb;this._requests.push(new Strophe.Request(d.tree(),this._onRequestStateChange.bind(this,e.bind(this._conn)),d.tree().getAttribute("rid"))),this._throttledRequestHandler()},_attach:function(a,b,c,d,e,f,g){this._conn.jid=a,this.sid=b,this.rid=c,this._conn.connect_callback=d,this._conn.domain=Strophe.getDomainFromJid(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=e||this.wait,this.hold=f||this.hold,this.window=g||this.window,this._conn._changeConnectStatus(Strophe.Status.ATTACHED,null)},_connect_cb:function(a){var b,c,d=a.getAttribute("type");if(null!==d&&"terminate"==d)return Strophe.error("BOSH-Connection failed: "+b),b=a.getAttribute("condition"),c=a.getElementsByTagName("conflict"),null!==b?("remote-stream-error"==b&&c.length>0&&(b="conflict"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,b)):this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"unknown"),this._conn._doDisconnect(),Strophe.Status.CONNFAIL;this.sid||(this.sid=a.getAttribute("sid"));var e=a.getAttribute("requests");e&&(this.window=parseInt(e,10));var f=a.getAttribute("hold");f&&(this.hold=parseInt(f,10));var g=a.getAttribute("wait");g&&(this.wait=parseInt(g,10))},_disconnect:function(a){this._sendTerminate(a)},_doDisconnect:function(){this.sid=null,this.rid=Math.floor(4294967295*Math.random())},_emptyQueue:function(){return 0===this._requests.length},_hitError:function(a){this.errors++,Strophe.warn("request errored, status: "+a+", number of errors: "+this.errors),this.errors>4&&this._onDisconnectTimeout()},_no_auth_received:function(a){a=a?a.bind(this._conn):this._conn._connect_cb.bind(this._conn);var b=this._buildBody();this._requests.push(new Strophe.Request(b.tree(),this._onRequestStateChange.bind(this,a.bind(this._conn)),b.tree().getAttribute("rid"))),this._throttledRequestHandler()},_onDisconnectTimeout:function(){for(var a;this._requests.length>0;)a=this._requests.pop(),a.abort=!0,a.xhr.abort(),a.xhr.onreadystatechange=function(){}},_onIdle:function(){var a=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===a.length&&!this._conn.disconnecting&&(Strophe.info("no requests during idle cycle, sending blank request"),a.push(null)),this._requests.length<2&&a.length>0&&!this._conn.paused){for(var b=this._buildBody(),c=0;c<a.length;c++)null!==a[c]&&("restart"===a[c]?b.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":Strophe.NS.BOSH}):b.cnode(a[c]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new Strophe.Request(b.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),b.tree().getAttribute("rid"))),this._processRequest(this._requests.length-1)}if(this._requests.length>0){var d=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait)&&this._throttledRequestHandler(),d>Math.floor(Strophe.TIMEOUT*this.wait)&&(Strophe.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(Strophe.TIMEOUT*this.wait)+" seconds since last activity"),this._throttledRequestHandler())
}},_onRequestStateChange:function(a,b){if(Strophe.debug("request id "+b.id+"."+b.sends+" state changed to "+b.xhr.readyState),b.abort)return void(b.abort=!1);var c;if(4==b.xhr.readyState){c=0;try{c=b.xhr.status}catch(d){}if("undefined"==typeof c&&(c=0),this.disconnecting&&c>=400)return void this._hitError(c);var e=this._requests[0]==b,f=this._requests[1]==b;(c>0&&500>c||b.sends>5)&&(this._removeRequest(b),Strophe.debug("request id "+b.id+" should now be removed")),200==c?((f||e&&this._requests.length>0&&this._requests[0].age()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait))&&this._restartRequest(0),Strophe.debug("request id "+b.id+"."+b.sends+" got 200"),a(b),this.errors=0):(Strophe.error("request id "+b.id+"."+b.sends+" error "+c+" happened"),(0===c||c>=400&&600>c||c>=12e3)&&(this._hitError(c),c>=400&&500>c&&(this._conn._changeConnectStatus(Strophe.Status.DISCONNECTING,null),this._conn._doDisconnect()))),c>0&&500>c||b.sends>5||this._throttledRequestHandler()}},_processRequest:function(a){var b=this,c=this._requests[a],d=-1;try{4==c.xhr.readyState&&(d=c.xhr.status)}catch(e){Strophe.error("caught an error in _requests["+a+"], reqStatus: "+d)}if("undefined"==typeof d&&(d=-1),c.sends>this.maxRetries)return void this._onDisconnectTimeout();var f=c.age(),g=!isNaN(f)&&f>Math.floor(Strophe.TIMEOUT*this.wait),h=null!==c.dead&&c.timeDead()>Math.floor(Strophe.SECONDARY_TIMEOUT*this.wait),i=4==c.xhr.readyState&&(1>d||d>=500);if((g||h||i)&&(h&&Strophe.error("Request "+this._requests[a].id+" timed out (secondary), restarting"),c.abort=!0,c.xhr.abort(),c.xhr.onreadystatechange=function(){},this._requests[a]=new Strophe.Request(c.xmlData,c.origFunc,c.rid,c.sends),c=this._requests[a]),0===c.xhr.readyState){Strophe.debug("request id "+c.id+"."+c.sends+" posting");try{c.xhr.open("POST",this._conn.service,this._conn.options.sync?!1:!0)}catch(j){return Strophe.error("XHR open failed."),this._conn.connected||this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"bad-service"),void this._conn.disconnect()}var k=function(){if(c.date=new Date,b._conn.options.customHeaders){var a=b._conn.options.customHeaders;for(var d in a)a.hasOwnProperty(d)&&c.xhr.setRequestHeader(d,a[d])}c.xhr.send(c.data)};if(c.sends>1){var l=1e3*Math.min(Math.floor(Strophe.TIMEOUT*this.wait),Math.pow(c.sends,3));setTimeout(k,l)}else k();c.sends++,this._conn.xmlOutput!==Strophe.Connection.prototype.xmlOutput&&this._conn.xmlOutput(c.xmlData.nodeName===this.strip&&c.xmlData.childNodes.length?c.xmlData.childNodes[0]:c.xmlData),this._conn.rawOutput!==Strophe.Connection.prototype.rawOutput&&this._conn.rawOutput(c.data)}else Strophe.debug("_processRequest: "+(0===a?"first":"second")+" request has readyState of "+c.xhr.readyState)},_removeRequest:function(a){Strophe.debug("removing request");var b;for(b=this._requests.length-1;b>=0;b--)a==this._requests[b]&&this._requests.splice(b,1);a.xhr.onreadystatechange=function(){},this._throttledRequestHandler()},_restartRequest:function(a){var b=this._requests[a];null===b.dead&&(b.dead=new Date),this._processRequest(a)},_reqToData:function(a){try{return a.getResponse()}catch(b){if("parsererror"!=b)throw b;this._conn.disconnect("strophe-parsererror")}},_sendTerminate:function(a){Strophe.info("_sendTerminate was called");var b=this._buildBody().attrs({type:"terminate"});a&&b.cnode(a.tree());var c=new Strophe.Request(b.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),b.tree().getAttribute("rid"));this._requests.push(c),this._throttledRequestHandler()},_send:function(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout(this._conn._onIdle.bind(this._conn),100)},_sendRestart:function(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)},_throttledRequestHandler:function(){Strophe.debug(this._requests?"_throttledRequestHandler called with "+this._requests.length+" requests":"_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}},Strophe.Websocket=function(a){this._conn=a,this.strip="stream:stream";var b=a.service;if(0!==b.indexOf("ws:")&&0!==b.indexOf("wss:")){var c="";c+="ws"===a.options.protocol&&"https:"!==window.location.protocol?"ws":"wss",c+="://"+window.location.host,c+=0!==b.indexOf("/")?window.location.pathname+b:b,a.service=c}},Strophe.Websocket.prototype={_buildStream:function(){return $build("stream:stream",{to:this._conn.domain,xmlns:Strophe.NS.CLIENT,"xmlns:stream":Strophe.NS.STREAM,version:"1.0"})},_check_streamerror:function(a,b){var c=a.getElementsByTagName("stream:error");if(0===c.length)return!1;for(var d=c[0],e="",f="",g="urn:ietf:params:xml:ns:xmpp-streams",h=0;h<d.childNodes.length;h++){var i=d.childNodes[h];if(i.getAttribute("xmlns")!==g)break;"text"===i.nodeName?f=i.textContent:e=i.nodeName}var j="WebSocket stream error: ";return j+=e?e:"unknown",f&&(j+=" - "+e),Strophe.error(j),this._conn._changeConnectStatus(b,e),this._conn._doDisconnect(),!0},_reset:function(){},_connect:function(){this._closeSocket(),this.socket=new WebSocket(this._conn.service,"xmpp"),this.socket.onopen=this._onOpen.bind(this),this.socket.onerror=this._onError.bind(this),this.socket.onclose=this._onClose.bind(this),this.socket.onmessage=this._connect_cb_wrapper.bind(this)},_connect_cb:function(a){var b=this._check_streamerror(a,Strophe.Status.CONNFAIL);return b?Strophe.Status.CONNFAIL:void 0},_handleStreamStart:function(a){var b=!1,c=a.getAttribute("xmlns");"string"!=typeof c?b="Missing xmlns in stream:stream":c!==Strophe.NS.CLIENT&&(b="Wrong xmlns in stream:stream: "+c);var d=a.namespaceURI;"string"!=typeof d?b="Missing xmlns:stream in stream:stream":d!==Strophe.NS.STREAM&&(b="Wrong xmlns:stream in stream:stream: "+d);var e=a.getAttribute("version");return"string"!=typeof e?b="Missing version in stream:stream":"1.0"!==e&&(b="Wrong version in stream:stream: "+e),b?(this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,b),this._conn._doDisconnect(),!1):!0},_connect_cb_wrapper:function(a){if(0===a.data.indexOf("<stream:stream ")||0===a.data.indexOf("<?xml")){var b=a.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===b)return;b=a.data.replace(/<stream:stream (.*[^\/])>/,"<stream:stream $1/>");var c=(new DOMParser).parseFromString(b,"text/xml").documentElement;this._conn.xmlInput(c),this._conn.rawInput(a.data),this._handleStreamStart(c)&&(this._connect_cb(c),this.streamStart=a.data.replace(/^<stream:(.*)\/>$/,"<stream:$1>"))}else{if("</stream:stream>"===a.data)return this._conn.rawInput(a.data),this._conn.xmlInput(document.createElement("stream:stream")),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"Received closing stream"),void this._conn._doDisconnect();var d=this._streamWrap(a.data),e=(new DOMParser).parseFromString(d,"text/xml").documentElement;this.socket.onmessage=this._onMessage.bind(this),this._conn._connect_cb(e,null,a.data)}},_disconnect:function(a){if(this.socket.readyState!==WebSocket.CLOSED){a&&this._conn.send(a);var b="</stream:stream>";this._conn.xmlOutput(document.createElement("stream:stream")),this._conn.rawOutput(b);try{this.socket.send(b)}catch(c){Strophe.info("Couldn't send closing stream tag.")}}this._conn._doDisconnect()},_doDisconnect:function(){Strophe.info("WebSockets _doDisconnect was called"),this._closeSocket()},_streamWrap:function(a){return this.streamStart+a+"</stream:stream>"},_closeSocket:function(){if(this.socket)try{this.socket.close()}catch(a){}this.socket=null},_emptyQueue:function(){return!0},_onClose:function(){this._conn.connected&&!this._conn.disconnecting?(Strophe.error("Websocket closed unexcectedly"),this._conn._doDisconnect()):Strophe.info("Websocket closed")},_no_auth_received:function(a){Strophe.error("Server did not send any auth methods"),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"Server did not send any auth methods"),a&&(a=a.bind(this._conn))(),this._conn._doDisconnect()},_onDisconnectTimeout:function(){},_onError:function(a){Strophe.error("Websocket error "+a),this._conn._changeConnectStatus(Strophe.Status.CONNFAIL,"The WebSocket connection could not be established was disconnected."),this._disconnect()},_onIdle:function(){var a=this._conn._data;if(a.length>0&&!this._conn.paused){for(var b=0;b<a.length;b++)if(null!==a[b]){var c,d;"restart"===a[b]?(c=this._buildStream(),d=this._removeClosingTag(c),c=c.tree()):(c=a[b],d=Strophe.serialize(c)),this._conn.xmlOutput(c),this._conn.rawOutput(d),this.socket.send(d)}this._conn._data=[]}},_onMessage:function(a){var b,c;if("</stream:stream>"===a.data){var d="</stream:stream>";return this._conn.rawInput(d),this._conn.xmlInput(document.createElement("stream:stream")),void(this._conn.disconnecting||this._conn._doDisconnect())}if(0===a.data.search("<stream:stream ")){if(c=a.data.replace(/<stream:stream (.*[^\/])>/,"<stream:stream $1/>"),b=(new DOMParser).parseFromString(c,"text/xml").documentElement,!this._handleStreamStart(b))return}else c=this._streamWrap(a.data),b=(new DOMParser).parseFromString(c,"text/xml").documentElement;if(!this._check_streamerror(b,Strophe.Status.ERROR))return this._conn.disconnecting&&"presence"===b.firstChild.nodeName&&"unavailable"===b.firstChild.getAttribute("type")?(this._conn.xmlInput(b),void this._conn.rawInput(Strophe.serialize(b))):void this._conn._dataRecv(b,a.data)},_onOpen:function(){Strophe.info("Websocket open");var a=this._buildStream();this._conn.xmlOutput(a.tree());var b=this._removeClosingTag(a);this._conn.rawOutput(b),this.socket.send(b)},_removeClosingTag:function(a){var b=Strophe.serialize(a);return b=b.replace(/<(stream:stream .*[^\/])\/>$/,"<$1>")},_reqToData:function(a){return a},_send:function(){this._conn.flush()},_sendRestart:function(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}},function(){var a;a=function(){function a(a,b){this.startInterval=6e4,this.init(a,b)}return a.prototype.init=function(a,b){return this.$element=$(a),this.options=$.extend({},$.fn.timeago.defaults,b),lang=this.options.lang,this.options.lang=lang[this.options.locale],this.updateTime(),this.startTimer()},a.prototype.startTimer=function(){var a;return a=this,this.interval=setInterval(function(){return a.refresh()},this.startInterval)},a.prototype.stopTimer=function(){return clearInterval(this.interval)},a.prototype.restartTimer=function(){return this.stopTimer(),this.startTimer()},a.prototype.refresh=function(){return this.updateTime(),this.updateInterval()},a.prototype.updateTime=function(){var a;return a=this,this.$element.findAndSelf(this.options.selector).each(function(){var b;return b=a.timeAgoInWords($(this).attr(a.options.attr)),$(this).html(b)})},a.prototype.updateInterval=function(){var a,b,c,d;if(this.$element.findAndSelf(this.options.selector).length>0){if("up"===this.options.dir?a=":first":"down"===this.options.dir&&(a=":last"),d=this.$element.findAndSelf(this.options.selector).filter(a).attr(this.options.attr),b=this.parse(d),c=this.getTimeDistanceInMinutes(b),c>=0&&44>=c&&6e4!==this.startInterval)return this.startInterval=6e4,this.restartTimer();if(c>=45&&89>=c&&132e4!==this.startInterval)return this.startInterval=132e4,this.restartTimer();if(c>=90&&2519>=c&&18e5!==this.startInterval)return this.startInterval=18e5,this.restartTimer();if(c>=2520&&432e5!==this.startInterval)return this.startInterval=432e5,this.restartTimer()}},a.prototype.timeAgoInWords=function(a){var b;return b=this.parse(a),""+this.options.lang.prefixes.ago+this.distanceOfTimeInWords(b)+this.options.lang.suffix},a.prototype.parse=function(a){var b;return b=$.trim(a),b=b.replace(/\.\d\d\d+/,""),b=b.replace(/-/,"/").replace(/-/,"/"),b=b.replace(/T/," ").replace(/Z/," UTC"),b=b.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(b)},a.prototype.getTimeDistanceInMinutes=function(a){var b;return b=(new Date).getTime()-a.getTime(),Math.round(Math.abs(b)/1e3/60)},a.prototype.distanceOfTimeInWords=function(a){var b;return b=this.getTimeDistanceInMinutes(a),0===b?""+this.options.lang.prefixes.lt+" "+this.options.lang.units.minute:1===b?"1 "+this.options.lang.units.minute:b>=2&&44>=b?""+b+" "+this.options.lang.units.minutes:b>=45&&89>=b?""+this.options.lang.prefixes.about+" 1 "+this.options.lang.units.hour:b>=90&&1439>=b?""+this.options.lang.prefixes.about+" "+Math.round(b/60)+" "+this.options.lang.units.hours:b>=1440&&2519>=b?"1 "+this.options.lang.units.day:b>=2520&&43199>=b?""+Math.round(b/1440)+" "+this.options.lang.units.days:b>=43200&&86399>=b?""+this.options.lang.prefixes.about+" 1 "+this.options.lang.units.month:b>=86400&&525599>=b?""+Math.round(b/43200)+" "+this.options.lang.units.months:b>=525600&&655199>=b?""+this.options.lang.prefixes.about+" 1 "+this.options.lang.units.year:b>=655200&&914399>=b?""+this.options.lang.prefixes.over+" 1 "+this.options.lang.units.year:b>=914400&&1051199>=b?""+this.options.lang.prefixes.almost+" 2 "+this.options.lang.units.years:""+this.options.lang.prefixes.about+" "+Math.round(b/525600)+" "+this.options.lang.units.years},a}(),$.fn.timeago=function(b){return null==b&&(b={}),this.each(function(){var c,d;return c=$(this),d=c.data("timeago"),d?"string"==typeof b?d[b]():void 0:c.data("timeago",new a(this,b))})},$.fn.findAndSelf=function(a){return this.find(a).add(this.filter(a))},$.fn.timeago.Constructor=a,$.fn.timeago.defaults={selector:"time.timeago",attr:"datetime",dir:"up",locale:"en_US",lang:{en_US:{units:{second:"second",seconds:"seconds",minute:"minute",minutes:"minutes",hour:"hour",hours:"hours",day:"day",days:"days",month:"month",months:"months",year:"year",years:"years"},prefixes:{lt:"less than a",about:"about",over:"over",almost:"almost",ago:""},suffix:" ago"},fr_FR:{units:{second:"seconde",seconds:"secondes",minute:"minute",minutes:"minutes",hour:"heure",hours:"heures",day:"jour",days:"jours",month:"mois",months:"mois",year:"an",years:"ans"},prefixes:{lt:"moins d'un",about:"environ",over:"plus de ",almost:"presque",ago:"il y a "},suffix:""},de_DE:{units:{second:"Sekunde",seconds:"Sekunden",minute:"Minute",minutes:"Minuten",hour:"Stunde",hours:"Stunden",day:"Tag",days:"Tagen",month:"Monat",months:"Monaten",year:"Jahr",years:"Jahren"},prefixes:{lt:"weniger als eine",about:"ungefähr",over:"über",almost:"fast",ago:"vor "},suffix:""},es_ES:{units:{second:"segundo",seconds:"segundos",minute:"minuto",minutes:"minutos",hour:"hora",hours:"horas",day:"día",days:"días",month:"mes",months:"meses",year:"año",years:"años"},prefixes:{lt:"hace menos de un",about:"cerca de",over:"poco más de",almost:"casi",ago:"hace "},suffix:""}}}}.call(this),function(){var a=function(a,b){this.options=a||{},this.options.container||(this.options.container=null),this.ee=new Backbone.Wreqr.EventAggregator,this.ee.emit=this.ee.trigger,this.ee.removeEventListener=this.ee.stopListening,this.socket=null,this.ready=!1,this.isParent="boolean"==typeof b?b:!this.isIframe()};a.prototype.log=function(){try{if(window.console&&window.console.log){var a=Array.prototype.slice.call(arguments);a.unshift("XFrameMessager "+(this.isParent?"parent":"child")),window.console.log.apply?window.console.log.apply(window.console,a):window.console.log(a)}}catch(b){}},a.prototype.start=function(a,b){var c={onMessage:this.onMessage.bind(this),onReady:this.onReady.bind(this)};a&&(c.container=a),b&&(c.remote=b);try{if(!b&&parent&&parent.socket)return this.socket=parent.socket,this.onReady(),!0}catch(d){}return this.socket=new easyXDM.Socket(c),!0},a.prototype.isIframe=function(){return window.top===window.self?!1:!0},a.prototype.onReady=function(){this.ready=!0,this.log("onReady",arguments),this.emit("xfm_ready",!0)},a.prototype.onEmit=function(a){this.log("onEmit",a)},a.prototype.emit=function(a,b,c){if(!this.ready)return void this.on("xfm_ready",function(){this.emit(a,b,c)}.bind(this));c&&(b.cbid=c);var d=[a,b];d=JSON.stringify(d),this.onEmit(d),this.socket.postMessage(d)},a.prototype.onMessage=function(a,b){var c=this;if(c.log("onMessage",a,b),a=JSON.parse(a),!_.isArray(a))return void c.log("onMessage","incorrect format");var d=function(b){c.emit(a[0],b,_.isObject(a[1])?a[1].cbid||null:null)};c.ee.emit(a[0],null,a[1],d)},a.prototype.on=function(a,b){this.ee.on(a,b)},a.prototype.once=function(a,b,c,d){var e,f,g,h=this;f=function(a,b){b&&b.cbid!=c||g(a,b)},g=function(c,d){e&&clearTimeout(e),h.ee.removeEvent(a,f),b(c,d)},d&&(e=setTimeout(g.bind(g,"timeout"),d)),this.on(a,f)},a.prototype.sendAndReceive=function(a,b,c,d){var e=Math.round(Date.now()+""+1e5*Math.random()).toString(16);this.once(a,c,e,d),this.emit(a,b,e)},a.prototype.listeners=function(a){return a?this.ee.$events[a]||[]:this.ee.$events},window.XFrameMessager=a}(),function(a,b,c){function d(){var a=b.createElement("style");return a.type="text/css",g=g||b.getElementsByTagName("head")[0],g.appendChild(a),a}var e,f,g,h="style",i="0.2.2",j=Object.prototype,k=j.hasOwnProperty,l=k.call(a,h),m=a[h],n={},o=Array.isArray||function(a){return"[object Array]"===j.toString.call(a)};e=a[h]=function(a,c,e){function g(a,b){var c=j?a.replace(/\./g,"."+j):a;if(i.push(c+" {"),o(b))for(var d=-1,e=b.length;++d<e;){var f=b[d];i.push(f[0]+": "+f[1]+";")}else for(var g in b)k.call(b,g)&&i.push(g+": "+b[g]+";");i.push("}")}var h=c&&c.key,i=[],j=c&&c.prefix;if(e||(e=f=f||d()),h){if(k.call(n,h))return;n[h]=!0}if("object"==typeof a){if(o(a))for(var l=-1,m=a.length;++l<m;){var p=a[l];g(p[0],p[1])}else for(var q in a)k.call(a,q)&&g(q,a[q]);a=i.join("\n")}e.styleSheet?e.styleSheet.cssText+=a:e.appendChild(b.createTextNode(a))},e.VERSION=i,e.noConflict=function(){if(a[h]===e&&(a[h]=l?m:c,!l))try{delete a[h]}catch(b){}return e},e.add=e,e.sheet=function(){var a=d(),b=function(b,c){e(b,c,a)};return b.add=b,b}}(this,document),function(a,b,c){function d(a){var b={},d=/^jQuery\d+$/;return c.each(a.attributes,function(a,c){c.specified&&!d.test(c.name)&&(b[c.name]=c.value)}),b}function e(a,b){var d=this,e=c(d);if(d.value==e.attr("placeholder")&&e.hasClass("placeholder"))if(e.data("placeholder-password")){if(e=e.hide().next().show().attr("id",e.removeAttr("id").data("placeholder-id")),a===!0)return e[0].value=b;e.focus()}else d.value="",e.removeClass("placeholder"),d==g()&&d.select()}function f(){var a,b=this,f=c(b),g=this.id;if(""==b.value){if("password"==b.type){if(!f.data("placeholder-textinput")){try{a=f.clone().attr({type:"text"})}catch(h){a=c("<input>").attr(c.extend(d(this),{type:"text"}))}a.removeAttr("name").data({"placeholder-password":f,"placeholder-id":g}).bind("focus.placeholder",e),f.data({"placeholder-textinput":a,"placeholder-id":g}).before(a)}f=f.removeAttr("id").hide().prev().attr("id",g).show()}f.addClass("placeholder"),f[0].value=f.attr("placeholder")}else f.removeClass("placeholder")}function g(){try{return b.activeElement}catch(a){}}var h,i,j="placeholder"in b.createElement("input"),k="placeholder"in b.createElement("textarea"),l=c.fn,m=c.valHooks,n=c.propHooks;j&&k?(i=l.placeholder=function(){return this},i.input=i.textarea=!0):(i=l.placeholder=function(){var a=this;return a.filter((j?"textarea":":input")+"[placeholder]").not(".placeholder").bind({"focus.placeholder":e,"blur.placeholder":f}).data("placeholder-enabled",!0).trigger("blur.placeholder"),a},i.input=j,i.textarea=k,h={get:function(a){var b=c(a),d=b.data("placeholder-password");return d?d[0].value:b.data("placeholder-enabled")&&b.hasClass("placeholder")?"":a.value},set:function(a,b){var d=c(a),h=d.data("placeholder-password");return h?h[0].value=b:d.data("placeholder-enabled")?(""==b?(a.value=b,a!=g()&&f.call(a)):d.hasClass("placeholder")?e.call(a,!0,b)||(a.value=b):a.value=b,d):a.value=b}},j||(m.input=h,n.value=h),k||(m.textarea=h,n.value=h),c(function(){c(b).delegate("form","submit.placeholder",function(){var a=c(".placeholder",this).each(e);setTimeout(function(){a.each(f)},10)})}),c(a).bind("beforeunload.placeholder",function(){c(".placeholder").each(function(){this.value=""})}))}(this,document,jQuery);var JSON;JSON||(JSON={}),function(){function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function f(a){return 10>a?"0"+a:a}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,!b||"function"==typeof b||"object"==typeof b&&"number"==typeof b.length)return str("",{"":a});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var a=document,b=window,c={},d=function(){};d.prototype.addEventListener=function(a,b){this._listeners||(this._listeners={}),a in this._listeners||(this._listeners[a]=[]);var d=this._listeners[a];-1===c.arrIndexOf(d,b)&&d.push(b)},d.prototype.removeEventListener=function(a,b){if(this._listeners&&a in this._listeners){var d=this._listeners[a],e=c.arrIndexOf(d,b);return-1!==e?void(d.length>1?this._listeners[a]=d.slice(0,e).concat(d.slice(e+1)):delete this._listeners[a]):void 0}},d.prototype.dispatchEvent=function(a){var b=a.type,c=Array.prototype.slice.call(arguments,0);if(this["on"+b]&&this["on"+b].apply(this,c),this._listeners&&b in this._listeners)for(var d=0;d<this._listeners[b].length;d++)this._listeners[b][d].apply(this,c)};var e=function(a,b){if(this.type=a,"undefined"!=typeof b)for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])};e.prototype.toString=function(){var a=[];for(var b in this)if(this.hasOwnProperty(b)){var c=this[b];"function"==typeof c&&(c="[function]"),a.push(b+"="+c)}return"SimpleEvent("+a.join(", ")+")"};var f=function(a){var b=this;b._events=a||[],b._listeners={}};f.prototype.emit=function(a){var b=this;if(b._verifyType(a),!b._nuked){var c=Array.prototype.slice.call(arguments,1);if(b["on"+a]&&b["on"+a].apply(b,c),a in b._listeners)for(var d=0;d<b._listeners[a].length;d++)b._listeners[a][d].apply(b,c)}},f.prototype.on=function(a,b){var c=this;c._verifyType(a),c._nuked||(a in c._listeners||(c._listeners[a]=[]),c._listeners[a].push(b))},f.prototype._verifyType=function(a){var b=this;-1===c.arrIndexOf(b._events,a)&&c.log("Event "+JSON.stringify(a)+" not listed "+JSON.stringify(b._events)+" in "+b)},f.prototype.nuke=function(){var a=this;a._nuked=!0;for(var b=0;b<a._events.length;b++)delete a[a._events[b]];a._listeners={}};var g="abcdefghijklmnopqrstuvwxyz0123456789_";c.random_string=function(a,b){b=b||g.length;var c,d=[];for(c=0;a>c;c++)d.push(g.substr(Math.floor(Math.random()*b),1));return d.join("")},c.random_number=function(a){return Math.floor(Math.random()*a)},c.random_number_string=function(a){var b=(""+(a-1)).length,d=Array(b+1).join("0");return(d+c.random_number(a)).slice(-b)},c.getOrigin=function(a){a+="/";var b=a.split("/").slice(0,3);return b.join("/")},c.isSameOriginUrl=function(a,c){return c||(c=b.location.href),a.split("/").slice(0,3).join("/")===c.split("/").slice(0,3).join("/")},c.getParentDomain=function(a){if(/^[0-9.]*$/.test(a))return a;if(/^\[/.test(a))return a;if(!/[.]/.test(a))return a;var b=a.split(".").slice(1);return b.join(".")},c.objectExtend=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};var h="_jp";c.polluteGlobalNamespace=function(){h in b||(b[h]={})},c.closeFrame=function(a,b){return"c"+JSON.stringify([a,b])},c.userSetCode=function(a){return 1e3===a||a>=3e3&&4999>=a},c.countRTO=function(a){var b;return b=a>100?3*a:a+200},c.log=function(){b.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},c.bind=function(a,b){return a.bind?a.bind(b):function(){return a.apply(b,arguments)}},c.flatUrl=function(a){return-1===a.indexOf("?")&&-1===a.indexOf("#")},c.amendUrl=function(b){var d=a.location;if(!b)throw new Error("Wrong url for SockJS");if(!c.flatUrl(b))throw new Error("Only basic urls are supported in SockJS");return 0===b.indexOf("//")&&(b=d.protocol+b),0===b.indexOf("/")&&(b=d.protocol+"//"+d.host+b),b=b.replace(/[/]+$/,"")},c.arrIndexOf=function(a,b){for(var c=0;c<a.length;c++)if(a[c]===b)return c;return-1},c.arrSkip=function(a,b){var d=c.arrIndexOf(a,b);if(-1===d)return a.slice();var e=a.slice(0,d);return e.concat(a.slice(d+1))},c.isArray=Array.isArray||function(a){return{}.toString.call(a).indexOf("Array")>=0},c.delay=function(a,b){return"function"==typeof a&&(b=a,a=0),setTimeout(b,a)};var i,j=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,k={"\x00":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","	":"\\t","\n":"\\n","":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","":"\\u0080","":"\\u0081","":"\\u0082","":"\\u0083","":"\\u0084","":"\\u0085","":"\\u0086","":"\\u0087","":"\\u0088","":"\\u0089","":"\\u008a","":"\\u008b","":"\\u008c","":"\\u008d","":"\\u008e","":"\\u008f","":"\\u0090","":"\\u0091","":"\\u0092","":"\\u0093","":"\\u0094","":"\\u0095","":"\\u0096","":"\\u0097","":"\\u0098","":"\\u0099","":"\\u009a","":"\\u009b","":"\\u009c","":"\\u009d","":"\\u009e","":"\\u009f","­":"\\u00ad","؀":"\\u0600","؁":"\\u0601","؂":"\\u0602","؃":"\\u0603","؄":"\\u0604","܏":"\\u070f","឴":"\\u17b4","឵":"\\u17b5","‌":"\\u200c","‍":"\\u200d","‎":"\\u200e","‏":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","‪":"\\u202a","‫":"\\u202b","‬":"\\u202c","‭":"\\u202d","‮":"\\u202e"," ":"\\u202f","⁠":"\\u2060","⁡":"\\u2061","⁢":"\\u2062","⁣":"\\u2063","⁤":"\\u2064","⁥":"\\u2065","⁦":"\\u2066","⁧":"\\u2067","⁨":"\\u2068","⁩":"\\u2069","⁪":"\\u206a","⁫":"\\u206b","⁬":"\\u206c","⁭":"\\u206d","⁮":"\\u206e","⁯":"\\u206f","﻿":"\\ufeff","￰":"\\ufff0","￱":"\\ufff1","￲":"\\ufff2","￳":"\\ufff3","￴":"\\ufff4","￵":"\\ufff5","￶":"\\ufff6","￷":"\\ufff7","￸":"\\ufff8","￹":"\\ufff9","￺":"\\ufffa","￻":"\\ufffb","￼":"\\ufffc","�":"\\ufffd","￾":"\\ufffe","￿":"\\uffff"},l=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,m=JSON&&JSON.stringify||function(a){return j.lastIndex=0,j.test(a)&&(a=a.replace(j,function(a){return k[a]})),'"'+a+'"'},n=function(a){var b,c={},d=[];for(b=0;65536>b;b++)d.push(String.fromCharCode(b));return a.lastIndex=0,d.join("").replace(a,function(a){return c[a]="\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4),""}),a.lastIndex=0,c};c.quote=function(a){var b=m(a);return l.lastIndex=0,l.test(b)?(i||(i=n(l)),b.replace(l,function(a){return i[a]})):b};var o=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];c.probeProtocols=function(){for(var a={},b=0;b<o.length;b++){var c=o[b];a[c]=y[c]&&y[c].enabled()}return a},c.detectProtocols=function(a,b,c){var d={},e=[];b||(b=o);for(var f=0;f<b.length;f++){var g=b[f];d[g]=a[g]}var h=function(a){var b=a.shift();d[b]?e.push(b):a.length>0&&h(a)};return c.websocket!==!1&&h(["websocket"]),d["xhr-streaming"]&&!c.null_origin?e.push("xhr-streaming"):!d["xdr-streaming"]||c.cookie_needed||c.null_origin?h(["iframe-eventsource","iframe-htmlfile"]):e.push("xdr-streaming"),d["xhr-polling"]&&!c.null_origin?e.push("xhr-polling"):!d["xdr-polling"]||c.cookie_needed||c.null_origin?h(["iframe-xhr-polling","jsonp-polling"]):e.push("xdr-polling"),e};var p="_sockjs_global";c.createHook=function(){var a="a"+c.random_string(8);if(!(p in b)){var d={};b[p]=function(a){return a in d||(d[a]={id:a,del:function(){delete d[a]}}),d[a]}}return b[p](a)},c.attachMessage=function(a){c.attachEvent("message",a)},c.attachEvent=function(c,d){"undefined"!=typeof b.addEventListener?b.addEventListener(c,d,!1):(a.attachEvent("on"+c,d),b.attachEvent("on"+c,d))},c.detachMessage=function(a){c.detachEvent("message",a)},c.detachEvent=function(c,d){"undefined"!=typeof b.addEventListener?b.removeEventListener(c,d,!1):(a.detachEvent("on"+c,d),b.detachEvent("on"+c,d))};var q={},r=!1,s=function(){for(var a in q)q[a](),delete q[a]},t=function(){r||(r=!0,s())};c.attachEvent("unload",t),c.unload_add=function(a){var b=c.random_string(8);return q[b]=a,r&&c.delay(s),b},c.unload_del=function(a){a in q&&delete q[a]},c.createIframe=function(b,d){var e,f,g=a.createElement("iframe"),h=function(){clearTimeout(e);try{g.onload=null}catch(a){}g.onerror=null},i=function(){g&&(h(),setTimeout(function(){g&&g.parentNode.removeChild(g),g=null},0),c.unload_del(f))},j=function(a){g&&(i(),d(a))},k=function(a,b){try{g&&g.contentWindow&&g.contentWindow.postMessage(a,b)
}catch(c){}};return g.src=b,g.style.display="none",g.style.position="absolute",g.onerror=function(){j("onerror")},g.onload=function(){clearTimeout(e),e=setTimeout(function(){j("onload timeout")},2e3)},a.body.appendChild(g),e=setTimeout(function(){j("timeout")},15e3),f=c.unload_add(i),{post:k,cleanup:i,loaded:h}},c.createHtmlfile=function(a,d){var e,f,g,i=new ActiveXObject("htmlfile"),j=function(){clearTimeout(e)},k=function(){i&&(j(),c.unload_del(f),g.parentNode.removeChild(g),g=i=null,CollectGarbage())},l=function(a){i&&(k(),d(a))},m=function(a,b){try{g&&g.contentWindow&&g.contentWindow.postMessage(a,b)}catch(c){}};i.open(),i.write('<html><script>document.domain="'+document.domain+'";</script></html>'),i.close(),i.parentWindow[h]=b[h];var n=i.createElement("div");return i.body.appendChild(n),g=i.createElement("iframe"),n.appendChild(g),g.src=a,e=setTimeout(function(){l("timeout")},15e3),f=c.unload_add(k),{post:m,cleanup:k,loaded:j}};var u=function(){};u.prototype=new f(["chunk","finish"]),u.prototype._start=function(a,d,e,f){var g=this;try{g.xhr=new XMLHttpRequest}catch(h){}if(!g.xhr)try{g.xhr=new b.ActiveXObject("Microsoft.XMLHTTP")}catch(h){}(b.ActiveXObject||b.XDomainRequest)&&(d+=(-1===d.indexOf("?")?"?":"&")+"t="+ +new Date),g.unload_ref=c.unload_add(function(){g._cleanup(!0)});try{g.xhr.open(a,d,!0)}catch(i){return g.emit("finish",0,""),void g._cleanup()}if(f&&f.no_credentials||(g.xhr.withCredentials="true"),f&&f.headers)for(var j in f.headers)g.xhr.setRequestHeader(j,f.headers[j]);g.xhr.onreadystatechange=function(){if(g.xhr){var a=g.xhr;switch(a.readyState){case 3:try{var b=a.status,c=a.responseText}catch(a){}1223===b&&(b=204),c&&c.length>0&&g.emit("chunk",b,c);break;case 4:var b=a.status;1223===b&&(b=204),g.emit("finish",b,a.responseText),g._cleanup(!1)}}},g.xhr.send(e)},u.prototype._cleanup=function(a){var b=this;if(b.xhr){if(c.unload_del(b.unload_ref),b.xhr.onreadystatechange=function(){},a)try{b.xhr.abort()}catch(d){}b.unload_ref=b.xhr=null}},u.prototype.close=function(){var a=this;a.nuke(),a._cleanup(!0)};var v=c.XHRCorsObject=function(){var a=this,b=arguments;c.delay(function(){a._start.apply(a,b)})};v.prototype=new u;var w=c.XHRLocalObject=function(a,b,d){var e=this;c.delay(function(){e._start(a,b,d,{no_credentials:!0})})};w.prototype=new u;var x=c.XDRObject=function(a,b,d){var e=this;c.delay(function(){e._start(a,b,d)})};x.prototype=new f(["chunk","finish"]),x.prototype._start=function(a,b,d){var e=this,f=new XDomainRequest;b+=(-1===b.indexOf("?")?"?":"&")+"t="+ +new Date;var g=f.ontimeout=f.onerror=function(){e.emit("finish",0,""),e._cleanup(!1)};f.onprogress=function(){e.emit("chunk",200,f.responseText)},f.onload=function(){e.emit("finish",200,f.responseText),e._cleanup(!1)},e.xdr=f,e.unload_ref=c.unload_add(function(){e._cleanup(!0)});try{e.xdr.open(a,b),e.xdr.send(d)}catch(h){g()}},x.prototype._cleanup=function(a){var b=this;if(b.xdr){if(c.unload_del(b.unload_ref),b.xdr.ontimeout=b.xdr.onerror=b.xdr.onprogress=b.xdr.onload=null,a)try{b.xdr.abort()}catch(d){}b.unload_ref=b.xdr=null}},x.prototype.close=function(){var a=this;a.nuke(),a._cleanup(!0)},c.isXHRCorsCapable=function(){return b.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:b.XDomainRequest&&a.domain?2:L.enabled()?3:4};var y=function(a,d,e){if(this===b)return new y(a,d,e);var f,g=this;g._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},e&&c.objectExtend(g._options,e),g._base_url=c.amendUrl(a),g._server=g._options.server||c.random_number_string(1e3),g._options.protocols_whitelist&&g._options.protocols_whitelist.length?f=g._options.protocols_whitelist:(f="string"==typeof d&&d.length>0?[d]:c.isArray(d)?d:null,f&&g._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),g._protocols=[],g.protocol=null,g.readyState=y.CONNECTING,g._ir=S(g._base_url),g._ir.onfinish=function(a,b){g._ir=null,a?(g._options.info&&(a=c.objectExtend(a,g._options.info)),g._options.rtt&&(b=g._options.rtt),g._applyInfo(a,b,f),g._didClose()):g._didClose(1002,"Can't connect to server",!0)}};y.prototype=new d,y.version="0.3.4",y.CONNECTING=0,y.OPEN=1,y.CLOSING=2,y.CLOSED=3,y.prototype._debug=function(){this._options.debug&&c.log.apply(c,arguments)},y.prototype._dispatchOpen=function(){var a=this;a.readyState===y.CONNECTING?(a._transport_tref&&(clearTimeout(a._transport_tref),a._transport_tref=null),a.readyState=y.OPEN,a.dispatchEvent(new e("open"))):a._didClose(1006,"Server lost session")},y.prototype._dispatchMessage=function(a){var b=this;b.readyState===y.OPEN&&b.dispatchEvent(new e("message",{data:a}))},y.prototype._dispatchHeartbeat=function(){var a=this;a.readyState===y.OPEN&&a.dispatchEvent(new e("heartbeat",{}))},y.prototype._didClose=function(a,b,d){var f=this;if(f.readyState!==y.CONNECTING&&f.readyState!==y.OPEN&&f.readyState!==y.CLOSING)throw new Error("INVALID_STATE_ERR");f._ir&&(f._ir.nuke(),f._ir=null),f._transport&&(f._transport.doCleanup(),f._transport=null);var g=new e("close",{code:a,reason:b,wasClean:c.userSetCode(a)});if(!c.userSetCode(a)&&f.readyState===y.CONNECTING&&!d){if(f._try_next_protocol(g))return;g=new e("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:g})}f.readyState=y.CLOSED,c.delay(function(){f.dispatchEvent(g)})},y.prototype._didMessage=function(a){var b=this,c=a.slice(0,1);switch(c){case"o":b._dispatchOpen();break;case"a":for(var d=JSON.parse(a.slice(1)||"[]"),e=0;e<d.length;e++)b._dispatchMessage(d[e]);break;case"m":var d=JSON.parse(a.slice(1)||"null");b._dispatchMessage(d);break;case"c":var d=JSON.parse(a.slice(1)||"[]");b._didClose(d[0],d[1]);break;case"h":b._dispatchHeartbeat()}},y.prototype._try_next_protocol=function(b){var d=this;for(d.protocol&&(d._debug("Closed transport:",d.protocol,""+b),d.protocol=null),d._transport_tref&&(clearTimeout(d._transport_tref),d._transport_tref=null);;){var e=d.protocol=d._protocols.shift();if(!e)return!1;if(y[e]&&y[e].need_body===!0&&(!a.body||"undefined"!=typeof a.readyState&&"complete"!==a.readyState))return d._protocols.unshift(e),d.protocol="waiting-for-load",c.attachEvent("load",function(){d._try_next_protocol()}),!0;if(y[e]&&y[e].enabled(d._options)){var f=y[e].roundTrips||1,g=(d._options.rto||0)*f||5e3;d._transport_tref=c.delay(g,function(){d.readyState===y.CONNECTING&&d._didClose(2007,"Transport timeouted")});var h=c.random_string(8),i=d._base_url+"/"+d._server+"/"+h;return d._debug("Opening transport:",e," url:"+i," RTO:"+d._options.rto),d._transport=new y[e](d,i,d._base_url),!0}d._debug("Skipping transport:",e)}},y.prototype.close=function(a,b){var d=this;if(a&&!c.userSetCode(a))throw new Error("INVALID_ACCESS_ERR");return d.readyState!==y.CONNECTING&&d.readyState!==y.OPEN?!1:(d.readyState=y.CLOSING,d._didClose(a||1e3,b||"Normal closure"),!0)},y.prototype.send=function(a){var b=this;if(b.readyState===y.CONNECTING)throw new Error("INVALID_STATE_ERR");return b.readyState===y.OPEN&&b._transport.doSend(c.quote(""+a)),!0},y.prototype._applyInfo=function(b,d,e){var f=this;f._options.info=b,f._options.rtt=d,f._options.rto=c.countRTO(d),f._options.info.null_origin=!a.domain;var g=c.probeProtocols();f._protocols=c.detectProtocols(g,e,b)};var z=y.websocket=function(a,d){var e=this,f=d+"/websocket";f="https"===f.slice(0,5)?"wss"+f.slice(5):"ws"+f.slice(4),e.ri=a,e.url=f;var g=b.WebSocket||b.MozWebSocket;e.ws=new g(e.url),e.ws.onmessage=function(a){e.ri._didMessage(a.data)},e.unload_ref=c.unload_add(function(){e.ws.close()}),e.ws.onclose=function(){e.ri._didMessage(c.closeFrame(1006,"WebSocket connection broken"))}};z.prototype.doSend=function(a){this.ws.send("["+a+"]")},z.prototype.doCleanup=function(){var a=this,b=a.ws;b&&(b.onmessage=b.onclose=null,b.close(),c.unload_del(a.unload_ref),a.unload_ref=a.ri=a.ws=null)},z.enabled=function(){return!(!b.WebSocket&&!b.MozWebSocket)},z.roundTrips=2;var A=function(){};A.prototype.send_constructor=function(a){var b=this;b.send_buffer=[],b.sender=a},A.prototype.doSend=function(a){var b=this;b.send_buffer.push(a),b.send_stop||b.send_schedule()},A.prototype.send_schedule_wait=function(){var a,b=this;b.send_stop=function(){b.send_stop=null,clearTimeout(a)},a=c.delay(25,function(){b.send_stop=null,b.send_schedule()})},A.prototype.send_schedule=function(){var a=this;if(a.send_buffer.length>0){var b="["+a.send_buffer.join(",")+"]";a.send_stop=a.sender(a.trans_url,b,function(b,c){a.send_stop=null,b===!1?a.ri._didClose(1006,"Sending error "+c):a.send_schedule_wait()}),a.send_buffer=[]}},A.prototype.send_destructor=function(){var a=this;a._send_stop&&a._send_stop(),a._send_stop=null};var B=function(b,d,e){var f=this;if(!("_send_form"in f)){var g=f._send_form=a.createElement("form"),h=f._send_area=a.createElement("textarea");h.name="d",g.style.display="none",g.style.position="absolute",g.method="POST",g.enctype="application/x-www-form-urlencoded",g.acceptCharset="UTF-8",g.appendChild(h),a.body.appendChild(g)}var g=f._send_form,h=f._send_area,i="a"+c.random_string(8);g.target=i,g.action=b+"/jsonp_send?i="+i;var j;try{j=a.createElement('<iframe name="'+i+'">')}catch(k){j=a.createElement("iframe"),j.name=i}j.id=i,g.appendChild(j),j.style.display="none";try{h.value=d}catch(l){c.log("Your browser is seriously broken. Go home! "+l.message)}g.submit();var m=function(){j.onerror&&(j.onreadystatechange=j.onerror=j.onload=null,c.delay(500,function(){j.parentNode.removeChild(j),j=null}),h.value="",e(!0))};return j.onerror=j.onload=m,j.onreadystatechange=function(){"complete"==j.readyState&&m()},m},C=function(a){return function(b,c,d){var e=new a("POST",b+"/xhr_send",c);return e.onfinish=function(a){d(200===a||204===a,"http status "+a)},function(a){d(!1,a)}}},D=function(b,d){var e,f,g=a.createElement("script"),h=function(a){f&&(f.parentNode.removeChild(f),f=null),g&&(clearTimeout(e),g.parentNode.removeChild(g),g.onreadystatechange=g.onerror=g.onload=g.onclick=null,g=null,d(a),d=null)},i=!1,j=null;if(g.id="a"+c.random_string(8),g.src=b,g.type="text/javascript",g.charset="UTF-8",g.onerror=function(){j||(j=setTimeout(function(){i||h(c.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},g.onload=function(){h(c.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},g.onreadystatechange=function(){if(/loaded|closed/.test(g.readyState)){if(g&&g.htmlFor&&g.onclick){i=!0;try{g.onclick()}catch(a){}}g&&h(c.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof g.async&&a.attachEvent)if(/opera/i.test(navigator.userAgent))f=a.createElement("script"),f.text="try{var a = document.getElementById('"+g.id+"'); if(a)a.onerror();}catch(x){};",g.async=f.async=!1;else{try{g.htmlFor=g.id,g.event="onclick"}catch(k){}g.async=!0}"undefined"!=typeof g.async&&(g.async=!0),e=setTimeout(function(){h(c.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var l=a.getElementsByTagName("head")[0];return l.insertBefore(g,l.firstChild),f&&l.insertBefore(f,l.firstChild),h},E=y["jsonp-polling"]=function(a,b){c.polluteGlobalNamespace();var d=this;d.ri=a,d.trans_url=b,d.send_constructor(B),d._schedule_recv()};E.prototype=new A,E.prototype._schedule_recv=function(){var a=this,b=function(b){a._recv_stop=null,b&&(a._is_closing||a.ri._didMessage(b)),a._is_closing||a._schedule_recv()};a._recv_stop=F(a.trans_url+"/jsonp",D,b)},E.enabled=function(){return!0},E.need_body=!0,E.prototype.doCleanup=function(){var a=this;a._is_closing=!0,a._recv_stop&&a._recv_stop(),a.ri=a._recv_stop=null,a.send_destructor()};var F=function(a,d,e){var f="a"+c.random_string(6),g=a+"?c="+escape(h+"."+f),i=0,j=function(a){switch(i){case 0:delete b[h][f],e(a);break;case 1:e(a),i=2;break;case 2:delete b[h][f]}},k=d(g,j);b[h][f]=k;var l=function(){b[h][f]&&(i=1,b[h][f](c.closeFrame(1e3,"JSONP user aborted read")))};return l},G=function(){};G.prototype=new A,G.prototype.run=function(a,b,c,d,e){var f=this;f.ri=a,f.trans_url=b,f.send_constructor(C(e)),f.poll=new $(a,d,b+c,e)},G.prototype.doCleanup=function(){var a=this;a.poll&&(a.poll.abort(),a.poll=null)};var H=y["xhr-streaming"]=function(a,b){this.run(a,b,"/xhr_streaming",db,c.XHRCorsObject)};H.prototype=new G,H.enabled=function(){return b.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},H.roundTrips=2,H.need_body=!0;var I=y["xdr-streaming"]=function(a,b){this.run(a,b,"/xhr_streaming",db,c.XDRObject)};I.prototype=new G,I.enabled=function(){return!!b.XDomainRequest},I.roundTrips=2;var J=y["xhr-polling"]=function(a,b){this.run(a,b,"/xhr",db,c.XHRCorsObject)};J.prototype=new G,J.enabled=H.enabled,J.roundTrips=2;var K=y["xdr-polling"]=function(a,b){this.run(a,b,"/xhr",db,c.XDRObject)};K.prototype=new G,K.enabled=I.enabled,K.roundTrips=2;var L=function(){};L.prototype.i_constructor=function(a,b,d){var e=this;e.ri=a,e.origin=c.getOrigin(d),e.base_url=d,e.trans_url=b;var f=d+"/iframe.html";e.ri._options.devel&&(f+="?t="+ +new Date),e.window_id=c.random_string(8),f+="#"+e.window_id,e.iframeObj=c.createIframe(f,function(a){e.ri._didClose(1006,"Unable to load an iframe ("+a+")")}),e.onmessage_cb=c.bind(e.onmessage,e),c.attachMessage(e.onmessage_cb)},L.prototype.doCleanup=function(){var a=this;if(a.iframeObj){c.detachMessage(a.onmessage_cb);try{a.iframeObj.iframe.contentWindow&&a.postMessage("c")}catch(b){}a.iframeObj.cleanup(),a.iframeObj=null,a.onmessage_cb=a.iframeObj=null}},L.prototype.onmessage=function(a){var b=this;if(a.origin===b.origin){var c=a.data.slice(0,8),d=a.data.slice(8,9),e=a.data.slice(9);if(c===b.window_id)switch(d){case"s":b.iframeObj.loaded(),b.postMessage("s",JSON.stringify([y.version,b.protocol,b.trans_url,b.base_url]));break;case"t":b.ri._didMessage(e)}}},L.prototype.postMessage=function(a,b){var c=this;c.iframeObj.post(c.window_id+a+(b||""),c.origin)},L.prototype.doSend=function(a){this.postMessage("m",a)},L.enabled=function(){var a=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof b.postMessage||"object"==typeof b.postMessage)&&!a};var M,N=function(a,d){parent!==b?parent.postMessage(M+a+(d||""),"*"):c.log("Can't postMessage, no parent window.",a,d)},O=function(){};O.prototype._didClose=function(a,b){N("t",c.closeFrame(a,b))},O.prototype._didMessage=function(a){N("t",a)},O.prototype._doSend=function(a){this._transport.doSend(a)},O.prototype._doCleanup=function(){this._transport.doCleanup()},c.parent_origin=void 0,y.bootstrap_iframe=function(){var d;M=a.location.hash.slice(1);var e=function(a){if(a.source===parent&&("undefined"==typeof c.parent_origin&&(c.parent_origin=a.origin),a.origin===c.parent_origin)){var e=a.data.slice(0,8),f=a.data.slice(8,9),g=a.data.slice(9);if(e===M)switch(f){case"s":var h=JSON.parse(g),i=h[0],j=h[1],k=h[2],l=h[3];if(i!==y.version&&c.log('Incompatibile SockJS! Main site uses: "'+i+'", the iframe: "'+y.version+'".'),!c.flatUrl(k)||!c.flatUrl(l))return void c.log("Only basic urls are supported in SockJS");if(!c.isSameOriginUrl(k)||!c.isSameOriginUrl(l))return void c.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([b.location.href,k,l])+")");d=new O,d._transport=new O[j](d,k,l);break;case"m":d._doSend(g);break;case"c":d&&d._doCleanup(),d=null}}};c.attachMessage(e),N("s")};var P=function(a,b){var d=this;c.delay(function(){d.doXhr(a,b)})};P.prototype=new f(["finish"]),P.prototype.doXhr=function(a,b){var d=this,e=(new Date).getTime(),f=new b("GET",a+"/info"),g=c.delay(8e3,function(){f.ontimeout()});f.onfinish=function(a,b){if(clearTimeout(g),g=null,200===a){var c=(new Date).getTime()-e,f=JSON.parse(b);"object"!=typeof f&&(f={}),d.emit("finish",f,c)}else d.emit("finish")},f.ontimeout=function(){f.close(),d.emit("finish")}};var Q=function(b){var d=this,e=function(){var a=new L;a.protocol="w-iframe-info-receiver";var c=function(b){if("string"==typeof b&&"m"===b.substr(0,1)){var c=JSON.parse(b.substr(1)),e=c[0],f=c[1];d.emit("finish",e,f)}else d.emit("finish");a.doCleanup(),a=null},e={_options:{},_didClose:c,_didMessage:c};a.i_constructor(e,b,b)};a.body?e():c.attachEvent("load",e)};Q.prototype=new f(["finish"]);var R=function(){var a=this;c.delay(function(){a.emit("finish",{},2e3)})};R.prototype=new f(["finish"]);var S=function(a){if(c.isSameOriginUrl(a))return new P(a,c.XHRLocalObject);switch(c.isXHRCorsCapable()){case 1:return new P(a,c.XHRLocalObject);case 2:return new P(a,c.XDRObject);case 3:return new Q(a);default:return new R}},T=O["w-iframe-info-receiver"]=function(a,b,d){var e=new P(d,c.XHRLocalObject);e.onfinish=function(b,c){a._didMessage("m"+JSON.stringify([b,c])),a._didClose()}};T.prototype.doCleanup=function(){};var U=y["iframe-eventsource"]=function(){var a=this;a.protocol="w-iframe-eventsource",a.i_constructor.apply(a,arguments)};U.prototype=new L,U.enabled=function(){return"EventSource"in b&&L.enabled()},U.need_body=!0,U.roundTrips=3;var V=O["w-iframe-eventsource"]=function(a,b){this.run(a,b,"/eventsource",_,c.XHRLocalObject)};V.prototype=new G;var W=y["iframe-xhr-polling"]=function(){var a=this;a.protocol="w-iframe-xhr-polling",a.i_constructor.apply(a,arguments)};W.prototype=new L,W.enabled=function(){return b.XMLHttpRequest&&L.enabled()},W.need_body=!0,W.roundTrips=3;var X=O["w-iframe-xhr-polling"]=function(a,b){this.run(a,b,"/xhr",db,c.XHRLocalObject)};X.prototype=new G;var Y=y["iframe-htmlfile"]=function(){var a=this;a.protocol="w-iframe-htmlfile",a.i_constructor.apply(a,arguments)};Y.prototype=new L,Y.enabled=function(){return L.enabled()},Y.need_body=!0,Y.roundTrips=3;var Z=O["w-iframe-htmlfile"]=function(a,b){this.run(a,b,"/htmlfile",cb,c.XHRLocalObject)};Z.prototype=new G;var $=function(a,b,c,d){var e=this;e.ri=a,e.Receiver=b,e.recv_url=c,e.AjaxObject=d,e._scheduleRecv()};$.prototype._scheduleRecv=function(){var a=this,b=a.poll=new a.Receiver(a.recv_url,a.AjaxObject),c=0;b.onmessage=function(b){c+=1,a.ri._didMessage(b.data)},b.onclose=function(c){a.poll=b=b.onmessage=b.onclose=null,a.poll_is_closing||("permanent"===c.reason?a.ri._didClose(1006,"Polling error ("+c.reason+")"):a._scheduleRecv())}},$.prototype.abort=function(){var a=this;a.poll_is_closing=!0,a.poll&&a.poll.abort()};var _=function(a){var b=this,d=new EventSource(a);d.onmessage=function(a){b.dispatchEvent(new e("message",{data:unescape(a.data)}))},b.es_close=d.onerror=function(a,f){var g=f?"user":2!==d.readyState?"network":"permanent";b.es_close=d.onmessage=d.onerror=null,d.close(),d=null,c.delay(200,function(){b.dispatchEvent(new e("close",{reason:g}))})}};_.prototype=new d,_.prototype.abort=function(){var a=this;a.es_close&&a.es_close({},!0)};var ab,bb=function(){if(void 0===ab)if("ActiveXObject"in b)try{ab=!!new ActiveXObject("htmlfile")}catch(a){}else ab=!1;return ab},cb=function(a){var d=this;c.polluteGlobalNamespace(),d.id="a"+c.random_string(6,26),a+=(-1===a.indexOf("?")?"?":"&")+"c="+escape(h+"."+d.id);var f,g=bb()?c.createHtmlfile:c.createIframe;b[h][d.id]={start:function(){f.loaded()},message:function(a){d.dispatchEvent(new e("message",{data:a}))},stop:function(){d.iframe_close({},"network")}},d.iframe_close=function(a,c){f.cleanup(),d.iframe_close=f=null,delete b[h][d.id],d.dispatchEvent(new e("close",{reason:c}))},f=g(a,function(){d.iframe_close({},"permanent")})};cb.prototype=new d,cb.prototype.abort=function(){var a=this;a.iframe_close&&a.iframe_close({},"user")};var db=function(a,b){var c=this,d=0;c.xo=new b("POST",a,null),c.xo.onchunk=function(a,b){if(200===a)for(;;){var f=b.slice(d),g=f.indexOf("\n");if(-1===g)break;d+=g+1;var h=f.slice(0,g);c.dispatchEvent(new e("message",{data:h}))}},c.xo.onfinish=function(a,b){c.xo.onchunk(a,b),c.xo=null;var d=200===a?"network":"permanent";c.dispatchEvent(new e("close",{reason:d}))}};return db.prototype=new d,db.prototype.abort=function(){var a=this;a.xo&&(a.xo.close(),a.dispatchEvent(new e("close",{reason:"user"})),a.xo=null)},y.getUtils=function(){return c},y.getIframeTransport=function(){return L},y}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),function(){var a,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=jQuery,a.fn.validateCreditCard=function(c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q;for(g=[{name:"amex",pattern:/^3[47]/,valid_length:[15]},{name:"diners_club_carte_blanche",pattern:/^30[0-5]/,valid_length:[14]},{name:"diners_club_international",pattern:/^3[68]/,valid_length:[14]},{name:"jcb",pattern:/^35(2[89]|[3-8][0-9])/,valid_length:[16]},{name:"laser",pattern:/^(6304|670[69]|6771)/,valid_length:[16,17,18,19]},{name:"visa_electron",pattern:/^(4026|417500|4405|4508|4844|491(3|7))/,valid_length:[16]},{name:"visa",pattern:/^4/,valid_length:[13,16]},{name:"mastercard",pattern:/^5[1-5]/,valid_length:[16]},{name:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,valid_length:[12,13,14,15,16,17,18,19]},{name:"discover",pattern:/^(6011|622(12[6-9]|1[3-9][0-9]|[2-8][0-9]{2}|9[0-1][0-9]|92[0-5]|64[4-9])|65)/,valid_length:[16]}],null==d&&(d={}),null==(p=d.accept)&&(d.accept=function(){var a,b,c;for(c=[],a=0,b=g.length;b>a;a++)e=g[a],c.push(e.name);return c}()),q=d.accept,n=0,o=q.length;o>n;n++)if(f=q[n],b.call(function(){var a,b,c;for(c=[],a=0,b=g.length;b>a;a++)e=g[a],c.push(e.name);return c}(),f)<0)throw"Credit card type '"+f+"' is not supported";return h=function(a){var c,h,i;for(i=function(){var a,c,f,h;for(h=[],a=0,c=g.length;c>a;a++)e=g[a],f=e.name,b.call(d.accept,f)>=0&&h.push(e);return h}(),c=0,h=i.length;h>c;c++)if(f=i[c],a.match(f.pattern))return f;return null},j=function(a){var b,c,d,e,f,g;for(d=0,g=a.split("").reverse(),c=e=0,f=g.length;f>e;c=++e)b=g[c],b=+b,c%2?(b*=2,d+=10>b?b:b-9):d+=b;return d%10===0},i=function(a,c){var d;return d=a.length,b.call(c.valid_length,d)>=0},m=function(a,b){var d,e;return f=h(a),e=!1,d=!1,null!=f&&(e=j(a),d=i(a,f)),c({card_type:f,luhn_valid:e,length_valid:d},b)},l=function(b){var c;return c=k(a(this).val()),m(c,b)},k=function(a){return a.replace(/[ -]/g,"")},this.bind("input",function(){return a(this).unbind("keyup"),l.call(this,"input")}),this.bind("keyup",function(){return l.call(this,"keyup")}),this.bind("blur",function(){return l.call(this,"blur")}),this.bind(""),0!==this.length&&l.call(this),this.data("validateFunc",l),this.data("getCardTypeFunc",function(){var b;return b=k(a(this).val()),h(b)}),this}}.call(this),function(){"use strict";var a=Marionette.Renderer.render;Marionette.Renderer.render=function(b,c){return c=_.extend(c,{config:KXL.config,switches:KXL.switches}),a(b,c)},Marionette.TemplateCache.prototype.compileTemplate=function(a){return Handlebars.compile(a)},Marionette.Application.prototype.asyncRequest=function(){var a=Array.prototype.slice.apply(arguments);return Backbone.Wreqr.RequestResponse.prototype.asyncRequest.apply(this.reqres,a)}}(),function(){"use strict";Backbone&&Backbone.Collection&&_.extend(Backbone.Collection.prototype,{save:function(){if(!this.url)throw"This collection does not have a url to save to.";var a;a="function"==typeof this.url?this.url():this.url;var b=[],c=[];_.each(this.models,function(a){a.isNew()?b.push(a.attributes):a.hasChanged()&&c.push(a.changedAttributes())});var d,e;return b.length&&(d=Backbone.ajax({url:a,type:"POST",data:JSON.stringify(b),dataType:"json",contentType:"application/json"})),c.length&&(e=Backbone.ajax({url:a,type:"PATCH",data:JSON.stringify(c),dataType:"json",contentType:"application/json"})),{postDeferred:d,patchDeferred:e}},saveAll:function(){var a=[];return _.each(this.models,function(b){a.push(b.save())}),a},search:function(a){return this.fetch(_.extend(a||{},{headers:{"X-HTTP-Method-Override":"SEARCH"}}))}})}(),function(){"use strict";if(Backbone&&Backbone.Model){var a=Backbone.Model;Backbone.Model=Backbone.Model.extend({constructor:function(){this._originalAttrs={},this._unsavedChanges={};var b=a.apply(this,arguments);return this._resetTracking(),b}}),_.extend(Backbone.Model.prototype,{_triggerUnsavedChanges:function(){this.trigger("unsavedChanges",!_.isEmpty(this._unsavedChanges),_.clone(this._unsavedChanges),this)},unsavedAttributes:function(a){if(!a)return _.isEmpty(this._unsavedChanges)?!1:_.clone(this._unsavedChanges);var b,c=!1,d=this._unsavedChanges;for(var e in a)_.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},_resetTracking:function(){this._originalAttrs=_.clone(this.attributes),this._unsavedChanges={}},set:_.wrap(Backbone.Model.prototype.set,function(a,b,c,d){var e,f,g=this;return null==b?this:("object"==typeof b?(e=b,d=c):(e={})[b]=c,d||(d={}),f=a.call(this,e,d),d.silent||(_.each(e,function(a,b){_.isEqual(g._originalAttrs[b],a)?delete g._unsavedChanges[b]:g._unsavedChanges[b]=a}),this._triggerUnsavedChanges()),f)}),save:_.wrap(Backbone.Model.prototype.save,function(a,b,c,d){var e=null==b||"object"==typeof b,f=this;return!e||(d=c,this.isNew()||_.size(b)||(b=d&&d.unsaved?this.unsavedAttributes():this.changedAttributes()))?(d=d||{},d.success=_.wrap(d.success,function(a,b,c,d){var e;return a&&(e=a.call(this,b,c,d)),f._resetTracking(),f._triggerUnsavedChanges(),f.trigger("save"),e}),d.patch=!d.put,e?a.call(this,b,d):a.call(this,b,c,d)):(d&&d.success&&d.success.call(this,this),!1)}),fetch:_.wrap(Backbone.Model.prototype.fetch,function(a,b){var c=this;return b=b||{},b.success=_.wrap(b.success,function(a,b,d,e){var f;return a&&(f=a.call(this,b,d,e)),c._resetTracking(),c._triggerUnsavedChanges(),f}),a.call(this,b)}),toJSON:function(){return this.blacklist?_.omit(this.attributes,this.blacklist):_.clone(this.attributes)}})}}(),function(){"use strict";Backbone.FilteredCollection.prototype.setFilter=function(a,b){b||(b={}),a===!1&&(a=this.defaultFilter),this.collectionFilter=a||this.collectionFilter||this.defaultFilter;var c=this.collectionFilter,d=this._mapping,e=[],f=_.extend({},b);this.collection.each(function(a,b){var g=d.indexOf(b);c(a,b,e)?(e.push(a),-1==g&&(f.index=b,this._forceAddModel(a,f))):g>-1&&(f.index=-1==g?this.length:g,this._forceRemoveModel(a,f))},this),b.silent||this._filterComplete()},Backbone.FilteredCollection.prototype._modelChanged=function(a,b,c){c||(c={});var d=this.indexOf(a);if(this.collectionFilter(a,d,this.models)){if(0>d){var e=this.collection.indexOf(a);this._forceAddModel(a,{index:e})}}else d>-1&&this._forceRemoveModel(a,{index:d});c.silent||this._filterComplete()},Backbone.FilteredCollection.prototype.addModel=function(a,b,c){this.collectionFilter(a,void 0,this.models)&&this._forceAddModel(a,_.extend(c||{},{index:c&&c.at||b.indexOf(a)})),this.renumberMappings()}}();var KXL=new Marionette.Application;!function(){var a=[];KXL.AppModel=Backbone.Model.extend({defaults:function(){return{currentUser:null,context:null,currentProfilePageUser:null,currentProfilePageUserId:null,friends:null,sentFriendRequests:null,receivedFriendRequests:null,deferredRegBarShowing:!1,dialogShowing:!1,deferredRegDialogOverridden:!1,attackBeaconEnabled:!1,attackBeaconShowing:!1,sideBarState:void 0}},lock:function(b){b&&a.push(b)},unlock:function(b){var c;b&&-1!==(c=a.indexOf(b))&&a.splice(c,1)},set:_.wrap(Backbone.Model.prototype.set,function(b,c,d,e){var f;return null==c?this:("object"==typeof c?(f=c,e=d):(f={})[c]=d,f=_.omit(f,a),b.call(this,f,e))})})}(),KXL.appModel=new KXL.AppModel,KXL.atom=new atom,KXL.Templates={},KXL.on("initialize:before",function(a){if(KXL.configBaseInitializeBefore(a),KXL.config.BI_LOGGING=a.kxBiLogging,KXL.config.autoRegCommonNames=a.autoRegCommonNames,KXL.config.SHOW_GAMES=a.showGames,KXL.switches=a.switches,KXL.config.chatFlashInterval=a.chatFlashInterval,KXL.config.SUPPORT_URL="https://www.kixeye.com/support/",KXL.config.FORUM_URL=a.forumUrl,KXL.config.SITE_CONTENT_URL=a.siteContentUrl,KXL.config.GAPI_CLIENT_ID=a.gapiClientId,KXL.config.braintreeJavascriptUrl=a.braintreeJavascriptUrl,KXL.config.braintreeEncryptionKey=a.braintreeEncryptionKey,KXL.config.braintreeMerchantId=a.braintreeMerchantId,KXL.config.braintreeKountMerchantId=a.braintreeKountMerchantId,KXL.config.warcommander={},KXL.config.warcommander.guide={},KXL.config.warcommander.guide.url=a.warCommanderGuideUrl,KXL.config.warcommander.guide.path=a.warCommanderGuidePath,KXL.config.battlepirates={},KXL.config.battlepirates.guide={},KXL.config.battlepirates.guide.url=a.battlePiratesGuideUrl,KXL.config.battlepirates.guide.path=a.battlePiratesGuidePath,KXL.config.TOME_MICROSITE_URL=a.tomeMicrositeUrl,KXL.config.LEGAL_URL=a.legalUrl,KXL.config.unsubEmailLink=a.unsubEmailLink,KXL.config.RECAPTCHA_PUBLIC_KEY=a.recaptchaPublicKey,KXL.config.AYAH_EVENT_ORIGIN=a.ayahEventOrigin,KXL.config.USER_MESSAGE_SUFFIX=a.userMessageSuffix,KXL.config.chatHistoryLimit=500,KXL.config.staticGames=a.staticGames,KXL.config.groupGames=a.groupGames,KXL.config.avatarPresets=a.avatarPresets,KXL.config.adWords=JSON.parse(a.adWords),KXL.config.hashChange=a.hashChange,KXL.config.xsollaSandbox=a.xsollaSandbox,KXL.webGames=KXL.request("webgames:entities",KXL.games),KXL.pagesMeta=KXL.request("page:meta:entities",a.pagesMeta),KXL.config.notificationSettings=[{settingId:"showGroupInviteNotifications",filteredNotificationTypes:["group-invite-added"]},{settingId:"showGroupAcceptedApplicationNotifications",filteredNotificationTypes:["group-applicant-added","group-applicant-accepted","group-new-member"]},{settingId:"showGroupPromotionDemotionNotifications",filteredNotificationTypes:["group-member-promoted","group-member-demoted","group-member-left","group-member-booted"]},{settingId:"showAllGroupPostNotifications",filteredNotificationTypes:["group-discussion-comment","group-discussion-like","group-updated","group-new-discussion"]},{settingId:"showWallPosts",filteredNotificationTypes:["notif-wall"]},{settingId:"showAttackNotifications",filteredNotificationTypes:["notif-underattack","urgent"]},{settingId:"showGiftNotifications",filteredNotificationTypes:["gift-sent"]},{settingId:"showGameInviteNotifications",filteredNotificationTypes:["invite"]},{settingId:"showGameUpdateNotifications",filteredNotificationTypes:["game-update"]},{settingId:"showForumUpdatesToBookmarkedThread",filteredNotificationTypes:["notif-thread-replied-bookmarked"]},{settingId:"showForumUpdatesToCreatedThread",filteredNotificationTypes:["notif-thread-replied-created","notif-thread-replied","notif-thread"]},{settingId:"showForumUpdatesToRepliedThread",filteredNotificationTypes:["notif-thread-replied-replied"]},{settingId:"showForumUpdatesToQuotedThread",filteredNotificationTypes:["notif-thread-quoted"]},{settingId:"showForumUpdatesToVotedThread",filteredNotificationTypes:["notif-thread-voted"]}],setWebsocketListeners(),KXL.currentUserGroupApplications=new KXL.Group.Entities.UserGroupApplications,KXL.fetchingCurrentUserGroups=$.Deferred(),a.currentUser){KXL.appModel.set("userSettings",KXL.request("new:user:settings:entity",a.currentUser.settings)),delete a.currentUser.settings,KXL.currentUser=KXL.request("new:user:entity",a.currentUser),KXL.appModel.set("currentUser",KXL.currentUser);var b=[];_.each(a.userGames,function(a){KXL.games.get(a.gameId)&&b.push(a)}),KXL.currentUserGames=new KXL.Entities.UserGamesCollection(b,{userId:KXL.currentUser.id}),KXL.currentUserGames.length&&KXL.execute("context:set",KXL.games.get(KXL.currentUserGames.first().id)),a.userGroups&&(KXL.currentUserGroups=new KXL.Group.Entities.UserGroups(a.userGroups,{parse:!0}),KXL.fetchingCurrentUserGroups.resolve(KXL.currentUserGroups))}else KXL.appModel.set("userSettings",KXL.request("new:user:settings:entity",{})),KXL.currentUser=null,KXL.currentUserGames=null,KXL.vent.on("auth:changed",function(){KXL.currentUserGroupApplications=new KXL.Group.Entities.UserGroupApplications});KXL.appModel.on("change:currentUser",function(){function a(){KXL.vent.trigger("app:reset"),KXL.vent.trigger("auth:changed")}var b=KXL.appModel.get("currentUser");b&&b.on("change:status",a)}),KXL.appModel.set("supportedLocales",KXL.request("new:locales:entity",KXL.config.supportedLocales)),KXL.config.animationCapabilities=!0,KXL.config.browser=a.browser,KXL.config.platform=a.platform,"Internet Explorer"===a.browser.name&&parseFloat(a.browser.version)<10&&(KXL.config.animationCapabilities=!1),KXL.animate=new KXL.Animations.Tweening({animationCapabilities:KXL.config.animationCapabilities,easingStyle:"Power2.easeInOut",animationOverlap:"-=.75"}),KXL.staticGames=KXL.request("staticgames:entities"),KXL.addRegions({headerRegion:"#header-region",homeRegion:"#home-region",gameRegion:"#game-region",leaderboardRegion:"#leaderboard-region",playRegion:"#play-region",inboxRegion:"#inbox-region",forumRegion:"#forum-region",guideRegion:"#guide-region",profileRegion:"#profile-region",settingsRegion:"#settings-region",sidebarRegion:"#sidebar-region",landingPageRegion:"#landing-page-region",footerRegion:"#footer-region",errorRegion:"#error-region",groupRegion:"#group-region",dialogRegion:KXL.Components.DialogRegion.extend({el:"#dialog-region"})}),KXL.appModel.set("pages",new KXL.Entities.SingleSelectCollection([{id:"home",region:KXL.homeRegion,name:"home"},{id:"profile",region:KXL.profileRegion,name:"profile"},{id:"settings",region:KXL.settingsRegion,name:"settings"},{id:"error",region:KXL.errorRegion,name:"error"},{id:"game",region:KXL.gameRegion,name:"game"},{id:"leaderboard",region:KXL.leaderboardRegion,name:"leaderboard"},{id:"play",region:KXL.playRegion,hideByOffset:!0,hideFooter:!0,hideOnlineCounter:!0,name:"play"},{id:"landing",region:KXL.landingPageRegion,name:"landing"},{id:"forum",region:KXL.forumRegion,name:"forum"},{id:"inbox",region:KXL.inboxRegion},{id:"guide",region:KXL.guideRegion,name:"guide"},{id:"group",region:KXL.groupRegion,loadedTimestamp:null,showNavTab:!0,name:"group"}])),KXL.appModel.get("pages").on("select:one",function(a){if(a){var b=a.get("region");
b&&(b.ensureEl(),a.get("hideByOffset")&&b.$el.removeClass("kx-offset-hide"),b.$el.show())}}),KXL.appModel.get("pages").on("deselect:one",function(a){if(a){var b=a.get("region");b&&(b.ensureEl(),a.get("hideByOffset")?b.$el.addClass("kx-offset-hide"):b.$el.hide())}}),window.onYouTubePlayerReady=function(a){KXL.vent.trigger("youtube:player:ready",a)},KXL.module("FooterApp").start(),KXL.execute("sidebar:initialize"),KXL.execute("chat:initialize")}),KXL.on("initialize:after",function(a){Backbone.history&&(Backbone.history.start({pushState:!0,hashChange:KXL.config.hashChange}),KXL.animate.animateHeaderMenu()),KXL.config.SHOW_GAMES||KXL.navigate(""),a.error&&KXL.navigate("/"+a.error,{trigger:!0}),KXL.vent.on("auth:changed",function(){KXL.navigate(KXL.getCurrentRoute(),{trigger:!0}),KXL.execute("sidebar:check")}),KXL.vent.on("completed:deferred:registration",function(){KXL.request("banner:hide","delayedRegBanner",!0),KXL.execute("forum:login")}),KXL.currentUser&&KXL.appModel.has("userSettings")&&KXL.execute("sidebar:check"),KXL.vent.on("forum:category:changed",function(a){KXL.appModel.set("currentForumCategory",a)}),KXL.vent.on("document:update:title",function(a,b){var c,d=window.location.pathname,e=d.split("/"),f="KIXEYE - ";"/"==d.substr(-1)&&(d=d.substr(0,d.length-1)),("forum"!==e[1]||b)&&(a?(c=f+a,KXL.pagesMeta.add({uri:d,title:a})):KXL.pagesMeta.get(d)?(c=KXL.pagesMeta.get(d).has("title")?KXL.pagesMeta.get(d).get("title"):KXL.i18n.t(KXL.pagesMeta.get(d).get("titleKey")),c=f+c):c="tomeimmortalarena"===e[2]&&"guardians"===e[3]?f+"TOME - "+KXL.Common.Utils.StringUtils.ucFirst(e[4]):"profile"===e[1]?f+KXL.i18n.t("page.title.profile"):"groups"===e[1]?f+KXL.i18n.t("page.title.groups"):KXL.config.siteName,window.history&&window.history.pushState&&window.history.replaceState({},c,window.location.href),document.title=c)}),$(window).bind("beforeunload",function(){if(KXL.request("auth:is:temp:user")){var a=KXL.appModel.get("context");if(a&&a.get("name"))return KXL.i18n.t("games.exitMessage",{gameName:a.get("name")})}})});var API={showDialog:function(a,b){var c=new KXL.Components.Dialog(b);return KXL.appModel.set("dialogShowing",!0),c.listenTo(c,"show",function(){c.setContent(a)}),c.listenTo(c,"close",function(){KXL.appModel.set("dialogShowing",!1)}),KXL.dialogRegion.show(c),c},showConfirmDialog:function(a){var b=new KXL.Components.ConfirmDialog(a);return KXL.appModel.set("dialogShowing",!0),b.listenTo(b,"close",function(){KXL.appModel.set("dialogShowing",!1)}),KXL.dialogRegion.show(b),b},ignoreUser:function(a){var b=$.Deferred();if(KXL.currentUser){var c=KXL.config.API_URL+"/users/"+KXL.currentUser.id+"/ignored-users",d={userId:a};$.ajax({type:"POST",url:c,contentType:"application/json",data:JSON.stringify(d),success:function(){var c=KXL.currentUser.get("ignoredUsers")||[];return c=_.union(c,[a]),KXL.currentUser.set("ignoredUsers",c),KXL.execute("fetch:received:friend:requests"),b.resolve()}}).fail(b.reject)}else b.reject();return b},unignoreUser:function(a){var b=$.Deferred();if(KXL.currentUser){var c=KXL.config.API_URL+"/users/"+KXL.currentUser.id+"/ignored-users/"+a;$.ajax({type:"DELETE",url:c,dataType:"json",success:function(){var c=KXL.currentUser.get("ignoredUsers")||[];return c=_.difference(c,[a]),KXL.currentUser.set("ignoredUsers",c),KXL.execute("fetch:received:friend:requests"),b.resolve()}}).fail(b.reject)}else b.reject();return b},isUserIgnored:function(a){if(KXL.currentUser){var b=KXL.currentUser.get("ignoredUsers")||[];return _.contains(b,a)}return!1},setLocale:function(a){function b(){window.location.reload()}if(KXL.Common.Utils.CookieUtils.getCookie("kxl-locale")&&KXL.Common.Utils.CookieUtils.setCookie("kxl-locale","",-1,!0),KXL.Common.Utils.CookieUtils.setCookie("kxl-locale",a,365,!0,"/"),KXL.currentUser){var c=KXL.request("current:user:settings:entity");c.set("locale",a),c.save(null,{success:b,error:b})}else b()}},fetchingCurrentFriends,fetchingCurrentSentFriendRequests,fetchingCurrentReceivedFriendRequests;KXL.appModel.on("change:currentUser",function(a,b){function c(){var a=$.Deferred(),c=new KXL.Entities.UserRoles(null,{userId:b.id});return c.fetch({success:function(b){a.resolve(b)}}),a}var d=KXL.request("current:user:settings:entity");if(b){KXL.request("user:settings:entity").done(function(a){d.clear().set(a.toJSON()),KXL.execute("sidebar:check")});var e=KXL.currentUser.id,f=$.Deferred(),g=function(a){var b={limit:100,expandGames:!0,presence:"available"},c=f.promise(),d=_.defaults({},a,b),h=function(a){return c._collection.trigger("reset"),g(a)},i=KXL.request("user:friend:entities",e,d);return i.then(function(a){return c._collection.add(a.models,{merge:!0,silent:!0}),KXL.request("get:user:friend:nextPageOffset:entity",e)?h(d):"available"===d.presence&&a.length<d.limit?(d.presence=null,h(d)):(c._collection.fetchComplete=!0,c._collection.trigger("reset"),void f.resolve(c._collection))}),c._collection||(c._collection=i._collection),c},h=function(){fetchingCurrentSentFriendRequests?fetchingCurrentSentFriendRequests._collection.fetch():fetchingCurrentSentFriendRequests=KXL.request("user:friend:request:entities",KXL.currentUser.id,{sent:!0,received:!1}),KXL.appModel.set("sentFriendRequests",fetchingCurrentSentFriendRequests._collection)},i=function(){fetchingCurrentReceivedFriendRequests?fetchingCurrentReceivedFriendRequests._collection.fetch():fetchingCurrentReceivedFriendRequests=KXL.request("user:friend:request:entities",KXL.currentUser.id,{sent:!1,received:!0,expandGames:!0}),KXL.appModel.set("receivedFriendRequests",fetchingCurrentReceivedFriendRequests._collection)};fetchingCurrentFriends=g(),KXL.commands.setHandlers({"fetch:sent:friend:requests":function(){h()},"fetch:received:friend:requests":function(){i()}}),KXL.vent.on("user:friend:request:sent",function(){h()}),KXL.appModel.set("friends",fetchingCurrentFriends._collection),$("body").addClass("kx-logged-in"),KXL.currentUserRoles=c()}else d.clear().set(d.defaults),KXL.appModel.set("friends",null),$("body").removeClass("kx-logged-in")}),KXL.reqres.setHandlers({"current:user:friend:entities":function(){return fetchingCurrentFriends},"context:change":function(a){function b(a){a!==KXL.context&&(KXL.appModel.get("pages").each(function(a){a.set("route",""),a.get("region").reset()}),KXL.appModel.set("context",a))}var c=$.Deferred(),d=KXL.appModel.get("context");return d&&d!==a&&KXL.request("user:playing")?KXL.asyncRequest("header:context:change:dialog",d,a).then(function(){b(a),c.resolve()}).fail(function(){c.reject()}):(b(a),c.resolve()),c.promise()},"context:get":function(){return KXL.appModel.get("context")},"user:playing":function(){return!!KXL.playRegion.currentView},"user:playing:active":function(){return KXL.request("user:playing")&&"play"===KXL.request("get:current:page")},"current:user:settings:entity":function(){return KXL.appModel.get("userSettings")},"current:user:sent:friend:request:entities":function(){return fetchingCurrentSentFriendRequests||(fetchingCurrentSentFriendRequests=KXL.request("user:friend:request:entities",KXL.currentUser.id,{sent:!0,received:!1})),KXL.appModel.set("sentFriendRequests",fetchingCurrentSentFriendRequests._collection),fetchingCurrentSentFriendRequests},"current:user:received:friend:request:entities":function(){return fetchingCurrentReceivedFriendRequests||(fetchingCurrentReceivedFriendRequests=KXL.request("user:friend:request:entities",KXL.currentUser.id,{sent:!1,received:!0,expandGames:!0})),KXL.appModel.set("receivedFriendRequests",fetchingCurrentReceivedFriendRequests._collection),fetchingCurrentReceivedFriendRequests},"current:user:remove:friend":function(a){var b=KXL.request("current:user:friend:entities")._collection;if(b&&b.get(a)){var c=b.get(a);KXL.request("decrement:service:friends:count",KXL.currentUser.id),KXL.request("decrement:service:friends:count",a),c.isNew=function(){return!1},c.destroy(),KXL.execute("fetch:sent:friend:requests")}},"get:current:user":function(){return KXL.currentUser},"current:user:game:entities":function(){return KXL.currentUserGames},"is:static:game":function(a){var b=KXL.games.get(a);return b&&KXL.staticGames.findWhere({commonName:b.get("commonName")})},"current:user:achievements:entities":function(){return KXL.currentUser?KXL.currentUser.get("achievements"):null},"get:current:page":function(){var a=KXL.appModel.get("pages").selected;return a?a.id:null},"new:game:selector:view":function(a){return new KXL.Components.GameSelector.Controller.getView(a)},"new:video:view":function(a){return KXL.Components.Video.Controller.getVideo(a)},"new:contentpane:view":function(a){return KXL.Components.ContentPane.Controller.getContentPane(a)},"new:game:logo:view":function(a,b){return KXL.HomeApp.Games.Controller.getLogoView(a,b)},"new:ticker:view":function(){return KXL.Components.Ticker.Controller.getTicker()},"new:playersonline:view":function(){return KXL.Components.PlayersOnline.Controller.getPlayersOnline()},"new:pager:view":function(a){return KXL.Components.Pager.Controller.getPager(a)},"new:gameprofileheader:view":function(a){return KXL.Components.UserGameProfile.Controller.getGameProfileHeader(a)},"new:gameprofile:view":function(a){return KXL.Components.UserGameProfile.Controller.getGameProfile(a)},"new:leaderboard:view":function(a){return new KXL.Components.Leaderboard.Controller.getLeaderboard(a)},"new:locale:selector:view":function(a){return new KXL.Components.LocaleSelector.Controller.getView(a)},"new:comments:view":function(a){return new KXL.Components.Comments.Controller.getComments(a)},"show:dialog":function(a,b){return API.showDialog(a,b)},"show:default:dialog":function(a,b){var c=_.extend({customClassName:"kxl-dialog"},b);return API.showDialog(a,c)},"show:confirm:dialog":function(a){var b=_.extend({customClassName:"kxl-dialog",size:"small"},a);return API.showConfirmDialog(b)},"ignore:user":function(a){return KXL.request("current:user:remove:friend",a),API.ignoreUser(a)},"unignore:user":function(a){return API.unignoreUser(a)},"is:user:ignored":function(a){return API.isUserIgnored(a)},"attack:beacon:is:feature:enabled":function(){return KXL.switches.AttackBeaconEnabled},"get:client:initiated:password:change":function(){return KXL.atom.get("clientInitiatedPasswordChange")||!1},"set:client:initiated:password:change":function(a){return KXL.atom.set("clientInitiatedPasswordChange",a)},"chat:start":function(){var a=$.Deferred();return KXL.asyncRequest("chat:show").then(function(){var b,c,d={sideBarState:"chat"},e=KXL.request("current:user:settings:entity"),f=KXL.request("get:chat:interface");return KXL.appModel.set("sideBarState","chat"),f.isConnected()?(a.resolve(),a.promise()):(c=function(){KXL.stopListening(f,"connected",b),a.reject()},b=function(){KXL.stopListening(f,"connection:failed",c),a.resolve()},KXL.listenToOnce(f,"connected",b),KXL.listenToOnce(f,"connection:failed",c),d.showOnlineStatusAs="online",e.save(d,{silent:!0}),void _.each(d,function(a,b){"sideBarState"!==b&&e.trigger("change:"+b,e,a)}))}),a.promise()}}),KXL.commands.setHandlers({"context:set":function(a){KXL.appModel.set("context",a)},"set:locale":function(a){API.setLocale(a)},"page:show":function(a){var b=KXL.appModel.get("pages").selected;b&&b.set("scrollPosition",$(document).scrollTop());var c=KXL.appModel.get("pages").get(a);if(c){var d=KXL.getCurrentRoute();c.set("route",d),d.indexOf("/lp/default")>-1&&KXL.vent.trigger("adwords:track:route",d),c.select(),window.scrollTo(0,c.get("scrollPosition")||0),KXL.execute(c.get("hideFooter")?"footer:hide":"footer:show"),KXL.execute(c.get("hideOnlineCounter")?"playersonline:hide":"playersonline:show")}KXL.vent.trigger("page:shown")},"page:close":function(a){var b=KXL.appModel.get("pages").get(a);b&&("game"===a&&KXL.atom.set("game:isopen",!1),b.get("region").close())},"chat:start:private":function(a,b){KXL.asyncRequest("chat:start").then(function(){KXL.execute("chat:start:conversation:private",a,b)})},"chat:start:group":function(a){KXL.asyncRequest("chat:start").then(function(){KXL.execute("chat:start:conversation",a)})}}),KXL.navigate=function(a,b){var c=_.extend({},b),d=KXL.Common.Utils.Url.parse(a),e=KXL.Common.Utils.Url.parse("//"+window.location.host).host;if(d.host&&d.host!==e)c.target?window.open(a,c.target):window.location.href=a;else{var f=KXL.getCurrentRoute().toLowerCase(),g=a.toLowerCase();c.trigger&&g===f?Backbone.history.loadUrl(a):g!==f&&Backbone.history.navigate(a,c),KXL.vent.trigger("document:update:title");var h=/\/$/;g.replace(h,"")!==f.replace(h,"")&&(c.auth?KXL.vent.trigger("info:page:nav",a.concat("?",$.param(_.pick(c,"auth")))):KXL.vent.trigger("info:page:nav")),KXL.vent.trigger("page:nav",a),a&&"/"!==a&&KXL.vent.trigger("adwords:track:route",a)}},KXL.getCurrentRoute=function(){return Backbone.history.fragment},KXL.appModel.on("change:context",function(a,b){KXL.context=b}),KXL.reqres.setHandlers({"get:current:user":function(){return KXL.currentUser},"new:leaderboard:view":function(a){return new KXL.Components.Leaderboard.Controller.getLeaderboard(a)},"new:avatar:view":function(a,b){return KXL.Components.Avatar.Controller.getAvatar(a,b)}}),KXL.commands.setHandlers({"context:set":function(a){KXL.appModel.set("context",a)}}),KXL.configBaseInitializeBefore=function(a){KXL.config={},KXL.i18n=new KXL.Language.i18n({localizations:a.localizations,locale:a.locale}),KXL.config.useCompressed=a.useCompressed,KXL.config.asyncModules=a.asyncModules,KXL.config.API_URL="/api/v2",KXL.config.LEGACY_API_URL="/api/v1",KXL.config.APP_ID=a.kxAppId,KXL.config.siteName=a.siteName,KXL.config.locale=a.locale,KXL.config.supportedLocales=a.supportedLocales,KXL.config.DEFAULT_LOCALE="en_US",KXL.config.PUBLIC_API_URL=a.apiUrl,KXL.config.WEBSOCKET_URL=a.websocketUrl,KXL.config.STATIC_BASE_URL=a.staticBaseUrl,KXL.config.BASE_URL=a.baseUrl,KXL.games=KXL.request("games:entities",a.games),KXL.mobileGames=KXL.request("mobilegames:entities",KXL.games),KXL.config.browser=a.browser,"Internet Explorer"===a.browser.name&&parseFloat(a.browser.version)<10&&(KXL.config.animationCapabilities=!1)},KXL.module("Common.Utils.Async",function(a,b,c,d,e,f){function g(a){a&&a.apply&&a()}function h(){return q||(q=document.getElementsByTagName("head")[0]),q}function i(a,b){s[a]=b}function j(a,b,c){return a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):void 0}function k(a){return b.config.asyncModules&&b.config.asyncModules[a]?b.config.asyncModules[a]:{}}function l(a,b){return o+a+"/"+b}function m(a){return p+a}function n(c,d){c.call(a,d,function(){b.atom.set(d,!0)},function(){b.atom.set(d,!1)})}var o="/modules/",p="/vendor/",q=null,r=["complete","loaded"],s={};a.loadRemoteJsUrls=function(a){var c=e.Deferred();a=f.isString(a)?[a]:a;var d=a.join("/");if(s[d])return s[d];i(d,c.promise());var g=this,h=[];return f.each(a,function(a){h.push(a),n(g.loadJS,a)}),b.atom.once(h,function(){c.resolve()}),s[d]},a.loadModule=function(c){function d(){if(x.locale&&f.isBoolean(x.locale)&&(w=x.locale),b.config.useCompressed){var a=o+c+"/",d=b.config.STATIC_BASE_URL+"/js"+a+p+(w?"."+b.config.locale:"")+".min.js";t.push(d),r.push(d)}else{var e=[],i=[],j=[],k=[],s=!1;if(x.css&&f.isArray(x.css)&&(i=x.css),x["vendor-css"]&&f.isArray(x["vendor-css"])&&(k=x["vendor-css"]),x.js&&f.isArray(x.js)&&(e=x.js),x["vendor-js"]&&f.isArray(x["vendor-js"])&&(j=x["vendor-js"]),x.template&&f.isBoolean(x.template)&&(s=x.template),f.each(k,function(a){var b=m(a);v.push(b),q.push(b)}),f.each(i,function(a){var b=l(c,"css/"+a);v.push(b),q.push(b)}),w){var y=l(c,"lang/"+b.config.locale+".compiled.js");u.push(y),q.push(y)}if(s){var z=l(c,"templates/"+p+".compiled.js");u.push(z),q.push(z)}f.each(j,function(a){var b=m(a);t.push(b),r.push(b)}),f.each(e,function(a){var b=l(c,a);t.push(b),r.push(b)})}f.each(v,function(a){n(h.loadCSS,a)}),f.each(u,function(a){n(h.loadJS,a)}),b.atom.once(q,function(){f.each(t,function(a){n(h.loadJS,a)})}),b.atom.once(r,function(){g.resolve()})}var g=e.Deferred();if(s[c])return s[c];i(c,g.promise());var h=this,j=c.split("/"),p=j.pop(),q=[],r=[],t=[],u=[],v=[],w=!1,x=k(c);if(x.dependencies){var y=[];f.each(x.dependencies,function(b){y.push(a.loadModule(b))}),e.when.apply(e,y).then(function(){d()})}else d();return s[c]},a.loadCSS=function(a,b,c){var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.href=a,this.loadScript(d,b,c)},a.loadJS=function(a,b,c){var d=document.createElement("script");d.type="text/javascript",d.async=!1,d.src=a,d.charset="utf-8",this.loadScript(d,b,c)},a.loadScript=function(a,b,c){j(a,"error",function(){g(c)}),a.addEventListener&&a.addEventListener("load",function(){g(b)},!1),a.attachEvent&&a.attachEvent("onreadystatechange",function(){-1!==a.indexOf(r)&&g(b)}),h().appendChild(a)},b.reqres.setHandlers({"async:load:module":function(b){return a.loadModule(b)},"async:load:remoteJsUrls":function(b){return a.loadRemoteJsUrls(b)}})}),KXL.module("Common.Utils.Base64",function(a){a.PADCHAR="=",a.ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a.makeDOMException=function(){try{return new DOMException(DOMException.INVALID_CHARACTER_ERR)}catch(a){var b=new Error("DOM Exception 5");return b.code=b.number=5,b.name=b.description="INVALID_CHARACTER_ERR",b.toString=function(){return"Error: "+b.name+": "+b.message},b}},a.getbyte64=function(b,c){var d=a.ALPHA.indexOf(b.charAt(c));if(-1===d)throw a.makeDOMException();return d},a.decode=function(b){b=""+b;var c,d,e,f=a.getbyte64,g=b.length;if(0===g)return b;if(g%4!==0)throw a.makeDOMException();c=0,b.charAt(g-1)===a.PADCHAR&&(c=1,b.charAt(g-2)===a.PADCHAR&&(c=2),g-=4);var h=[];for(d=0;g>d;d+=4)e=f(b,d)<<18|f(b,d+1)<<12|f(b,d+2)<<6|f(b,d+3),h.push(String.fromCharCode(e>>16,e>>8&255,255&e));switch(c){case 1:e=f(b,d)<<18|f(b,d+1)<<12|f(b,d+2)<<6,h.push(String.fromCharCode(e>>16,e>>8&255));break;case 2:e=f(b,d)<<18|f(b,d+1)<<12,h.push(String.fromCharCode(e>>16))}return h.join("")},a.getbyte=function(b,c){var d=b.charCodeAt(c);if(d>255)throw a.makeDOMException();return d},a.encode=function(b){if(1!==arguments.length)throw new SyntaxError("Not enough arguments");var c,d,e=a.PADCHAR,f=a.ALPHA,g=a.getbyte,h=[];b=""+b;var i=b.length-b.length%3;if(0===b.length)return b;for(c=0;i>c;c+=3)d=g(b,c)<<16|g(b,c+1)<<8|g(b,c+2),h.push(f.charAt(d>>18)),h.push(f.charAt(d>>12&63)),h.push(f.charAt(d>>6&63)),h.push(f.charAt(63&d));switch(b.length-i){case 1:d=g(b,c)<<16,h.push(f.charAt(d>>18)+f.charAt(d>>12&63)+e+e);break;case 2:d=g(b,c)<<16|g(b,c+1)<<8,h.push(f.charAt(d>>18)+f.charAt(d>>12&63)+f.charAt(d>>6&63)+e)}return h.join("")},a.dataURItoBlob=function(b){for(var c=a.decode(b.split(",")[1]),d=b.split(",")[0].split(":")[1].split(";")[0],e=new ArrayBuffer(c.length),f=new Uint8Array(e),g=0;g<c.length;g++)f[g]=c.charCodeAt(g);var h=new Blob([e],{type:d});return h}}),KXL.module("Common.Utils.DateUtils",function(a,b){a.fuzzytime=function(a){var c="";if(a){var d=new Date;d.setTime(a);var e=d.getTime(),f=new Date,g=Math.ceil((f.getTime()-e)/1e3);f.setSeconds(f.getSeconds()-g);var h=new Date(f);h.setHours(0,0,0,0);var i=(new Date).setHours(0,0,0,0),j=(i-h)/864e5;if(0===j){if(180>g)c=b.i18n.t("fuzzytime.justnow");else if(420>g)c=b.i18n.t("fuzzytime.afewminutesago");else if(3e3>g)c=b.i18n.t("fuzzytime.minutesago",{minutes:Math.ceil(g/60)});else if(g>3e3){var k=Math.ceil(g/3600).toString();c="1"===k?b.i18n.t("fuzzytime.aboutanhourago"):b.i18n.t("fuzzytime.hoursago",{hours:k})}}else if(1>=j){var l=new Date(f);f.getMinutes()<30&&l.setMinutes(f.getMinutes()+30);var m=l.getHours();c=b.i18n.t("fuzzytime.yesterdayaround")+" "+(m>12?m-12:m)+b.i18n.t(13>m?"fuzzytime.am":"fuzzytime.pm")}else if(5>=j){var n=new Array(7);n[0]=b.i18n.t("fuzzytime.day.sunday"),n[1]=b.i18n.t("fuzzytime.day.monday"),n[2]=b.i18n.t("fuzzytime.day.tuesday"),n[3]=b.i18n.t("fuzzytime.day.wednesday"),n[4]=b.i18n.t("fuzzytime.day.thursday"),n[5]=b.i18n.t("fuzzytime.day.friday"),n[6]=b.i18n.t("fuzzytime.day.saturday");var o=n[f.getDay()],p=f.getHours();o+=12>p?" "+b.i18n.t("fuzzytime.day.part.morning"):17>p?" "+b.i18n.t("fuzzytime.day.part.afternoon"):20>p?" "+b.i18n.t("fuzzytime.day.part.evening"):" "+b.i18n.t("fuzzytime.day.part.night"),c=o}else if(24.5>=j)c=b.i18n.t(10.5>j?"fuzzytime.aboutaweekago":17.5>j?"fuzzytime.abouttwoweeksago":"fuzzytime.aboutthreeweeksago");else if(356.5>j){var q=Math.round(j/31);c=b.i18n.t("fuzzytime.aboutxmonthsago",{smart_count:q})}else if(3640>j){var r=Math.round(j/365);c=b.i18n.t("fuzzytime.aboutxyearsago",{smart_count:r})}else c=b.i18n.t("fuzzytime.morethantenyearsago")}return c},a.fuzzytime2=function(a){var b="";if(a){var c=new Date;c.setTime(a);var d=c.getTime(),e=new Date,f=Math.ceil((e.getTime()-d)/1e3);e.setSeconds(e.getSeconds()-f);var g=new Date(e),h=g.getDay();g.setHours(0,0,0,0);var i=new Date,j=i.getDay();i=i.setHours(0,0,0,0);var k=(i-g)/864e5,l=h!==j;b=0!==k||l?6>=k&&l?(0|k)+"d":moment(a).format(365>k?"M/DD":"M/DD/YY"):moment(a).format("h:mm A")}return b},a.now=function(){return(new Date).getTime()},a.isoString=function(a){return new Date(parseInt(a,0)).toISOString()},a.getDateVars=function(a){var c=null;if(a){var d=new Date(a);c={year:d.getFullYear(),month:b.Common.Utils.StringUtils.datePartPadZero(d.getMonth()+1),day:b.Common.Utils.StringUtils.datePartPadZero(d.getDate()),hours:d.getHours(),minutes:b.Common.Utils.StringUtils.datePartPadZero(d.getMinutes())}}return c},a.kixDateStringFormat1=function(b){var c=null;if(b){var d=a.getDateVars(b);d&&(c=d.year+"-"+d.month+"-"+d.day+" ("+d.hours+":"+d.minutes+")")}return c||"invalid date"},a.kixDateStringFormat2=function(b){var c=null;if(b){var d=a.getDateVars(b);d&&(c=d.month+"/"+d.day+" "+d.hours+":"+d.minutes)}return c||"invalid date"}}),KXL.module("Common.Utils.Collection",function(a,b,c,d,e,f){a.prev=function(a,b,c){var d=a.indexOf(b)-1;return d=c?d>-1?d:f.size(a)-1:d>-1?d:0,a.at(d)},a.next=function(a,b,c){var d=a.indexOf(b)+1,e=f.size(a);return c&&(d%=e),d>=e&&(d=e-1),a.at(d)}}),KXL.module("Common.Utils.CookieUtils",function(a){a.getCookie=function(a,b){for(var c,d=a+"=",e=document.cookie.split(";"),f=0;f<e.length;f++){var g=e[f].trim();if(0===g.indexOf(d))return c=g.substring(d.length,g.length),b?decodeURIComponent(c):c}return""},a.getJSONCookie=function(a){var b=this.getCookie(a,!0);if(b){try{b=JSON.parse(b)}catch(c){return}return b}},a.setCookie=function(a,b,c,d,e,f){var g=864e5,h=new Date,i=[a,"=",f?encodeURIComponent(b):b,";"];if(c){var j=new Date;j.setTime(h.getTime()+c*g),i.push("expires=",j.toUTCString(),";")}e&&i.push("path=",e,";"),d&&i.push("secure;"),document.cookie=i.join("")},a.setJSONCookie=function(a,b,c,d,e){var f;try{f=JSON.stringify(b)}catch(g){return}return this.setCookie(a,f,c,d,e,!0)},a.deleteCookie=function(a,b,c){return this.setCookie(a,"",-1,b,c)}}),KXL.module("Common.Utils.Dom",function(a){a.isolatedScroll=function(){}}),KXL.module("Common.Utils.ImageUtils",function(a,b,c,d,e,f){a.loadImage=function(a){return e.Deferred(function(b){var c=new Image;c.onload=function(){b.resolve(c)},c.onerror=function(){b.reject()},c.src=a}).promise()},a.imageToDataURL=function(a){var b=document.createElement("canvas");b.width=a.width,b.height=a.height;var c=b.getContext("2d");return c.drawImage(a,0,0),b.toDataURL("image/png")},a.setImgUsingFile=function(a,b){var b=b||document.createElement("img");b.file=a;var c=new FileReader;return c.onload=function(a){return function(b){a.src=b.target.result}}(b),c.readAsDataURL(a),b},a.calculateAspectRatioFit=function(a,b,c,d){var e=Math.min(c/a,d/b);return{width:a*e,height:b*e}},a.preload=function(a){var b=new PxLoader;return f.each(a,function(a){b.addImage(a)}),b.start(),b}}),KXL.module("Common.Utils.StringUtils",function(a,b,c,d,e,f){a.prettySubString=function(a,b,c,d){if(!a||!b)return a;var e=b.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"),f=new RegExp("("+e+")","i");return a.replace(f,"<span"+(c?' id="'+c+'"':"")+(d?' class="'+d+'"':"")+">$1</span>")},a.nl2br=function(a){return(a+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br>$2")},a.htmlDecode=function(a){return a?e("<div />").html(a).text():""},a.datePartPadZero=function(a){var b=a.toString().length;return 1===b&&(a="0"+a.toString()),a},a.ucFirst=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},a.lcFirst=function(a){return a.charAt(0).toLowerCase()+a.slice(1)},a.truncateEllipsis=function(a,b){return e.trim(a),a.length>b&&(a=a.substr(0,b-3),a=a.concat("...")),a},a.filterMessage=function(a){var c=a,d=g.all;return f.each(f.union(d,g.locales[b.config.locale.toLowerCase()]),function(a){var b=new RegExp(a,"gi");c=c.replace(b,"****")}),c};var g={all:["\\bfuck\\b","\\basshole\\b","\\bshit\\b","\\bcunt\\b"],locales:{en_us:["\\b4r5e\\b","\\b5h1t\\b","\\b5hit\\b","\\ba55\\b","\\banal\\b","\\banus\\b","\\bass\\b","\\bass-fucker\\b","\\basses\\b","\\bassfucker\\b","\\bassfukka\\b","\\bassholes\\b","\\basswhole\\b","\\ba_s_s\\b","\\bb!tch\\b","\\bb00bs\\b","\\bb17ch\\b","\\bb1tch\\b","\\bballbag\\b","\\bballsack\\b","\\bbastard\\b","\\bbeastial\\b","\\bbeastiality\\b","\\bbellend\\b","\\bbestial\\b","\\bbestiality\\b","\\bbi+ch\\b","\\bbiatch\\b","\\bbitch\\b","\\bbitches\\b","\\bblow job\\b","\\bblowjob\\b","\\bblowjobs\\b","\\bboiolas\\b","\\bboner\\b","\\bboob\\b","\\bboobs\\b","\\bbooobs\\b","\\bboooobs\\b","\\bbooooobs\\b","\\bbooooooobs\\b","\\bbuceta\\b","\\bbugger\\b","\\bbunny fucker\\b","\\bbutthole\\b","\\bbuttmuch\\b","\\bbuttplug\\b","\\bc0ck\\b","\\bc0cksucker\\b","\\bcarpet muncher\\b","\\bcawk\\b","\\bchink\\b","\\bcipa\\b","\\bcl1t\\b","\\bclit\\b","\\bclitoris\\b","\\bclits\\b","\\bcnut\\b","\\bcock\\b","\\bcock-sucker\\b","\\bcockface\\b","\\bcockhead\\b","\\bcockmunch\\b","\\bcockmuncher\\b","\\bcocks\\b","\\bcocksuck\\b","\\bcocksucked \\b","\\bcocksucker\\b","\\bcocksucking\\b","\\bcocksucks \\b","\\bcocksuka\\b","\\bcocksukka\\b","\\bcok\\b","\\bcokmuncher\\b","\\bcoksucka\\b","\\bcoon\\b","\\bcox\\b","\\bcum\\b","\\bcummer\\b","\\bcumming\\b","\\bcums\\b","\\bcumshot\\b","\\bcunilingus\\b","\\bcunillingus\\b","\\bcunnilingus\\b","\\bcuntlick\\b","\\bcuntlicker\\b","\\bcuntlicking\\b","\\bcunts\\b","\\bcyalis\\b","\\bcyberfuc\\b","\\bcyberfuck\\b","\\bcyberfucked\\b","\\bcyberfucker\\b","\\bcyberfuckers\\b","\\bcyberfucking\\b","\\bdickhead\\b","\\bdildo\\b","\\bdildos\\b","\\bdirsa\\b","\\bdog-fucker\\b","\\bdogging\\b","\\bdonkeyribber\\b","\\bdoosh\\b","\\bduche\\b","\\bdyke\\b","\\bejaculate\\b","\\bejaculated\\b","\\bejaculates\\b","\\bejaculating\\b","\\bejaculatings\\b","\\bejaculation\\b","\\bejakulate\\b","\\bf u c k\\b","\\bf u c k e r\\b","\\bfag\\b","\\bfagging\\b","\\bfaggitt\\b","\\bfaggot\\b","\\bfaggs\\b","\\bfagot\\b","\\bfagots\\b","\\bfags\\b","\\bfannyflaps\\b","\\bfannyfucker\\b","\\bfatass\\b","\\bfcuk\\b","\\bfcuker\\b","\\bfcuking\\b","\\bfeck\\b","\\bfecker\\b","\\bfelching\\b","\\bfellate\\b","\\bfellatio\\b","\\bfingerfuck\\b","\\bfingerfucked\\b","\\bfingerfucker\\b","\\bfingerfuckers\\b","\\bfingerfucking\\b","\\bfingerfucks\\b","\\bfistfuck\\b","\\bfistfucked\\b","\\bfistfucker\\b","\\bfistfuckers\\b","\\bfistfucking\\b","\\bfistfuckings\\b","\\bfistfucks\\b","\\bfucka\\b","\\bfucked\\b","\\bfucker\\b","\\bfuckers\\b","\\bfuckhead\\b","\\bfuckheads\\b","\\bfuckin\\b","\\bfucking\\b","\\bfuckings\\b","\\bfuckingshitmotherfucker\\b","\\bfuckme\\b","\\bfucks\\b","\\bfuckwhit\\b","\\bfuckwit\\b","\\bfudge packer\\b","\\bfudgepacker\\b","fuk","\\bfuker\\b","\\bfukker\\b","\\bfukkin\\b","\\bfuks\\b","\\bfukwhit\\b","\\bfukwit\\b","\\bfux\\b","\\bfux0r\\b","\\bf_u_c_k\\b","\\bgangbang\\b","\\bgangbanged\\b","\\bgangbangs\\b","\\bgaylord\\b","\\bgaysex\\b","\\bgoatse\\b","\\bgod-dam\\b","\\bgod-damned\\b","\\bgoddamn\\b","\\bgoddamned\\b","\\bhardcoresex\\b","\\bheshe\\b","\\bhomo\\b","\\bhore\\b","\\bhorniest\\b","\\bhorny\\b","\\bhotsex\\b","\\bjack-off\\b","\\bjackoff\\b","\\bjap\\b","\\bjerk-off\\b","\\bjism\\b","\\bjiz\\b","\\bjizm\\b","\\bjizz\\b","\\bkawk\\b","\\bknob\\b","\\bknobead\\b","\\bknobed\\b","\\bknobend\\b","\\bknobhead\\b","\\bknobjocky\\b","\\bknobjokey\\b","\\bkock\\b","\\bkondum\\b","\\bkondums\\b","\\bkum\\b","\\bkummer\\b","\\bkumming\\b","\\bkums\\b","\\bkunilingus\\b","\\bl3i+ch\\b","\\bl3itch\\b","\\blabia\\b","\\blust\\b","\\blusting\\b","\\bm0f0\\b","\\bm0fo\\b","\\bm45terbate\\b","\\bma5terb8\\b","\\bma5terbate\\b","\\bmasochist\\b","\\bmaster-bat\\b","\\bmasterb8\\b","\\bmasterbat\\b","\\bmasterbat3\\b","\\bmasterbate\\b","\\bmasterbation\\b","\\bmasterbations\\b","\\bmasturbate\\b","\\bmo-fo\\b","\\bmof0\\b","\\bmofo\\b","\\bmothafuck\\b","\\bmothafucka\\b","\\bmothafuckas\\b","\\bmothafuckaz\\b","\\bmothafucked\\b","\\bmothafucker\\b","\\bmothafuckers\\b","\\bmothafuckin\\b","\\bmothafucking\\b","\\bmothafuckings\\b","\\bmothafucks\\b","\\bmother fucker\\b","\\bmotherfuck\\b","\\bmotherfucked\\b","\\bmotherfucker\\b","\\bmotherfuckers\\b","\\bmotherfuckin\\b","\\bmotherfucking\\b","\\bmotherfuckings\\b","\\bmotherfuckka\\b","\\bmotherfucks\\b","\\bmutha\\b","\\bmuthafecker\\b","\\bmuthafuckker\\b","\\bmuther\\b","\\bmutherfucker\\b","\\bn1gga\\b","\\bn1gger\\b","\\bnazi\\b","\\bnigg3r\\b","\\bnigg4h\\b","\\bnigga\\b","\\bniggah\\b","\\bniggas\\b","\\bniggaz\\b","\\bnigger\\b","\\bniggers\\b","\\bnob jokey\\b","\\bnobhead\\b","\\bnobjocky\\b","\\bnobjokey\\b","\\borgasim\\b","\\borgasims\\b","\\borgasm\\b","\\borgasms\\b","\\bpenis\\b","\\bpenisfucker\\b","\\bphonesex\\b","\\bphuck\\b","\\bphuk\\b","\\bphuked\\b","\\bphuking\\b","\\bphukked\\b","\\bphukking\\b","\\bphuks\\b","\\bphuq\\b","\\bpigfucker\\b","\\bpimpis\\b","\\bpiss\\b","\\bpissed\\b","\\bpisser\\b","\\bpissers\\b","\\bpisses\\b","\\bpissflaps\\b","\\bpissin\\b","\\bpissing\\b","\\bpissoff\\b","\\bpoop\\b","\\bporn\\b","\\bporno\\b","\\bpornography\\b","\\bpornos\\b","\\bprick\\b","\\bpricks\\b","\\bpron\\b","\\bpube\\b","\\bpusse\\b","\\bpussi\\b","\\bpussies\\b","\\bpussy\\b","\\bpussys\\b","\\brectum\\b","\\bretard\\b","\\brimjaw\\b","\\brimming\\b","\\bsadist\\b","\\bschlong\\b","\\bscroat\\b","\\bscrote\\b","\\bscrotum\\b","\\bsemen\\b","\\bsh!+\\b","\\bsh!t\\b","\\bsh1t\\b","\\bshagger\\b","\\bshaggin\\b","\\bshagging\\b","\\bshemale\\b","\\bshi+\\b","\\bshitdick\\b","\\bshite\\b","\\bshited\\b","\\bshitey\\b","\\bshitfuck\\b","\\bshitfull\\b","\\bshithead\\b","\\bshiting\\b","\\bshitings\\b","\\bshits\\b","\\bshitted\\b","\\bshitter\\b","\\bshitters\\b","\\bshitting\\b","\\bshittings\\b","\\bshitty\\b","\\bskank\\b","\\bslut\\b","\\bsluts\\b","\\bsmegma\\b","\\bsmut\\b","\\bsnatch\\b","\\bson-of-a-bitch\\b","\\bspunk\\b","\\bt1tt1e5\\b","\\bt1tties\\b","\\btestical\\b","\\btesticle\\b","\\btit\\b","\\btitfuck\\b","\\btits\\b","\\btitt\\b","\\btittie5\\b","\\btittiefucker\\b","\\btitties\\b","\\btittyfuck\\b","\\btittywank\\b","\\btitwank\\b","\\bturd\\b","\\btw4t\\b","\\btwat\\b","\\btwathead\\b","\\btwatty\\b","\\btwunt\\b","\\btwunter\\b","\\bv14gra\\b","\\bv1gra\\b","\\bvagina\\b","\\bviagra\\b","\\bvulva\\b","\\bw00se,\\b","\\bwhoar\\b","\\bwhore\\b","\\bxrated\\b"],fr_fr:["\\banal(?=\\s|$)","\\bandouille(?=\\s|$)","\\banus(?=\\s|$)","\\bappareilleuse(?=\\s|$)","\\bastèque(?=\\s|$)","\\bavorton(?=\\s|$)","\\bbaise(?=\\s|$)","\\bbâtard(?=\\s|$)","\\bbic(?=\\s|$)","\\bbicot(?=\\s|$)","\\bbite(?=\\s|$)","\\bbordel(?=\\s|$)","\\bbordille(?=\\s|$)","\\bboudin(?=\\s|$)","\\bbouffon(?=\\s|$)","\\bbougnoul(?=\\s|$)","\\bbougnoulisation(?=\\s|$)","\\bbougnouliser(?=\\s|$)","\\bbougre(?=\\s|$)","\\bboukak(?=\\s|$)","\\bboulet(?=\\s|$)","\\bbounioul(?=\\s|$)","\\bbranlette(?=\\s|$)","\\bbranleur(?=\\s|$)","\\bbrigand(?=\\s|$)","\\bburne(?=\\s|$)","\\bchaudasse(?=\\s|$)","\\bchiennasse(?=\\s|$)","\\bchienne(?=\\s|$)","\\bchier(?=\\s|$)","\\bchinetoque(?=\\s|$)","\\bchintok(?=\\s|$)","\\bchleuh(?=\\s|$)","\\bchnoque(?=\\s|$)","\\bcoche(?=\\s|$)","\\bcolon(?=\\s|$)","\\bcon(?=\\s|$)","\\bconchier(?=\\s|$)","\\bconnard(?=\\s|$)","\\bconnasse(?=\\s|$)","\\bcouille(?=\\s|$)","\\bcounifle(?=\\s|$)","\\bcourtaud(?=\\s|$)","\\bcrétin(?=\\s|$)","\\bcrevure(?=\\s|$)","\\bcul(?=\\s|$)","\\bdébile(?=\\s|$)","\\bdoryphore(?=\\s|$)","\\bdu schnoc(?=\\s|$)","\\bducon(?=\\s|$)","\\bduconnot(?=\\s|$)","\\bdugenoux(?=\\s|$)","\\bdugland(?=\\s|$)","\\bduschnock(?=\\s|$)","\\benculé(?=\\s|$)","\\benculer(?=\\s|$)","\\benflure(?=\\s|$)","\\benfoiré(?=\\s|$)","\\bentuber(?=\\s|$)","\\benvaselineur(?=\\s|$)","\\bépais(?=\\s|$)","\\bespingoin(?=\\s|$)","\\bétron(?=\\s|$)","\\bfion(?=\\s|$)","\\bfouteur(?=\\s|$)","\\bfoutre(?=\\s|$)","\\bfripouille(?=\\s|$)","\\bfrisé(?=\\s|$)","\\bfritz(?=\\s|$)","\\bfumier(?=\\s|$)","\\bgland(?=\\s|$)","\\bglandeur(?=\\s|$)","\\bglandu(?=\\s|$)","\\bgnoul(?=\\s|$)","\\bgodon(?=\\s|$)","\\bgogol(?=\\s|$)","\\bgouilland(?=\\s|$)","\\bgouine(?=\\s|$)","\\bgourde(?=\\s|$)","\\bgrognasse(?=\\s|$)","\\bguide de merde(?=\\s|$)","\\bguignol(?=\\s|$)","\\bmakoumé(?=\\s|$)","\\bmanche(?=\\s|$)","\\bmange-merde(?=\\s|$)","\\bmangeux de marde(?=\\s|$)","\\bmauviette(?=\\s|$)","\\bmerde(?=\\s|$)","\\bmerdeux(?=\\s|$)","\\bmerdouillard(?=\\s|$)","\\bmongol(?=\\s|$)","\\bmoule(?=\\s|$)","\\bnègre(?=\\s|$)","\\bnibard(?=\\s|$)","\\bnibards(?=\\s|$)","\\bnichons(?=\\s|$)","\\bniquer(?=\\s|$)","\\bpédale(?=\\s|$)","\\bpédé(?=\\s|$)","\\bpédophile(?=\\s|$)","\\bpénis(?=\\s|$)","\\bpétasse(?=\\s|$)","\\bpignouf(?=\\s|$)","\\bpleutre(?=\\s|$)","\\bplouc(?=\\s|$)","\\bporc(?=\\s|$)","\\bporcas(?=\\s|$)","\\bporcasse(?=\\s|$)","\\bpouf(?=\\s|$)","\\bpouffiasse(?=\\s|$)","\\bputain(?=\\s|$)","\\bpute(?=\\s|$)","\\bsalaud(?=\\s|$)","\\bsalop(?=\\s|$)","\\bsalope(?=\\s|$)","\\bsuceuse(?=\\s|$)","\\btafiole(?=\\s|$)","\\btantouze(?=\\s|$)","\\btapette(?=\\s|$)","\\btarlouze(?=\\s|$)","\\btête de noeud(?=\\s|$)","\\bteub(?=\\s|$)","\\btrouduc(?=\\s|$)","\\bvagin(?=\\s|$)","\\bviol(?=\\s|$)","\\bvioleur(?=\\s|$)","\\byoupin(?=\\s|$)","\\bzboub(?=\\s|$)","\\bzguègue(?=\\s|$)"],de_de:["\\bfick\\b","\\bfickdes\\b","\\bficke\\b","\\bficken\\b","\\bfickend\\b","\\bfickende\\b","\\bfickendem\\b","\\bfickenden\\b","\\bfickender\\b","\\bfickendes\\b","\\bficker\\b","\\bfickest\\b","\\bficket\\b","\\bfickmuede\\b","\\bfickmuff\\b","\\bfickspan\\b","\\bfickst\\b","\\bfickt\\b","\\bfickte\\b","\\bfickten\\b","\\bficktest\\b","\\bficktet\\b","\\bfickzitze\\b","\\bgefickt\\b","\\bgefickte\\b","\\bgeficktem\\b","\\bgefickten\\b","\\bgefickter\\b","\\bgeficktes\\b","\\bhasenfick\\b","\\bwandfick\\b","\\bwandficken\\b","\\bbescheisse\\b","\\bscheiss\\b","\\bscheissen\\b","\\bscheissend\\b","\\bscheisser\\b","\\bscheissers\\b","\\bscheissest\\b","\\bscheisst\\b","\\bnigger\\b","\\bschlampe\\b","\\bfotzen\\b","\\bpimmel\\b","\\bpimmeln\\b","\\bpimmels\\b","\\banpisse\\b","\\banpissen\\b","\\banpisst\\b","\\banpisste\\b","\\banpissten\\b","\\bbepissen\\b","\\bbepisst\\b","\\bbepisste\\b","\\bbettpiss\\b","\\bbettpisse\\b","\\bgepisst\\b","\\bgepisste\\b","\\bgepisstem\\b","\\bhinpisser\\b","\\bpiss\\b","\\bpisse\\b","\\bpissecke\\b","\\bpissen\\b","\\bpissend\\b","\\bpissende\\b","\\bpissendem\\b","\\bpissenden\\b","\\bpissender\\b","\\bpissendes\\b","\\bpissens\\b","\\bpisser\\b","\\bpissern\\b","\\bpissers\\b","\\bpissest\\b","\\bpisset\\b","\\bpissnelke\\b","\\bpisst\\b","\\bpisste\\b","\\bpissten\\b","\\bpisstest\\b","\\bpisstet\\b","\\bverpiss\\b","\\bverpissen\\b","\\bverpisst\\b","\\bverpisste\\b","\\babwichst\\b","\\bgewichst\\b","\\bgewichste\\b","\\bgewichstem\\b","\\bgewichsten\\b","\\bgewichster\\b","\\bgewichstes\\b","\\bwichs\\b","\\bwichse\\b","\\bwichsen\\b","\\bwichsend\\b","\\bwichsende\\b","\\bwichsendem\\b","\\bwichsenden\\b","\\bwichsender\\b","\\bwichsendes\\b","\\bwichser\\b","\\bwichst\\b","\\bwichste\\b","\\bwichsten\\b","\\bhuren\\b","\\bhurend\\b","\\bhurende\\b","\\bhurendem\\b","\\bhurenden\\b","\\bhurender\\b","\\bhurendes\\b","\\bhurenkind\\b","\\bhurenkinds\\b","\\bhurensohn\\b","\\bbimbo\\b","\\bkanak\\b","\\bkanake\\b","\\bkanaken\\b","\\babschaum\\b","\\babschaumes\\b","\\babschaums\\b","\\bschissen\\b","\\bschisser\\b","\\bschissers\\b","\\bschisses\\b","\\bschissest\\b","\\bschisset\\b","\\bschisst\\b","\\barsch\\b","\\barsches\\b","\\barschgeige\\b","\\barschlochs\\b","\\bfettarsch\\b","\\bnacktarsch\\b","\\boberarsch\\b","\\bverarsche\\b","\\bverarschen\\b","\\bverarschst\\b","\\bverarscht\\b","\\bverarschte\\b","\\bbums\\b","\\bbumse\\b","\\bbumsen\\b","\\bbumsend\\b","\\bbumsende\\b","\\bbumsendem\\b","\\bbumsenden\\b","\\bbumsender\\b","\\bbumsendes\\b","\\bbumsens\\b","\\bbumser\\b","\\bbumsern\\b","\\bbumsers\\b","\\bbumses\\b","\\bbumsest\\b","\\bbumst\\b","\\bbumste\\b","\\bbumsten\\b","\\bbumstest\\b","\\bbumstet\\b","\\bgebumst\\b","\\bgebumste\\b","\\bgebumstem\\b","\\bgebumsten\\b","\\bgebumster\\b","\\bgebumstes\\b","\\btucke\\b","\\bhomo\\b","\\bhomos\\b","\\bblasen\\b","\\bblasend\\b","\\bblasende\\b","\\bblasendem\\b","\\bblasenden\\b","\\bblasender\\b","\\bblasendes\\b","\\bgeblasen\\b","\\bgepoppt\\b","\\bpoppen\\b","\\bpoppt\\b","\\bhure\\b","\\bkinderficker\\b","\\bnazischlampe\\b","\\bnutte\\b","\\bschwanzlutscher\\b","\\bwixer\\b","\\bwixxer\\b","\\bejakulieren\\b","\\bgeil\\b","\\bmasturbieren\\b","\\bmöse\\b","\\bonanieren\\b","\\borgasmus\\b","\\bporno\\b","\\bpornografie\\b","\\bsado-maso\\b","\\bscheiße\\b","\\bscheisse\\b","\\bschwuchtel\\b","\\btitte\\b","\\btitten\\b"]}}
}),KXL.module("Animations",function(a,b,c,d,e){a.Tweening=d.Controller.extend({animationCapabilities:!0,easingStyle:"Power2.easeInOut",animationOverlap:"-=.75",animateOnlyOnIntro:!0,initialize:function(){TweenLite.ticker.fps(30),this.timelineGamePageLoggedIn=new TimelineLite,this.timelineGamePageLoggedOut=new TimelineLite,this.timelineHomePage=new TimelineLite},animateHeaderMenu:function(){b.config.animationCapabilities&&TweenLite.fromTo(e("#header-region"),1,{opacity:0,y:-50,ease:this.easingStyle},{opacity:1,y:0,clearProps:"transform",ease:this.easingStyle})},pageIn:function(a){if(this.animationCapabilities&&b.config.animationCapabilities)switch(this.animateOnlyOnIntro&&(this.animationCapabilities=!1),a){case"home":this.animatePageHome();break;case"gameloggedin":this.animatePageGameLoggedIn();break;case"gameloggedout":this.animatePageGameLoggedOut();break;case"gameLandingloggedout":this.animatePageGameLandingLoggedOut()}},pageOut:function(){},animatePageGameLoggedIn:function(){this.timelineGamePageLoggedIn.clear(),this.timelineGamePageLoggedIn.add(TweenLite.fromTo(e(".kx-game .game-background"),1,{opacity:0,ease:this.easingStyle},{delay:1.5,opacity:1,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineGamePageLoggedIn.add(TweenLite.fromTo(e(".game-nav-region"),1,{opacity:0,y:0,ease:this.easingStyle},{opacity:1,y:0,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineGamePageLoggedIn.add(TweenLite.fromTo(e(".game-profile-region"),1,{opacity:0,y:50,ease:this.easingStyle},{opacity:1,y:0,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineGamePageLoggedIn.add(TweenLite.fromTo(e(".game-leaderboard-region"),1,{opacity:0,y:50,ease:this.easingStyle},{opacity:1,y:0,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineGamePageLoggedIn.add(TweenLite.fromTo(e(".game-latest-posts-region"),1,{opacity:0,y:50,ease:this.easingStyle},{opacity:1,y:0,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineGamePageLoggedIn.add(TweenLite.fromTo(e(".game-featured-items-region"),1,{opacity:0,y:50,ease:this.easingStyle},{opacity:1,y:0,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineGamePageLoggedIn.add(TweenLite.fromTo(e(".game-media-region"),1,{opacity:0,y:50,ease:this.easingStyle},{opacity:1,y:0,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineGamePageLoggedIn.restart()},animatePageGameLoggedOut:function(){this.timelineGamePageLoggedOut.clear(),this.timelineGamePageLoggedOut.add(TweenLite.fromTo(e(".game-nav-region"),1,{opacity:0,ease:this.easingStyle},{delay:1,opacity:1,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineGamePageLoggedOut.add(TweenLite.fromTo(e(".kx-game .game-background"),1,{opacity:0,ease:this.easingStyle},{opacity:1,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineGamePageLoggedOut.add(TweenLite.fromTo(e(".game-video-region"),1,{opacity:0,y:-50,scaleX:5,scaleY:5,ease:this.easingStyle},{opacity:1,y:0,scaleX:1,scaleY:1,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineGamePageLoggedOut.add(TweenLite.fromTo(e(".game-signup-region"),1,{opacity:0,y:50,ease:this.easingStyle},{opacity:1,y:0,ease:this.easingStyle,clearProps:"transform"})),this.timelineGamePageLoggedOut.add(TweenLite.fromTo(e(".game-story-region"),1,{opacity:0,y:50,ease:this.easingStyle},{opacity:1,y:0,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineGamePageLoggedOut.add(TweenLite.fromTo(e(".game-screenshots-region"),1,{opacity:0,y:50,ease:this.easingStyle},{delay:.25,opacity:1,y:0,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineGamePageLoggedOut.restart},animatePageGameLandingLoggedOut:function(){this.timelineGamePageLoggedOut.clear(),this.timelineGamePageLoggedOut.add(TweenLite.fromTo(e(".kx-game .game-background"),1,{opacity:0,ease:this.easingStyle},{opacity:1,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineGamePageLoggedOut.add(TweenLite.fromTo(e(".game-screenshots-region"),1,{opacity:0,y:-50,scaleX:5,scaleY:5,ease:this.easingStyle},{delay:.5,opacity:1,y:0,scaleX:1,scaleY:1,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineGamePageLoggedOut.add(TweenLite.fromTo(e(".game-signup-region"),1,{opacity:0,x:100,ease:this.easingStyle},{opacity:1,x:0,ease:this.easingStyle,clearProps:"transform"})),this.timelineGamePageLoggedOut.restart},animatePageHome:function(){this.timelineHomePage.clear(),this.timelineHomePage.add(TweenLite.fromTo(e(".kx-home-pager"),1,{opacity:0,y:50,ease:this.easingStyle},{delay:1,opacity:1,y:0,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineHomePage.add(TweenLite.fromTo(e(".kx-home-games-container"),1,{opacity:0,y:50,ease:this.easingStyle},{opacity:1,y:0,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineHomePage.add(TweenLite.fromTo(e(".kx-home-game-signup, .kx-home-logged-out h2"),1,{opacity:0,y:50,ease:this.easingStyle},{opacity:1,y:0,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineHomePage.add(TweenLite.fromTo(e(".kx-home-posts-container"),1,{opacity:0,y:50,ease:this.easingStyle},{opacity:1,y:0,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineHomePage.add(TweenLite.fromTo(e(".kx-home-user-game-profiles"),1,{opacity:0,y:50,ease:this.easingStyle},{opacity:1,y:0,ease:this.easingStyle,clearProps:"transform"}),this.animationOverlap),this.timelineHomePage.restart()}})}),KXL.module("Common.Utils.Animation",function(a){a.calculateAnimateDuration=function(a,b){return a/b},a.calculateAnimateSpeed=function(a,b){return a/b}}),KXL.module("Language",function(a,b,c,d){a.i18n=d.Controller.extend({initialize:function(a){a=a||{},this.polyglot=new Polyglot({locale:a.locale.substring(0,2)}),this.polyglot.extend(a.localizations)},addLocales:function(a){this.polyglot.extend(a||{})},t:function(a,b){return this.polyglot.t(a,b)}})}),KXL.module("Common.Utils.PatternUtils",function(a){a.validateEmail=function(a){var b=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i;return b.test(a)}}),KXL.module("Common.Utils.Url",function(a){a.isRelative=function(a,b){b||(b=window.location.host);var c=this.parse(a),d=this.parse(c.href);return d.host===b},a.parse=function(a){var b=document.createElement("a");return b.href=a,{source:a,protocol:b.protocol.replace(":",""),host:b.hostname,port:b.port,href:b.href,query:b.search,params:function(){for(var a,c={},d=b.search.replace(/^\?/,"").split("&"),e=d.length,f=0;e>f;f++)d[f]&&(a=d[f].split("="),c[a[0]]=a[1]);return c}(),file:(b.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:b.hash.replace("#",""),path:b.pathname.replace(/^([^\/])/,"/$1"),relative:(b.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:b.pathname.replace(/^\//,"").split("/")}},a.build=function(a){var b=window.location.protocol+"//"+window.location.hostname,c=a&&"/"!==a.charAt(0);return b+(c?"/":"")+(a?a:"")}}),function(){Handlebars.registerHelper("i18n",function(a,b){return a?new Handlebars.SafeString(KXL.i18n.t(a,b.hash)):void 0}),Handlebars.registerHelper("nl2br",function(a){return new Handlebars.SafeString(KXL.Common.Utils.StringUtils.nl2br(Handlebars.Utils.escapeExpression(a)))}),Handlebars.registerHelper("escapeUrlize",function(a){return new Handlebars.SafeString($.fn.urlize(Handlebars.Utils.escapeExpression(a)))}),Handlebars.registerHelper("htmlDecode",function(a){return new Handlebars.SafeString(KXL.Common.Utils.StringUtils.htmlDecode(a))}),Handlebars.registerHelper("ucFirst",function(a){return new Handlebars.SafeString(KXL.Common.Utils.StringUtils.ucFirst(a))}),Handlebars.registerHelper("fuzzytime",function(a){return new Handlebars.SafeString(KXL.Common.Utils.DateUtils.fuzzytime(a))}),Handlebars.registerHelper("lcfuzzytime",function(a){return new Handlebars.SafeString(KXL.Common.Utils.StringUtils.lcFirst(KXL.Common.Utils.DateUtils.fuzzytime(a)))}),Handlebars.registerHelper("chain",function(){var a=Array.prototype.slice.call(arguments,0,arguments.length-2),b=arguments[arguments.length-2],c=arguments[arguments.length-1];return _.forEach(a,function(a){Handlebars.helpers[a]&&(b=Handlebars.helpers[a](b,c))}),b})}(),KXL.module("Analytics",function(a,b,c,d,e,f){a.Controller=d.Controller.extend({pollData:{tag:"session",stage:"sessioninpro"},pollHandle:null,timeout:270,initialize:function(){var a=this;this.startListening(),this.websocket=b.module("Websocket"),b.switches.analyticsHeartBeat&&(this.startSessionPolling(),b.commands.setHandlers({"analytics:track:page:view":function(b){a.trackPageView(b)}}))},startSessionPolling:function(){var a=this;this.pollHandle||(this.pollHandle=setInterval(function(){a.gaTrackEvent("heartbeat","alive",null,a.timeout,!0)},1e3*a.timeout),this.gaTrackEvent("heartbeat","first"))},kxBiLog:function(a){b.currentUser&&(a.k=b.currentUser.get("id")),f.extend(a,{p:"kxp",key:"qwerty",x:b.Common.Utils.CookieUtils.getCookie("PHPSESSID")||"",t:Math.floor(Date.now()/1e3),env:b.config.BI_LOGGING.environment}),this.callImgUrl(b.config.BI_LOGGING.biUrl+"?"+jQuery.param(a))},callImgUrl:function(a,b){var c=new Image;c.src=a,f.delay(function(){try{c.destroy()}catch(a){}},b||6e4)},trackConversion:function(){var a=985860830,b="AOmoCLrC0AcQ3pWM1gM",c=new Image;c.src="//www.googleadservices.com/pagead/conversion/"+a+"/?value=0&label="+b+"&guid=ON&script=0",e.getScript("//www.googleadservices.com/pagead/conversion.js")},getPaymentDetail:function(a){var b=this.getCurrentGamePlaying(),c=a.provider;return a.paymentType&&(c+="."+a.paymentType),a.paymentMethod&&(c+="."+a.paymentMethod),b&&(c+="."+b),c},getCurrentGamePlaying:function(){return b.context&&b.context.get("urlName")},startListening:function(){function a(a,b){var c=b.trackSource||"sourceunknown";return"/"+a+"/"+(b&&b.wasDeferred?"delayed/":"")+(b&&b.trackControl?b.trackControl:"controlunknown")+"/"+c+"/"}function c(a,c,d){var e=b.config.BI_LOGGING.special_offer,f={u:d,tag:e.tag,g:e.g,app:e.app,event_id:e.events[c].event_id,event_name:c,event_context:e.event_context,event_group:a};g.kxBiLog(f)}function d(a,c,d,e){var f=b.config.BI_LOGGING.player_guides,h={u:a,game:d,tag:f.tag,g:f.g,app:f.app,event_id:f.event_id,event_name:f.event_name,event_context:f.event_context,event_group:c,data_load:e};g.kxBiLog(h)}var g=this;b.vent.on("info:page:nav",function(a){g.trackPageView(a)}),b.vent.on("page:nav",function(a){/\/?(game|forum\/categories)\/tome(-?)immortal(-?)arena\/?.*/i.test(a)&&(window.adroll_adv_id="7NOVMYUMMRGV5JKMDD3AAI",window.adroll_pix_id="QW4H5KZGMFGKZGBS6GVJZM",e.getScript("https://s.adroll.com/j/roundtrip.js"))}),b.vent.on("info:game:page",function(a,c){if(a&&"home"===c&&!b.currentUser){var d=b.games&&b.games.findWhere({urlName:a}),e=d&&d.get("commonName");e&&f.has(b.config.autoRegCommonNames,e)&&g.trackPageView("/startnow/"+a+"/page")}}),b.vent.on("info:game:load",function(a){g.gaTrackEvent("game load",a)}),b.vent.on("info:payment:processor:init",function(a){g.trackPaymentsPageView("processor/"+g.getPaymentDetail(a)+"/init")}),b.vent.on("info:payment:processor:auth",function(a){g.trackPaymentsPageView("processor/"+g.getPaymentDetail(a)+"/success")}),b.vent.on("info:payment:processor:denied",function(a){var b=a.reason||"unknown";g.trackPaymentsPageView("processor/"+g.getPaymentDetail(a)+"/denied/"+b)}),b.vent.on("info:payment:processor:error",function(a){var b=a.reason||"unknown";g.trackPaymentsPageView("processor/"+g.getPaymentDetail(a)+"/error/"+b)}),b.vent.on("info:payment:init",function(){g.trackPaymentsPageView(g.getCurrentGamePlaying()+"/init")}),b.vent.on("info:payment:success",function(){g.trackPaymentsPageView(g.getCurrentGamePlaying()+"/success")}),b.vent.on("info:payment:error",function(a){var b=a.reason||"unknown";g.trackPaymentsPageView(g.getCurrentGamePlaying()+"/error/"+b)}),b.vent.on("info:payment:failed",function(){g.trackPaymentsPageView(g.getCurrentGamePlaying()+"/failure")}),b.vent.on("info:payment:denied",function(a){var b=a.reason||"unknown";g.trackPaymentsPageView(g.getCurrentGamePlaying()+"/denied/"+b)}),b.vent.on("info:payment:settings",function(){g.trackPaymentsPageView(g.getCurrentGamePlaying()+"/settings")}),b.vent.on("info:login:success",function(){g.gaTrackEvent("Regflow","Login","success")}),b.vent.on("info:login:error",function(a){g.gaTrackEvent("Regflow","Login","error:"+a.error.error)}),b.vent.on("info:fblogin:start",function(b){g.trackPageView(a("fbauth",b)+"start")}),b.vent.on("info:fblogin:success",function(c){if(c&&c.response&&(c.response.isNew||!c.response.user||!c.response.user.lastLoggedIn)){var d=c.response.user,e=g.getUaGameUrlName();g.trackPageView(a("registration",c)+(e?e+"/":"")+"success/fb"),g.trackBICreateAccountEvent(d&&d.id),g.trackBIRegisterAccountEvent(d&&d.id,"facebook",d&&d.facebookId),g.trackPMS(d&&d.id),b.Common.Utils.CookieUtils.deleteCookie("uaTrack.kxl.queryString",!0,"/")}g.trackPageView(a("fbauth",c)+"success")}),b.vent.on("info:fblogin:error",function(b){g.trackPageView(a("fbauth",b)+"error:"+(b&&b.error&&b.error.error))}),b.vent.on("info:googlelogin:start",function(b){g.trackPageView(a("googleauth",b)+"start")}),b.vent.on("info:googlelogin:success",function(c){if(c&&c.response&&(c.response.isNew||!c.response.user||!c.response.user.lastLoggedIn)){var d=c.response.user,e=g.getUaGameUrlName();g.trackPageView(a("registration",c)+(e?e+"/":"")+"success/google"),g.trackBICreateAccountEvent(d&&d.id),g.trackBIRegisterAccountEvent(d&&d.id,"google",d&&d.googleId),g.trackPMS(d&&d.id),b.Common.Utils.CookieUtils.deleteCookie("uaTrack.kxl.queryString",!0,"/")}g.trackPageView(a("googleauth",c)+"success")}),b.vent.on("info:googlelogin:error",function(b){g.trackPageView(a("googleauth",b)+"error:"+(b&&b.error&&b.error.error))}),b.vent.on("info:steamlogin:start",function(b){g.trackPageView(a("steamauth",b)+"start")}),b.vent.on("info:steamlogin:success",function(c){if(c&&c.response&&(c.response.isNew||!c.response.user||!c.response.user.lastLoggedIn)){var d=c.response.user,e=g.getUaGameUrlName();g.trackPageView(a("registration",c)+(e?e+"/":"")+"success/steam"),g.trackBICreateAccountEvent(d&&d.id),g.trackBIRegisterAccountEvent(d&&d.id,"steam",d&&d.steamId),g.trackPMS(d&&d.id),b.Common.Utils.CookieUtils.deleteCookie("uaTrack.kxl.queryString",!0,"/")}g.trackPageView(a("steamauth",c)+"success")}),b.vent.on("info:steamlogin:error",function(b){g.trackPageView(a("steamauth",b)+"error:"+(b&&b.error))}),b.vent.on("info:register:start",function(b){g.trackPageView(a("registration",b)+(b.trackGameUrlName?b.trackGameUrlName+"/":"")+"start")}),b.vent.on("info:register:cancel",function(b){g.trackPageView(a("registration",b)+(b.trackGameUrlName?b.trackGameUrlName+"/":"")+"cancel")}),b.vent.on("info:register:submit",function(b){g.trackPageView(a("registration",b)+(b.trackGameUrlName?b.trackGameUrlName+"/":"")+"submit")}),b.vent.on("info:register:captcha:start",function(b){g.trackPageView(a("registration",b)+(b.trackGameUrlName?b.trackGameUrlName+"/":"")+"captcha/start")}),b.vent.on("info:register:success",function(c){g.trackConversion();var d=g.getUaGameUrlName()||c.trackGameUrlName;g.trackPageView(a("registration",c)+(d?d+"/":"")+"success/kxl"),c&&!c.wasDeferred&&g.trackBICreateAccountEvent(c.id),g.trackBIRegisterAccountEvent(c&&c.id,"kxl",c&&c.email),g.trackPMS(c&&c.id),b.Common.Utils.CookieUtils.deleteCookie("uaTrack.kxl.queryString",!0,"/")}),b.vent.on("info:register:autoreg",function(a){g.trackBICreateAccountEvent(b.currentUser&&b.currentUser.get("id")||""),g.trackPageView("/autoregistration/"+(a?a+"/":"unknowngame/")+"success")}),b.vent.on("info:register:error",function(b){g.trackPageView(a("registration",b)+(b.trackGameUrlName?b.trackGameUrlName+"/":"")+"regerror/"+b.error.error)}),b.vent.on("info:landingpage:ctaclick",function(b){g.trackPageView(a("registration",b)+"click")}),b.vent.on("info:specialoffer:displayed",function(a,b){c(a,"specialoffer_displayed",b)}),b.vent.on("info:specialoffer:redeemed",function(a,b){c(a,"specialoffer_redeemed",b)}),b.vent.on("info:specialoffer:transacted",function(a,b){c(a,"specialoffer_transacted",b)}),b.vent.on("guide:article:read",function(a,b,c){d(a,"",b.get("commonName"),c)}),b.vent.on("autoreg:error",function(a,b){g.gaTrackEvent("Autoreg","TempAccountCreate:"+(b?b:"unknowngame"),"error:"+(a.error?a.error:"unknownerror"))}),b.vent.on("info:gameCTA:click",function(a){var b=a&&a.game||"unknowngame",c=a&&a.cta||"unknowncta";g.trackPageView("/startnow/"+b+"/ctaclick/"+c)}),b.vent.on("adwords:track:route",function(a){var c,d=a.toLowerCase().replace(/\/$/,"").replace(/^\//,""),e=b.config.adWords;if(f.has(e.fixedRoutes,d)){var h=e.fixedRoutes[d];c=e.conversionParams[h]}else f.some(f.keys(e.subRoutes),function(a){return d.indexOf(a)?void 0:(c=e.conversionParams[e.subRoutes[a]],!0)});c&&g.callImgUrl("//googleads.g.doubleclick.net/pagead/viewthroughconversion/"+c.id+"/?value=0&label="+c.label+"&guid=ON&script=0")}),b.vent.on("info:startnow:menu",function(a){g.trackPageView("/startnow/"+(a||"unknowngame")+"/menu")}),b.vent.on("info:startnow:new",function(a){g.trackPageView("/startnow/"+(a||"unknowngame")+"/new")}),b.vent.on("info:startnow:fb",function(a){g.trackPageView("/startnow/"+(a||"unknowngame")+"/fb")}),b.vent.on("info:startnow:fb:success",function(a){g.trackPageView("/startnow/"+(a||"unknowngame")+"/fb/success")}),b.vent.on("info:ribbon:ctaClick",function(){g.trackPageView("/adtogame/ctaclick")}),b.vent.on("info:steamconnect:success",function(a){g.trackPageView("game/tomeimmortalarena/steamconnect/success/"+a.userId)}),b.vent.on("info:steamconnect:error",function(){g.trackPageView("game/tomeimmortalarena/steamconnect/error")})},queryStringCookie:function(a){var c=b.Common.Utils.CookieUtils.getJSONCookie("uaTrack.kxl.queryString");if(a&&c&&c.game){var d="gp"===c.game?"vc":c.game,e=b.staticGames.findWhere({commonName:d});c.gameUrlName=e&&e.get("urlName")||d}return c},getUaGameUrlName:function(){var a=this.queryStringCookie(!0);return a&&a.gameUrlName},trackPMS:function(a){var c=this,d=c.queryStringCookie();if(d){var f=b.config.BI_LOGGING.kxPmsUrl+"?"+e.param(d)+"&event_type=Registration&from_string="+d.from+"&kxid="+a;e.ajax({url:f,dataType:"jsonp",jsonp:"jsoncallback",success:function(a){for(var b=0;b<a.length;b++)c.callImgUrl(a[b],6e3)}})}},trackBICreateAccountEvent:function(a){var c=this,d=b.config.BI_LOGGING.createAccount;if(d){var g={k:a,x:b.Common.Utils.CookieUtils.getCookie("PHPSESSID")||"",t:b.Common.Utils.DateUtils.now,data_load:JSON.stringify({query_string:e.param(c.queryStringCookie()||"")}),env:b.config.BI_LOGGING.environment};this.kxBiLog(f.defaults(d,g))}},trackBIRegisterAccountEvent:function(a,c,d){var e=b.config.BI_LOGGING.registerAccount;if(e){var g={k:a,x:b.Common.Utils.CookieUtils.getCookie("PHPSESSID")||"",t:b.Common.Utils.DateUtils.now,data_load:JSON.stringify({authentication_method:c||"",authentication_value:d||""}),env:b.config.BI_LOGGING.environment};this.kxBiLog(f.defaults(e,g))}},trackPaymentsPageView:function(a){this.trackPageView("/payments/"+a.toLowerCase())},trackPageView:function(a){var b=["_trackPageview"];a&&b.push(a),_gaq.push(b)},gaTrackEvent:function(a,b,c,d,e){_gaq.push(["_trackEvent",a,b,c||null,d||0,!e])}}),b.addInitializer(function(b){new a.Controller(b)})}),KXL.module("Errors",function(a,b,c,d){a.Router=d.AppRouter.extend({appRoutes:{"*notFound":"notFound",500:"internalError"}}),b.addInitializer(function(){new a.Router({controller:e})}),b.commands.setHandlers({"404:show":function(){b.navigate("/404"),e.notFound()},"500:show":function(){b.navigate("/500"),e.internalError()},"error:show":function(a){e.showError(a)}});var e={notFound:function(){this.showError(b.request("new:error:view",{error:404}))},internalError:function(){this.showError(b.request("new:error:view",{error:500}))},showError:function(a){b.execute("page:show","error"),b.errorRegion.show(a)}};a.BaseError=function(){},a.BaseError.prototype=new Error,a.BaseError.prototype.toJSON=function(){var a={error:this.error,reason:this.message};return this.detail&&(a.detail=this.detail),JSON.stringify(a)},a.UsernameConflictError=function(a,c){this.error="UsernameConflict",this.message=a||b.i18n.t("errors.UsernameConflict"),this.detail=c},a.UsernameConflictError.prototype=new a.BaseError,a.UsernameConflictError.prototype.constructor=a.UsernameConflictError,a.RegistrationAuthorizationError=function(a,c){this.error="RegistrationAuthorizationFailure",this.message=a||b.i18n.t("errors.RegistrationAuthorizationError"),this.detail=c},a.InvalidCredentialsError=function(a,c){this.error="InvalidCredentials",this.message=a||b.i18n.t("errors.InvalidCredentials"),this.detail=c},a.InvalidCredentialsError.prototype=new a.BaseError,a.InvalidCredentialsError.prototype.constructor=a.InvalidCredentialsError,a.TooManyLoginAttemptsError=function(a,c){this.error="RateLimit",this.message=a||b.i18n.t("errors.TooManyLoginAttemptsError"),this.detail=c},a.TooManyLoginAttemptsError.prototype=new a.BaseError,a.TooManyLoginAttemptsError.prototype.constructor=a.TooManyLoginAttemptsError,a.GenericLoginError=function(a,c){this.error="GenericLoginError",this.message=a||b.i18n.t("errors.GenericLoginError"),this.detail=c},a.GenericLoginError.prototype=new a.BaseError,a.GenericLoginError.prototype.constructor=a.GenericLoginError,a.IOvationBlockedError=function(a,c){this.error="IOvationBlockedError",this.message=a||b.i18n.t("errors.IOvationBlockedError"),this.detail=c},a.IOvationBlockedError.prototype=new a.BaseError,a.IOvationBlockedError.prototype.constructor=a.IOvationBlockedError,a.DeviceFingerprintError=function(a,c){this.error="DeviceFingerprintError",this.message=a||b.i18n.t("errors.DeviceFingerprintError"),this.detail=c},a.DeviceFingerprintError.prototype=new a.BaseError,a.DeviceFingerprintError.prototype.constructor=a.DeviceFingerprintError,a.UnexpectedError=function(a,c){this.error="Unexpected",this.message=a||b.i18n.t("errors.Unexpected"),this.detail=c},a.UnexpectedError.prototype=new a.BaseError,a.UnexpectedError.prototype.constructor=a.UnexpectedError,a.UnexpectedFacebookLoginError=function(a,c){this.error="UnexpectedFacebookLoginError",this.message=a||b.i18n.t("errors.UnexpectedFacebookLoginError"),this.detail=c},a.UnexpectedFacebookLoginError.prototype=new a.BaseError,a.UnexpectedFacebookLoginError.prototype.constructor=a.UnexpectedFacebookLoginError,a.UnexpectedGoogleLoginError=function(a,c){this.error="UnexpectedGoogleLoginError",this.message=a||b.i18n.t("errors.UnexpectedGoogleLoginError"),this.detail=c},a.UnexpectedGoogleLoginError.prototype=new a.BaseError,a.UnexpectedGoogleLoginError.prototype.constructor=a.UnexpectedGoogleLoginError,a.FacebookMergeConflictError=function(a,c){this.error="FacebookMergeConflictError",this.message=a||b.i18n.t("errors.FacebookMergeConflictError"),this.detail=c},a.FacebookMergeConflictError.prototype=new a.BaseError,a.FacebookMergeConflictError.prototype.constructor=a.FacebookMergeConflictError,a.EmailConflictError=function(a,c){this.error="EmailConflictError",this.message=a||b.i18n.t("errors.EmailConflictError"),this.detail=c},a.EmailConflictError.prototype=new a.BaseError,a.EmailConflictError.prototype.constructor=a.EmailConflictError,a.FacebookAPILoginError=function(a,c){this.error="FacebookAPILoginError",this.message=a||b.i18n.t("errors.FacebookAPILoginError"),this.detail=c},a.FacebookAPILoginError.prototype=new a.BaseError,a.FacebookAPILoginError.prototype.constructor=a.FacebookAPILoginError,a.InvalidEmailError=function(a,c){this.error="InvalidEmailError",this.message=a||b.i18n.t("errors.InvalidEmailError"),this.detail=c},a.InvalidEmailError.prototype=new a.BaseError,a.InvalidEmailError.prototype.constructor=a.InvalidEmailError,a.EmailInUseError=function(a,c){this.error="EmailInUseError",this.message=a||b.i18n.t("errors.EmailInUseError"),this.detail=c},a.EmailInUseError.prototype=new a.BaseError,a.EmailInUseError.prototype.constructor=a.EmailInUseError,a.ValidationError=function(a,b){this.error="ValidationError",this.message=a,this.detail=b},a.RequestError=function(a,b){this.error="RequestError",this.message=a,this.detail=b},a.SystemError=function(a,b){this.error="SystemError",this.message=a,this.detail=b,this.toString=function(){return this.message+": "+this.detail}}});var JSONSocket=function(a){_.extend(this,Backbone.Events),this.options=a||{},this.socket=null,this.connecting=!1,this.connected=!1,this.clientClosed=!1,this.reconnectCount=0,this.reconnectTimeout=null,this.reconnectLimit=null,this.subscriptions={}};JSONSocket.prototype.connect=function(a){var b=this;b.log("connect",{connected:b.connected,connecting:b.connecting,reconnectCount:b.reconnectCount}),b.connected||b.connecting||(b.connecting=!0,b.clientClosed=!1,a&&_.extend(b.options,a),b.socket=new SockJS(b.options.url),b.emitLocal=b.trigger,b.socket.onopen=b.onOpen.bind(b),b.socket.onmessage=b.onMessage.bind(b),b.socket.onclose=b.onClose.bind(b),b.on("unsubscribe",function(a){b.unsubscribePath(a,!0)}))},JSONSocket.prototype.disconnect=function(){this.connected&&(this.clientClosed=!0,this.socket.close(1e3))},JSONSocket.prototype.reconnect=function(a){var b=this;if(b.log("reconnect",{connected:b.connected,connecting:b.connecting,limit:a}),a&&(b.reconnectLimit=a),!(b.connected||b.connecting||b.reconnectTimeout)){if(b.reconnectLimit&&b.reconnectCount>=b.reconnectLimit)return void b.log("reconnect limit reached",b.reconnectLimit,b.reconnectCount);b.reconnectCount++;var c=b.getReconnectDelay();b.reconnectTimeout=setTimeout(function(){b.reconnectTimeout=null,b.connect()},c),b.log("Reconnecting in",c)}},JSONSocket.prototype.log=function(){if(this.options&&this.options.debug){var a=Array.prototype.slice.call(arguments);a.unshift("JSONSocket"),console.log.apply(console,a)}},JSONSocket.prototype.emit=function(a,b){var c={eventName:a};b&&(c.payload=b),c=JSON.stringify(c),this.socket.send(c)},JSONSocket.prototype.onOpen=function(){this.authorize()},JSONSocket.prototype.onClose=function(a){switch(this.log("onClose",{clientClosed:this.clientClosed},a),this.socket.onopen=null,this.socket.onmessage=null,this.socket.onclose=null,this.socket=null,this.connected=!1,this.connecting=!1,a.code){case 401:this.clientClosed||this.reconnect(1);break;case 1e3:break;default:this.clientClosed||this.reconnect()}},JSONSocket.prototype.authorize=function(){var a=this;a.once("authorization",a.onAuthorization.bind(a)),a.emit("authorize",a.options.authData)},JSONSocket.prototype.onAuthorization=function(a){var b=this;return a!==!0?b.close(401,"Authorization failed"):(b.log("onAuthorization",b.subscriptions),_.forEach(b.subscriptions,function(a,c){b.emit("subscribe",c)}),b.connected=!0,b.connecting=!1,b.reconnectCount=0,void(b.reconnectLimit=null))},JSONSocket.prototype.onMessage=function(a){try{a=JSON.parse(a.data)}catch(b){this.log("onMessage error",b)}this.log("onMessage",a.eventName,a.payload),this.emitLocal(a.eventName,a.payload)},JSONSocket.prototype.getReconnectDelay=function(){return this.reconnectCount<5?75*this.reconnectCount:this.reconnectCount<10?300*this.reconnectCount:this.reconnectCount<20?500*this.reconnectCount:1e4},JSONSocket.prototype.subscribe=function(a,b){return this.log("subscribe",this.connected,a,b),this.subscriptions[a]?this.subscriptions[a]++:(this.subscriptions[a]=1,this.connected&&this.emit("subscribe",a)),b&&this.on(a,b),!0},JSONSocket.prototype.unsubscribe=function(a,b){return this.log("unsubscribe",a,b),this.subscriptions[a]?(this.subscriptions[a]--,this.off(a,b),this.subscriptions[a]<1&&(delete this.subscriptions[a],this.connected&&this.emit("unsubscribe",a)),!0):!1},JSONSocket.prototype.unsubscribePath=function(a,b){return this.log("unsubscribePath",a),this.subscriptions[a]?(delete this.subscriptions[a],this.off(a),void(this.connected&&!b&&this.emit("unsubscribe",a))):!1},JSONSocket.prototype.unsubscribeAll=function(){var a=this;_.forEach(a.subscriptions,function(b,c){a.off(c),a.emit("unsubscribe",c),delete a.subscriptions[c]})},KXL.module("Websocket",function(a,b){var c=this;c.socket=new JSONSocket,c.connectSocket=function(){var a={};return document.cookie.split("; ").forEach(function(b){b=b.split("="),a[b.shift()]=b.join("=")}),a.PHPSESSID?void c.socket.connect({url:b.config.WEBSOCKET_URL+"/sockjs",authData:{token:b.currentUser.get("websocketToken")}}):!1},c.disconnectSocket=function(){c.socket.disconnect()},c.on=c.socket.on.bind(c.socket),c.once=c.socket.once.bind(c.socket),c.off=c.socket.off.bind(c.socket),c.emit=c.socket.emit.bind(c.socket),b.appModel.on("change:currentUser",function(a,b){b?c.connectSocket():c.disconnectSocket()}),b.commands.setHandlers({"websocket:connect":c.connectSocket,"websocket:disconnect":c.disconnectSocket,"websocket:subscribe":c.socket.subscribe.bind(c.socket),"websocket:unsubscribe":c.socket.unsubscribe.bind(c.socket),"websocket:unsubscribeAll":c.socket.unsubscribeAll.bind(c.socket)})}),KXL.module("Facades",function(a,b,c,d,e){a.Facebook={login:function(){var a=e.Deferred();return FB.login(function(c){"connected"===c.status?a.resolve(c):a.reject(new b.Errors.FacebookAPILoginError(null,c))},{scope:"email"}),a},logout:function(){function a(c){"connected"!==c.status?b.resolve(c):FB.logout(a)}var b=e.Deferred();return FB&&FB.getLoginStatus&&FB.getLoginStatus(a),b}}}),KXL.module("Facades",function(a,b,c,d,e,f){function g(a,b){return e.ajax({type:"POST",url:a,data:JSON.stringify(b),dataType:"json",contentType:"application/json"})}a.Kixeye={logout:function(){return e.get("/api/auth/logout")},login:function(a,b){return e.post("/api/auth/login/kxl",{username:a,password:b},null,"json")},fbLogin:function(a){var c=e.Deferred();return b.request("fraud:fingerprint:promise:get").then(function(d){g("/api/auth/login/fb",{accessToken:a,deviceFingerprint:d}).done(function(a){if(a&&a.error){var e;e=409===a.error?new b.Errors.EmailConflictError(null,a.detail):401===a.error&&a.detail&&!d?new b.Errors.DeviceFingerprintError:401===a.error&&a.detail&&a.detail.deviceFingerprintCheck===!1?new b.Errors.IOvationBlockedError:new b.Errors.UnexpectedFacebookLoginError,c.reject(e)}else c.resolve(a)}).fail(function(){c.reject(error||new b.Errors.UnexpectedFacebookLoginError)})}),c},googleLogin:function(a){var c=e.Deferred();return b.request("fraud:fingerprint:promise:get").then(function(d){g("/api/auth/login/google",{accessToken:a,deviceFingerprint:d}).done(function(a){a&&a.error?c.reject(401===a.error&&a.detail&&!d?new b.Errors.DeviceFingerprintError:401===a.error&&a.detail&&a.detail.deviceFingerprintCheck===!1?new b.Errors.IOvationBlockedError:new b.Errors.UnexpectedGoogleLoginError):c.resolve(a)}).fail(function(){c.reject(new b.Errors.UnexpectedGoogleLoginError)})}),c},forgotPasswordLogin:function(a){return e.post("/api/auth/login/forgot-password",{token:a})},changeEmailLogin:function(a){return e.post("/api/auth/login/change-email",{token:a})},emailVerificationLogin:function(a){var b=e.Deferred();return e.post("/api/auth/login/email-verification",{token:a}).done(function(c){c&&c.user?b.resolve(c.user):b.reject(a)}).fail(function(){b.reject(a)
}),b},validateEmail:function(a){var c=e.Deferred();return e.ajax({type:"GET",url:b.config.API_URL+"/emails/"+a,data:{email:a},dataType:"json",contentType:"application/json"}).done(function(d){d.isValid?d.isTaken?c.resolve(a,!1,new b.Errors.EmailInUseError):c.resolve(a,!0):c.resolve(a,!1,new b.Errors.InvalidEmailError)}).fail(function(){c.reject(a)}),c},validateUsername:function(a,c){var d={minLength:6,maxLength:20},g=e.Deferred();return c=f.extend({},d,c),e.ajax({type:"GET",url:b.config.API_URL+"/usernames/"+encodeURIComponent(a),data:c}).done(function(b){var c=["hasRestrictedCharacters","hasRestrictedWords","isGreaterThanMaxLength","isLessThanMinLength","isTaken"],d=[];f.each(c,function(a){b[a]&&d.push(a)}),d.length?g.resolve(a,!1,d):g.resolve(a,!0)}).fail(function(){g.reject(a)}),g},facebookMerge:function(a,c){var d=e.Deferred();return b.request("fraud:fingerprint:promise:get").then(function(e){g("/api/auth/facebook-merges",{accessToken:c,sourceUserId:a,deviceFingerprint:e}).done(function(a){if(a&&a.error){var c;switch(a.error){case 409:c=a.detail&&a.detail.email?new b.Errors.EmailConflictError(null,a.detail):new b.Errors.FacebookMergeConflictError(null,a.detail);break;default:c=new b.Errors.UnexpectedError}d.reject(c)}else d.resolve(a)}).fail(function(){d.reject(new b.Errors.UnexpectedError)})}),d},updatePassword:function(a,b){return e.ajax({url:"/api/auth/changePassword",type:"POST",data:JSON.stringify({password:b}),contentType:"application/json"})},deviceFingerprints:function(a,b,c){return e.ajax({url:"/api/v2/device-fingerprints",type:"POST",data:JSON.stringify({userId:a,deviceFingerprint:b,originEvent:c}),contentType:"application/json"})},isCurrentUserMonetized:function(){return e.ajax({url:"/payment/ismonetized",type:"GET",contentType:"application/json"})},getProcessorSessionByPaypalTransactionId:function(a,b){return e.ajax({url:"/api/v2/users/"+a+"/processor-sessions?transactionId="+b,method:"GET"})},getPaymentOptions:function(a){return e.ajax({url:"/api/v2/payment-sessions/"+a+"/payment-options",type:"GET",contentType:"application/json",dataType:"json"})},postProcessorSession:function(a,b,c,d,e,f){return g("/api/v2/processor-sessions",{paymentSessionId:a,paymentOptionId:b,paymentProvider:c,paymentType:d,saveToken:e,paymentDetails:f})},paymentLocalization:function(a){return e.ajax({url:"/payment/localization?locale="+a,type:"GET",contentType:"application/json"})},verifyEmail:function(){return g(b.config.API_URL+"/email-verifications")},sendDeviceVerificationCode:function(a){return g(b.config.API_URL+"/user-verified-devices/"+a+"/verifications",{"null":null})},checkDeviceVerificationCode:function(a,c){return e.ajax({url:b.config.API_URL+"/user-verified-devices/"+a+"/verifications?verificationCode="+c,type:"GET"})}}}),KXL.module("Entities",function(a,b,c,d,e,f){a.Model=c.Model.extend(f.omit(c.Picky.Selectable.prototype,"constructor")),a.Model=a.Model.extend({constructor:function(){var a=this;return this.fetched=0,this.listenTo(this,"sync",function(){a.fetched=(new Date).getTime()}),c.Model.prototype.constructor.apply(this,arguments)}}),f.extend(a.Model.prototype,c.Validation.mixin),a.DeepModel=c.DeepModel.extend(f.omit(c.Picky.Selectable.prototype,"constructor")),f.extend(a.DeepModel.prototype,c.Validation.mixin)}),KXL.module("Entities",function(a,b,c,d,e,f){a.Collection=c.Collection.extend({model:a.Model,constructor:function(){var a=this;return this.fetched=0,this.listenTo(this,"sync",function(){a.fetched=(new Date).getTime()}),c.Collection.prototype.constructor.apply(this,arguments)},next:function(a,b){var c=this.indexOf(a)+1,d=f.size(this);return b&&(c%=d),c>=d&&(c=d-1),this.at(c)},prev:function(a,b){var c=this.indexOf(a)-1;return c=b?c>-1?c:f.size(this)-1:c>-1?c:0,this.at(c)}}),a.SingleSelectCollection=a.Collection.extend(f.omit(c.Picky.SingleSelect.prototype,"constructor"))}),KXL.module("Group.Helpers",function(a){a.getDefaultLogoIconForGroup=function(a){var b=KXL.games.get(a.gameId),c=b&&b.get("urlName");return KXL.config.STATIC_BASE_URL+"/modules/common/images/group/"+(c||"default")+"_logo.png"},a.getDefaultCoverIconForGroup=function(a){var b=KXL.games.get(a.gameId),c=b&&b.get("urlName");return KXL.config.STATIC_BASE_URL+"/modules/common/images/group/"+(c||"default")+"_cover.jpg"}}),KXL.module("Group.Entities",function(a,b,c,d,e,f){function g(c,d,f){var g=e.Deferred();return"update"!==d||c.unsavedAttributes()||c.changedAttributes()?(c.isValid(!0)?c.save(f,{success:function(){var d=O.getUserGroup(b.currentUser.id,c.id);d.done(function(c){var d=new a.UserGroup(c,{parse:!0});b.currentUserGroups.add(d,{merge:!0}),g.resolve(d.get("group"))}).fail(function(a){404===a.status?b.currentUserRoles.then(function(a){b.request("auth:has:group:super:admin",a)&&b.asyncRequest("group:get",c.id,{data:{expand:"discussions,members,applicants,ranks"}}).then(function(a){g.resolve(a)})}):g.reject(new b.Errors.SystemError("Usergroup request failed",a))})},error:function(a,c){g.reject(new b.Errors.RequestError("Group "+d+" request failed",c))}}):g.reject(new b.Errors.ValidationError("Invalid group attributes",c.validate())),g.promise()):(g.resolve(c),g.promise())}var h=b.Entities.Model.extend({defaults:{title:null,visibility:null},validation:{title:{fn:function(a){return a?a.length>40||a.length<2?b.i18n.t("group.validation.title.length"):void 0:b.i18n.t("group.validation.title.required")}},visibility:{required:!0,oneOf:["public","private","secret"],msg:"group.validation.visibility"},shortMotto:{required:!1,maxLength:120,msg:"group.validation.shortMotto"},recruitingPitch:{required:!1,maxLength:420,msg:"group.validation.recruitingPitch"}},parse:function(b,d){return d=f.extend(d||{},{id:b.id}),(!this.get("discussions")||b.discussions)&&(this.get("discussions")?(this.get("discussions").add(b.discussions,{merge:!0}),delete b.discussions):b.discussions=new p(b.discussions||[],d)),(!this.get("ranks")||b.ranks)&&(this.get("ranks")?(this.get("ranks").add(b.ranks,{merge:!0}),delete b.ranks):b.ranks=new z(b.ranks||[])),(!this.get("online")||b.online)&&(this.get("online")?(this.get("online").add(b.online,{merge:!0}),delete b.online):b.online=new w(b.online||[],d)),(!this.get("members")||b.members)&&(this.get("members")?(this.get("members").add(b.members,{merge:!0}),delete b.members):b.members=new u(b.members||[],d)),(!this.get("friendMembers")||b.friendMembers)&&(this.get("friendMembers")?(this.get("friendMembers").add(b.friendMembers,{merge:!0,parse:!0}),delete b.friendMembers):b.friendMembers=new v(b.friendMembers||[],d)),(!this.get("invites")||b.invites)&&(this.get("invites")?(this.get("invites").add(b.invites,{merge:!0}),delete b.invites):b.invites=new r(b.invites||[],d)),(!this.get("applicants")||b.applicants)&&(this.get("applicants")?(this.get("applicants").add(b.applicants,{merge:!0}),delete b.applicants):b.applicants=new n(b.applicants||[],d)),(!this.get("recruits")||b.recruits)&&(this.get("recruits")?(this.get("recruits").add(b.recruits,{merge:!0}),delete b.recruits):b.recruits=new x(b.recruits||[],d)),(!this.get("lists")||b.lists)&&(this.get("lists")?(this.get("lists").add(b.lists,{merge:!0}),delete b.lists):b.lists=new D(b.lists||[],d)),(!this.get("attackBeacons")||b.attackBeacons)&&(this.get("attackBeacons")?(this.get("attackBeacons").add(b.attackBeacons&&b.attackBeacons.data||[],{merge:!0}),delete b.attackBeacons):b.attackBeacons=new a.AttackBeacons(b.attackBeacons&&b.attackBeacons.data||[],d)),this.get("userDossierStreams")||(b.userDossierStreams=new c.Collection),b},url:function(){var a=f.result(this,"urlRoot")||f.result(this.collection,"url")||urlError();return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+this.id},urlRoot:function(){var a="/api/groups";return this.isNew()?a+"/"+this.get("type"):a},save:function(a,b){var d=new FormData;return a=this.isNew()?a||f.clone(this.attributes):a||this.unsavedAttributes()||this.changedAttributes()||null,f.each(a,function(a,b){"type"!==b&&("gameId"!==b||a)&&d.append(b,a)}),f.defaults(b||{},{data:d,processData:!1,contentType:!1,type:"POST"}),c.Model.prototype.save.call(this,a,b)}}),i=b.Entities.Collection.extend({constructor:function(a,c){return this.options=c||{},b.Entities.Collection.prototype.constructor.apply(this,arguments)},url:function(){return b.config.API_URL+"/groups/"+this.options.id+"/"+f.result(this,"endpoint")},parse:function(a,b){return a.data&&(this.meta=a.meta,this.paging||(this.paging={}),b&&"previous"===b.direction?this.paging.previous=a.paging.previous:b&&"next"===b.direction?this.paging.next=a.paging.next:this.paging=a.paging,a=a.data),a},getPrevious:function(a){return this.getMore("previous",a)},getNext:function(a){return this.getMore("next",a)},getMore:function(a,b){var c=e.Deferred();if(this.paging&&this.paging[a]){var d;d=f.isString(this.paging[a])&&"?"===this.paging[a][0]?this.paging[a].slice(1):this.paging[a],this.fetch(f.extend({remove:!1,data:d,direction:a,success:function(){c.resolve()},error:function(){c.reject()}},b))}else c.resolve();return c.promise()}});a.Groups=i.extend({model:h,url:function(){return b.config.API_URL+"/groups"}}),a.UserGroupApplications=b.Entities.Collection.extend({model:h,url:function(){var a=b.currentUser&&b.currentUser.id;return b.config.API_URL+"/users/"+a+"/group-applications"}});var j=b.Entities.Model.extend({groupId:void 0,initialize:function(a,b){this.groupId=b.groupId}});a.UserGroup=b.Entities.Model.extend({idAttribute:"groupId",url:function(){var a=f.result(this,"urlRoot")||f.result(this.collection,"url")||urlError();return this.isNew()?a:a.replace(/([^\/])$/,"$1/")+this.id},parse:function(a,b){a.group&&(a.group=new h(a.group,b));var c=this.get("settings");return c?(c.set(a.settings||{},f.extend({merge:!0},b)),delete a.settings):(c=new j(a.settings||{},f.extend({groupId:a.groupId},b)),a.settings=c),a}}),a.UserGroups=b.Entities.Collection.extend({model:a.UserGroup,initialize:function(a,c){this.userId=(c||{}).userId||b.currentUser.id},url:function(){return b.config.API_URL+"/users/"+this.userId+"/groups"}});var k=b.Entities.Model,l=k.extend({idAttribute:"userId",parse:function(a){return a.user&&(a.user=new b.Entities.Model(a.user)),a.userGame&&(a.userGame=new b.Entities.Model(a.userGame)),a}}),m=l.extend({}),n=i.extend({model:m,endpoint:"applicants"}),o=k.extend({defaults:{title:"",topic:"",type:"public",eventStartAt:parseInt(Math.round((new Date).getTime())),eventEndAt:parseInt(Math.round((new Date).getTime()+6048e5))},blacklist:["stream"],validation:{title:{fn:function(a){return a?a.length>20?b.i18n.t("group.discussion.validate.titleTooLong"):void 0:"Please provide a title."}},topic:{fn:function(a){return a.length>140?b.i18n.t("group.discussion.validate.topicTooLong"):void 0}},type:{required:!0},eventStartAt:{required:function(a,b,c){return"event"===c.type},fn:function(a){return a?void 0:b.i18n.t("group.discussion.validate.noDate")}},eventEndAt:{required:function(a,b,c){return"event"===c.type},fn:function(a,c,d){return a?d.eventStartAt&&d.eventEndAt<=d.eventStartAt?b.i18n.t("group.discussion.validate.startDateAfterEndDate"):void 0:b.i18n.t("group.discussion.validate.noDate")}}},saveAttrs:function(a){var b=e.Deferred();return this.save(a,{patch:!0,wait:!0,success:function(a){b.resolve(a)},error:function(a,c){b.reject(a,c)}}),b.promise()},archive:function(){return this.saveAttrs({status:"archived"})},activate:function(){return this.saveAttrs({status:"active"})}}),p=i.extend({model:o,url:function(){return b.config.API_URL+"/groups/"+this.options.id+"/discussions"},post:function(a){var b=e.Deferred(),c=a;return c.urlRoot=this.url(),c.save(null,{success:function(a){b.resolve(a)},error:function(a){b.reject(a)}}),b.promise()}}),q=l.extend({}),r=i.extend({model:q,endpoint:"invites"}),s=l.extend({urlRoot:function(){return b.config.API_URL+"/groups/"+this.groupId+"/members"},initialize:function(a,b){b.collection&&b.collection.options&&b.collection.options.id&&(this.groupId=b.collection.options.id)},save:function(a,b){return b||(b={}),a||(a=this.isNew()?f.clone(this.attributes):this.changedAttributes()),delete a.selected,b.attrs=a,c.Model.prototype.save.call(this,a,b)}}),t=s.extend({sync:function(a,d,e){return e=e||{},e.url="read"===a?b.config.API_URL+"/groups/"+this.groupId+"/recruits":this.url(),c.sync(a,d,e)}}),u=i.extend({model:s,endpoint:"members"}),v=i.extend({model:s,endpoint:"friendMembers"}),w=i.extend({model:s,endpoint:"online-members"}),x=i.extend({model:t,endpoint:"recruits"}),y=k.extend({idAttribute:"rankId"}),z=b.Entities.Collection.extend({model:y}),A=l.extend({idAttribute:"id"}),B=i.extend({model:A,endpoint:function(){return"lists/"+this.options.listId+"/list-items"},addItems:function(a){var b=e.Deferred(),c=this,d={itemType:"user",userId:"",completed:!0},g=[];return a=f.defaults(a||{},d),a.players.each(function(b){var d={itemType:a.itemType,userId:b.get("id"),completed:!0};g.push(e.ajax({url:c.url(),type:"post",data:JSON.stringify(d),dataType:"json",contentType:"application/json",success:function(a){var b=new A(a,{parse:!0});c.add(b)}}))}),e.when.apply(void 0,g).then(function(){b.resolve()}),b.promise()}});a.AttackBeacon=k.extend({idAttribute:"attackId"}),a.AttackBeacons=i.extend({model:a.AttackBeacon});var C=k.extend({parse:function(a,b){var c=b&&b.id;return!c&&this.options&&this.options.id&&(c=this.options.id),a.listItems=new B(a.listItems,{id:c,listId:a.id}),a}}),D=i.extend({model:C,endpoint:"lists",create:function(a){var b=e.Deferred(),c={title:"Enemy List",type:"user",visibility:"published",style:"none"},d=this,a=f.defaults(a||{},c),g=new C(a);return g.options=this.options,g.urlRoot=this.url(),g.save(null,{success:function(a){d.add(a),b.resolve(a)}}),b.promise()},retrieve:function(a){var b=e.Deferred(),c=this,d=new C;return d.options=this.options,d.urlRoot=this.url()+"/"+a,d.fetch({success:function(a){c.add(a),b.resolve(a)}}),b.promise()}}),E=k.extend(),F=i.extend({model:E,comparator:"priority",update:function(){var a=this.options.group,b=a.get("discussions").findWhere({id:this.options.discussionKey});return b.set("subpods",this.models),c.sync("update",this)},endpoint:function(){return"discussions/"+this.options.discussionKey+"/sub-pods"}}),G=k.extend({initialize:function(a,b){this.options=b},url:function(){return b.config.API_URL+"/groups/"+this.options.group.get("id")+"/discussions/"+this.options.discussionKey+"/posts/"+this.options.postId+"/likes"},like:function(a){var b=e.Deferred(),c={data:{isLiked:!0}};return a=f.defaults(a||{},c),e.ajax({url:this.url(),type:"put",data:JSON.stringify(a.data),dataType:"json",contentType:"application/json",success:function(){b.resolve()}}),b.promise()}}),H=k.extend({url:function(){this.options||(this.options=this.collection.options);var a=b.config.API_URL+"/groups/"+this.options.group.get("id")+"/discussions/"+this.options.discussionKey+"/posts/"+this.options.postId+"/comments";return this.get("id")&&(a+="/"+this.get("id")),a},update:function(a){var b=e.Deferred();return this.save(a,{patch:!0,success:function(a){b.resolve(a)}}),b.promise()},hide:function(){var a=e.Deferred();return this.save({isHidden:!0},{patch:!0,success:function(b){a.resolve(b)}}),a.promise()}}),I=i.extend({model:H,comparator:"createdAt",url:function(){return b.config.API_URL+"/groups/"+this.options.group.get("id")+"/discussions/"+this.options.discussionKey+"/posts/"+this.options.postId+"/comments"},post:function(a){var b=this,c=e.Deferred(),d={content:"This is cool."},a=f.defaults({content:a.content}||{},d),g=new H(a);return g.options=this.options,g.urlRoot=this.url(),g.save(null,{success:function(a){c.resolve(a),b.add(a)}}),c.promise()},sync:function(a,b,d){var e={url:this.url()};return d=f.defaults(d||{},e),d.direction&&this.paging[d.direction]&&(d.url+=this.paging[d.direction]),d.data={entityId:this.options.entityId,limit:5},c.sync(a,b,d)}}),J=k.extend({}),K=i.extend({model:J}),L=k.extend({defaults:{text:""},fileAttribute:"image",url:function(){return"/api/groups/"+this.options.group.get("id")+"/discussions/"+this.options.discussionKey+"/posts/notes"}}),M=k.extend({parse:function(a){var b=this.collection.options,c={data:[],paging:[]};return this.options={group:b.group,discussionKey:b.discussionKey,postId:a.id},a.likesCount=new G({likedByViewer:a.likedByViewer||!1,count:a.likesCount},this.options),a.comments&&a.comments.data&&(c=a.comments),a.comments=new I(c.data,this.options),a.comments.paging=c.paging,a.object&&a.object.hydrated.images&&(a.images=new K(a.object.hydrated.images)),a},url:function(){return b.config.API_URL+"/groups/"+this.options.group.get("id")+"/discussions/"+this.options.discussionKey+"/posts/"+this.options.postId},hide:function(){var a=e.Deferred();return this.save({visibility:0},{patch:!0,success:function(b){a.resolve(b)}}),a.promise()}}),N=i.extend({model:M,parse:function(a,b){return a.data||(a={data:a}),f.isArray(a.data)||(a.data=[a.data]),a.data=f.reject(a.data,function(a){return"base-attack"!==a.action&&"level-up"!==a.action||!f.isEmpty(a.actor.hydrated.username)&&!f.isEmpty(a.object.hydrated.username)?void 0:!0}),i.prototype.parse.call(this,a,b)},comparator:function(a){return-a.get("createdAt")},url:function(){return b.config.API_URL+"/users/"+b.currentUser.id+"/groups/"+this.options.group.id+"/discussions/"+this.options.discussionKey+"/posts"},post:function(a){var b=e.Deferred(),c=this,d=new L(a.data);return d.options=this.options,d.save(null,{formData:!0,success:function(){c.getNext().then(function(){b.resolve()})}}),b.promise()}}),O={createGroup:function(a){var b=new h(a);return g(b,"create",a)},updateGroup:function(a){return g(a,"update")},validateGroupAttribute:function(a,b){return h.prototype.preValidate(a,b)},getGroup:function(a,c){var d=e.Deferred(),g=new h({id:a});return g.fetch(f.extend({success:function(a){d.resolve(a)},error:function(a,c){d.reject(new b.Errors.RequestError("Group get request failed",c))}},c||{})),d.promise()},getUserGroup:function(a,c){var d=e.Deferred();return e.ajax({url:b.config.API_URL+"/users/"+a+"/groups/"+c,success:function(a){d.resolve(a)},error:function(a,b){d.reject(a,b)}}),d.promise()},getTempDiscussion:function(){return new o},getDiscussionSubPods:function(a,b){var c=a.get("discussions").findWhere({id:b}),d=new F(c.get("subpods"),{id:a.get("id"),group:a,discussionKey:b});return d},getDiscussionSubPodList:function(a,b){var c=e.Deferred(),d=a.get("lists"),f=d.findWhere({id:b});return f?0!==(f.has("listItems")&&f.get("listItems").length)&&f.has("listItems")?c.resolve(f):f.get("listItems").fetch().done(function(){c.resolve(f)}):d.retrieve(b).done(function(a){a.get("listItems").fetch().done(function(){c.resolve(a)})}),c.promise()},createDiscussionSubPodList:function(a,b,c,d){var f=e.Deferred(),g=a.get("lists");return g.create(d).then(function(a){var b=new E({foreignEntityId:a.get("id"),podType:a.get("type")+"-list",priority:c.length});c.add(b),c.update().then(function(){f.resolve()})}),f.promise()},getDiscussionStream:function(a,b){var d=e.Deferred();if("user-"===b.substring(0,5)){var f=a.get("userDossierStreams").get(b);f&&d.resolve(f.get("stream"));var g=function(d){a.get("userDossierStreams").add(new c.Model({id:b,stream:d}))}}else{var h=a.get("discussions")&&a.get("discussions").get(b);h&&h.get("stream")&&d.resolve(h.get("stream"));var g=function(a){h.set("stream",a,{silent:!0})}}if("resolved"!==d.state()){var i=new N([],{group:a,discussionKey:b});i.fetch({success:function(){g(i),d.resolve(i)},error:function(){d.reject(i)}})}return d.promise()},createDiscussion:function(a,c){var d=e.Deferred();return e.ajax({url:b.config.API_URL+"/groups/"+a+"/discussions",type:"post",data:JSON.stringify(c),dataType:"json",contentType:"application/json",success:function(){b.currentUserGroups.fetch().then(function(){d.resolve()})}}),d},deleteDiscussion:function(a,c){return e.ajax({url:b.config.API_URL+"/groups/"+a.get("id")+"/discussions/"+c.get("id"),type:"delete"})},setDiscussionVisibility:function(a,c,d){var f=e.Deferred(),g=c.get("id");return e.ajax({url:b.config.API_URL+"/users/"+b.currentUser.id+"/groups/"+a.get("id")+"/discussions/"+g,type:"patch",data:JSON.stringify({visibility:d}),dataType:"json",contentType:"application/json",success:function(a){f.resolve(c.set(a))},error:function(a,b){f.reject(a,b)}}),f.promise()},promoteGroupMember:function(a,c){var d,g=c.get("ranks").pluck("rankId").sort(),h=a.get("rankId"),i=e.Deferred();return f.some(g,function(a){return a>h?(d=a,!0):void 0}),d&&(a.set("rankId",d),a.save(null,{success:function(){var b=c.get("recruits");b.contains(a)&&(b.remove(a),c.get("members").add(new s(a.attributes,{id:c.id}))),i.resolve()},error:function(a,c){i.reject(new b.Errors.RequestError("Member promote request failed",c))}})),i.promise()},addGroupMember:function(c,d){var f=e.Deferred();return e.ajax({url:b.config.API_URL+"/groups/"+d+"/members",type:"post",data:JSON.stringify({userId:c}),dataType:"json",contentType:"application/json",success:function(){c===b.currentUser.id?e.when(O.getUserGroup(b.currentUser.id,d)).done(function(c){var d=new a.UserGroup(c,{parse:!0});b.currentUserGroups.add(d),f.resolve()}):f.resolve()},error:function(a,b){f.reject(a,b)}}),f.promise()},rejectApplicant:function(a,c){return e.ajax({url:b.config.API_URL+"/groups/"+c+"/applicants/"+a,type:"delete"})},addApplicant:function(a,c){return e.ajax({url:b.config.API_URL+"/groups/"+c+"/applicants",type:"post",data:JSON.stringify({userId:a}),dataType:"json",contentType:"application/json"})},addInvites:function(a,c){return e.ajax({url:b.config.API_URL+"/groups/"+c+"/invites",type:"post",data:JSON.stringify(a),dataType:"json",contentType:"application/json"})},rejectInvite:function(a,c){return e.ajax({url:b.config.API_URL+"/groups/"+c+"/invites/"+a,type:"delete"})},getRecruits:function(a){var c=e.Deferred();return a.get("recruits").length?c.resolve(a.get("recruits")):a.get("recruits").fetch({id:a.id,success:function(){c.resolve(a.get("recruits"))},error:function(a,d){c.reject(new b.Errors.RequestError("Group recruit request failed",d))}}),c.promise()}};b.reqres.setHandlers({"group:create":function(a){return O.createGroup(a)},"group:update":function(a){return O.updateGroup(a)},"group:get":function(a,b){return O.getGroup(a,b)},"group:get:temp:discussion":function(){return O.getTempDiscussion()},"group:delete:discussion":function(a,b){return O.deleteDiscussion(a,b)},"group:hide:discussion":function(a,b){return O.setDiscussionVisibility(a,b,0)},"group:set:discussion:visibility":function(a,b,c){return O.setDiscussionVisibility(a,b,c)},"group:discussion:add":function(a,b){return O.createDiscussion(a,b)},"group:get:discussion:subpods":function(a,b){return O.getDiscussionSubPods(a,b)},"group:get:discussion:subpod:list":function(a,b){return O.getDiscussionSubPodList(a,b)},"group:create:discussion:subpod:list":function(a,b,c,d){return O.createDiscussionSubPodList(a,b,c,d)},"group:get:discussion:stream":function(a,b){return O.getDiscussionStream(a,b)},"group:attribute:validate":function(a,b){return O.validateGroupAttribute(a,b)},"group:member:add":function(a,b){return O.addGroupMember(a,b)},"group:applicant:add":function(a,b){return O.addApplicant(a,b)},"group:applicant:reject":function(a,b){return O.rejectApplicant(a,b)},"group:invites:add":function(a,b){return O.addInvites(a,b)},"group:invites:reject":function(a,b){return O.rejectInvite(a,b)},"group:member:promote":function(a,b){return O.promoteGroupMember(a,b)},"group:recruits:get":function(a){return O.getRecruits(a)},"group:get:user:group":function(a,b){return O.getUserGroup(a,b)}})});var websocket=KXL.module("Websocket");websocket.on("group-update",function(a){if(KXL.currentUserGroups&&KXL.currentUserGroups.get(a.groupId)){var b=KXL.currentUserGroups.get(a.groupId).get("group");processNotification(b,a)}else KXL.asyncRequest("group:get",a.groupId,{data:{expand:"members,applicants"}}).then(function(b){processNotification(b,a)})}),websocket.on("group-discussion-update",function(a){var b,c=KXL.currentUserGroups.get(a.groupId)&&KXL.currentUserGroups.get(a.groupId).get("group");if(c&&(b="user-"===a.discussionKey.substring(0,5)?c.get("userDossierStreams")&&c.get("userDossierStreams").get(a.discussionKey)&&c.get("userDossierStreams").get(a.discussionKey).get("stream"):c.get("discussions")&&c.get("discussions").get(a.discussionKey)&&c.get("discussions").get(a.discussionKey).get("stream")))switch(a.operation){case"upsert":b.add(a.data,{parse:!0,merge:!0});break;case"delete":}}),websocket.on("group-discussion-post-comment-update",function(a){var b=KXL.currentUserGroups.get(a.groupId)&&KXL.currentUserGroups.get(a.groupId).get("group").get("discussions")&&KXL.currentUserGroups.get(a.groupId).get("group").get("discussions").get(a.discussionKey)&&KXL.currentUserGroups.get(a.groupId).get("group").get("discussions").get(a.discussionKey).get("stream")&&KXL.currentUserGroups.get(a.groupId).get("group").get("discussions").get(a.discussionKey).get("stream").get(a.postId);b&&b.get("comments").add(a.data,{parse:!0,merge:!0})}),websocket.on("applicant-update",function(a){switch(a.operation){case"upsert":KXL.currentUserGroupApplications.add(a.entity,{parse:!0});break;case"delete":KXL.currentUserGroupApplications.remove(a.groupId)}}),websocket.on("usergroup-update",function(a){switch(a.operation){case"upsert":KXL.currentUserGroups.add(a.entity,{parse:!0,merge:!0});break;case"delete":KXL.currentUserGroups.remove(a.groupId)}}),KXL.module("Entities",function(a,b,c,d,e){a.Alliance=a.Model.extend({initialize:function(a){this.allianceId=a.allianceId,this.gameId=a.gameId,this.membersList=new c.Collection},url:function(){return b.config.API_URL+"/games/"+this.gameId+"/alliances/"+this.allianceId},parse:function(a){return this.membersList.add(new c.Collection(a.members).models,{parse:!0,remove:!1,merge:!0}),delete a.members,a}});var f={getAlliance:function(b,c){var d=new a.Alliance({allianceId:c,gameId:b}),f=e.Deferred();return f._model=d,d.fetch({success:function(a,b,c){f.resolve(a,b,c)},error:function(a,b,c){f.reject(a,b,c)}}),f._model=d,f}};b.reqres.setHandler("alliance:entity",function(a,b){return f.getAlliance(a,b)})}),KXL.module("Entities",function(a,b){a.Battlelog=a.Model.extend({}),a.BattlelogCollection=a.Collection.extend({model:a.Battlelog,initialize:function(a,b){this.userId=b.userId,this.gameId=b.gameId},url:function(){return b.config.API_URL+"/users/"+this.userId+"/games/"+this.gameId+"/battle-log"}});var c={getBattlelog:function(b,c){var d=new a.BattlelogCollection(null,{userId:b,gameId:c}),e=d.fetch({error:function(){d.reset()}});return e._collection=d,e}};b.reqres.setHandler("battlelog:entities",function(a,b){return c.getBattlelog(a,b)})}),KXL.module("Entities",function(a,b){a.Bookmark=a.Model.extend({idAttribute:"discussionId",url:function(){var a=b.config.API_URL+"/users/"+b.request("get:current:user").id+"/forum-bookmarks";return this.id&&(a+="/"+this.id),a}}),a.BookmarksCollection=a.Collection.extend({model:a.Bookmark,initialize:function(a,b){this.userId=b.userId},url:function(){return b.config.API_URL+"/users/"+this.userId+"/forum-bookmarks"}});var c={getBookmarks:function(b){var c=new a.BookmarksCollection(null,{userId:b}),d=c.fetch({error:function(){c.reset()}});return d._collection=c,d}};b.reqres.setHandler("forumbookmark:entities",function(a){return c.getBookmarks(a)})}),KXL.module("Entities",function(a,b){a.Avatar=a.Model.extend({defaults:{userId:"",url:""},url:function(){return b.config.API_URL+"/user-avatar-updates"}}),a.AvatarPreset=a.Model.extend(),a.AvatarPresetsCollection=a.Collection.extend({model:a.AvatarPreset});var c={getAvatarPresets:function(){return new a.AvatarPresetsCollection(b.config.avatarPresets)}};b.reqres.setHandler("get:avatar:presets",function(){return c.getAvatarPresets()})}),KXL.module("Entities",function(a,b,c,d,e,f){var g=b.Entities.Model.extend({defaults:{content:"",userId:"",entityType:"",entityId:""},url:function(){this.options||(this.options=this.collection.options);var a=b.config.API_URL+"/comments/";return this.get("id")&&(a+=this.get("id")),a},update:function(a){var b=e.Deferred();return this.save(a,{patch:!0,success:function(a){b.resolve(a)}}),b.promise()},hide:function(){var a=e.Deferred();return this.save({isHidden:!0},{patch:!0,success:function(b){a.resolve(b)}}),a.promise()}}),h=b.Entities.Collection.extend({model:g,comparator:"createdAt",constructor:function(a,c){return this.options=c||{},b.Entities.Collection.prototype.constructor.apply(this,arguments)},url:function(){return b.config.API_URL+"/comments/"},parse:function(a,b){return a.data&&(this.meta=a.meta,b&&"previous"===b.direction?this.paging.previous=a.paging.previous:b&&"next"===b.direction?this.paging.next=a.paging.next:this.paging=a.paging,a=a.data),a},post:function(a){var c=this,d=e.Deferred(),h={content:"This is cool.",userId:b.currentUser.id,entityType:this.options.entityType,entityId:this.options.entityId},a=f.defaults({content:a.content}||{},h),i=new g(a);return i.options=this.options,i.save(null,{success:function(a){c.add(a),d.resolve(a)}}),d.promise()},sync:function(a,b,d){var e={url:this.url()};return d=f.defaults(d||{},e),d.direction&&this.paging[d.direction]&&(d.url+=this.paging[d.direction]),d.data={entityId:this.options.entityId,limit:5},c.sync(a,b,d)}}),i={getComments:function(a,b){return new h(a,b)}};b.reqres.setHandler("item:get:comments",i.getComments)}),KXL.module("Entities",function(a,b,c,d,e,f){a.ForumPost=a.Model.extend(),a.ForumPostsCollection=a.Collection.extend({model:a.ForumPost,url:function(){return b.config.API_URL+"/forum-discussions"}});var g={getForumPosts:function(b){var c={titleId:null,curated:!1,offset:null,limit:null};b=f.defaults({},b,c);var d=new a.ForumPostsCollection,e=d.fetch({data:b});return e._collection=d,e}};b.reqres.setHandler("forumposts:entities",function(a){return g.getForumPosts(a)})}),KXL.module("Entities",function(a,b){a.ForumProfile=a.Model.extend({url:function(){return b.config.API_URL+"/forum-profiles/"+this.get("userId")}});var c={getForumProfile:function(b){var c=new a.ForumProfile({userId:b}),d=c.fetch();return d._model=c,d}};b.reqres.setHandler("forumprofile:entity",function(a){return c.getForumProfile(a)})}),KXL.module("Entities",function(a,b,c,d,e,f){a.ForumSignatures=a.Model.extend({defaults:{body:"",format:""},idAttribute:"userId",url:function(){return b.config.API_URL+"/users/"+b.currentUser.id+"/forum-signatures"},save:function(a,b){return c.Model.prototype.save.call(this,a,f.extend(b||{},{put:!0}))},isNew:function(){return!1}});var g={getForumSignature:function(){var b=new a.ForumSignatures,c=e.Deferred();return b.fetch({success:function(a){c.resolve(a)},error:function(a){c.reject(a)}}),c.promise()},saveForumSignature:function(a,c){var d=new b.Entities.ForumSignatures({body:a,format:c}),e=d.save();return e._model=d,e}};b.reqres.setHandler("forumsignature:entity",function(){return g.getForumSignature()}),b.reqres.setHandler("save:forumsignature",function(a,b){return g.saveForumSignature(a,b)})}),KXL.module("Entities",function(a,b,c,d,e,f){a.FriendRequest=a.Model.extend({url:function(){return b.config.API_URL+"/friend-requests"}}),a.FriendRequestsCollection=a.Collection.extend({model:a.FriendRequest,url:function(){return b.config.API_URL+"/friend-requests"}});var g={getFriendRequests:function(b){var c=e.Deferred(),d=f.extend({sent:void 0,received:void 0},b),g=new a.FriendRequestsCollection([],d);return g.fetch({success:function(a){c.resolve(a)},error:function(a){c.reject(a)}}),c._collection=g,c}};b.reqres.setHandler("friend:request:entities",function(a){return g.getFriendRequests(a)})}),KXL.module("Entities",function(a,b,c,d,e,f){a.UserFriendRequest=a.Model.extend({initialize:function(a){this.userId=a.userId},url:function(){return b.config.API_URL+"/users/"+this.userId+"/friend-requests"}}),a.UserFriendRequestsCollection=a.Collection.extend({options:null,initialize:function(a,b){this.options=b,this.id=b.userId},model:a.UserFriendRequest,url:function(){return b.config.API_URL+"/users/"+this.id+"/friend-requests"}});var g={getUserFriendRequests:function(b,c){var d=e.Deferred(),g=f.defaults(c,{sent:void 0,received:void 0}),h=[];g.expandGames&&h.push("games"),delete g.expandGames,h.length&&(g.expand=h.join(",")),g.userId=b;
var i=new a.UserFriendRequestsCollection([],{userId:b});return i.fetch({data:g,success:function(a){d.resolve(a)},error:function(a){d.reject(a)}}),d._collection=i,d},acceptUserFriendRequest:function(c,d){var f=e.Deferred(),g=new a.Friend({userId:d});return g.save(null,{success:function(a){b.request("increment:service:friends:count",b.currentUser.id),b.request("increment:service:friends:count",g.get("userId")),b.request("current:user:friend:entities")._collection.add(a),f.resolve()},error:function(){f.reject()}}),f},rejectUserFriendRequest:function(a){var c=b.config.API_URL+"/friend-requests/"+a;return e.ajax({type:"DELETE",url:c})},sendFriendRequest:function(a){var c=b.config.API_URL+"/friend-requests";return e.ajax({type:"POST",url:c,contentType:"application/json",data:JSON.stringify([{userId:b.currentUser.id,targetId:a}])})}};b.reqres.setHandlers({"user:friend:request:entities":function(a,b){return g.getUserFriendRequests(a,b)},"user:friend:request:accept":function(a,b){return g.acceptUserFriendRequest(a,b)},"user:friend:request:reject":function(a){return g.rejectUserFriendRequest(a)},"user:friend:request:send":function(a){return g.sendFriendRequest(a)}})}),KXL.module("Entities",function(a,b,c,d,e,f){var g=25,h={};a.FacebookFriend=a.Model.extend({idAttribute:"facebookId"}),a.FacebookFriends=a.Collection.extend({initialize:function(a,b){this.id=b.id},url:function(){return b.config.API_URL+"/users/"+this.id+"/facebook-friends"}}),a.Friend=a.Model.extend({idAttribute:"userId",defaults:{presence:"unavailable"},blacklist:["presence"],urlRoot:function(){return b.config.API_URL+"/users/"+b.request("get:current:user").id+"/friends"},isNew:function(){return!0}}),a.Friends=a.Collection.extend({model:a.Friend,initialize:function(a,b){this.id=b.id},url:function(){return b.config.API_URL+"/users/"+this.id+"/friends"},fetch:function(b){return b=b||{},b.data=f.extend(b.data||{},{expand:"games"}),a.Collection.prototype.fetch.call(this,b)},parse:function(a){var c=this.id;if(a.meta&&a.meta.totalAvailable&&b.request("set:service:friends:count",c,a.meta.totalAvailable),h[c]=a.paging&&a.paging.nextOffset?a.paging.nextOffset:null,a.data){var d={};f.each(a.data,function(b,c){var e=b.userId;e&&b.user&&(b.user.presence&&(a.data[c].presence=b.user.presence),b.user.avatars&&(d[e]=b.user.avatars))}),f.isEmpty(d)||b.request("set:services:avatars",d)}return a.data?a.data:a}});var i={getFriends:function(b,c){c=c||{};var d=new a.Friends([],{id:b}),i=e.Deferred(),j=f.isUndefined(c.offset)?h[b]?h[b]:0:c.offset;if(-1===j)return i.reject();var k={offset:j,limit:c.limit||g};c.presence&&(k.presence=c.presence);var l=[];return c.expandGames&&l.push("games"),l.push("avatars"),l.length&&(k.expand=l.join(",")),d.fetch({data:k,success:function(a){i.resolve(a)},error:function(a){i.reject(a)}}),i._collection=d,c.promise?i.promise():i},getFriendsPagingOffset:function(a){return h[a]?h[a]:0},getFacebookFriendsOnKXL:function(a){return this.getFacebookFriends(a,{hasLoggedIn:!0})},getFacebookFriends:function(b,c){var d=new a.FacebookFriends([],{id:b}),e=d.fetch({data:f.extend({limit:400,offset:void 0},c)});return e._collection=d,e}};b.reqres.setHandlers({"user:friend:entities":function(a,b){return i.getFriends(a,b)},"get:user:friend:nextPageOffset:entity":function(a){return i.getFriendsPagingOffset(a)},"get:facebook:friends:on:KXL:entities":function(a){return i.getFacebookFriendsOnKXL(a)},"get:facebook:friends:entities":function(a){return i.getFacebookFriends(a)}})}),KXL.module("Entities",function(a,b,c,d,e,f){function g(){var c=new a.StaticGames(b.config.staticGames);return c}function h(a,b,d){var e=new c.FilteredCollection(null,{collection:a});return e.setFilter(function(a){return-1!==b.indexOf(a.get("urlName"))}),d&&(e.comparator=d,e.sort()),e}a.Game=a.Model.extend({}),a.GameSiteContents=a.Model.extend({defaults:{id:null,gameBannerClickUrl:null,gameBannerImageUrl:null,gameScreenshotThumbUrl:null,gameScreenshotUrl:null,gameVideoThumbUrl:null,gameVideoYoutubeUrl:null},url:function(){return"/api/games/site-contents/"+this.id+"/"+b.config.locale}}),a.GamesCollection=a.Collection.extend({model:a.Game,url:function(){return b.config.API_URL+"/games"}}),a.StaticGame=a.Model.extend({defaults:{id:"",name:"",url:"",className:"",subMenuItems:[]}}),a.StaticGames=b.Entities.Collection.extend({model:a.StaticGame});var i=["vegaconflict","warcommander","battlepirates"],j=["warcommanderrogueassault","vcm"],k={getGameByGameUrl:function(a,b){return a.findWhere({urlName:b})},getMobileGames:function(a){return h(a,j)},getWebGames:function(a){return h(a,i,function(a,b){var c=i.indexOf(a.get("urlName")),d=i.indexOf(b.get("urlName"));return d>c?-1:c>d?1:0})},getGames:function(b){return new a.GamesCollection(b)},getGameIFrameUrl:function(a,b){var c=f.extend({},b),d=e.Deferred(),g=c.section?"/"+c.section:"",h=c.path?"/"+c.path:"",i=c.queryParams?"?"+e.param(c.queryParams):"";return e.ajax({dataType:"json",url:"/api/games/get/"+a+g+h+i,success:function(a){a.error||null===a.iframeSrc?d.resolve(""):a.iframeSrc&&d.resolve(a.iframeSrc)}}),d.promise()},getGameSiteContents:function(b){var c=new a.GameSiteContents({id:b}),d=c.fetch();return d._model=c,d},getStaticWebGames:function(){var a=new c.FilteredCollection(null,{collection:g(),collectionFilter:function(a){return!a.get("isMobile")}});return a},getStaticGames:function(){return g()}};b.reqres.setHandlers({"get:game:by:gameurl":function(a,b){return k.getGameByGameUrl(a,b)},"get:game:site-contents":function(a){return k.getGameSiteContents(a)},"get:game:iframe:url":function(a,b){return k.getGameIFrameUrl(a,b)},"games:entities":function(a){return a=a||[],k.getGames(a)},"mobilegames:entities":function(a){return k.getMobileGames(a)},"webgames:entities":function(a){return k.getWebGames(a)},"staticgames:entities":function(){return k.getStaticGames()},"static:webgames:entities":function(){return k.getStaticWebGames()}})}),KXL.module("Entities",function(a,b){a.GameInvite=a.Model.extend({initialize:function(){this.validation.inviteCode.msg=b.i18n.t("games.mustBeHex"),this.on("save",function(){b.vent.trigger("beta:code:success")})},url:function(){return b.config.API_URL+"/users/"+b.request("get:current:user").id+"/game-invites/"},validation:{inviteCode:{required:!0,length:24,pattern:"^[a-zA-Z0-9]"}}})}),KXL.module("Entities",function(a,b,c,d,e,f){a.Leaderboard=a.Model.extend(),a.Leaderboards=a.Collection.extend({model:a.Leaderboard,initialize:function(a,c){this.url=function(){return b.config.API_URL+"/leaderboards?gameId="+c.gameId}}}),a.LeaderboardEntry=a.Model.extend(),a.LeaderboardEntryItem=a.Collection.extend({model:a.LeaderboardEntry,initialize:function(a,c){this.url=function(){var a=b.config.API_URL+"/leaderboards/"+c.leaderboardId+"/entries";return c.entryId&&(a+="/"+c.entryId),a}}}),a.LeaderboardEntries=a.Collection.extend({model:a.LeaderboardEntry,defaults:{limit:100},initialize:function(a,b){this.options=f.defaults({},b,this.defaults)},url:function(){return b.config.API_URL+"/leaderboards/"+this.options.leaderboardId+"/entries?"+e.param(this.options)}}),a.LeaderboardEntryMulti=a.Collection.extend({model:a.LeaderboardEntry,initialize:function(a,c){this.url=function(){var a=b.config.API_URL+"/leaderboard-entries/?leaderboardIds="+c.leaderboardIds;return c.entryId&&(a+="&entryId="+c.entryId),c.friendOf&&(a+="&friendOf="+c.friendOf),a}}});var g={getLeaderboardEntries:function(b){var c=new a.LeaderboardEntries([],b),d=e.Deferred(),f={success:function(a){d.resolve(a)},error:function(a){d.reject(a)}};return c.fetch(f),d},getLeaderboardEntryItem:function(b){var c=new a.LeaderboardEntryItem([],b),d=e.Deferred(),f={success:function(a){d.resolve(a)},error:function(a){d.reject(a)}};return c.fetch(f),d},getLeaderboardEntriesFor:function(b){var c=new a.LeaderboardEntryMulti([],b),d=e.Deferred(),f={success:function(a){d.resolve(a)},error:function(a){d.reject(a)}};return c.fetch(f),d},getLeaderboards:function(b){var c=new a.Leaderboards([],b),d=e.Deferred(),f={success:function(a){d.resolve(a)},error:function(a){d.reject(a)}};return c.fetch(f),d}};b.reqres.setHandler("leaderboard:entities",function(a){return g.getLeaderboards(a)}),b.reqres.setHandler("leaderboard:entry:entities",function(a){return g.getLeaderboardEntryItem(a)}),b.reqres.setHandler("leaderboard:entries:entities",function(a){return g.getLeaderboardEntries(a)}),b.reqres.setHandler("leaderboard:entry:entities:multi",function(a){return g.getLeaderboardEntriesFor(a)})}),KXL.module("Entities",function(a,b,c,d,e,f){a.Locale=a.Model.extend({idAttribute:"locale"}),a.Locales=a.Collection.extend({model:a.Locale});var g={setLocales:function(b){return new a.Locales(b)}};b.reqres.setHandler("new:locales:entity",function(a){var b=f.map(a,function(a){return f.object(["locale"],[a])});return g.setLocales(b)})}),KXL.module("Entities",function(a,b,c,d,e,f){a.Note=a.Model.extend({defaults:{from:"",to:"",text:"",category:"post"},url:function(){return b.config.API_URL+"/notes/"}});var g={saveNote:function(a,c,d){var e=new b.Entities.Note({from:a,to:c,text:f.escape(d),appId:b.config.APP_ID.toString()}),g=e.save();return g._model=e,g},hideNote:function(a){var c=e.Deferred();return e.ajax({type:"PATCH",url:b.config.API_URL+"/notes/"+a,dataType:"json",contentType:"application/json",data:JSON.stringify({isHidden:!0})}).done(function(a){c.resolve(a)}).fail(function(a){c.resolve(a)}),c.promise()}};b.reqres.setHandler("save:note",function(a,b,c){return g.saveNote(a,b,c)}),b.reqres.setHandler("hide:note",function(a){return g.hideNote(a)})}),KXL.module("Entities",function(a,b,c,d,e,f){a.NotificationItem=a.Model.extend(),a.NotificationsCollection=a.Collection.extend({model:a.NotificationItem,parse:function(a){if(delete this.paging,a.paging){var b=/\d+/,c=a.paging,d=c.next,e=c.previous;this.paging={},d&&(this.paging.next=d.substr(d.search(b))),e&&(this.paging.previous=e.substr(e.search(b)))}return a.meta&&(this.totalAvailable=a.meta.totalAvailable,this.trigger("total:changed",this.totalAvailable)),f.filter(a.data,function(a){return"fr"!==a.type})},url:function(){return b.config.API_URL+"/users/"+b.request("get:current:user").id+"/notifications"}});var g=function(b){var c=new a.NotificationsCollection([],b),d=e.Deferred(),f={success:function(a){d.resolve(a)},error:function(a){d.reject(a)}};return b&&b.data&&(f.data=b.data),c.fetch(f),d.promise()},h=function(){return e.ajax({type:"DELETE",url:b.config.API_URL+"/users/"+b.request("get:current:user").id+"/notifications"})},i={getNotifications:function(a){return g(a)},deleteNotifications:function(){return h()}};b.reqres.setHandlers({"get:userNotifications":function(a){return i.getNotifications(a)},"delete:userNotifications":function(){return i.deleteNotifications()}})}),KXL.module("Entities",function(a,b){a.PageMeta=a.Model.extend({idAttribute:"uri"}),a.PagesMeta=a.Collection.extend({model:a.PageMeta});var c={getPageMeta:function(b){var c=new a.PagesMeta(b);return c}};b.reqres.setHandlers({"page:meta:entities":function(a){return c.getPageMeta(a)}})}),KXL.module("Entities",function(a,b,c,d,e,f){var g=null,h=null;a.PostItem=a.Model.extend(),a.PostsCollection=a.Collection.extend({model:a.PostItem,parse:function(a){if(a.paging&&(g=a.paging,("initial"===this.method||"latest"===this.method)&&(h=g.next)),a.data){var c={};f.each(a.data,function(a){var d=a.actor||{};d&&d.hydrated&&d.hydrated.avatars&&(c[d.hydrated.id]=d.hydrated.avatars);var e=a.object||{};e.comments&&e.comments.data?f.each(e.comments.data,function(a){var b=a.author||{};b.avatars&&(c[b.id]=b.avatars)}):e.comments={data:[],paging:[]};var g=e.comments;e.comments=b.request("item:get:comments",g.data,{entityType:e.entityType,entityId:e.entityId,postId:a.id}),e.comments.paging=g.paging}),f.isEmpty(c)||b.request("set:services:avatars",c)}return f.reject(a.data,function(a){return f.isEmpty(a.object.hydrated)})}});var i=function(b,c){a.Posts=new a.PostsCollection,a.Posts.method=c;var d=e.Deferred(),f=b;return a.Posts.url=f,a.Posts.fetch({success:function(a){d.resolve(a)},error:function(a,b){d.reject(b)}}),d.promise()},j={getPosts:function(a){return i(b.config.API_URL+"/users/"+a+"/activity-stream-posts","initial")},getLatestPosts:function(a){var c=b.config.API_URL+"/users/"+a+"/activity-stream-posts";return h?(c+=h,i(c,"latest")):null},getPreviousPosts:function(a){var c=b.config.API_URL+"/users/"+a+"/activity-stream-posts";return g&&g.previous?(c+=g.previous,i(c,"previous")):null},hidePost:function(a,c){var d=e.Deferred();return e.ajax({type:"PATCH",url:b.config.API_URL+"/users/"+a+"/activity-stream-posts/"+c,dataType:"json",contentType:"application/json",data:JSON.stringify({isHidden:!0})}).done(function(a){d.resolve(a)}).fail(function(a){d.resolve(a)}),d.promise()},getPostPaging:function(){return g}};b.reqres.setHandler("get:posts:by:userid",function(a){return j.getPosts(a)}),b.reqres.setHandler("get:latest:posts:by:userid",function(a){return j.getLatestPosts(a)}),b.reqres.setHandler("get:previous:posts:by:userid",function(a){return j.getPreviousPosts(a)}),b.reqres.setHandler("get:posts:paging",function(){return j.getPostPaging()}),b.reqres.setHandler("hide:post:by:userid",function(a,b){return j.hidePost(a,b)})}),KXL.module("Entities",function(a,b,c,d,e){a.User=a.Model.extend({defaults:{username:"",email:"",password:""},url:function(){return b.config.API_URL+"/users/"+this.id+"?expand=ignored"},validation:{username:{required:!0},password:{required:!0,minLength:6,maxLength:20},email:{required:!0,pattern:"email",msg:"Please enter a valid email"}}}),a.UsersCollection=a.Collection.extend({model:a.User,url:function(){return"/api/v2/users"}});var f={getNewUserEntity:function(b){return new a.User(b||{})},getUser:function(b){var c=new a.User({id:b}),d=e.Deferred();return c.fetch({success:function(a){d.resolve(a)},error:function(a){d.reject(a)}}),d._model=c,d},getUsers:function(a){var c=e.Deferred(),d=new b.Entities.UsersCollection,f={success:function(a){c.resolve(a)},error:function(){c.reject()}};return a&&(f.data=a),d.fetch(f),c}};b.reqres.setHandler("new:user:entity",function(a){return f.getNewUserEntity(a)}),b.reqres.setHandler("user:entity",function(a){return f.getUser(a)}),b.reqres.setHandler("user:entities",function(a){return f.getUsers(a)})}),KXL.module("Entities",function(a){a.AutoRegistration=a.Model.extend({url:"/api/auth/autoregister"})}),KXL.module("Entities",function(a,b){a.DelayedRegistration=a.Model.extend({defaults:{username:"",email:"",password:""},url:"/api/auth/autoregister/convert",validation:{username:{required:!0,rangeLength:[6,20],msg:"Error message"},email:{required:!0,fn:function(a){return b.Common.Utils.PatternUtils.validateEmail(a)?void 0:b.i18n.t("settings.emailValidationMessage")}},password:{required:!0,minLength:6,maxLength:20}}})}),KXL.module("Entities",function(a,b,c,d,e,f){f.extend(c.Validation.validators,{notEqualToUsername:function(a,b,c,d){return c&&a===d.get("username")?this.format("{0} may not be the same as Username",this.formatLabel(b,d)):void 0}}),a.Registration=a.Model.extend({defaults:{username:"",email:"",password:"",validated:!1},url:"/api/auth/register",validation:{password:{required:!0,minLength:6,maxLength:20,notEqualToUsername:!0}}})}),KXL.module("Entities",function(a,b,c,d,e){a.UserGame=a.Model.extend({idAttribute:"gameId",url:function(){return b.config.API_URL+"/users/"+this.get("userId")+"/games/"+this.get("gameId")}}),a.UserGamesCollection=a.Collection.extend({model:a.UserGame,url:function(){return b.config.API_URL+"/users/"+this.userId+"/games"},initialize:function(a,b){this.userId=b.userId},comparator:function(a,b){var c=a.get("seen"),d=b.get("seen");return c>d?-1:d>c?1:0}});var f={getUserGames:function(b){var c=new a.UserGamesCollection([],{userId:b}),d=e.Deferred();return c.fetch({success:function(a,b,c){d.resolve(a,b,c)},error:function(a,b,c){d.reject(a,b,c)}}),d._collection=c,d},getUserGame:function(b,c){var d=new a.UserGame({userId:b,gameId:c}),e=d.fetch();return e._model=d,e}};b.reqres.setHandler("usergame:entities",function(a){return f.getUserGames(a)}),b.reqres.setHandler("usergame:entity",function(a,b){return f.getUserGame(a,b)})}),KXL.module("Entities",function(a,b,c,d,e){a.UserSettings=a.Model.extend({defaults:{searchForPlayersByKixeyeName:!0,searchForPlayersByTomeImmortalArenaName:!0,searchForPlayersByVegaConflictName:!0,searchForPlayersByBattlePiratesName:!0,searchForPlayersByWarCommanderName:!0},idAttribute:"userId",url:function(){return b.config.API_URL+"/users/"+b.currentUser.id+"/settings/"},isNew:function(){return!1}});var f={getUserSettings:function(){var b=new a.UserSettings,c=e.Deferred();return b.fetch({success:function(a,b,d){c.resolve(a,b,d)},error:function(a,b,d){c.reject(a,b,d)}}),c._model=b,c},getNewUserSettings:function(b){return new a.UserSettings(b)}};b.reqres.setHandler("new:user:settings:entity",function(a){return f.getNewUserSettings(a)}),b.reqres.setHandler("user:settings:entity",function(){return f.getUserSettings()})}),KXL.module("Entities",function(a,b){a.Forum=a.Model.extend({url:"/api/forum/js-connect/sso"});var c,d={getForumSSO:function(b){if(!c||b){var d=new a.Forum;c=d.fetch(),c._model=d}return c}};b.reqres.setHandler("forum:sso",function(a){return d.getForumSSO(a)})}),KXL.module("Entities",function(a,b){a.PlayersOnline=a.Model.extend({url:function(){return"/api/metrics"}});var c={getPlayersOnline:function(){var b=new a.PlayersOnline,c=b.fetch();return c._model=b,c}};b.reqres.setHandler("playersonline:entity",function(){return c.getPlayersOnline()})}),KXL.module("Entities",function(a,b,c,d,e,f){a.UserSearchScopeCollection=a.Collection.extend({model:a.Model}),a.UserSearch=a.Model.extend({parse:function(a){var d=f.extend({},a),e=(f.extend({},d.games),["tome","vc","bp","wc"]),g=[],h={wc:[{id:"playerId",label:"ID"},{id:"sector",label:"SECTOR"},{id:"level",label:"LEVEL"},{id:"totalXP",label:"INFAMY"}],vc:[{id:"playerId",label:"ID"},{id:"planet",label:"PLANET"},{id:"level",label:"LEVEL"},{id:"medals",label:"MEDALS"}],bp:[{id:"playerId",label:"ID"},{id:"sector",label:"SECTOR"},{id:"level",label:"LEVEL"},{id:"medals",label:"MEDALS"}],tome:[{id:"playerId",label:"ID"}]};return d.id=d.id||d.user&&d.user.id,d.username=d.username||d.user&&d.user.username,delete d.user,delete d.userId,f.each(d.games,function(a){var i=b.games.get(a.gameId);if(i&&a.alias&&i.get("commonName")&&-1!==e.indexOf(i.get("commonName"))){var j=h[i.get("commonName")]||[];f.each(j,function(b){b.value=a[b.id]||"N/A"}),j=new c.Collection(j),g.push({userId:d.id,commonName:i.get("commonName"),gameId:a.gameId,alias:a.alias,attributes:j})}}),d.games=g,d}}),a.UserSearchCollection=a.Collection.extend({model:a.UserSearch,url:function(){var a=b.config.API_URL.concat("/users");return"friends"===this.options.scope&&(a=a.concat("/",this.options.userId,"/friends")),a},fetch:function(b){return b=b||{},b.data=f.extend(b.data||{},{expand:"games"}),"kxl"===this.options.scope&&(this.options.searchTerm&&this.options.searchTerm.length&&(b.data.alias=this.options.searchTerm),this.options.apps&&this.options.apps.length&&(b.data.gameId=this.options.apps.join())),this.options.limit&&(b.data.limit=this.options.limit),this.options.offset&&(b.data.offset=this.options.offset),this.options.userScope&&(b.data.userScope=this.options.userScope),this.options.sector&&(b.data.sector=this.options.sector),this.options.planet&&(b.data.planet=this.options.planet),this.options.minLevel&&(b.data.minLevel=this.options.minLevel),this.options.maxLevel&&(b.data.maxLevel=this.options.maxLevel),this.options.ignoreUserIds&&this.options.ignoreUserIds.length&&(b.data.ignoreUserIds=this.options.ignoreUserIds.join(",")),a.Collection.prototype.fetch.call(this,b)},initialize:function(a,b){this.options=b||{}},parse:function(a){function c(a){var c=f.filter(a.games,function(a){return b.games.get(a.gameId)&&!!a.alias});return a.games&&a.games.length!==c.length&&(a.games=c),!!a.username||a.games&&a.games.length>0}var d=this.id;if(a.meta&&a.meta.totalAvailable&&b.request("set:service:friends:count",d,a.meta.totalAvailable),a.data){var e={};f.each(a.data,function(a){var b=a.userId;b&&a.user&&a.user.avatars&&(e[b]=a.user.avatars)}),f.isEmpty(e)||b.request("set:services:avatars",e)}return a.data?a.data:f.filter(a,function(a){return c(a)})}}),a.UserSearchGame=a.Model.extend({}),a.UserSearchGameCollection=a.Collection.extend({model:a.UserSearchGame});var g={getSearchUsers:function(b){var c=e.Deferred(),d=new a.UserSearchCollection([],b),f="friends"===b.scope?"fetch":"search";return d[f]({success:function(a){c.resolve(a)},error:function(){c.reject()}}),c._collection=d,c},getSearchUsersCollection:function(){return new a.UserSearchCollection},getUserSearchGames:function(b){var c=[];return f.each(b,function(b){c.push(new a.UserSearchGame(b))}),new a.UserSearchGameCollection(c,{comparator:!1})},getUserSearchScopes:function(b){return new a.UserSearchScopeCollection(b)}};b.reqres.setHandlers({"usersearch:entities":function(a){return g.getSearchUsers(a)},"usersearch:empty:entities":function(){return g.getSearchUsersCollection()},"usersearch:game:entities":function(a){return g.getUserSearchGames(a)},"usersearch:scope:entities":function(a){return g.getUserSearchScopes(a)}})}),KXL.module("Entities",function(a,b,c,d,e){var f={getGroups:function(a){var c=e.Deferred();if(a==b.currentUser.id)c.resolve(b.currentUserGroups);else{var d=new b.Group.Entities.UserGroups(null,{userId:a});d.fetch({success:function(){c.resolve(d)},error:function(){d.reset(),c.reject()}})}return c.promise()}};b.reqres.setHandler("user:usergroups:entities",function(a){return f.getGroups(a)})}),KXL.module("Entities",function(a,b){var c=a.Model.extend({idAttribute:"roleId"});a.UserRoles=a.Collection.extend({idAttribute:"roleId",url:function(){return b.config.API_URL+"/users/"+this.userId+"/roles"},initialize:function(a,b){this.userId=b.userId},model:c})}),KXL.module("Entities",function(a){a.GeoLocation=Backbone.Model.extend({defaults:{countryShortName:null,countryLongName:null},url:function(){return KXL.config.API_URL+"/geo-countries/here"}}),KXL.reqres.setHandler("geo:location:entity",function(){return new a.GeoLocation})}),KXL.module("Entities.Inbox",function(a,b,c,d,e,f){"use strict";a.Thread=b.Entities.Model.extend({urlRoot:function(){return b.config.API_URL+"/users/"+b.request("get:current:user").id+"/threads"},getMessages:function(){var c=new a.Messages;c.fetch({data:{threadId:this.id,userId:b.request("get:current:user").id}}),this.set({messages:c},{suppressSort:!0})},getMoreMessages:f.throttle(function(a,c){var d=this;b.vent.trigger("inbox:more:messages:fetching");var e=g.getMoreMessages(this.id,a,c);e.then(function(a){0===a.length&&d.set("moreMessages",!1),f.each(a.last(a.length).reverse(),function(a){d.get("messages").add(a,{at:0})}),b.vent.trigger("inbox:more:messages:fetched")})},500,{trailing:!1})}),a.Threads=b.Entities.Collection.extend({model:a.Thread,url:function(){return b.config.API_URL+"/users/"+b.request("get:current:user").id+"/threads"}}),a.Message=b.Entities.Model.extend({url:function(){var a=b.config.API_URL+"/messages";return this.id&&(a+="/"+this.id),a}}),a.Messages=b.Entities.Collection.extend({model:a.Message,url:function(){return b.config.API_URL+"/messages"}});var g={getThreads:function(b){var c=e.Deferred(),d=new a.Threads,f={success:function(a){c.resolve(a)},error:function(){c.reject()}};return b&&b.data&&(f.data=b.data),d.fetch(f),c},getMessages:function(c){var d=e.Deferred(),f=new a.Messages;return f.fetch({data:{threadId:c,userId:b.appModel.get("currentUser").get("id")},success:function(a){d.resolve(a)},error:function(){d.reject()}}),d._collection=f,d},getMoreMessages:function(c,d,f){var g=e.Deferred(),h=new a.Messages;return h.fetch({data:{threadId:c,userId:b.appModel.get("currentUser").get("id"),offset:d,limit:f},success:function(a){g.resolve(a)},error:function(){g.reject()}}),g._collection=h,g},sendMessage:function(c,d){var h,i;if(d.threadId)h=d.threadId;else{if(!d.recipients)throw"Trying to send a message without a destination (recipients or thread)";i=[],f.isArray(d.recipients)?f.each(d.recipients,function(a){i.push(g.addSuffix(a))}):i.push(g.addSuffix(d.recipients))}var j=new a.Message({from:g.addSuffix(b.appModel.get("currentUser").get("id")),to:i,body:c,threadId:h}),k=e.Deferred();return j.save(null,{success:function(a){k.resolve(a)},error:function(){k.reject()}}),k._model=j,k},subscribe:function(c){var d=function(b){var d=new a.Message(b);c(d)},e=b.module("Websocket");e.on("messages",d)},stripSuffix:function(a){return a.split("@")[0]},addSuffix:function(a){return a+"@"+b.config.USER_MESSAGE_SUFFIX}};b.reqres.setHandlers({"inbox:get:threads":g.getThreads,"inbox:get:messages":g.getMessages,"inbox:send:message":g.sendMessage,"inbox:add:suffix":g.addSuffix,"inbox:strip:suffix":g.stripSuffix}),b.commands.setHandlers({"inbox:subscribe":g.subscribe})}),KXL.module("Entities.MediaPreview",function(a,b){var c=b.Entities.Model.extend({defaults:{customClass:"",type:"image",previewThumbSrc:"",previewSrc:"",width:!1,height:!1}});b.reqres.setHandler("mediapreview:entity",function(a){return new c(a)})}),KXL.module("Entities.Screenshot",function(a,b,c,d,e){"use strict";var a=c.Model.extend({url:function(){return b.config.API_URL+"/screenshots"},parse:function(a){return a&&a.length?a[0]:void 0},fetchToday:function(a){var b=e.Deferred();return this.fetch({data:{date:0,tags:(a||[]).join(",")},success:function(a,c){c.length?b.resolve(a):b.reject(c)},error:function(a,c){b.reject(c)}}),b}});b.reqres.setHandlers({"screenshot:get:today":function(b){var c=new a;return c.fetchToday(b)}})}),KXL.module("Entities",function(a,b,c){var d=c.Model.extend({url:function(){return b.config.API_URL+"/users/"+b.request("get:current:user").id+"/surveys"}}),e=c.Collection.extend({url:function(){return b.config.API_URL+"/surveys"}});b.reqres.setHandlers({"get:surveys:entity":function(){return new e},"get:usersurvey:entity":function(){return new d}})}),KXL.module("Common.Views",function(a,b,c,d){a.ContentWithNav=d.Layout.extend({template:"#content-with-nav",regions:{navRegion:".content-nav-region",contentRegion:".content-region"}})}),KXL.module("Components",function(a,b,c,d){a.Layout=d.Layout.extend()}),KXL.module("Components",function(a,b,c,d,e,f){a.ItemView=d.ItemView.extend({serializeData:function(){var a=d.ItemView.prototype.serializeData.call(this);return a&&this.options&&(a.items?f.each(a.items,function(a){a=f.extend({},this.options,a)}):a=f.extend({},this.options,a)),a}})}),KXL.module("Components.Tooltip",function(a,b,c,d,e,f){a.View=d.ItemView.extend({template:"#tooltip-template",className:"kx-tooltip",tagName:"div",initialize:function(b){var c={$elParent:null,text:"",position:a.Positions.right,noWrap:!0,width:"auto",fadeOut:!1,fadeOutAfter:5e3};this.options=f.defaults(b||{},c)},ui:{text:".kx-tooltip-text",arrow:".kx-tooltip-arrow"},serializeData:function(){return{options:this.options}},showError:function(a,b){this._show(a,b),this.$el.addClass("kx-error")},showText:function(a,b){this._show(a,b),this.$el.removeClass("kx-error")},_show:function(b,c){var d=this,e=f.defaults({},c,this.options);e.$elParent&&(b&&d.ui.text.html(b),d.$el.addClass("kx-active"),d.$el.toggleClass("kx-tooltip-left",e.position===a.Positions.left),d.$el.toggleClass("kx-tooltip-right",e.position===a.Positions.right),d.$el.toggleClass("kx-tooltip-no-wrap",e.noWrap),d.$el.css({width:e.width}),d.$el.show(),setTimeout(function(){var b=(e.$elParent.position(),0),c=e.$elParent.width()+12;d.$el.css(e.position===a.Positions.right?{top:b,left:c}:{top:b,right:c})},0),e.fadeOut&&setTimeout(function(){d.$el.fadeOut(500)},e.fadeOutAfter))},hide:function(){this.$el.removeClass("kx-active kx-error"),this.$el.hide()}}),a.Positions={left:"left",right:"right"}}),KXL.module("Components.BootstrapCarousel.Entities",function(a,b,c){"use strict";a.Carousel=c.Collection.extend({model:c.Model,url:function(){return b.config.API_URL+"/slides"},comparator:function(a){return-a.get("createdAt")}})}),KXL.module("Components.BootstrapCarousel.Views",function(a,b,c,d){"use strict";var e=d.ItemView.extend({template:function(){return""},tagName:"li",onRender:function(){this.$el.attr("data-target",this.options.carouselSelector),this.$el.attr("data-slide-to",this.options.slideNumber),0===this.options.slideNumber&&this.$el.addClass("active")}});a.Indicators=d.CollectionView.extend({itemView:e,tagName:"ol",className:"carousel-indicators",itemViewOptions:function(a,b){return{slideNumber:b,carouselSelector:this.options.carouselSelector}}});var f=d.ItemView.extend({template:"#bootstrap-carousel-item-template",className:function(){return this.options&&0===this.options.slideNumber?"item active":"item"},triggers:{"click .kx-click-box":"clicked"}});a.Carousel=d.CollectionView.extend({itemView:f,itemViewEventPrefix:"carousel:slide",className:"carousel-inner",itemViewOptions:function(a,b){return{slideNumber:b}}}),a.CarouselLayout=d.Layout.extend({template:"#bootstrap-carousel-template",className:"carousel slide carousel-fade",regions:{indicatorsRegion:".kx-indicators-region",imagesRegion:".kx-slides-region"}})}),KXL.module("Components.BootstrapCarousel",function(a,b,c,d,e){"use strict";var f=d.Controller.extend({getCarousel:function(c){var d=new a.Entities.Carousel,f=e.Deferred();return d.fetch({data:{tags:(c||[]).join(",")},success:function(d){var e,g="kx-carousel-"+(c||[]).join(","),h=new a.Views.CarouselLayout({id:g}),i=new a.Views.Carousel({collection:d});d&&d.length>1&&(e=new a.Views.Indicators({collection:d,carouselSelector:"#"+g})),i.on("carousel:slide:clicked",function(a){if(a&&a.model){var c=a.model.get("url");b.navigate(c,{trigger:!0,target:"_blank"})}}),h.on("render",function(){e&&h.indicatorsRegion.show(e),h.imagesRegion.show(i),h.$el.carousel()}),h.on("before:close",function(){this.$el.carousel("pause")}),f.resolve(h)},error:function(){b.execute("500:show")}}),f.promise()}});a.Controller=new f}),KXL.module("Components.BootstrapCarousel",function(a,b){"use strict";b.reqres.setHandlers({"get:carousel":function(b){return a.Controller.getCarousel(b)}})}),KXL.module("Components.Avatar",function(a,b,c,d,e,f){a.Controller={getAvatar:function(c,d){var e={size:a.size.SMALL,color:a.borderColors.RED,avatarMenu:a.avatarMenu.OFF,menuPosition:"bottom-right",clickable:!0,suppressDefaultClickAction:!1,friendCard:!1,avatarUsernameOverlay:!1,presenceOn:!1,presence:a.presence.WEBSITE,stopClickPropagation:!1,radiusStyle:"square"},g=f.defaults({},d,e),h=!1,i=g.size;if(i.split("-")[1]&&(i=g.size.split("-")[1]),!g.avatarUrl){(i===a.size.SMALL||i===a.size.XSMALL)&&(i=a.size.MEDIUM);var j=b.request("get:service:avatars",c,i);g.avatarUrl=j||b.config.PUBLIC_API_URL.concat("/users/",c,"/avatars/",i)}g.model||(g.model=b.request("user:entity",c)._model);var k=new a.View(g);return g.suppressDefaultClickAction||k.on("clicked",function(a){b.execute("profile:show",a.model.id,f.pick(d,"gameId"))}),k.on("ignore:clicked",function(){var a=k.$el.find(".kx-avatar-menu-ignore");b.request("is:user:ignored",c)?b.request("unignore:user",c).then(function(){k.$el.removeClass("kx-avatar-menu-ignored"),a.attr("title",b.i18n.t("avatar.menu.ignore.title")),a.html(b.i18n.t("avatar.menu.ignore"))}):b.request("ignore:user",c).then(function(){k.$el.addClass("kx-avatar-menu-ignored"),a.attr("title",b.i18n.t("avatar.menu.unignore.title")),a.html(b.i18n.t("avatar.menu.unignore"))})}),k.on("friend-request:clicked",function(){h||b.request("is:user:ignored",c)||b.request("user:friend:request:send",c).then(function(){k.trigger("user:friend:request:exists"),b.vent.trigger("user:friend:request:sent",c)})}),k.on("friend:request:check:sent",function(a){b.request("current:user:sent:friend:request:entities").then(function(b){var c=b.findWhere({targetId:a});k.trigger(c?"user:friend:request:exists":"user:friend:request:does:not:exist")})}),k.on("user:friend:request:exists",function(){h=!0;var a=k.$el.find(".kx-avatar-menu-add");a.hasClass("friend-request-sent")||a.addClass("friend-request-sent")}),k.on("user:friend:request:does:not:exist",function(){h=!1;var a=k.$el.find(".kx-avatar-menu-add");
a.hasClass("friend-request-sent")&&a.removeClass("friend-request-sent")}),k.on("friend-chat:clicked",function(){b.request("is:user:ignored",c)||b.execute("chat:start:private",c)}),k}}}),KXL.module("Components.Avatar",function(a,b,c,d,e,f){a.size={XSMALL:"xsmall",SMALL:"small",MEDIUM:"medium",MEDIUM_LARGE:"medium-large",LARGE:"large"},a.borderColors={RED:"red",GREY:"grey",BLACK:"black",NONE:"none"},a.avatarMenu={ON:"on",OFF:"off",SELF_ON:"self"},a.presence={WEBSITE:"website",CHAT:"chat",NONE:"none"},a.View=b.Components.Layout.extend({className:function(){var a=["kx-avatar"];return this.options.clickable&&a.push("kx-clickable"),a.join(" ")},tagName:"div",triggers:function(){return{"click .kx-avatar-wrapper":{event:"clicked",stopPropagation:this.options.stopClickPropagation},"click .kx-avatar-menu-ignore":"ignore:clicked","click .kx-avatar-menu-add":"friend-request:clicked","click .kx-avatar-menu-chat":"friend-chat:clicked"}},modelEvents:{change:"render","change:avatar":"setAvatarUrl"},ui:{img:"img",avatar:".kx-avatar-wrapper",avatarMenu:".kx-avatar-menu",avatarName:".kx-avatar-name",ignore:".kx-avatar-menu-ignore",mutualFriendsHeader:".kx-avatar-mutual-friends-header"},regions:{avatarMenuAvatar:".kx-avatar-menu-avatar",mutualFriendsList:".kx-avatar-mutual-friends-list"},maintainMenuOpen:!1,delayedMenuOpen:null,delayedMenuClose:null,friendsCollection:null,friend:null,initialize:function(c){var d=this,e=this.model.get("user");if(this.userModel=e?e:this.model,b.currentUser)if(b.currentUser.id===this.userModel.id&&c.avatarMenu===a.avatarMenu.ON&&(this.options.avatarMenu=a.avatarMenu.OFF),this.friendsCollection=b.request("current:user:friend:entities")._collection,this.listenTo(this.friendsCollection,"add remove reset",function(){d.checkFriend()}),this.friend=this.friendsCollection.get(this.userModel.id),this.options.presence===a.presence.WEBSITE)this.friend&&this.listenTo(this.friend,"change",function(){d.setPresence(d.friend.get("presence"))});else if(this.options.presence===a.presence.CHAT&&this.friend){var f=b.request("get:chat:interface");this.listenTo(f,"presence",function(a){a.userId===d.userModel.id&&d.setPresence(a.status)})}},setPresence:function(a){"available"===a?this.$el.find(".kx-online-presence").addClass("kx-online"):this.$el.find(".kx-online-presence").removeClass("kx-online")},checkFriend:function(){var a=this.friendsCollection.get(this.userModel.id);a!==this.friend&&(this.friend&&this.stopListening(this.friend,"change"),this.friend=a,this.render())},getTemplate:function(){return b.currentUser&&b.currentUser.id===this.userModel.id&&this.options.avatarMenu===a.avatarMenu.SELF_ON?"#avatar-template-self-with-menu":b.currentUser&&b.currentUser.id!==this.userModel.id&&this.options.avatarMenu!==a.avatarMenu.OFF?this.friend?"#avatar-template-friend":"#avatar-template-non-friend":"#avatar-template-no-menu"},onRender:function(){var c=this;switch(this.options.size&&this.$el.addClass("kx-avatar-"+this.options.size),this.options.color&&this.$el.addClass("kx-border-"+this.options.color),this.options.radiusStyle){case"circular":this.$el.addClass("kx-circular");break;default:this.$el.addClass("kx-square")}if(this.options.avatarMenu===a.avatarMenu.OFF||this.options.friendCard||(this.ui.avatar.on("mouseenter",function(){c.trigger("friend:request:check:sent",c.model.id),c.delayedMenuOpen=setTimeout(function(){c.showMenu()},500)}),this.ui.avatar.on("mouseleave",function(){clearTimeout(c.delayedMenuOpen),c.delayedMenuClose=setTimeout(function(){c.hideMenu()},500)}),this.ui.avatarMenu.on("mouseover",function(){c.maintainMenuOpen=!0}),this.ui.avatarMenu.on("mouseout",function(){c.maintainMenuOpen=!1,c.delayedMenuClose=setTimeout(function(){c.hideMenu()},500)})),this.options.presenceOn)this.setPresence("available");else if(this.friend)if(this.options.presence===a.presence.WEBSITE)this.setPresence(this.friend.get("presence"));else if(this.options.presence===a.presence.CHAT){var d=b.request("get:chat:interface");this.setPresence(d.getUserPresence(this.friend.id))}},showMenu:function(c){if(this.ui.avatarMenu instanceof jQuery&&this.userModel.get("username")&&b.currentUser&&!b.request("auth:is:temp:user")){clearTimeout(this.delayedMenuOpen),this.$el.addClass("kx-avatar-menu-active");var d=this.$el.offset(),f=d.top-e(document).scrollTop(),g=d.left;if(this.options.friendCard)this.ui.avatarMenu.addClass("kx-avatar-friend-card"),f=c.menuPositionTop,g=c.menuPositionLeft;else switch(this.options.menuPosition){case"top-left":f-=50,g-=202;break;case"top-right":f-=50,g+=202;break;case"bottom-right":f+=50;break;case"bottom-left":f+=50,g-=202;break;case"lock-bottom-right-avatar":f+=this.ui.avatar.outerHeight(!0)?this.ui.avatar.outerHeight(!0):0,g+=this.ui.avatar.outerWidth(!0)?this.ui.avatar.outerWidth(!0):0}this.avatarMenuAvatar&&!this.avatarMenuAvatar.currentView&&(this.menuAvatar||(this.menuAvatar=b.request("new:avatar:view",this.userModel.id,{size:b.Components.Avatar.size.LARGE,color:b.Components.Avatar.borderColors.BLACK})),this.avatarMenuAvatar.show(this.menuAvatar));var h=this;this.mutualFriendsList&&!this.mutualFriendsView&&(this.mutualFriendsView={},b.request("user:entities",{friendsOf:[b.currentUser.id,this.userModel.id].join(",")}).then(function(c){c&&c.length&&(h.mutualFriendsView=new a.MutualFriendsListView({collection:c}),h.mutualFriendsList.show(h.mutualFriendsView),h.ui.mutualFriendsHeader.html(b.i18n.t("avatar.menu.mutualfriends.header")))})),this.ui.avatarMenu.css("top",f),this.ui.avatarMenu.css("left",g),b.request("is:user:ignored",this.userModel.id)?(this.$el.addClass("kx-avatar-menu-ignored"),this.ui.ignore.attr("title",b.i18n.t("avatar.menu.unignore.title")),this.ui.ignore.html(b.i18n.t("avatar.menu.unignore"))):(this.$el.removeClass("kx-avatar-menu-ignored"),this.ui.ignore.attr("title",b.i18n.t("avatar.menu.ignore.title")),this.ui.ignore.html(b.i18n.t("avatar.menu.ignore"))),this.setupScrollListener()}},hideMenu:function(){clearTimeout(this.delayedMenuClose),this.maintainMenuOpen||(this.unbindScrollListener(),this.$el.removeClass("kx-avatar-menu-active"))},setupScrollListener:function(){var a=this;e(document).scroll(function(){a.unbindScrollListener(),a.delayedMenuClose=setTimeout(function(){a.maintainMenuOpen=!1,a.hideMenu()},100)})},unbindScrollListener:function(){e(document).unbind("scroll")},serializeData:function(){this.userModel.get("avatarUrl")&&(this.options.avatarUrl=this.userModel.get("avatarUrl"));var a=this.userModel.get("created");return{id:this.userModel.id,size:this.options.size,color:this.options.color,username:this.userModel.get("username"),avatarUrl:this.options.avatarUrl,avatarUsernameOverlay:this.options.avatarUsernameOverlay,bgMode:this.options.bgMode,memberSinceYear:a&&new Date(1e3*a).getFullYear()}},setAvatarUrl:function(a){this.userModel.set("avatarUrl",a+"?"+b.Common.Utils.DateUtils.now()),this.ui.img.attr("src",this.userModel.get("avatarUrl")),this.render()},onClose:function(){this.ui.avatar.unbind("mouseenter"),this.ui.avatar.unbind("mouseleave"),this.ui.avatarMenu.unbind("mouseover"),this.ui.avatarMenu.unbind("mouseout")}}),a.MutualFriendsListView=d.CollectionView.extend({template:function(){return""},className:"kx-mutual-friends-list",collectionEvents:{sort:"sortEvent","add remove reset change":"collectionModified"},collectionModified:function(){var a=this;f.debounce(function(){a.collection.sort()},1e3)},sortEvent:function(){this.render()},initialize:function(){this.collection&&(this.collection.comparator=function(a,b){return a.username>b.username?1:a.username<b.username?-1:0},this.collection.sort())},itemView:d.Layout.extend({template:"#mutual-friends-list-item-template",className:"kx-mutual-friends-list-item",regions:{avatar:".avatar-region"},ui:{avatar:".avatar-region"},onRender:function(){var a=b.request("new:avatar:view",this.model.id,{model:this.model,size:b.Components.Avatar.size.SMALL,color:b.Components.Avatar.borderColors.BLACK,stopClickPropagation:!0});this.avatar.show(a);var c=this.model.get("username");c&&this.ui.avatar.attr("title",c)}})})}),KXL.module("Components.Button",function(a,b,c,d,e,f){a.View=b.Components.Layout.extend({template:"#kx-button-template",className:"kx-button",regions:{loaderRegion:".kx-loader-region"},initialize:function(a){var b={label:"",customClass:"",theme:"",singleClick:!1,enabled:!0,loading:!1,tooltip:void 0,preventDefault:void 0,stopPropagation:void 0};this.options=f.defaults(a||{},b)},serializeData:function(){var a=this.options.tooltip;return void 0===a&&this.options.label&&(a=this.options.label),{label:this.options.label,tooltip:a}},events:{click:"clickHandler"},ui:{buttonLabel:".kx-button-label"},onRender:function(){this.options.customClass&&this.$el.addClass(this.options.customClass),this.options.theme&&this.$el.addClass(this.options.theme),this.options.enabled||this.disable()},clickHandler:f.debounce(function(a){if(a){var b=a.preventDefault,c=a.stopPropagation;this.options.preventDefault&&b&&b.apply(a),this.options.stopPropagation&&c&&c.apply(a)}this.options.enabled&&(this.trigger("click"),this.options.singleClick&&this.disable(),this.options.loading&&this.startLoading())},1e3,{leading:!0,trailing:!1}),enable:function(){this.options.enabled=!0,this.$el.removeClass("kx-disabled")},disable:function(){this.options.enabled=!1,this.$el.addClass("kx-disabled")},startLoading:function(){this.loaderRegion.currentView||this.loaderRegion.show(new b.Components.Loader.View({size:b.Components.Loader.sizes.small})),this.$el.addClass("kx-loading")},stopLoading:function(){this.$el.removeClass("kx-loading")},label:function(a){this.isClosed||this.ui.buttonLabel.text(a)}}),a.Themes={alt1:"kx-alt1",alt2:"kx-alt2",alt3:"kx-alt3",alt4:"kx-alt4",alt4o:"kx-alt4o",alt5:"kx-alt5",alt6:"kx-alt6",alt7:"kx-alt7",alt8:"kx-alt8",alt9:"kx-alt9",alt10:"kx-alt10",alt11:"kx-alt11",alt11b:"kx-alt11b",alt11c:"kx-alt11c",alt12:"kx-alt12",alt14:"kx-alt14",alt15:"kx-alt15",alt16:"kx-alt16",alt17:"kx-alt17",alt18:"kx-alt18",alt19:"kx-alt19",alt20:"kx-alt20",alt21:"kx-alt21",alt22:"kx-alt22",fbalt1:"kx-fb-alt1",gplusalt1:"kx-gplus-alt1",link:"kx-link",alt23:"kx-alt23",alt24:"kx-alt24",alt25:"kx-alt25",alt26:"kx-alt26"}}),KXL.module("Components.KXLButton",function(a,b){a.View=b.Components.Button.View.extend({template:"#kx-kxl-button-template",className:"kxl-button"})}),KXL.module("Components.Comments",function(a,b,c,d,e,f){a.Controller={getComments:function(c){var d={inputCloseOnOtherInputOpen:!0,inputStartExpanded:!1,canComment:!0,showNoCommentingCTALink:!1};this.options=f.defaults(c||{},d);var e,g=new a.CommentsLayout(this.options),h=new a.ListView({canManage:c.canManage,commentOwnerCanManage:c.commentOwnerCanManage,collection:c.collection});return this.options.canComment?(e=new b.Components.CommentInput.Controller.getCommentInput({userId:b.currentUser.id,startExpanded:this.options.inputStartExpanded,closeOnOtherInputOpen:this.options.inputCloseOnOtherInputOpen,canComment:this.options.canComment}),g.on("show",function(){e.on("submit",function(a){c.collection.post({content:a}).then(function(){e.ui.commentInputField.val(""),e.options.closeOnOtherInputOpen=!1,g.trigger("new:comment")})}),g.on("show:comment:input",function(){g.expand(),e.expandCommentInput()}),g.listenTo(b.vent,"comment:input:opened",function(a){a.cid!==e.cid&&e.options.closeOnOtherInputOpen&&!e.options.startExpanded&&(e.reset(),g.contract(),g.trigger("comments:contracted"))}),g.commentInputRegion.show(e)})):this.options.showNoCommentingCTALink&&g.on("comments:no:commenting:cta:clicked",function(){b.request("show:delayed:register:form:banner",{referrer:"comment-input",registrationHeaderText:"Register to comment"})}),g.on("show",function(){if(c.collection.paging&&c.collection.paging.previous){var b=this,d=new a.PagingView;d.on("previous:page",function(){c.collection.fetch({remove:!1,direction:"previous",success:function(a){a.paging.previous||b.commentPagingRegion.close()}})}),this.commentPagingRegion.show(d)}h.on("feed:item:hide:comment",function(a){a.model.hide().then(function(){c.collection.remove(a.model),g.trigger("delete:comment")})}),this.commentsRegion.show(h)}),g.on("append:comment",function(a){c.collection.add(a)}),g}}}),KXL.module("Components.Comments",function(a,b,c,d,e,f){a.CommentView=d.Layout.extend({template:"#kx-comment-template",tagName:"li",className:"kx-feed-item-comment",regions:{avatar:".kx-feed-item-comment-avatar"},ui:{itemTime:".kx-feed-item-comment-time",itemOptions:".kx-feed-item-comment-delete"},events:{"click .kx-feed-item-comment-username":"routeToUserProfile","mouseover .kx-feed-item-comment-delete":"itemOver",mouseover:"itemOver",mouseout:"itemOut"},triggers:{"click .kx-feed-item-comment-delete":"hide:comment"},onRender:function(){this.avatar.show(b.request("new:avatar:view",this.model.get("userId"),{avatarMenu:b.Components.Avatar.avatarMenu.ON,color:b.Components.Avatar.borderColors.NONE,size:"small"}));var a=this.options.canManage;this.options.commentOwnerCanManage&&b.currentUser.id===this.model.get("userId")&&(a=!0),a||this.ui.itemOptions.hide(),this.ui.itemTime.timeago()},itemOver:function(){TweenLite.killTweensOf(this.ui.itemOptions),TweenLite.to(this.ui.itemOptions,.5,{opacity:1,clearProps:"transform"})},itemOut:function(){TweenLite.to(this.ui.itemOptions,.5,{opacity:0,clearProps:"transform"})},routeToUserProfile:function(a){b.execute("profile:show",e(a.currentTarget).attr("id")),a.preventDefault()},serializeData:function(){var a;a=this.model.has("author")?this.model.get("author").username:this.model.get("userId");var c=new Handlebars.SafeString(e.fn.urlize(Handlebars.Utils.escapeExpression(this.model.get("content"))));return{userId:this.model.get("userId"),author:a,content:c,updatedAt:b.Common.Utils.DateUtils.isoString(this.model.get("updatedAt"))}}}),a.PagingView=d.ItemView.extend({template:"#kx-comments-paging-template",className:"kx-comments-paging",triggers:{"click .kx-comments-paging-view-more":"previous:page"}}),a.ListView=d.CompositeView.extend({template:"#kx-comments-list-template",className:"kx-comments-list-wrapper",itemAppend:!1,itemViewEventPrefix:"feed:item",itemViewContainer:".kx-comments-list",initialize:function(a){this.options=a},buildItemView:function(b,c,d){if(this.collection.length){var e=f.extend({model:b,canManage:this.options.canManage,commentOwnerCanManage:this.options.commentOwnerCanManage},d);return new a.CommentView(e)}},appendHtml:function(a,c){var d=a.getItemViewContainer(a);a.collection.last()!==c.model||this.isBuffering?a.children&&1===a.children.length?d.append(c.$el):a.collection.prev(c.model)!==c.model&&a.children.findByModel(a.collection.prev(c.model))?a.children.findByModel(a.collection.prev(c.model)).$el.after(c.$el):a.children.findByModel(a.collection.next(c.model))&&a.children.findByModel(a.collection.next(c.model)).$el.before(c.$el):d.append(c.$el),b.animationCapabilities&&TweenLite.fromTo(c.$el,1,{opacity:0,ease:"Power2.easeInOut"},{opacity:1,clearProps:"transform",ease:"Power2.easeInOut"})}}),a.CommentsLayout=d.Layout.extend({template:"#kx-comments-layout-template",className:"kx-comments",commentInputView:null,commentsListView:null,triggers:{"click .kx-comments-no-commenting-cta":"comments:no:commenting:cta:clicked"},regions:{commentsRegion:".kx-comments-list-region",commentInputRegion:".kx-comments-input-region",commentPagingRegion:".kx-comments-paging-region"},expand:function(){this.$el.addClass("expanded")},contract:function(){this.$el.removeClass("expanded")},initialize:function(a){this.options=f.defaults(a||{},{canComment:!0,showNoCommentingCTALink:!1,noCommentingCTALinkText:b.i18n.t("comments.noCommentingCTALink")})},onRender:function(){this.options.collection.length&&this.expand()},serializeData:function(){return{options:this.options}}})}),KXL.module("Components.CommentInput",function(a){a.Controller={getCommentInput:function(b){return new a.View(b)}}}),KXL.module("Components.CommentInput",function(a,b,c,d,e,f){a.View=b.Components.Layout.extend({initialize:function(a){var b={startMinimized:!1,maxlength:500,clickToExpand:!1,expandHeight:50,canComment:!0};this.options=f.defaults(a||{},b)},regions:{avatar:".kx-comment-thumbnail-container"},template:"#kx-comment-input",tagName:"div",className:"kx-comment-input",ui:{commentInput:".kx-comment-input-small",commentInputField:".kx-comment-input-field",commentSubmitBtn:".kx-comment-submit-btn"},events:{"keyup @ui.commentInput":"inputKeyUp","click @ui.commentSubmitBtn":"commentInputSubmit"},commentInputSubmit:function(){""!==this.ui.commentInputField.val()&&this.trigger("submit",this.ui.commentInputField.val())},inputKeyUp:function(a){13===a.keyCode&&""!==this.ui.commentInputField.val()&&this.trigger("submit",this.ui.commentInputField.val())},onRender:function(){this.options.canComment&&this.options.startExpanded&&this.expandCommentInput()},expandCommentInput:function(){!this.expanded&&this.options.canComment&&(this.$el.parent().css("overflow","hidden"),this.ui.commentInput.css("display","table-row"),this.ui.commentInputField.focus(),this.avatar.show(b.request("new:avatar:view",this.options.userId,{avatarMenu:b.Components.Avatar.avatarMenu.ON,size:"small",color:b.Components.Avatar.borderColors.NONE})),b.config.animationCapabilities&&(TweenLite.fromTo(this.$el.parent(),.3,{height:0},{height:this.options.expandHeight}),TweenLite.fromTo(this.ui.commentInput,.3,{opacity:0},{opacity:1,delay:.3})),b.vent.trigger("comment:input:opened",this),this.expanded=!0)},hideCommentInput:function(){b.config.animationCapabilities?TweenLite.to(this.ui.commentInput,.3,{opacity:0}):this.ui.hide()},reset:function(){var a=this;b.config.animationCapabilities?(TweenLite.to(this.ui.commentInput,.3,{opacity:0}),TweenLite.to(this.$el.parent(),.3,{height:0,delay:.3,onComplete:function(){a.ui.commentInput.hide()}})):this.ui.commentInput.hide(),this.expanded=!1},serializeData:function(){var a={};return this.model&&(a=this.model.toJSON()),f.extend(a,{options:this.options}),a}})}),KXL.module("Components.ContentPane",function(a){a.Controller={getContentPane:function(b){return new a.View(b)}}}),KXL.module("Components.ContentPane",function(a,b,c,d,e,f){a.Types={NO_BOTTOM:"no-bottom"},a.View=d.Layout.extend({template:"#content-pane-template",className:"kx-content-pane",ui:{content:".kx-content-pane-content"},regions:{top:".kx-content-pane-top",content:".kx-content-pane-content"},initialize:function(a){defaults={scroll:!0},this.options=f.defaults({},a,defaults)},onRender:function(){this.options.topView&&this.setTopView(this.options.topView),this.options.contentView&&this.setContentView(this.options.contentView),this.options.type===a.Types.NO_BOTTOM&&this.$el.addClass("kx-content-pane-nobottom")},setTopView:function(a){this.top.show(a)},setContentView:function(a){this.content.show(a)},serializeData:function(){var a={};return a.headingText=this.options.headingText||"",a}})}),KXL.module("Components",function(a,b,c,d,e,f){a.Dialog=a.Layout.extend({template:Templates["common/components/dialog/dialog"],className:"kx-dialog",dialogId:null,regions:{content:".kx-dialog-pane-content"},ui:{closeBtn:".kx-dialog-close-button",veil:".kx-dialog-veil"},initialize:function(a){f.extend(this,c.Events);var d={size:"medium",allowClose:!0,closeOnEsc:!0,showCloseButton:!0,showVeil:!0,transparentVeil:!0,center:!0,customClassName:"",clickVeilToClose:!0,dialogId:null};this.options=f.defaults(a||{},d),this.dialogId=this.options.dialogId,b.vent.trigger("overlay:toggle",!0)},bindWindowEvents:function(){var a=this;this.options.allowClose&&this.options.closeOnEsc&&(this.onKeyUpHandler=function(b){27===b.keyCode&&a.trigger("dialog:close",!0)},e(window).on("keyup.dialog",this.onKeyUpHandler))},setContent:function(a){this.content.show(a)},onClose:function(){e("body").removeClass("kx-dialog-disable-scroll"),e(window).off("resize.dialog"),e(window).off("keyup.dialog"),b.vent.trigger("overlay:toggle",!1)},onRender:function(){this.$pane=this.$el.find(".kx-dialog-pane"),this.bindWindowEvents(),this.options.size&&this.$el.addClass(a.Dialog.SIZE_CLASS_NAMES[this.options.size]),this.options.customClassName&&this.$el.addClass(this.options.customClassName),this.options.showVeil||this.ui.veil.hide(),this.options.transparentVeil&&this.$el.find(".kx-dialog-veil").addClass("transparent"),this.toggleClosable(this.options.allowClose)},onShow:function(){this.options.center&&this.center(),this.options.showVeil&&e("body").addClass("kx-dialog-disable-scroll")},toggleClosable:function(a){function b(){c.trigger("dialog:close",!0)}var c=this;this.ui.veil.off("click"),this.ui.closeBtn.off("click"),a?(this.options.showVeil&&this.options.clickVeilToClose&&this.ui.veil.on("click",b),this.options.showCloseButton?(this.ui.closeBtn.show(),this.ui.closeBtn.on("click",b)):this.ui.closeBtn.hide()):this.ui.closeBtn.hide()},center:function(){var a=this.$pane.width();this.$pane.css({"margin-left":-(a/2)+"px",left:"50%"})}}),a.Dialog.SIZES={tiny:"tiny",small:"small",medium:"medium",large:"large"},a.Dialog.SIZE_CLASS_NAMES={},a.Dialog.SIZE_CLASS_NAMES[a.Dialog.SIZES.tiny]="kx-dialog-tiny",a.Dialog.SIZE_CLASS_NAMES[a.Dialog.SIZES.small]="kx-dialog-small",a.Dialog.SIZE_CLASS_NAMES[a.Dialog.SIZES.medium]="kx-dialog-medium",a.Dialog.SIZE_CLASS_NAMES[a.Dialog.SIZES.large]="kx-dialog-large",a.DialogRegion=d.Region.extend({onShow:function(a){this.listenTo(a,"dialog:close",this.closeDialog),this.listenTo(a,"dialog:resize",this.resizeDialog),b.vent.trigger("dialog:opened")},closeDialog:function(a){this.stopListening(),b.vent.trigger("dialog:closed",a,this.currentView),this.close()},resizeDialog:function(){console.log("resizing dialog")}})}),KXL.module("Components",function(a,b,c,d,e,f){a.ConfirmDialog=a.Dialog.extend({template:Templates["common/components/confirm_dialog/confirm-dialog"],regions:f.extend({cancelRegion:".kx-confirm-dialog-cancel",confirmRegion:".kx-confirm-dialog-confirm"},a.Dialog.prototype.regions),initialize:function(c){this.defaults={title:b.i18n.t("dialog.confirm.defaultTitle"),message:"",confirmButtonOptions:{label:b.i18n.t("dialog.confirm.confirmButtonLabel"),theme:b.Components.Button.Themes.alt11b,singleClick:!0},cancelButtonOptions:{label:b.i18n.t("dialog.confirm.cancelButtonLabel"),theme:b.Components.Button.Themes.alt11b,singleClick:!0},showCancelButton:!0},a.Dialog.prototype.initialize.call(this,f.defaults(c||{},this.defaults))},onRender:function(){var c=this;if(this.options.showCancelButton){var d=new b.Components.Button.View(f.defaults(this.options.cancelButtonOptions||{},this.defaults.cancelButtonOptions));this.listenTo(d,"click",function(){b.dialogRegion.close()}),this.cancelRegion.show(d)}this.confirmButton=new b.Components.Button.View(f.defaults(this.options.confirmButtonOptions||{},this.defaults.confirmButtonOptions)),this.listenTo(this.confirmButton,"click",function(){c.toggleConfirmBtnLoading(!0),c.trigger("confirm:clicked")}),this.confirmRegion.show(this.confirmButton),this.$el.addClass("kx-confirm-dialog"),a.Dialog.prototype.onRender.call(this)},toggleConfirmBtnLoading:function(a){this.confirmButton[a?"startLoading":"stopLoading"]()},serializeData:function(){return{title:this.options.title,message:this.options.message,showCancelButton:this.options.showCancelButton}}})}),KXL.module("Components.EditOptions",function(a,b,c,d,e,f){var g=b.Entities.Model.extend({defaults:{label:"",value:"",active:!1}}),h=b.Entities.Collection.extend({model:g});a.Controller={editOptionsView:null,getEditOptions:function(b){var c=this;if(b&&f.isArray(b.optionItems))return b.optionItems=new h(b.optionItems),this.editOptionsView=new a.CompositeView(b),this.editOptionsView.listenTo(this.editOptionsView,"option:item:clicked",function(a){b.model&&b.model.set(b.modelAttr,a.model.get(b.valueAttr||"value")),this.setLabel(a.model.get(b.labelAttr||"label")),b.modelSaveOnChange&&b.model.save(),(a.model.get("itemEvent")||b.itemEvent)&&(b.closeOnItemEvent&&c.editOptionsView.ui.editOptions.removeClass("kx-edit-options-active"),this.trigger(b.itemEvent||a.model.get("itemEvent"),a.model))}),b.model&&b.model.bind("change:"+b.modelAttr,function(){c.editOptionsView.children.each(function(a){a.$el.removeClass("kx-active"),a.model.get(b.valueAttr||"value")===b.model.get(b.modelAttr)&&(a.$el.addClass("kx-active"),c.editOptionsView.setLabel(a.model.get(b.labelAttr||"label")))})}),this.editOptionsView}}}),KXL.module("Components.EditOptions",function(a,b,c,d,e,f){function g(){f.each(h,function(a){a&&a.closeMenu&&a.closeMenu()})}a.itemView=d.CompositeView.extend({template:"#edit-options-item-template",tagName:"li",triggers:{click:"clicked"},onRender:function(){this.$el.attr(f.extend({title:this.options.model.get(this.options.labelAttr||"label")},f.result(this,"attributes")))},serializeData:function(){return{label:this.options.model.get(this.options.labelAttr||"label")}}});var h=[];a.CompositeView=d.CompositeView.extend({template:"#edit-options-template",className:"kx-edit-options kx-clearfix",tagName:"div",itemViewContainer:".kx-edit-options-items",itemViewEventPrefix:"option:item",ui:{editOptions:".kx-edit-options-controls",editOptionsLabel:".kx-edit-options-label",editButton:".kx-button"},events:{"click .kx-edit-options-edit-btn":"toggleMenu"},itemEvents:{clicked:function(){this.toggleMenu()}},initialize:function(a){var c={name:"",customClass:"",modelAttr:"",optionsTitle:"",selectedDisplay:!1,optionItems:null,buttonText:b.i18n.t("editOptions.buttonText"),buttonIconClass:"none",buttonStyle:"kx-alt3",pointerStyle:"wrap",labelAttr:"label",valueAttr:"value",stateAttr:"itemState",optionsLabel:b.i18n.t("editOptions.everyone")};this.collection=a.optionItems,this.options=f.defaults(a||{},c)},onRender:function(){this.options.customClass&&this.$el.addClass(this.options.customClass)},buildItemView:function(b,c,d){var e=this.options;d=f.extend(d||{},{labelAttr:e.labelAttr});var g=f.extend({model:b},d);return g.model.get(e.stateAttr)&&(g.className="kx-ellipsis kx-active"),e.model&&g.model.get(e.valueAttr)===e.model.get(e.modelAttr)&&(g.className="kx-ellipsis kx-active",e.selectedDisplay&&(this.setLabel(g.model.get(e.labelAttr)),this.ui.editOptionsLabel.show())),new a.itemView(g)},setLabel:function(a){this.ui.editOptionsLabel.html(a)},onBeforeClose:function(){e(window).off(this.clickEventName())},openMenu:function(){this.isOpen()||(g(),h.push(this),this.ui.editOptions.addClass("kx-edit-options-active"),e(window).on(this.clickEventName(),this.toggleMenu.bind(this)),this.trigger("menu:opened"))},clickEventName:function(){return"click.dismiss.edit.options."+this.cid},closeMenu:function(){this.isOpen()&&(this.ui.editOptions.removeClass("kx-edit-options-active"),e(window).off(this.clickEventName()),this.trigger("menu:closed"))},toggleMenu:function(a){a&&a.stopPropagation(),this.isOpen()?this.closeMenu():this.openMenu()},isOpen:function(){return this.ui.editOptions.hasClass&&this.ui.editOptions.hasClass("kx-edit-options-active")?!0:!1},updateButtonText:function(a){this.ui.editButton.html(a)},serializeData:function(){return{optionsTitle:this.options.optionsTitle,buttonText:this.options.buttonText,buttonStyle:this.options.buttonStyle,pointerStyle:"kx-edit-options-pointer-style-"+this.options.pointerStyle,optionsLabel:this.options.optionsLabel}}})}),KXL.module("Components.FacebookShareButton",function(a,b){b.reqres.setHandlers({"new:facebook:share:button:view":function(a){var c=new b.Components.Button.View({customClass:"kx-facebook-share-btn"});return c.listenTo(c,"click",function(){FB.ui({method:"feed",link:a.link,caption:a.caption,name:a.name})}),c}})}),KXL.module("Components.TwitterShareButton",function(a,b,c,d,e,f){function g(a,b,c,d){var e=screen.width/2-c/2,f=screen.height/2-d/2;return window.open(a,b,"toolbar=no, 			location=no, 			directories=no, 			status=no, 			menubar=no, 			scrollbars=no, 			resizable=no, 			copyhistory=no, 			width="+c+", 			height="+d+", 			top="+f+", 			left="+e)}b.reqres.setHandlers({"new:twitter:share:button:view":function(a){var c=new b.Components.Button.View({customClass:"kx-twitter-share-btn"});return c.listenTo(c,"click",function(){var b=f.template("https://twitter.com/share?					url=<%= url %>					&text=<%= text %>					&related=<%= related %>",a);g(b,"",575,320)}),c}})}),KXL.module("Components.KixeyeShareButton",function(a,b,c,d,e,f){b.reqres.setHandlers({"new:kixeye:share:button:view":function(a){var c={text:"",link:"",renableAfterSuccess:!1,renableAfterSuccessPause:5e3},d=f.defaults({},a,c),e=new b.Components.Button.View({customClass:"kx-kixeye-share-btn",singleClick:!0});return e.listenTo(e,"click",function(){e.$el.removeClass("kx-success"),b.request("save:note",b.currentUser.id,b.currentUser.id,a.text+" "+d.link).then(function(){e.$el.removeClass("kx-disabled"),e.$el.addClass("kx-success"),d.renableAfterSuccess&&(e.enable(),f.delay(function(){e.$el.removeClass("kx-success")},d.renableAfterSuccessPause))}).fail(function(){e.enable()})}),e}})}),KXL.module("Components.ForumPosts",function(a,b,c,d){a.Post=d.Layout.extend({template:"#_forum-post-template",tagName:"li",className:"kx-item",regions:{avatar:".kx-avatar-holder"},events:{"click .kx-title":"forumPostTitleClicked","click .kx-comment":"forumPostCommentClicked"},forumPostTitleClicked:function(){b.execute("forum:show","discussion/"+this.model.id)},forumPostCommentClicked:function(){b.execute("forum:show","discussion/"+this.model.id+"#reply")},onRender:function(){this.avatar.show(b.request("new:avatar:view",this.model.get("userId"),{model:new b.Entities.User({id:this.model.get("userId"),username:this.model.get("username")}),size:"medium",avatarMenu:b.currentUser?b.Components.Avatar.avatarMenu.ON:b.Components.Avatar.avatarMenu.OFF,color:"grey"}))},serializeData:function(){return{forumPost:this.model.toJSON(),postedDate:b.Common.Utils.DateUtils.fuzzytime(this.model.get("postedDate"))}}}),a.View=d.CollectionView.extend({itemView:a.Post,tagName:"ul",className:"kx-forum-posts"})}),KXL.module("Components.ForumPosts",function(a,b){a.Controller={getForumPostsView:function(c){var d=b.request("forumposts:entities",c)._collection;return new a.View({collection:d})}}}),KXL.module("Components.FriendCard",function(a,b,c,d,e,f){a.FriendCardGameAvatarView=b.Components.ItemView.extend({template:"#friendcard-game-avatar-template",className:"kx-usergame-avatar",events:{"click .kx-avatar-wrapper":"clicked"},triggers:{click:"clicked"},clicked:function(){b.execute("profile:show",this.model.get("userId"),{gameId:this.model.get("gameId")})}}),a.UserGame=d.ItemView.extend({initialize:function(a){var b={searchTerm:null,alignment:"vertical",displayGameName:!0};this.options=f.defaults(a||{},b),this.searchTerm=this.options.searchTerm,this.alignment=this.options.alignment,this.displayGameName=this.options.displayGameName,this.clickable=this.options.clickable},template:function(){return""},className:"kx-friend-card-user-game kx-ellipsis",events:{click:"gameAliasClicked"},gameAliasClicked:function(){this.clickable&&b.execute("profile:show",this.model.get("userId"),{gameId:this.model.get("gameId"),overrideGameContext:!0})},prettyAlias:function(){return b.Common.Utils.StringUtils.prettySubString(this.model.get("alias")||this.model.get("playerId"),this.searchTerm,null,"kx-friend-search-highlight")},_renderIcon:function(){var a=this.model.get("gameId"),c=a&&b.games.get(a);if(c){var d=b.config.STATIC_BASE_URL+"/modules/game/images/favicon/"+c.get("commonName")+".png";this.$el.css("background-image","url("+d+")")}},_renderUsername:function(){this.$el.html(this.prettyAlias())},onRender:function(){switch(this._renderIcon(),this.displayGameName&&this._renderUsername(),this.clickable&&this.$el.addClass("kx-clickable"),this.alignment){case"grid":this.$el.addClass("kx-quad-grid");break;case"vertical":this.$el.addClass("kx-vertical")}}}),a.UserGames=d.CollectionView.extend({template:function(){return""},className:"kx-friend-card-user-games",itemView:a.UserGame,itemViewOptions:function(){return this.options},initialize:function(){this.collection=new c.FilteredCollection(null,{collection:this.collection}),this.collection.setFilter(function(a){return b.request("is:static:game",a.get("gameId"))
})},onRender:function(){this.options&&"horizontal"===this.options.alignment&&this.$el.addClass("kx-align-right")}}),a.FriendCardAttributeView=d.CollectionView.extend({template:function(){return""},tagName:"li",onRender:function(){this.$el.html(this.model.get("label")+': <span class="kx-highlight">'+this.model.get("value")+"</span>")}}),a.FriendCardAttributesView=d.CollectionView.extend({tagName:"ul",className:"kx-user-attributes",itemView:a.FriendCardAttributeView}),a.HorizontalDividerView=b.Components.Layout.extend({template:function(){return""},className:"kx-friendcard-horizontal-divider"}),a.FriendCardSubTitleView=b.Components.ItemView.extend({template:function(){return""},tagName:"span",className:"kx-sub-title",onRender:function(){this.$el.html(this.options.text)}}),a.ExpandBtnView=b.Components.Layout.extend({template:function(){return""},className:"kx-expand-arrow-btn",initialize:function(a){var b={expanded:!1,highlighted:!1};this.options=f.defaults({},a,b),this.expanded=this.options.expanded},onRender:function(){this.$el.addClass(this.expanded?"kx-close":"kx-open"),this.$el.addClass("kx-clickable"),this.options.highlighted&&this.$el.addClass("kx-highlight")},events:{mousedown:"onMouseDown"},onMouseDown:function(){this.$el.toggleClass("kx-open"),this.$el.toggleClass("kx-close"),this.expanded=!this.expanded,this.trigger("expandBtn:toggle",this.expanded)}}),a.View=b.Components.Layout.extend({template:"#friendcard-template",className:"kx-friend-card kx-player-details kx-clickable",tagName:"li",triggers:{click:"clicked"},regions:{avatarRegion:".kx-avatar",gamesPlayedIconsRegion:".kx-games-played-icons-region",gamesPlayedRegion:".kx-games-played-region",dividerRegion:".kx-divider-region",featuredGameNameRegion:".kx-featured-game-name-region",subTitleRegion:".kx-sub-title-region",attributesRegion:".kx-attributes-region",ctaRegion:".kx-cta-region",expandBtnRegion:".kx-expand-arrow-btn-region"},ui:{friendCard:".kx-friend-card-inner",username:".kx-user-name",avatar:".kx-avatar",presence:".kx-online-presence",lastSeen:".kx-user-last-seen",friendIcon:".kx-user-is-friend-icon",title:".kx-title",content:".kx-card-content",chatBtn:".kx-chat-btn"},events:{"click .kx-user-name":function(){this.trigger("username:clicked",this.model),this.trigger("cta:clicked")},mouseover:"onMouseOver",mouseout:"onMouseOut",mousedown:"onMouseDown","mouseover .kx-clickable":"onClickableOver","mouseout .kx-clickable":"onClickableOut","click @ui.chatBtn":"_initiateChat"},initialize:function(a){var c=this,d={searchTerm:"",context:"kxl",userType:"",hoverCard:"full",cardType:"search",displayChatBtn:!1,selectable:!1,expandable:!1,namespace:null,displayScopedGameName:!0};if(this.options=f.defaults({},a,d),this.searchTerm=this.options.searchTerm,this.context=this.options.context,this.userType=this.options.userType,this.hoverCard=this.options.hoverCard,this.cardType=this.options.cardType,this.displayChatBtn=this.options.displayChatBtn,this.selectable=this.options.selectable,this.expandable=this.options.expandable,this.namespace=this.options.namespace,this.displayScopedGameName=this.options.displayScopedGameName,this.entireCardIsClickable=!0,this.namespace&&(this.listenTo(this.model,"selected:"+this.namespace,function(){c.selectedState()}),this.listenTo(this.model,"deselected:"+this.namespace,function(){c.deselectedState()})),this.model.has("user")){var e=null,g=null;this.model.has("games")&&(e=this.model.get("games")),"request"===this.cardType&&(g=this.model.get("id")),this.model=b.request("new:user:entity",this.model.get("user")),e&&this.model.set("games",e),g&&this.model.set("requestId",g)}a.appScope&&this.options.appScope.length&&(this.appScope=a.appScope),this.friendsCollection=b.request("current:user:friend:entities")._collection,this.friend=this.friendsCollection.get(this.model.id),this.friend&&this.listenTo(this.friend,"change",function(){c.setPresence(c.friend.get("presence"))})},onMouseOver:function(){this.$el.addClass("hover"),this.displayChatBtn&&this.ui.chatBtn.show(),this.expandBtnRendered||this.autoExpand?this.expandBtnRegion.$el&&this.expandBtnRegion.$el.show():this._renderExpandBtn(),this.ctaView&&this.ctaRegion.currentView?this.ctaRegion.$el.show():this.ctaView&&!this.ctaRegion.currentView&&this.ctaRegion.show(this.ctaView),this.ctaView&&this.subTitle&&this.subTitleRegion.$el.hide()},onMouseOut:function(){this.$el.removeClass("hover"),this.ui.chatBtn.hide(),!this.expandBtnHighlighted&&this.expandBtnRegion.$el&&this.expandBtnRegion.$el.hide(),this.ctaView&&this.ctaRegion.currentView&&this.ctaRegion.$el.hide(),this.ctaView&&this.subTitle&&this.subTitleRegion.$el.show()},onMouseDown:function(){this.entireCardIsClickable&&this.onCardClicked()},onClickableOver:function(){this.entireCardIsClickable=!1},onClickableOut:function(){this.entireCardIsClickable=!0},onCardClicked:function(){this.trigger("username:clicked",this.model)},_initiateChat:function(a){a&&(a.stopPropagation(),a.preventDefault()),b.request("is:user:ignored",this.model.get("id"))||b.execute("chat:start:private",this.model.get("id"))},_minimizeFriendCard:function(){b.config.animationCapabilities&&this.expandTimeline?this.expandTimeline.reverse():this.ui.content.height(this.contentMinimizedHeight)},_expandFriendCard:function(){b.config.animationCapabilities&&this.expandTimeline?this.expandTimeline.play():this.ui.content.height(this.contentMaximizedHeight-10)},_renderExpandBtn:function(c){var d=this,e=!0,f=function(){d.contentMaximizedHeight=d.ui.content[0].scrollHeight,d.contentMinimizedHeight=d.ui.content.height()};if(this.ui.content&&!c&&(f(),this.contentMaximizedHeight<this.contentMinimizedHeight+20&&(e=!1)),e){var g=new a.ExpandBtnView({highlighted:c||!1});g.on("expandBtn:toggle",function(a){d.contentMaximizedHeight||d.contentMinimizedHeight||f(),b.config.animationCapabilities&&!d.expandTimeline&&(d.expandTimeline=new TimelineLite,d.expandTimeline.add(TweenLite.to(d.ui.content,.25,{height:d.contentMaximizedHeight,ease:"Power2.easeInOut"})),d.expandTimeline.pause()),a?d._expandFriendCard():d._minimizeFriendCard()}),this.expandBtnRegion.show(g),this.expandBtnRendered=!0}},_renderAttributes:function(b){if(b.length){var c=["level","sector","playerId","totalXP"];c=f.filter(c,function(a){return b.get(a)}),b.reset(f.map(c,function(a){return b.get(a)}))}var d=new a.FriendCardAttributesView({collection:b});return this.attributesRegion.show(d),b.length?!0:void 0},_renderSubTitle:function(b){this.subTitle=new a.FriendCardSubTitleView({text:b.text}),this.subTitleRegion.show(this.subTitle)},_renderFeaturedGameName:function(b){var c=new a.UserGame({searchTerm:this.searchTerm,model:b,displayGameName:!0});this.featuredGameNameRegion.show(c)},_renderHorizontalDivider:function(){var b=new a.HorizontalDividerView;this.dividerRegion.show(b)},_renderGamesPlayed:function(b){var d={games:[],exclude:[],alignment:"grid",displayGameName:!0,region:this.gamesPlayedRegion},e=f.defaults(b||{},d),g=e.games,h=e.exclude,i=e.alignment,j=this;if(g=new c.FilteredCollection(null,{collection:g}),h&&h.length&&g.setFilter(function(a){return!f.contains(h,a.get("gameId"))}),g.length){var k=new a.UserGames({collection:g,searchTerm:this.searchTerm,alignment:i,displayGameName:e.displayGameName,clickable:!this.selectable});e.region.show(k);var l=!1;return this.searchTerm&&g.each(function(a){a.get("alias")&&a.get("alias").indexOf(j.searchTerm)>-1&&""!==j.searchTerm&&(l=!0)}),{displayed:!0,highlighted:l}}},onRender:function(){function c(){j=setTimeout(function(){e.showMenu({menuPositionTop:0,menuPositionLeft:e.$el.width()})},1e3)}function d(){clearTimeout(j);setTimeout(function(){e.hideMenu()},500)}var e,g=this,h=null;if(this.model.has("games")&&(h=b.request("usersearch:game:entities",this.model.get("games"))),this.model.has("username")){var i={color:b.Components.Avatar.borderColors.BLACK,size:b.Components.Avatar.size.MEDIUM_LARGE,avatarMenuFriend:this.userType&&"friends"===this.userType,model:this.model,friendCard:!0,suppressDefaultClickAction:this.selectable};if("none"!==this.hoverCard){var j=null;"full"===this.hoverCard?(this.ui.friendCard.on("mouseenter",c),this.ui.friendCard.on("mouseleave",d)):"avatar"===this.hoverCard&&(this.ui.avatar.on("mouseenter",c),this.ui.avatar.on("mouseleave",d)),i.avatarMenu=b.Components.Avatar.avatarMenu.ON}e=b.request("new:avatar:view",this.model.id,f.extend(i,{color:b.Components.Avatar.borderColors.GREY,radiusStyle:"circular",bgMode:!0,presence:b.Components.Avatar.presence.NONE,avatarMenuFriend:this.userType&&"friends"===this.userType,model:this.model})),this.listenTo(e,["clicked","friend-chat:clicked"].join(" "),function(){g.trigger("cta:clicked")})}else{if(h&&h.length>0){var k=h.at(0);this.model.set("alias",k.get("alias"));var l=b.games.get(k.get("gameId"));e=new a.FriendCardGameAvatarView({model:new b.Entities.Model({commonName:l.get("commonName"),userId:this.model.id,gameId:l.id})}),e.listenTo(e,"clicked",function(){g.trigger("cta:clicked")})}this.displayChatBtn=!1}if(e&&this.avatarRegion.show(e),this.friend&&(this.setPresence(this.friend.get("presence")),this.ui.friendIcon.show()),this.appScope&&h){var m=null,n=null,o=null,p=null,q=null,r=[],s="vertical",t=!0;1===this.appScope.length&&(m=h.findWhere({gameId:this.appScope[0]}),n=m),!n&&h.length&&(n=1===h.length?h.at(0):h.max(function(a){return a.get("seen")||!1})),n&&this.displayScopedGameName&&b.request("is:static:game",n.get("gameId"))&&(this._renderFeaturedGameName(n),r.push(n.get("gameId"))),m&&m.get("attributes")&&"search"===this.cardType?o=this._renderAttributes(m.get("attributes")):"search"===this.cardType?this.autoExpand=!0:("friend"===this.cardType||"request"===this.cardType)&&(q=this._renderGamesPlayed({games:h,exclude:r,alignment:"horizontal",displayGameName:!1,region:this.gamesPlayedIconsRegion})),p=this._renderGamesPlayed({games:h,exclude:r,alignment:s,displayGameName:t,region:this.gamesPlayedRegion});var u=p&&p.displayed||!1;(o&&u||u&&q)&&this._renderHorizontalDivider(),this.expandBtnHighlighted=p&&p.highlighted||!1,this.autoExpand||this.ui.content.addClass("kx-expandable"),this.expandable&&this.expandBtnHighlighted&&!this.autoExpand&&this._renderExpandBtn(this.expandBtnHighlighted)}},onClicked:function(){this.namespace&&this.model.toggleSelected()},selectedState:function(){this.$el.addClass("kx-selected")},deselectedState:function(){this.$el.removeClass("kx-selected")},setPresence:function(a){"available"===a?(this.ui.presence.addClass("kx-online"),this.ui.lastSeen.hide()):(this.ui.presence.removeClass("kx-online"),this.ui.lastSeen.show())},templateHelpers:{prettyTitle:function(){return b.Common.Utils.StringUtils.prettySubString(this.user.username||this.user.alias,this.searchTerm,null,"kx-friend-search-highlight")},lastSeen:function(){return this.user.lastSeen?b.Common.Utils.DateUtils.fuzzytime2(1e3*this.user.lastSeen):null}},serializeData:function(){return{user:this.model.toJSON(),searchTerm:this.searchTerm||"",templateHelpers:this.templateHelpers}}}),a.FriendRequestCTAView=b.Components.ItemView.extend({template:"#friendcard-friend-request-cta-template",className:"kx-friend-request-buttons",events:{"click .kx-friend-request-accept-button":"acceptClicked","click .kx-friend-request-reject-button":"rejectClicked","click .kx-view-profile-button":"profileClicked"},acceptClicked:function(){var a=this;a.$el.find("cta-button").prop("disabled",!0),a.options.vent.trigger("friend:request:remove",a.model),b.request("user:friend:request:accept",this.model.get("requestId"),this.model.get("id")).then(function(){a.options.vent.trigger("friend:request:remove",a.model)}).always(function(){a.$el.find("cta-button").prop("disabled",!1)})},rejectClicked:function(){var a=this;a.$el.find("cta-button").prop("disabled",!0),b.request("user:friend:request:reject",this.model.get("requestId"),this.model.get("id")).then(function(){a.options.vent.trigger("friend:request:remove",a.model)}).always(function(){a.$el.find("cta-button").prop("disabled",!1)})},profileClicked:function(){b.execute("profile:show",this.model.get("userId"))}}),a.FriendRequestView=a.View.extend({className:"kx-friend-card kx-friend-request",onRender:function(){this.ctaView=new a.FriendRequestCTAView({model:this.model,vent:this.options.vent}),this._renderSubTitle({text:b.i18n.t("friends.panel.friendRequest")}),a.View.prototype.onRender.call(this)}}),a.SimpleView=a.View.extend({className:"kx-friend-card kx-friend-card-simple",template:"#friendcard-simple-template",regions:{avatarRegion:".kx-avatar"},triggers:{click:"selected:user"},events:{},onRender:function(){var a=this,c=b.request("new:avatar:view",this.model.id,{size:"small",avatarMenu:b.Components.Avatar.avatarMenu.ON,color:"grey",avatarMenuFriend:this.userType&&"friends"===this.userType,model:this.model,suppressDefaultClickAction:!0});this.listenTo(c,["clicked","friend-chat:clicked"].join(" "),function(){a.trigger("cta:clicked")}),this.avatarRegion.show(c),this.friend&&(this.setPresence(this.friend.get("presence")),this.ui.friendIcon.show())}})}),KXL.module("Components.GroupCard",function(a,b){a.View=b.Components.Layout.extend({template:"#groupcard-template",className:"kx-group-card",tagName:"li",triggers:{click:"clicked"},regions:{avatarRegion:".kx-avatar"},ui:{groupCard:".kx-group-card-inner",title:".kx-group-title"},events:{"click .kx-group-title":function(){b.execute("group:show",this.model.id),b.vent.trigger("close:friendsearch")}},initialize:function(a){this.searchTerm=a&&a.searchTerm},templateHelpers:{prettyTitle:function(){return b.Common.Utils.StringUtils.prettySubString(this.title,this.searchTerm,null,"kx-friend-search-highlight")}},serializeData:function(){var a=this.model.toJSON(),c=b.games.get(a.gameId),d=c&&c.get("urlName");return a.logoImageUrl=a.logo&&a.logo.medium?a.logo.medium:b.config.STATIC_BASE_URL+"/modules/common/images/group/"+(d||"default")+"_logo.png",a.searchTerm=this.searchTerm,a.templateHelpers=this.templateHelpers,a}})}),KXL.module("Components.Leaderboard",function(a,b,c){a.Controller={getLeaderboard:function(d){var e=new a.Layout({model:new c.Model,userId:d.userId,gameId:d.gameId}),f=b.request("leaderboard:entities",{gameId:d.gameId});return f.then(function(c){c.length>0&&(e.model.set(c.first().toJSON()),e.on("render",function(){var c=this,d=b.request("leaderboard:entry:entities",{leaderboardId:this.model.id});d.then(function(d){var e=new a.EntriesView({collection:d,gameId:c.options.gameId}),f=b.request("leaderboard:entry:entities",{leaderboardId:c.model.id,entryId:c.options.userId});c.entries.show(e),f.then(function(b){var d=new a.EntriesView({collection:b,gameId:c.options.gameId});c.currentUser.show(d)})})})),e.render()}),e}}}),KXL.module("Components.Leaderboard",function(a,b,c,d){a.EntryView=b.Components.Layout.extend({template:"#_leaderboard-entry-template",tagName:"li",regions:{avatar:".kx-leaderboard-avatar"},onRender:function(){this.model.get("entryId"),this.model.get("alias");this.avatar.show(b.request("new:avatar:view",this.model.get("entryId"),{model:new b.Entities.User({id:this.model.get("entryId"),username:this.model.get("alias")}),size:"medium",avatarMenu:b.Components.Avatar.avatarMenu.ON,color:"grey",gameId:this.options.gameId}))}}),a.EntriesView=d.CollectionView.extend({template:function(){return""},itemView:a.EntryView,tagName:"ul",itemViewOptions:function(){return{gameId:this.options.gameId}}}),a.Layout=b.Components.Layout.extend({template:"#leaderboard-template",regions:{entries:".kx-leaderboard .kx-top",currentUser:".kx-leaderboard .kx-self"},ui:{sectors:".kx-sectors"},events:{"click .kx-leaderboard-header .kx-sector-carat":"toggleList","click .kx-leaderboard-header .kx-sectors .selectable":"selectSector"},toggleList:function(){this.ui.sectors.toggleClass("open")},selectSector:function(){this.toggleList()}})}),KXL.module("Components.MaskInput",function(a){a.Controller={getMaskInput:function(b){var c=new a.View(b);return c}}}),KXL.module("Components.MaskInput",function(a,b,c,d,e,f){a.View=b.Components.Layout.extend({template:"#masked-input",className:"kx-textbox-wrapper",tagName:"span",initialize:function(a){var c={symbol:"",inputName:"",placeHolder:"",customClass:"",showSuccess:!0,tooltipPos:b.Components.Tooltip.Positions.right,modelAttr:""};this.options=f.defaults(a||{},c),""===this.options.symbol&&(this.options.symbol=e("<div />").html("&bull;").text())},regions:{tooltipRegion:".kx-tooltip-region"},ui:{inputField:".kx-input-text",maskInput:".kx-masked-input-text",errorValidation:".kx-validation"},serializeData:function(){return{options:this.options}},modelEvents:{validated:"onValidated"},onValidated:function(a,b,c){a?this.model.hasChanged(this.options.modelAttr)&&this.options.showSuccess&&this.showSuccess():c[this.options.modelAttr]&&this.showError(c[this.options.modelAttr])},onRender:function(){this.options.customClass&&this.$el.addClass(this.options.customClass),this.isIE="undefined"!=typeof document.uniqueID,this.fullMask=!1,""!==this.options.inputName&&this.ui.inputField.attr("name",this.options.inputName),""!==this.options.className&&this.ui.maskInput.addClass(this.options.className),this.limitCaretPosition(this.ui.maskInput);var a=this;this.ui.maskInput.on("input",function(b){a.showNormal(),a.processEvents(b,!1)}),this.ui.maskInput.on("keyup",function(b){/^(9|1[678]|224|3[789]|40|8|46)$/.test(b.keyCode.toString())||a.processEvents(b,!1)}),this.ui.maskInput.on("blur",function(b){a.processEvents(b,!0)}),this.ui.maskInput.on("click focus",function(){a.clickHandler()}),this.tooltip=new b.Components.Tooltip.View({$elParent:this.$el,position:this.options.tooltipPos}),this.tooltipRegion.show(this.tooltip),this.model&&this.options.modelAttr&&(this.listenTo(this.model,"invalid:"+this.options.modelAttr,function(b){a.showError(b)}),this.listenTo(this.model,"valid:"+this.options.modelAttr,function(){a.options.showSuccess&&a.showSuccess()}))},processEvents:function(a,b){return 13===a.keyCode?void this.trigger("submit"):(void 0!==b&&(this.fullMask=b),this.doInputMasking(this.getTarget(a)),this.model&&this.options.modelAttr&&this.model.set(this.options.modelAttr,this.ui.inputField.val()),void this.trigger("change"))},clickHandler:function(){this.showNormal()},doInputMasking:function(a){var b="",c=a.val(),d=this.ui.inputField.val();if(this.ui.inputField.val().length>0)for(var e=0;e<c.length;e++)b+=c[e]==this.options.symbol?d[e]:c[e];else b=c;var f=c;c.length>=d.length&&(f=this.encodeMaskInput(b,this.fullMask)),(d!=b||c!=f)&&(this.ui.inputField.val(b),a.val(f))},encodeMaskInput:function(a,b){for(var c=b===!0?0:1,d="",e=0;e<a.length;e++)d+=e<a.length-c?this.options.symbol:a.charAt(e);return d},limitCaretPosition:function(a){var b=a.get(0),c=null,d=function(){null==c&&(c=this.isIE?window.setInterval(function(){var a=b.createTextRange(),c=b.value.length,d="character";a.moveEnd(d,c),a.moveStart(d,c),a.select()},100):window.setInterval(function(){var a=b.value.length;b.selectionEnd==a&&b.selectionStart<=a||(b.selectionStart=a,b.selectionEnd=a)},100))},e=function(){window.clearInterval(c),c=null};a.on("focus",function(){d()}),a.on("blur",function(){e()})},getTarget:function(a){return a?e(a.target?a.target:a.srcElement):null},val:function(a){return"undefined"==typeof a?this.ui.inputField.val():(this.ui.inputField.val(a),this.ui.inputField)},showError:function(a,b){this.tooltip.showError(a,b),this.ui.errorValidation.removeClass("success"),this.ui.errorValidation.addClass("error")},showNormal:function(){this.tooltip.hide(),this.ui.errorValidation.removeClass("error"),this.ui.errorValidation.removeClass("success")},showSuccess:function(){this.ui.errorValidation.removeClass("error"),this.ui.errorValidation.addClass("success")},focus:function(){var a=this;setTimeout(function(){a.$el.find(".kx-masked-input-text").focus()},0)}})}),KXL.module("Components.TextBox",function(a,b,c,d,e,f){function g(){h=!0}var h=!1;document.addEventListener("keydown",g,!0),a.View=b.Components.Layout.extend({template:"#textbox-template",className:"kx-textbox-wrapper",tagName:"span",originalValue:"",initialize:function(a){var c={name:"",value:"",text:"",tooltipPos:b.Components.Tooltip.Positions.right,placeHolder:"",customClass:"",showSuccess:!0,modelAttr:""};this.options=f.defaults(a||{},c),this.originalValue=a.model&&a.modelAttr?a.model.get(a.modelAttr):""},ui:{textBox:".kx-textbox",errorValidation:".kx-validation"},regions:{tooltipRegion:".kx-tooltip-region"},modelEvents:{validated:"onValidated"},events:{"keyup input":"keyupHandler","blur input":"blurHandler","focus input":"focusHandler"},serializeData:function(){return{options:this.options}},onValidated:function(a,b,c){b.isValid(this.options.modelAttr)?this.originalValue!==this.model.get(this.options.modelAttr)&&this.options.showSuccess&&this.showSuccess():c&&c[this.options.modelAttr]&&this.showError(c[this.options.modelAttr])},onRender:function(){var a=this;this.options.customClass&&this.$el.addClass(this.options.customClass),this.model&&this.options.modelAttr&&(this.listenTo(this.model,"invalid:"+this.options.modelAttr,function(b){a.showError(b)}),this.listenTo(this.model,"valid:"+this.options.modelAttr,function(){a.options.showSuccess&&a.showSuccess()}),this.listenTo(this.model,"change:"+this.options.modelAttr,function(){var a=this.model.get(this.options.modelAttr);this.ui.textBox.val()!==a&&this.ui.textBox.val(a)}),this.options.value||this.ui.textBox.val(this.model.get(this.options.modelAttr))),this.options.className&&this.ui.textBox.addClass(this.options.className)},blurHandler:function(a){this.trigger("blur",a)},focusHandler:function(a){this.trigger("focus",a)},keyupHandler:function(a){if(h){if(h=!1,f.isFunction(this.options.keyupHandler)&&this.options.keyupHandler.call(this,a),13===a.keyCode)return void this.trigger("submit");this.model&&this.options.modelAttr&&this.model.set(this.options.modelAttr,this.val()),this.trigger("change")}},val:function(a){return"undefined"==typeof a?this.ui.textBox.val():(this.ui.textBox.val(a),this.ui.textBox)},_showTooltip:function(a,c,d){var e=f.defaults({},d,{tooltipPos:this.options.tooltipPos}),g=new b.Components.Tooltip.View({$elParent:this.$el,position:e.tooltipPos,text:a});g.listenTo(g,"show",function(){c?g.showError(a,e):g.showText(a,e)}),this.tooltipRegion.show(g),this.tooltipRegion.ensureEl(),this.tooltipRegion.$el.show()},_hideTooltip:function(){this.tooltipRegion.ensureEl(),this.tooltipRegion.$el.hide()},showError:function(a,b){this._showTooltip(a,!0,b),this.ui.errorValidation.removeClass("success"),this.ui.errorValidation.addClass("error")},showNormal:function(){this._hideTooltip(),this.ui.errorValidation.removeClass("success"),this.ui.errorValidation.removeClass("error")},showTooltip:function(a,b){this._showTooltip(a,!1,b)},showSuccess:function(){this._hideTooltip(),this.ui.errorValidation.removeClass("error"),this.ui.errorValidation.addClass("success")},focus:function(){var a=this;setTimeout(function(){a.$el.find(".kx-textbox").focus()},0)},onClose:function(){document.removeEventListener("keydown",g)}})}),KXL.module("Components.GameSelector",function(a,b,c,d){a.ItemView=d.ItemView.extend({tagName:"li",template:"#_game-selector-item-template",modelEvents:function(){var a=this;return events={},namespace=this.collection.namespace,events["selected:"+namespace]=function(){a.$el.addClass("kx-active")},events["deselected:"+namespace]=function(){a.$el.removeClass("kx-active")},events},onRender:function(){this.collection.selected===this.model&&this.$el.addClass("kx-active")}}),a.View=d.CompositeView.extend({template:"#game-selector-template",itemViewContainer:".kx-games",itemViewOptions:function(a){return{collection:this.collection,model:a}},itemView:a.ItemView,className:"kx-game-selector kx-clearfix kx-no-text-selection",modelEvents:{change:"render"},events:{"click .kx-left-arrow":function(){var a=this.collection.prev(this.collection.selected,!0);a&&(this.collection.select(a),this.trigger("prev:clicked"))},"click .kx-right-arrow":function(){var a=this.collection.next(this.collection.selected,!0);a&&(this.collection.select(a),this.trigger("next:clicked"))}}})}),KXL.module("Components.GameSelector",function(a,b,c,d,e,f){a.Controller={getView:function(d){function e(a){var c=b.games.get(a),d=g.findWhere({urlName:c.get("urlName")});d&&g.select(d)}var g,h=f.extend({},d),i=f.uniqueId("game:selector:games:");g=h.collection?h.collection:f.extend(b.staticGames,new c.PickThis.SingleSelect(b.staticGames,i));var j=new a.View({collection:g});return h.defaultGameId?e(h.defaultGameId):g.length&&!g.selected&&g.select(g.first()),j}}}),KXL.module("Components.Pager",function(a){a.Controller={getPager:function(b){var c=new a.View({collection:b});return c.on("pager:item:clicked",function(a){a.model.select()}),c}}}),KXL.module("Components.Pager",function(a,b,c,d){a.PagerItem=d.ItemView.extend({template:function(){return""},tagName:"li",className:"kx-pager-item",triggers:{click:"clicked"},modelEvents:{selected:function(){this.$el.addClass("kx-pager-item-active")},deselected:function(){this.$el.removeClass("kx-pager-item-active")}}}),a.View=d.CollectionView.extend({itemView:a.PagerItem,tagName:"ul",itemViewEventPrefix:"pager:item",className:"kx-pager"})}),KXL.module("Components.PlayersOnline",function(a,b,c){a.Controller={getPlayersOnline:function(){var d=b.request("playersonline:entity")._model,e=c.Poller.get(d,{delay:3e4});return e.start(),new a.View({model:d})}}}),KXL.module("Components.PlayersOnline",function(a,b,c,d){a.View=d.ItemView.extend({template:"#players-online-template",className:"kx-players-online",ui:{count:".kx-players-online-count"},modelEvents:{change:function(){var a=this.model.get("totalPlayersOnline");a&&"number"==typeof a?(a=a.toLocaleString(),a.match(/[,\.]00$/)&&(a=a.substring(0,a.length-3)),this.ui.count.html(a),this.$el.is(":visible")||this.$el.show()):this.$el.hide()}}})}),KXL.module("Components.Ticker",function(a){a.Controller={getTicker:function(){return new a.View}}}),KXL.module("Components.Ticker",function(a,b,c,d){a.View=d.ItemView.extend({template:"#ticker-template",tickerTimeline:null,events:{"mouseover .kx-ticker":"tickerOver","mouseout .kx-ticker":"tickerOut"},tickerOver:function(){this.tickerTimeline.pause()},tickerOut:function(){this.tickerTimeline.play()},onShow:function(){function a(){b.tickerTimeline.restart()}var b=this,c=this.$el.find(".kx-ticker-text"),d=this.$el.find(".kx-ticker"),e=c.outerWidth()/75,f=c.width()/75,g=d.width();this.tickerTimeline=new TimelineLite({onComplete:a}),c.ready(function(){e=c.outerWidth()/75,f=c.width()/75,f>e&&(e=f),g=d.width(),c.css("left",g),b.tickerTimeline.add(TweenLite.to(c,e,{x:-c.outerWidth(),ease:"linear"})),a()})}})}),KXL.module("Components.UserGameProfile",function(a,b,c,d){a.GameProfile=d.ItemView.extend({template:"#game-profile-template",className:"kx-user-game-profile",modelEvents:{change:"modelChanged"},serializeData:function(){var a=b.games.get(this.model.id),c=!1,d=!1,e=!1,f=!1;if(a)switch(a.get("commonName")){case"bp":c=!0;break;case"wc":e=!0;break;case"vc":f=!0}var g=this.model.get("alliance");g&&g.name&&(d=!0);var h=this.model.get("medals"),i=this.model.get("infamy");return{medals:"undefined"!=typeof h?h:"-",infamy:"undefined"!=typeof i?i:"-",userGameProfile:this.model.toJSON(),renderForBP:c,renderForVC:f,renderForWC:e,renderForBPAlliance:d}},modelChanged:function(){this.render()}}),a.GameProfileHeader=d.ItemView.extend({template:"#game-profile-header-template",className:"kx-ugp-user kx-user-game-profile",modelEvents:{change:"modelChanged"},onRender:function(){b.request("new:avatar:view",this.model.get("userId"),{size:"large",color:b.Components.Avatar.borderColors.NONE,el:this.$el.find(".kx-ugp-user-avatar")}).render()},modelChanged:function(){this.render()}})}),KXL.module("Components.UserGameProfile",function(a){a.Controller={getGameProfile:function(b){return new a.GameProfile({model:b})},getGameProfileHeader:function(b){return new a.GameProfileHeader({model:b})}}}),KXL.module("Components.Video",function(a){a.Controller={getVideo:function(b){return new a.View(b)}}}),KXL.module("Components.Video",function(a,b,c,d,e,f){a.View=b.Components.ItemView.extend({template:"#video-template",className:"kx-video",initialize:function(a){var c=this;this.atom=new atom,this.playerId="kx-video-"+this.cid,this.options=f.defaults({},a,{playerId:this.playerId,autoPlay:!1,muted:!1,width:554,height:380}),this.listenTo(b.vent,"youtube:player:ready",function(a){if(a==c.playerId){var d=e("#"+c.playerId);d.length&&c.atom.set("api",d.get(0)),c.stopListening(b.vent,"youtube:player:ready")}}),this.options.muted&&this.mute(),this.options.autoPlay&&this.play();var d=this.options;this.options.scriptTag=f.template('<script type="text/javascript">					var params = { allowScriptAccess: "always", wmode: "transparent", allowfullscreen:true };					var atts = { id: "<%=playerId%>" };					swfobject.embedSWF(						"//www.youtube.com/v/<%=youTubeVideoId%>?enablejsapi=1&playerapiid=<%=playerId%>&version=3&rel=0",						"<%=playerId%>",						"<%=width%>",						"<%=height%>",						"8",						null,						null,						params,						atts);					</script>',d)},stop:function(){this.atom.once("api",function(a){a.stopVideo()})},play:function(){this.atom.once("api",function(a){a.playVideo()})},mute:function(){this.atom.once("api",function(a){a.mute()})},unmute:function(){this.atom.once("api",function(a){a.unMute()})}})}),KXL.module("Components.CheckBox",function(a,b,c,d,e,f){a.View=d.ItemView.extend({template:"#checkbox-template",className:"kx-checkbox",ui:{checkBox:"input:checkbox",label:"label"},events:{click:"clickHandler"},modelEvents:function(){var a={};return this.model&&this.useModelAttr&&(a["change:"+this.useModelAttr]="render"),a},tagName:function(){return this.options.tagName||"span"},initialize:function(a){var b={customClass:"",name:"",value:"",label:"",modelAttr:"",checked:!1,tagName:"span",addEllipsisToLabel:!0,getCheckedValueFromModel:this.getModelValue.bind(this),getModelValueFromChecked:this.getValue.bind(this)};this.options=f.defaults(a||{},b),this.useModelAttr=this.model&&this.options.modelAttr},serializeData:function(){return{options:this.options}},onRender:function(){this.options.customClass&&this.$el.addClass(this.options.customClass),this.ui.label.toggleClass("kx-ellipsis",this.options.addEllipsisToLabel);var a=this.useModelAttr?this.options.getCheckedValueFromModel():this.options.checked;this.showState(a)},clickHandler:function(){this.showState(!this.getValue()),this.useModelAttr&&this.model.set(this.options.modelAttr,this.options.getModelValueFromChecked()),this.trigger("change")},getValue:function(){return this.ui.checkBox.is(":checked")},getModelValue:function(){return!!this.model.get(this.options.modelAttr)},showState:function(a){this.ui.checkBox.prop("checked",a),this.ui.label.toggleClass("checked",a)}})}),KXL.module("Components.Loader",function(a,b,c,d,e,f){a.View=d.View.extend({className:"kx-loader",initialize:function(b){var c={lines:13,length:20,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#fff",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto",center:!0};this.options=f.defaults(b||{},c),this.options=f.extend(this.options,this.options.size||a.sizes.small)},center:function(){function a(a){for(var b={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}var b=this.options,c=b.radius+b.length+b.width,d=this.$el[0],e=a(d),f=a(d.firstChild);this.$el.css({left:("auto"==b.left?e.x-f.x+(d.offsetWidth>>1):parseInt(b.left,10)+c)+"px",top:("auto"==b.top?e.y-f.y+(d.offsetHeight>>1):parseInt(b.top,10)+c)+"px"})},onShow:function(){if(this.$el.spin(this.options),this.options.center){var a=this;setTimeout(function(){a.center()},0)}}}),a.sizes={tiny:{lines:8,length:2,width:2,radius:3},small:{lines:8,length:4,width:3,radius:5},large:{lines:10,length:8,width:4,radius:8},xlarge:{lines:13,length:20,width:10,radius:30}},b.reqres.setHandlers({"new:loader:view":function(b){return new a.View(b)}})}),KXL.module("Components.LocaleSelector",function(a,b,c,d,e,f){a.Controller={getView:function(d){function e(a){var b=g.get(a);
g.select(b)}var g,h={locales:b.request("new:locales:entity",["en_US"]),locale:"en_US",namespace:"locale:selector:selector",execute:"set:locale"},i=f.defaults(d||{},h);g=f.extend(i.locales,new c.PickThis.SingleSelect(i.locales,i.namespace)),g.selected&&(i.locale=g.selected.get("locale")),e(i.locale);var j=new a.View({collection:g});return j.on("locales:locale:clicked",function(a){g.select(a.model),i.execute&&b.execute(i.execute,g.selected.get("locale"))}),j}}}),KXL.module("Components.LocaleSelector",function(a,b,c,d){a.ItemView=d.ItemView.extend({tagName:"span",template:"#_locale-selector-item-template",modelEvents:function(){var a=this;return events={},namespace=this.collection.namespace,events["selected:"+namespace]=function(){a.$el.addClass("kx-active")},events["deselected:"+namespace]=function(){a.$el.removeClass("kx-active")},events},triggers:{click:"clicked"},onRender:function(){this.collection.selected===this.model&&this.$el.addClass("kx-active")},serializeData:function(){return{locale:this.model.get("locale"),name:b.i18n.t("localeSelector."+this.model.get("locale")+"_name")}}}),a.View=d.CompositeView.extend({template:"#locale-selector-template",itemViewContainer:".kx-locales",itemViewEventPrefix:"locales:locale",itemViewOptions:function(a){return{collection:this.collection,model:a}},itemView:a.ItemView,className:"kx-locale-selector kx-clearfix kx-no-text-selection",modelEvents:{change:"render"}})}),KXL.module("Components.ErrorPage",function(a,b,c,d){a.View=d.ItemView.extend({initialize:function(a){this.options=a},getTemplate:function(){switch(this.options.error){case 404:return"#error-page-404-template";case 500:return"#error-page-500-template";default:return"#error-page-template"}}})}),KXL.module("Components.ErrorPage",function(a,b){b.reqres.setHandlers({"new:error:view":function(b){return new a.View(b)}})}),KXL.module("Services.Avatars",function(a,b,c,d,e,f){function g(a){return a&&a.length?!0:!1}var h={},i=["small","medium","large"];b.reqres.setHandlers({"get:service:avatars":function(a,b){if(b=b||"medium",h[a]&&-1!==f.indexOf(i,b)){var c=f.findWhere(h[a],{id:b});return c.url}return null},"set:services:avatars":function(a){f.each(a,function(a,b){g(a)&&(h[b]=a)})}})}),KXL.module("Services.BattleLog",function(a,b){var c={};b.reqres.setHandlers({"get:services:battlelog":function(a){return c[a]?c[a]:null},"set:services:battlelog":function(a,b){c[b]=a}})}),KXL.module("Services.Friends",function(a,b,c,d,e,f){function g(a,b){return i[a]&&i[a][b]?i[a][b]:null}function h(a,b){i[a]||(i[a]={}),f.isEmpty(b)||f.extend(i[a],b)}var i={};b.reqres.setHandlers({"purge:service:friends:count":function(a){i[a]&&delete i[a]},"get:service:friends:count":function(a){return g(a,"friendCount")||0},"increment:service:friends:count":function(a){if(i[a]){var b=i[a].friendCount||0;i[a].friendCount=++b}else i[a]={friendCount:1}},"decrement:service:friends:count":function(a){if(i[a]&&f.has(i[a],"friendCount")){var b=i[a].friendCount||0;i[a].friendCount=Math.max(0,--b)}},"set:service:friends:count":function(a,b){h(a,{friendCount:b})}})}),KXL.module("Services.TabManager",function(a,b,c,d,e,f){var g=b.Entities.Model.extend({idAttribute:"tabKey"}),h=b.Entities.Collection.extend({model:g});a.create=function(a){if(a=a||{},!a.contentRegion)throw"TabManager requires a contentRegion";var e=a.contentRegion,g=new h;g=f.extend(g,new c.PickThis.SingleSelect(g,"tabs")),g.on("select:one",function(a){var c=a.get("tab");c&&c.selected&&c.selected(),e.show(b.request("new:loader:view"));var d;d=f.isFunction(a.get("content"))?a.get("content")():a.get("content"),d.then(function(a){e.show(a)}).fail(function(a){a&&e.show(a)})});var i;g.on("deselect:one",function(a){i=a;var b=a.get("tab");b&&b.deselected&&b.deselected()});var j=d.Controller.extend({addTab:function(a,c,d){var e=new b.Entities.Model({id:a,content:d});return f.isFunction(c)?e.set("tab",c(e)):e.set("tab",c),e.get("tab").on("select",function(){g.select(e)}),g.add(e,{merge:!0}),e},removeTab:function(a){g&&g.get(a)&&g.remove(a)},previousTab:function(){return i?i:void 0},selectTab:function(a){a&&g&&g.get(a)&&g.select(g.get(a))},currentTab:function(){return g?g.selected:void 0}});return new j(a)},a.TabView=d.Layout.extend({triggers:{click:"select"},selected:function(){this.$el.addClass("kx-active")},deselected:function(){this.$el.removeClass("kx-active")}})}),KXL.module("FooterApp.Footer",function(a,b){a.Controller={loadFooter:function(){var c=b.request("get:current:user"),d=new a.View({model:c});b.footerRegion.show(d),d.on("forum:clicked",function(){b.execute("forum:show")}),d.on("oldgroups:clicked",function(){b.execute("groups:show")}),d.on("tos:clicked",function(){b.execute("show:TOS",{legal:"showTermsOfServices"})}),d.on("pp:clicked",function(){b.execute("show:TOS",{legal:"showPrivacyPolicy"})}),d.on("cp:clicked",function(){b.execute("show:TOS",{legal:"showCookiePolicy"})})},showFooter:function(){b.footerRegion.ensureEl(),b.footerRegion.$el.is(":hidden")&&b.footerRegion.$el.show()},hideFooter:function(){b.footerRegion.ensureEl(),b.footerRegion.$el.is(":visible")&&b.footerRegion.$el.hide()}}}),KXL.module("FooterApp.Footer",function(a,b,c,d){a.View=d.Layout.extend({template:Templates["footer/footer"],className:"kx-footer",triggers:{"click .termsofservice":"tos:clicked","click .privacypolicy":"pp:clicked","click .cookiepolicy":"cp:clicked","click .forum":"forum:clicked","click .oldgroups":"oldgroups:clicked"},ui:{oldgroups:".oldgroups"},regions:{localesRegion:".locales-region"},onRender:function(){this.localesRegion.show(b.request("new:locale:selector:view",{locales:b.appModel.get("supportedLocales"),locale:b.config.locale}))},onShow:function(){/\/?groups.*/i.test(b.getCurrentRoute())?this.ui.oldgroups.show():this.ui.oldgroups.hide()},initialize:function(){var a=this;this.listenTo(b.vent,"page:nav",function(b){/\/?groups.*/i.test(b)?a.ui.oldgroups.show():a.ui.oldgroups.hide()})},serializeData:function(){return{currentYear:(new Date).getFullYear()}}})}),KXL.module("FooterApp",function(a,b){this.startWithParent=!1;var c={loadFooter:function(){a.Footer.Controller.loadFooter()},showFooter:function(){a.Footer.Controller.showFooter()},hideFooter:function(){a.Footer.Controller.hideFooter()},showTOS:function(){window.open(b.config.LEGAL_URL)},showPress:function(a){b.asyncRequest("async:load:module","press").then(function(){var c=b.PressApp.Press.Controller.getView(a);b.request("show:default:dialog",c)})}};b.on("start",function(){c.loadFooter()}),b.commands.setHandlers({"footer:show":function(){c.showFooter()},"footer:hide":function(){c.hideFooter()},"show:TOS":function(){c.showTOS()},"show:Press":function(){c.showPress()}})}),KXL.module("HeaderApp.Header",function(a,b,c,d,e){var f;a.Controller=new(d.Controller.extend({bannersController:void 0,userControlsRegion:null,userMenuRegion:null,navToggle:null,navRibbon:null,searchView:null,friendsRegion:null,notificationsRegion:null,chatsRegion:null,vent:null,options:{},headerView:null,atom:null,initialize:function(){this.atom=atom.create()},createHeader:function(){var d=this,f=this.headerView=new a.View;f.bannersRegion.ensureEl();var g=this.bannersController=new a.Banner.Controller;return f.on("show",function(){d.updateUserControls(),e("body").addClass("header-showing"),f.bannersRegion.show(g.getBannersView()),d.atom.set("header",f)}),f.on("home:click",function(){b.execute("home:show")}),this.friendsRegion=new c.Marionette.Region({el:".kx-user-friends-wrapper"}),this.navToggle=new c.Marionette.Region({el:".kx-header-nav-toggle-region"}),this.navRibbon=new c.Marionette.Region({el:".kx-header-nav-ribbon-region"}),this.userControlsRegion=new c.Marionette.Region({el:".kx-header-user-controls-region"}),this.notificationsRegion=new c.Marionette.Region({el:".kx-user-notifications-wrapper"}),this.chatsRegion=new c.Marionette.Region({el:".kx-user-chats-wrapper"}),this.attackBeaconRegion=new c.Marionette.Region({el:".kx-attack-beacon-btn-region"}),this.searchRegion=new c.Marionette.Region({el:".kx-searchbar-region"}),b.vent.on("game:clicked",function(a){b.execute("game:show",a.model.get("id"),"home")}),b.vent.on("game:section:clicked",function(a,c){switch(c.model.id){case"home":case"guardians":case"blog":case"about":b.execute("game:show",a.model.id,c.model.id);break;case"leaderboards":b.execute("game:leaderboard:show",a.model.id);break;case"guide":"battlepirates"===a.model.id?b.asyncRequest("async:load:module","guide").then(function(){b.execute("guide:show",a.model.id)}):b.asyncRequest("async:load:module","game/guide").then(function(){b.execute("oldGuide:show",a.model.id,c.model.id)});break;case"strategy":b.execute("forum:show",c.model.get("url"),a);break;case"forum":b.execute("forum:show",c.model.get("url"));break;case"groups":b.execute("group:show",null,a);break;case"support":window.open(c.model.get("href"));break;case"play":b.currentUser?b.execute("game:play:load",a.model.id):c.model.get("startNowUrlName")||b.execute("game:show",a.model.id,"home")}}),b.vent.on("auth:changed",function(){d.updateUserControls()}),f},showContextChangeDialog:function(c,d){var g=e.Deferred();return b.appModel.set("navRibbonShowing",!0),b.appModel.lock("navRibbonShowing"),f.overlay.show(new a.ContextChangeOverlay({defer:g,currentContext:c,newContext:d})),g.always(function(a){b.appModel.unlock("navRibbonShowing"),a&&b.appModel.set("navRibbonShowing",!1),f.overlay.close()}),g.promise()},updateUserControls:function(){function c(a){d.navRibbon.ensureEl(),a?(e(".kx-menu-wrapper").removeClass("kx-active"),b.request("banner:remove","accountInfoRibbon"),g.toggleActive(!0),d.navRibbon.$el.css("height",h),b.vent.trigger("request:header:height:change:check")):(g.toggleActive(!1),d.navRibbon.$el.css("height",0),b.vent.trigger("request:header:height:change:check"))}var d=this,g=new a.NavToggleView,h=162;if(f=new a.NavRibbonView,f.on("show",function(){h=f.$el.height()}),g.on("clicked",function(){b.appModel.set("navRibbonShowing",!b.appModel.get("navRibbonShowing"))}),this.listenTo(b.appModel,"change:navRibbonShowing",function(){var a=b.appModel.get("navRibbonShowing");c(a)}),f.on("cta:clicked",function(){b.appModel.set("navRibbonShowing",!1)}),this.navToggle.show(g),this.navRibbon.show(f),b.currentUser){var i=function(a){a.options.buttonClassName&&"kx-chat-btn"===a.options.buttonClassName&&b.execute("chat:toggle"),a.options.sidebarViewId&&b.atom.once("sidebar:states:ready",function(){var c=a.options.sidebarViewId,d=b.request("sidebar:get:content",c);d&&(d.$el.is(":visible")?b.request("sidebar:hide:content",c):b.request("sidebar:show:content",c))})};this.headerView.ui.userMenu.show();var j=new a.UserMenuItem({buttonClassName:"kx-friends-btn",text:b.i18n.t("header.userFriends"),sidebarViewId:"friends"});this.headerView.listenTo(j,"user:menu:clicked",function(a){i(a)}),this.friendsRegion.show(j),b.vent.on("user:userFriendRequests:count:changed",function(a){j.updateFriendRequestsCount(a)});var k=new a.UserMenuItem({buttonClassName:"kx-notifications-btn",text:b.i18n.t("header.userNotifications"),sidebarViewId:"notifications"});if(this.headerView.listenTo(k,"user:menu:clicked",function(a){i(a)}),this.notificationsRegion.show(k),b.vent.on("user:userNotifications:count:changed",function(a){k.updateNotificationCount(a)}),b.switches.chatEnabled){var l=new a.UserMenuItem({buttonClassName:"kx-chat-btn",text:b.i18n.t("header.userChat")});this.headerView.listenTo(l,"user:menu:clicked",function(a){i(a)}),this.chatsRegion.show(l),b.vent.on("user:userChats:count:changed",function(a){l.updateNotificationCount(a)})}var m=new a.AccountInfoView({model:b.currentUser,className:"kx-header-user-controls-wrapper",API_URL:b.config.API_URL});m.on("account:click",function(){b.execute("home:show")}),b.request("attack:beacon:is:feature:enabled")&&b.asyncRequest("async:load:module","attack_beacon").then(function(){b.request("attack:beacon:setup",{attackBeaconBtnRegion:d.attackBeaconRegion})}),b.atom.once("sidebar",function(){var a=b.request("sidebar:get:states");a.on("select:one",function(a){var b=e(".kx-"+a.id+"-btn");b=b.parent(),b.addClass("active")}),a.on("deselect:one",function(a){"chat"===a.id&&b.execute("chat:toggle",!1);var c=e(".kx-"+a.id+"-btn");c=c.parent(),c.removeClass("active")})}),this.userControlsRegion.show(m),this.userControlsRegion.show(m)}else{this.headerView.ui.userMenu.hide();var n=new a.LoginJoinView({className:"kx-header-user-controls-wrapper"});n.on("join:click",function(){b.execute("show:register:dialog")}),n.on("login:click",function(){b.execute("show:login:dialog")}),this.notificationsRegion.close(),this.friendsRegion.close(),this.chatsRegion.close(),this.userControlsRegion.show(n)}},showPlayersOnline:function(){this.atom.once("header",function(a){var b=a.playersOnlineRegion;b.ensureEl(),b.$el.is(":hidden")&&b.$el.show()})},hidePlayersOnline:function(){this.atom.once("header",function(a){var b=a.playersOnlineRegion;b.ensureEl(),b.$el.is(":visible")&&b.$el.hide()})},showHeader:function(){this.atom.once("header",function(){e("body").addClass("header-showing");var a=b.headerRegion;a.ensureEl(),a.$el.is(":hidden")&&a.$el.show()})},hideHeader:function(){this.atom.once("header",function(){e("body").removeClass("header-showing");var a=b.headerRegion;a.ensureEl(),a.$el.is(":visible")&&a.$el.hide()})}}))}),KXL.module("HeaderApp.Header",function(a,b,c,d,e,f){var g=(e("#kx-body-veil"),b.Entities.Model.extend({defaults:{id:"",url:"",text:"",className:"kx-game-subflyout-item-text"}})),h=b.Entities.Collection.extend({model:g});a.View=b.Components.Layout.extend({playersOnline:null,template:Templates["header/header"],className:"kx-header",regions:{gamesMenu:".kx-header-games-menu",playersOnlineRegion:".kx-header-players-online-region",contextNavRegion:".kx-header-context-nav",bannersRegion:".kx-banners-region"},triggers:{"click .kx-header-logo":"home:click"},events:{"click .kx-user-notifications-wrapper":"notificationsWrapperClicked"},ui:{userMenu:".kx-user-menu-wrapper"},initialize:function(){this.listenTo(b.appModel,"change:context",this.setupContextNav)},setPlayersOnlineTop:function(a){this.playersOnlineRegion&&(this.playersOnlineRegion.ensureEl(),this.playersOnlineRegion.$el.css("top",a))},setupContextNav:function(){function a(){d.stopListening(b.vent,"auth:changed beta:code:success info:game:load",d.setupContextNav),d.listenToOnce(b.vent,"auth:changed beta:code:success info:game:load",d.setupContextNav),!b.context||b.currentUserGames&&b.currentUserGames.get(b.context.id)||(h=f.reject(h,function(a){return a.userGameRequired})),b.currentUserGames&&(d.stopListening(b.currentUserGames,"add remove",d.setupContextNav),d.listenToOnce(b.currentUserGames,"add remove",d.setupContextNav));var a;h=new c.Collection(h),h=f.extend(h,new c.PickThis.SingleSelect(h,"context")),b.config.SHOW_GAMES||h.remove(h.get("play")),h.on("deselect:one",function(b){a=b}),h.on("select:one",function(c){if(b.request("get:current:page")!==c.id){var d,e=c.get("url"),f=b.appModel.get("pages").get(c.id);switch(f&&f.get("route")&&(d=f.get("route")),c.id){case"home":b.homeRegion.currentView?(b.navigate(d),b.execute("page:show","home")):b.execute("home:show");break;case"profile":b.profileRegion.currentView?(b.navigate(d),b.execute("page:show","profile")):b.execute("home:show");break;case"guide":b.guideRegion.currentView?(b.navigate(d),b.execute("page:show","guide")):"battlepirates"===b.context.get("urlName")?b.asyncRequest("async:load:module","guide").then(function(){b.execute("guide:show",b.context.get("urlName"))}):b.asyncRequest("async:load:module","game/guide").then(function(){b.execute("oldGuide:show",b.context.get("urlName"))});break;case"strategy":case"forum":b.forumRegion.currentView?(b.navigate(d),b.execute("page:show","forum")):b.execute("forum:show",e.substring(7));break;case"support":b.navigate(d||e,{target:"kxl-support"}),h.select(a);break;case"group":b.groupRegion.currentView?(b.navigate(d),b.execute("page:show","group")):b.execute("group:show");break;case"play":var g=b.staticGames.get(b.context.get("urlName"));if(g&&g.has("steamUrl"))b.execute("game:navigate:steam",b.context.get("urlName"));else if(g&&!g.get("autoRegistration"))b.execute("game:register",b.context.get("urlName"));else if(b.playRegion.currentView)b.navigate(d),b.execute("page:show","play");else if(b.currentUser)b.execute("game:play:load",b.context.get("urlName"));else{var i=b.context&&b.context.get("urlName");i&&b.execute("show:register:dialog",{step:b.AuthApp.RegisterSteps.IMPORT_FB_GAMES_PROMPT,startNowUrlName:i,registrationHeaderText:b.i18n.t("auth.autoStart.registrationHeaderText")})}break;case"leaderboard":b.leaderboardRegion.currentView?(b.navigate(d),b.execute("page:show","leaderboard")):b.execute("game:leaderboard:show",b.context.get("urlName"));break;default:b.gameRegion.currentView?(b.navigate(d),b.execute("page:show","game")):b.execute("game:show",b.context.get("urlName"),"home")}}}),d.stopListening(b.appModel.get("pages")),d.listenTo(b.appModel.get("pages"),"select:one",function(a){h.get(a.id)?h.select(h.get(a.id)):h.deselect()}),d.contextNavRegion.show(new m({collection:h,icon:i}));var e=b.appModel.get("pages").selected,g=e&&h.get(e.id);g&&h.select(g)}var d=this;if(b.context)var g=b.staticGames.get(b.context.get("urlName")),h=g&&g.get("contextNavItems"),i=g&&g.get("contextNavIcon");h||(h=[{id:"group",url:"/groups",text:"header.context.groups",loggedInRequired:!0},{id:"forum",text:"header.context.forum",url:"/forum"},{id:"support",text:"header.context.support",url:"https://support.kixeye.com"}]),b.context&&b.context.get("inviteOnly")?b.currentUser?b.atom.get("game:isopen")?e.when(b.asyncRequest("game:is:user:allowed"),b.asyncRequest("async:load:module","game/beta_code")).then(function(c){var d=c[0],e=c[1];d||(h=f.reject(h,function(a){return a.betaAccessRequired?!0:void 0}),h.push({id:"enter-beta-key",url:"",text:function(){return new b.GamesApp.BetaCode.EnterCode({tagName:"li",model:e})}})),a()}):a():(h=f.reject(h,function(a){return a.betaAccessRequired?!0:void 0}),a()):b.currentUser?a():(h=f.reject(h,function(a){return a.loggedInRequired?!0:void 0}),a())},onRender:function(){this.playersOnline=b.request("new:playersonline:view"),this.playersOnlineRegion.show(this.playersOnline),this.setupContextNav()}}),a.NavToggleView=b.Components.Layout.extend({template:Templates["header/header-nav-toggle"],className:"kx-nav-toggle kx-menu-wrapper",triggers:{"click .kx-main-menu-btn":"clicked"},toggleActive:function(a){this.$el.find(".kx-main-menu-btn").toggleClass("kx-active",a)}}),a.ContextChangeOverlay=d.Layout.extend({template:Templates["header/header-context-change"],className:"kx-header-context-change",regions:{cancelRegion:".kx-cancel-region",continueRegion:".kx-continue-region"},serializeData:function(){return{currentContextName:this.options.currentContext.get("name"),newContextName:this.options.newContext.get("name")}},onRender:function(){var a=new b.Components.Button.View({label:b.i18n.t("header.context.change.cancel"),theme:"kx-alt23"}),c=new b.Components.Button.View({label:b.i18n.t("header.context.change.continue"),theme:"kx-alt23"}),d=this;a.on("click",function(){d.options.defer.reject(!1)}),c.on("click",function(){d.options.defer.resolve(!0)}),this.cancelRegion.show(a),this.continueRegion.show(c)}}),a.NavRibbonView=b.Components.Layout.extend({template:Templates["header/header-nav-ribbon"],className:"kx-nav-ribbon",regions:{overlay:".kx-nav-ribbon-overlay-region",desktopGameList:".kx-nav-ribbon-desktopgamelist-region",mobileGameList:".kx-nav-ribbon-mobilegamelist-region",communityList:".kx-nav-ribbon-communitylist-region",grouplistRegion:".kx-nav-ribbon-grouplist-region",corpListRegion:".kx-nav-ribbon-corplist-region"},onRender:function(){function c(){var c=[];c.push({id:"forum",text:b.i18n.t("header.commForum"),className:"kx-community-nav-item-text",href:"/forums"}),b.currentUser&&c.push({className:"kx-game-subflyout-item-text",id:"groups",text:b.i18n.t("header.commGroup"),href:"/groups"}),c.push({className:"kx-game-subflyout-item-text",id:"support",subnavClassName:"kx-game-nav-item-text",subnavText:"game.nav.support",text:b.i18n.t("header.commSupport"),href:"https://www.kixeye.com/support"}),f.communityList.show(new a.NavCommunityListSubmenuView({collection:new h(c)}))}function d(){var c=[];c.push({id:"about",text:b.i18n.t("header.corpAbout"),className:"kx-corp-nav-item-text",href:"http://corp.kixeye.com/",target:"_blank"},{id:"careers",text:b.i18n.t("header.corpCareers"),className:"kx-corp-nav-item-text",href:"http://corp.kixeye.com/#/en/jobs",target:"_blank"},{id:"press",text:b.i18n.t("header.corpPress"),className:"kx-corp-nav-item-text",href:"/press",target:"_self"}),f.corpListRegion.show(new a.NavCorpListSubmenuView({collection:new h(c)}))}function e(){var b=new a.NavGroupsSubMenuView;f.grouplistRegion.show(b)}var f=this;this.desktopGameList.show(new a.NavGameListView({type:"desktop"})),this.mobileGameList.show(new a.NavGameListView({type:"mobile"})),b.currentUser&&e(),f.communityList&&c(),f.corpListRegion&&d(),this.overlay.on("show",function(){f.overlay.$el.show()}),this.overlay.on("close",function(){f.overlay.$el.hide()})}}),a.NavGameListView=b.Components.Layout.extend({regions:{gameListLinks:".kx-nav-ribbon-gamelist-links-region"},ui:{desktopList:".kx-desktop-list",iconToggle:".kx-nav-ribbon-gamelist-icon"},events:{"click .kx-desktop-list":"showMobileGames","click .kx-mobile-list":"showDesktopGames"},template:Templates["header/header-nav-gamelist"],className:"kx-nav-ribbon-gamelist",showMobileGames:function(){this.gameListLinks.reset(),this.gameListLinks.show(new a.NavGameListMobileView({collection:new c.FilteredCollection(null,{collection:b.staticGames,collectionFilter:function(a){return a.get("isMobile")}})}))},showDesktopGames:function(){this.gameListLinks.reset(),this.gameListLinks.show(new a.NavGameListDesktopView({collection:new c.FilteredCollection(null,{collection:b.staticGames,collectionFilter:function(a){return!a.get("isMobile")}})}))},onRender:function(){this.options&&this.options.type&&("desktop"===this.options.type?this.showDesktopGames():this.showMobileGames())}}),a.NavGameListViewItem=d.ItemView.extend({template:Templates["header/header-nav-gamelist-item"],tagName:"li",triggers:{"click .kx-nav-ribbon-gamelist-list-link":"clicked"},onClicked:function(){b.vent.trigger("game:clicked",this),this.trigger("clicked"),b.appModel.set("navRibbonShowing",!1)},initialize:function(){(this.model.get("isMobile")||this.model.get("supportsMobile"))&&this.$el.addClass("kx-mobile")}}),a.NavGameListDesktopView=d.CompositeView.extend({template:Templates["header/header-nav-gamelist-desktop"],itemView:a.NavGameListViewItem,itemViewContainer:".kx-nav-ribbon-gamelist-list",className:"kx-nav-ribbon-gamelist-links-desktop"}),a.NavGameListMobileView=d.CompositeView.extend({template:Templates["header/header-nav-gamelist-mobile"],itemView:a.NavGameListViewItem,itemViewContainer:".kx-nav-ribbon-gamelist-list",className:"kx-nav-ribbon-gamelist-links-mobile"}),a.NavCommunityListItemView=d.ItemView.extend({template:Templates["header/header-nav-communitylist-item"],tagName:"li",triggers:{click:"clicked"}}),a.NavCommunityListSubmenuView=d.CompositeView.extend({template:Templates["header/header-nav-communitylist"],itemViewContainer:".kx-submenu-flyout",itemView:a.NavCommunityListItemView,itemViewEventPrefix:"sub:menu:item",className:"kx-header-nav-communitylist",onSubMenuItemClicked:function(a){b.vent.trigger("game:section:clicked",this,a),this.trigger("game:section:clicked",this,a),b.appModel.set("navRibbonShowing",!1)}}),a.NavCorpListItemView=d.ItemView.extend({template:Templates["header/header-nav-corplist-item"],tagName:"li",triggers:{click:{event:"clicked",preventDefault:!1,stopPropagation:!0}}}),a.NavCorpListSubmenuView=d.CompositeView.extend({template:Templates["header/header-nav-corplist"],itemViewContainer:".kx-submenu-flyout",itemView:a.NavCorpListItemView,itemViewEventPrefix:"sub:menu:item",className:"kx-header-nav-corplist",onSubMenuItemClicked:function(){b.appModel.set("navRibbonShowing",!1)}});var i=d.ItemView.extend({template:Templates["header/header-nav-groupslist-item"],tagName:"li",className:"kx-submenu-groups-item kx-ellipsis",triggers:{click:"Clicked"},templateHelpers:function(){var a={};if(this.model){var c=b.currentUserGroups.get(this.model.id);if(c&&c.get("group")){var d=c.get("group"),e=d.get("logo")&&d.get("logo").small||b.Group.Helpers.getDefaultLogoIconForGroup(d);a.logoUrl=e}}return a}}),j=d.Layout.extend({template:Templates["header/header-nav-groupslist-empty"],events:{"click .kx-browse-groups":"browseGroupsClicked","click .kx-suggested-groups":"suggestedGroupsClicked","click .kx-create-group":"createGroupClicked"},browseGroupsClicked:function(a){a&&(a.stopPropagation(),a.preventDefault()),b.appModel.set("navRibbonShowing",!1),b.execute("group:show")},suggestedGroupsClicked:function(a){a&&(a.stopPropagation(),a.preventDefault()),b.appModel.set("navRibbonShowing",!1),b.execute("group:show:suggested")},createGroupClicked:function(a){a&&(a.stopPropagation(),a.preventDefault()),b.appModel.set("navRibbonShowing",!1),b.execute("group:create:show")}});a.NavGroupsSubMenuView=d.CompositeView.extend({template:Templates["header/header-nav-groupslist"],itemViewContainer:".kx-submenu-groups-item-container",itemView:i,itemViewEventPrefix:"sub:menu:item",className:"kx-header-nav-grouplist",emptyView:j,events:{"click .kx-nav-ribbon-grouplist-header":"groupsClicked"},initialize:function(){b.execute("nav:groups:load"),this.collection=b.HeaderApp.navGroups,this.listenTo(b.currentUserGroups,"add remove",function(){b.execute("nav:groups:load")})},onSubMenuItemClicked:function(a){b.execute("group:show",a.model.id),b.appModel.set("navRibbonShowing",!1)},groupsClicked:function(a){a&&(a.stopPropagation(),a.preventDefault()),b.execute("group:show"),b.appModel.set("navRibbonShowing",!1)}});var k=d.ItemView.extend({template:Templates["header/header-context-nav-item"],tagName:"li",className:function(){var a=["kx-context-nav-item kx-game-nav-item-text"];return this.model&&(this.model.id&&a.push(this.model.id),this.model.get("userCanClose")&&a.push("kx-user-can-close")),a.join(" ")},triggers:{click:"clicked","click .kx-context-item-close":"close"},modelEvents:{"selected:context":function(){this.$el.addClass("kx-active")},"deselected:context":function(){this.$el.removeClass("kx-active")}}}),l=k.extend({modelEvents:{"selected:context":function(){this.$el.addClass("kx-active"),this.$el.toggleClass("kx-loaded",this.collection.selected===this.model&&b.request("user:playing"))},"deselected:context":function(){this.$el.removeClass("kx-active")}},serializeData:function(){return{text:this.model.get(!b.currentUser&&this.model.has("textLoggedOut")?"textLoggedOut":"text")}}}),m=d.CompositeView.extend({template:Templates["header/header-context-nav"],className:"kx-context-nav",ui:{icon:".kx-context-icon"},buildItemView:function(a,b,c){var d={model:a,collection:this.collection};return c&&(d=f.extend(c,d)),"function"==typeof a.get("text")?a.get("text")(d):("play"===a.id&&(b=l),new b(d))},itemView:k,itemViewEventPrefix:"context:nav:item",itemViewContainer:".kx-context-nav-items",onContextNavItemClicked:function(a){this.collection.select(a.model)},onContextNavItemClose:function(a){b.execute("page:close",a.model.id),a.$el.removeClass("kx-loaded"),a.model===this.collection.selected&&this.collection.select(this.collection.get("game"))},onRender:function(){this.options.icon?(this.ui.icon.css&&this.ui.icon.css("background-image","url(".concat(b.config.STATIC_BASE_URL,this.options.icon,")")),this.ui.icon.show&&this.ui.icon.show()):this.ui.icon.hide&&this.ui.icon.hide()}});a.UserMenuItem=b.Components.Layout.extend({template:Templates["header/_header-user-menu-item"],tagName:"li",triggers:{mouseover:"hovered"},events:{"click .kx-menu-item-lnk":"menuItemClicked"},regions:{countRegion:".kx-menu-item-count",buttonRegion:".kx-menu-btn",flyoutRegion:".kx-megaflyout-inner"},initialize:function(a){this.options=a},onRender:function(){this.options.flyoutView&&this.flyoutRegion.show(this.options.flyoutView)},menuItemClicked:function(){this.trigger("user:menu:clicked",this)},updateNotificationCount:function(a){var b=this;0===a?b.$el.find(".kx-notify-count").hide():b.$el.find(".kx-notify-count").text(a).show()},updateFriendRequestsCount:function(a){var b=this;0===a?b.$el.find(".kx-notify-count").hide():b.$el.find(".kx-notify-count").text(a).show()},serializeData:function(){return{buttonClassName:this.options.buttonClassName}}}),a.UserMenu=d.CollectionView.extend({itemView:a.UserMenuItem,itemViewEventPrefix:"menu:item",className:"kx-menu",tagName:"ul"}),a.AccountInfoView=b.Components.Layout.extend({template:Templates["header/header-account-info"],model:b.Entities.User,ui:{menuWrapper:".kx-account-info-menu-wrapper"},triggers:{"click .kx-header-account":"account:click"},events:{"click .kx-menu-btn-open":"toggleRibbon"},regions:{avatar:".kx-header-account-avatar"},initialize:function(){this.model.on("change",this.render),this.listenTo(b.vent,"user:menu:clicked nav:veil:off",function(){this.$el&&this.$(".kx-menu-wrapper").removeClass("kx-active")})},toggleRibbon:function(){var c=e(".accountInfoRibbon").is(":visible");c?b.request("banner:remove","accountInfoRibbon"):(b.appModel.set("navRibbonShowing",!1),b.request("banner:create",{bannerId:"accountInfoRibbon",view:new a.AccountInfoRibbonView({model:b.currentUser,className:"kx-header-user-controls-wrapper",API_URL:b.config.API_URL})})),this.ui.menuWrapper.toggleClass("kx-active")},onRender:function(){this.avatar.show(b.request("new:avatar:view",this.model.id,{model:this.model,size:"small",color:b.Components.Avatar.borderColors.GREY}))},serializeData:function(){return{user:this.model.toJSON()}}}),a.AccountInfoRibbonView=b.Components.Layout.extend({template:Templates["header/header-account-info-ribbon"],model:b.Entities.User,className:"kx-account-ribbon",events:{"click .kx-header-logout-btn":function(){e(".kx-menu-wrapper").removeClass("kx-active"),b.request("banner:remove","accountInfoRibbon"),b.execute("logout")},"click .kx-settings-btn":function(){e(".kx-menu-wrapper").removeClass("kx-active"),b.request("banner:remove","accountInfoRibbon"),b.request("auth:register:deferred:gate",{referrer:"header-account-settings"})||b.execute("settings:show")}},regions:{localesRegion:".kx-header-locales-region"},initialize:function(){this.model.on("change",this.render)},onRender:function(){this.localesRegion.show(b.request("new:locale:selector:view",{locales:b.appModel.get("supportedLocales"),locale:b.config.locale}))},serializeData:function(){return{user:this.model.toJSON()}}}),a.LoginJoinView=d.ItemView.extend({template:Templates["header/header-login-join"],triggers:{"click .kx-header-login-btn":"login:click","click .kx-header-join-btn":"join:click"}}),a.SimpleRibbon=d.ItemView.extend({template:Templates["header/header-simple-ribbon"],className:"kx-simple-ribbon",triggers:{click:"click"},serializeData:function(){return{message:this.options.message}}})}),KXL.module("HeaderApp",function(a,b,c,d,e,f){this.startWithParent=!1,a.navGroups=void 0;var g,h={MAX_GROUPS_LIST:4,createHeader:function(){return a.Header.Controller.createHeader()},showPlayersOnline:function(){a.Header.Controller.showPlayersOnline()},hidePlayersOnline:function(){a.Header.Controller.hidePlayersOnline()},showHeader:function(){a.Header.Controller.showHeader()},hideHeader:function(){a.Header.Controller.hideHeader()},showBanner:function(b,c){return a.Header.Controller.bannersController.showBanner(b,c)},createBanner:function(b){return a.Header.Controller.bannersController.createBanner(b)},hideBanner:function(c,d,e){b.atom.once("header",function(){a.Header.Controller.bannersController.hideBanner(c,d,e)})},removeBanner:function(b){a.Header.Controller.bannersController.removeBanner(b)},getBanner:function(b){return a.Header.Controller.bannersController.getBanner(b)},showContextChangeDialog:function(b,c){return a.Header.Controller.showContextChangeDialog(b,c)},loadNavGroups:function(){var d=[],e=b.currentUser&&b.currentUser.id;
if(e){var g=b.currentUserGroups&&b.currentUserGroups.pluck("group")||[],h=this.MAX_GROUPS_LIST;if(h)if(d=JSON.parse(localStorage.getItem("lvg_"+e)||"[]"),d=f.filter(d,function(a){return f.findWhere(g,{id:a.id})}),d.length)if(d.length<h){g=f.filter(g,function(a){return!f.findWhere(d,{id:a.id})});for(var i=h-d.length,j=0;i>j&&g[j];j++)d.push(g[j])}else d.length>h&&(d=h>1?f.first(d,h):[d[0]]);else g.length>h?h>1?d=f.first(g,h):d.push(g[0]):d=g}a.navGroups?a.navGroups.reset(d):a.navGroups=new c.Collection(d)},addViewedGroup:function(a){if(a){var c=b.currentUserGroups&&b.currentUserGroups.findWhere({groupId:a});if(c){c=c.get("group");var d=JSON.parse(localStorage.getItem("lvg_"+b.currentUser.id)||"[]");localStorage.removeItem("lvg_"+b.currentUser.id),this.MAX_GROUPS_LIST&&(d=f.filter(d,function(b){return b.id!=a}),d.unshift({id:a,title:c.get("title")}),d.length>this.MAX_GROUPS_LIST&&(d=this.MAX_GROUPS_LIST>1?f.first(d,this.MAX_GROUPS_LIST):[d[0]]),localStorage.setItem("lvg_"+b.currentUser.id,JSON.stringify(d))),this.loadNavGroups()}}}};b.on("start",function(){function a(a){var d=g.$el.find(".kx-header-bottom"),f=0;a&&a.headerBottomHeight?(f=a.headerBottomHeight,d.height(a.headerBottomHeight)):(d.children().each(function(){f+=this.offsetHeight}),d.height(f)),b.headerRegion.ensureEl();var h=b.headerRegion.$el.get(0).offsetHeight+f;e("#play-region").css("top",h),e("#sidebar-region").css("top",h),b.atom.once("sidebar",function(){b.execute("sidebar:adjust:children:to:container:height")}),b.atom.once("header",function(){g.setPlayersOnlineTop(h)}),c.css("padding-top",h),b.vent.trigger("header:height:changed",h)}g=h.createHeader(),g.on("show",function(){a(),b.atom.set("header",g)});{var c=e("body");b.request("current:user:settings:entity")}b.vent.on("request:header:height:change:check",function(b){a(b)}),b.appModel.on("change:sideBarState",a),"Win32"===navigator.platform&&(b.vent.on("overlay:toggle",function(a){var c=b.atom.get("overlay:open:count");c=c||0,c=a?c+1:c-1,c=Math.max(0,c),b.atom.set("overlay:open:count",c)}),b.atom.on("overlay:open:count",function(a){a>=1?b.atom.set("is:overlay:open",!0):b.atom.set("is:overlay:open",!1)}),b.atom.on("is:overlay:open",function(a){b.atom.get("game:isopen")&&b.atom.once("game:xframe:ready",function(){b.vent.trigger(a?"nav:overlay:open":"nav:overlay:closed")})})),b.headerRegion.show(g)}),b.addInitializer(function(){b.reqres.setHandlers({"banner:create":function(a){return h.createBanner(a)},"banner:show":function(a){return h.showBanner(a)},"banner:hide":function(a,b,c){h.hideBanner(a,b,c)},"banner:remove":function(a){h.removeBanner(a)},"banner:get":function(a){return h.getBanner(a)},"header:context:change:dialog":function(a,b){return h.showContextChangeDialog(a,b)}}),b.commands.setHandlers({"playersonline:show":function(){h.showPlayersOnline()},"playersonline:hide":function(){h.hidePlayersOnline()},"header:show":function(){h.showHeader()},"header:hide":function(){h.hideHeader()},"nav:groups:load":function(){h.loadNavGroups()}}),b.vent.on("group:viewed",function(a){h.addViewedGroup(a)})})}),KXL.module("HeaderApp.Header.Banner",function(a,b,c,d,e,f){a.Controller=d.Controller.extend({bannersView:void 0,initialize:function(){this.bannersView=new a.Banners},getBannersView:function(){return this.bannersView},getBanner:function(a){return this.bannersView.regions[a]},showBanner:function(a,c){var d=this.bannersView.regions[a];if(d){var e=this,g=f.defaults({},c,{hideOthers:!0}),h=d.$el;if(g.hideOthers){var i=f.keys(this.bannersView.regions);f.each(i,function(b){b!==a&&e.hideBanner(b)})}d.ensureEl(),h.show(),b.vent.trigger("request:header:height:change:check")}},createBanner:function(b){var d=this,g=f.defaults({},b,{animate:!0,show:!0,removeOnClose:!0}),h=g.view;this.bannersView.$el.show();var i,j=this.bannersView.regions[g.bannerId];if(!j){i=e('<div class="kx-banner-region '+g.bannerId+(g.className?" "+g.className:"")+'" style="display:none;"></div>'),this.bannersView.$el.append(i),j=new c.Marionette.Region({el:i});var k={};k[g.bannerId]=j,this.bannersView.addRegions(k)}var l=new a.Banner({contentView:h,closable:g.closable});return l.listenTo(l,"close:clicked",function(){d.hideBanner(g.bannerId,g.removeOnClose,{manual:!0})}),j.toggleClosable=function(a){l.toggleClosable(a)},g.show&&j.on("show",function(){d.showBanner(g.bannerId,g)}),j.show(l),j},removeBanner:function(a){var c=this.bannersView.regions[a];c&&(c.close(),this.bannersView.removeRegion(a),c.$el.remove(),c.trigger("removed"),b.vent.trigger("request:header:height:change:check"))},hideBanner:function(a,c,d){var e=this;if(!a){var g=f.keys(this.bannersView.regions);return void f.each(g,function(a){e.hideBanner(a,c,d)})}var h=this.bannersView.regions[a];if(h){var i=h.$el;i&&(i.hide(),b.vent.trigger("request:header:height:change:check"),c?e.removeBanner(a):h.trigger("hidden")),b.vent.trigger("banner:hidden",f.extend({bannerId:a},d||{}))}}})}),KXL.module("HeaderApp.Header.Banner",function(a,b,c,d,e,f){a.Banner=b.Components.ContentPane.View.extend({template:"#banner-template",className:"kx-banner",ui:{closeBtn:".kx-banner-close-button"},initialize:function(a){this.options=f.defaults(a||{},{closable:!1})},onShow:function(){this.toggleClosable(this.options.closable)},toggleClosable:function(a){if(a){this.ui.closeBtn.show();var b=this;this.ui.closeBtn.on("click",function(){b.trigger("close:clicked")})}else this.ui.closeBtn.hide()}}),a.Banners=b.Components.Layout.extend({template:function(){return""},className:"kx-banners"})}),KXL.module("ProfileApp",function(a,b,c,d){a.Router=d.AppRouter.extend({appRoutes:{"profile/:userId(/:section)":"showProfile"}});var e={showProfile:function(c,d){b.currentUser?(b.execute("page:show","profile"),a.Profile.Controller.showProfile(c,d),b.vent.trigger("profile:shown")):b.execute("home:show",!0)},getAddFriendView:function(b,c){return a.AddFriend.Controller.getAddFriendView(b,c)},getGameStatsView:function(b,c,d,e){return a.GameStats.Controller.getGameStatsView(b,c,d,e)},getUserInfoView:function(b){return a.UserInfo.Controller.getUserInfoView(b)},getFriendsView:function(b,c){return a.Friends.Controller.getFriendsView(b,c)},getLatestPostsView:function(b){return a.LatestPosts.Controller.getLatestPostsView(b)},getBookmarksView:function(b){return a.Bookmarks.Controller.getBookmarksView(b)},getActivityFeedView:function(b){return a.ActivityFeed.Controller.getActivityFeedView(b)},getUserGroupsView:function(b){return a.Groups.Controller.getUserGroups(b)}};b.addInitializer(function(){new a.Router({controller:e})}),b.vent.on("auth:changed",function(){b.request("get:current:user")||b.profileRegion.close()}),b.commands.setHandlers({"profile:show":function(a,c){c=c||{},b.navigate("/profile/"+a+(c.section?"/"+c.section:"")),b.execute("page:show","profile"),e.showProfile(a,c)}}),b.reqres.setHandlers({"new:gamestats:view":function(a,b,c,d){return e.getGameStatsView(a,b,c,d)},"new:addfriend:view":function(a,b){return e.getAddFriendView(a,b)},"new:userinfo:view":function(a){return e.getUserInfoView(a)},"new:friends:view":function(a,b){return e.getFriendsView(a,b)},"new:latestposts:view":function(a){return e.getLatestPostsView(a)},"new:bookmarks:view":function(a){return e.getBookmarksView(a)},"new:activityfeed:view":function(a){return e.getActivityFeedView(a)},"new:usergroups:view":function(a){return e.getUserGroupsView(a)}})}),KXL.module("ProfileApp.Profile",function(a,b,c,d,e,f){a.Controller={currentUserId:null,currentProfileUser:null,showProfile:function(c,d){function g(){var a=b.request("usergame:entities",c);a.then(function(a){var e=b.request("new:gamestats:view",a,b.request("user:entity",c)._model,d&&d.gameId,{overrideGameContext:d&&d.overrideGameContext});e.then(function(b){m.gameStats.show(b),i(a)})})}function h(){var a=b.request("current:user:game:entities"),c=b.request("new:gamestats:view",a,b.currentUser,d&&d.gameId);c.then(function(b){m.gameStats.show(b),i(a)}),a.on("add",function(c,e){var f=b.request("new:gamestats:view",e,b.currentUser,d&&d.gameId);f.then(function(b){m.gameStats.show(b),i(a)})})}function i(a){m.latestPosts.show(b.request("new:contentpane:view",{contentView:b.request("new:latestposts:view",{defaultGameId:a&&a.length&&a.selected.id||null})}))}var j=this,k=b.currentUser&&b.currentUser.id===c;if(!b.profileRegion.currentView||this.currentUserId!==c||j.currentProfileUser&&j.currentProfileUser.hasChanged()){var l=j.currentProfileUser=k?b.currentUser:b.request("user:entity",c)._model;if(b.appModel.set("currentProfilePageUser",l),b.appModel.set("currentProfilePageUserId",c),this.currentUserId=c,l){var m=new a.LoggedInLayout;m.on("show",function(){if(m.userInfo.show(b.request("new:contentpane:view",{contentView:b.request("new:userinfo:view",l.id),type:b.Components.ContentPane.Types.NO_BOTTOM})),m.friends.show(b.request("new:friends:view",l.id,{isSelf:c===b.currentUser.id})),m.bookmarks.show(b.request("new:contentpane:view",{contentView:b.request("new:bookmarks:view",l.id)})),m.groups.show(b.request("new:usergroups:view",l.id)),b.config.SHOW_GAMES?b.currentUser.id!==c?g():h():i(),!k){var a=b.request("current:user:friend:entities")._collection,d=function(a,c,d){var g=c.get(a);if(!g&&c.fetchComplete){var h=b.request("user:entity",a).promise();e.when(h).done(function(c){var e=c.get("username"),g=c.get("ignored");f.isBoolean(g)&&g===!1&&e&&b.asyncRequest("async:load:module","profile/add_friend").then(function(){var c=b.request("new:addfriend:view",a,e);d.addFriend.show(c),c.checkRequestSent()})})}else d.addFriend.currentView&&d.addFriend.close()};this.listenTo(a,"add remove reset",function(){d(c,a,m)}),d(c,a,m)}m.activity.show(b.request("new:contentpane:view",{headingText:b.i18n.t("profile.gameActivity"),contentView:b.request("new:activityfeed:view",l.id)}))}),b.profileRegion.show(m)}}}}}),KXL.module("ProfileApp.Profile",function(a,b){a.LoggedInLayout=b.Components.Layout.extend({template:"#profile-template",className:"kx-profile",regions:{userInfo:".kx-profile-user-info-region",friends:".kx-profile-friends-region",latestPosts:".kx-profile-latest-posts",bookmarks:".kx-profile-bookmarks",groups:".kx-profile-groups",gameStats:".kx-profile-game-stats",addFriend:".kx-profile-add-friend-region",activity:".kx-profile-activity"}})}),KXL.module("ProfileApp.ActivityFeed",function(a,b,c,d,e,f){a.Controller={feedLayout:null,feedView:null,messageInputView:null,feedUserId:null,currentUserFeed:null,emptyFeed:null,websocket:null,systemNotifications:null,getActivityFeedView:function(c){var d=this;return this.feedUserId=c,this.feedLayout=new a.mainLayout({previousPostsAction:"click"}),this.currentUserFeed=b.currentUser&&b.currentUser.id===d.feedUserId?!0:!1,b.asyncRequest("async:load:module","common/components/message_input").then(function(){d.messageInputView=b.request("new:messageinput:view",{startMinimized:!0,submitBtnLabel:b.i18n.t("messageInput.postBtnLabel")}),d.messageInputView.on("submit",function(a){this.displayLoadingState(),d.postNote(a)})}),this.feedLayout.on("load:previous:page",function(){d.loadPreviousPosts()}),this.feedLayout.on("activityfeed:closed",function(){d.activityFeedUnSubscribe()}),this.feedLayout.on("show",function(){if(b.currentUser.id===d.feedUserId){var a=new b.Components.EditOptions.Controller.getEditOptions({name:"editactivityfeedprivacy",optionsTitle:b.i18n.t("activityFeed.editPrivacyOptionsTitle"),model:b.request("current:user:settings:entity"),modelAttr:"activityStreamPrivacy",modelSaveOnChange:!0,optionItems:[{label:b.i18n.t("activityFeed.editPrivacyOptionsLabelEveryone"),value:"public"},{label:b.i18n.t("activityFeed.editPrivacyOptionsLabelFriends"),value:"friends"},{label:b.i18n.t("activityFeed.editPrivacyOptionsLabelPrivate"),value:"private"}]});this.editPrivacy.show(a)}if(d.currentUserFeed){var c=b.request("get:userNotifications");e.when(c).done(function(a){d.systemNotifications=a.filter(function(a){return"system"===a.attributes.type}),d.loadPosts()}).fail(function(){d.loadPosts()})}else d.loadPosts()}),this.feedLayout},postNote:function(a){var c=this,d=b.request("save:note",b.currentUser.id,this.feedUserId,a);e.when(d).done(function(){c.messageInputView.reset(),c.emptyFeed?c.loadPosts():c.loadLatestPosts()}).fail(function(a){switch(a.status){case 400:break;case 401:}})},loadPosts:function(){var c=this,d=new a.LoadingView;this.feedLayout.feed.show(d),this.feedLayout.showPreloader();var f=b.request("get:posts:by:userid",this.feedUserId);e.when(f).done(function(d){c.currentUserFeed&&(d=c.combinePostsWithSystemNotifications(d)),c.emptyFeed=d.length?!1:!0,c.feedView=new a.CompositeView({userId:c.feedUserId,currentUserFeed:c.currentUserFeed,collection:d}),c.feedView.on("feed:item:hide:post",function(a){c.feedView.collection.remove(a.model),"notification"===a.model.get("action")?a.model.destroy():"note"===a.model.get("object").entityType&&b.currentUser.id===a.model.get("object").hydrated.from?b.request("hide:note",a.model.get("object").entityId):c.currentUserFeed&&b.request("hide:post:by:userid",c.feedUserId,a.model.get("id"))}),c.feedLayout.feed.show(c.feedView),c.feedLayout.hidePreloader({paging:b.request("get:posts:paging")}),c.feedLayout.isLoading=!1,b.asyncRequest("async:load:module","common/components/message_input").then(function(){c.feedLayout.messageInput.show(c.messageInputView)}),b.currentUser&&(c.websocket=b.module("Websocket"),b.execute("websocket:subscribe","/users/"+c.feedUserId+"/activity-stream-posts",c.activityFeedSubListener.bind(c)))}).fail(function(d){switch(d.status){case 403:c.feedLayout.hidePreloader({paging:b.request("get:posts:paging")});var e=new a.PermissionsView;c.feedLayout.feed.show(e);break;default:console.log(d)}})},activityFeedSubListener:function(a){"comment"===a.type?this.feedView.children.each(function(b){a.content.entityId&&b.entityId===a.content.entityId&&b.addComment(a.content)}):(this.feedView.itemAppend=!1,this.feedView.collection.add(b.Entities.PostsCollection.prototype.parse({data:[a.content]},null)))},activityFeedUnSubscribe:function(){this.websocket&&b.execute("websocket:unsubscribe","/users/"+this.feedUserId+"/activity-stream-posts",this.activityFeedSubListener)},loadLatestPosts:function(){var a=this,c=b.request("get:latest:posts:by:userid",this.feedUserId);e.when(c).done(function(b){b&&(a.feedView.itemAppend=!1,a.feedView.collection.add(b.models))}).fail(function(a){console.log(a)})},loadPreviousPosts:function(){var a=this,c=b.request("get:previous:posts:by:userid",this.feedUserId);this.feedLayout.showPreloader(),e.when(c).done(function(c){if(c){var d=a.combinePostsWithSystemNotifications(c);a.feedView.collection.add(d.models),a.feedLayout.hidePreloader({paging:b.request("get:posts:paging")}),a.feedLayout.isLoading=!1}else{var e=a.getRemainingSytemNotifications();a.feedView.collection.add(e.models),a.feedLayout.hidePreloader({paging:b.request("get:posts:paging")})}}).fail(function(a){console.log(a)})},combinePostsWithSystemNotifications:function(a){var b=this,d=new c.Collection,e=[];return a.each(function(a){b.systemNotifications&&f.each(b.systemNotifications,function(c,f){c&&a&&c.get("publishAt")&&a.get("createdAt")&&c.get("publishAt")>a.get("createdAt")&&(c.set("action","notification"),d.add(c),e.push(f),delete b.systemNotifications[f])}),d.add(a)}),this.systenNotificationsRemaining=f.difference(this.systemNotifications,e),this.systemNotifications=this.systenNotificationsRemaining,d},getRemainingSytemNotifications:function(){var a=new c.Collection;return this.systemNotifications&&(f.each(this.systemNotifications,function(b){b&&(b.set("action","notification"),a.add(b))}),this.systemNotifications=null),a}}}),KXL.module("ProfileApp.ActivityFeed",function(a,b,c,d,e,f){a.EmptyView=b.Components.ItemView.extend({template:Templates["profile/activity_feed/activity-feed-empty"],tagName:"li",className:"kx-feed-empty"}),a.LoadingView=b.Components.ItemView.extend({template:Templates["profile/activity_feed/activity-feed-loading"],tagName:"li",className:"kx-feed-loading"}),a.PermissionsView=b.Components.ItemView.extend({template:Templates["profile/activity_feed/activity-feed-permission-denied"],tagName:"li",className:"kx-feed-permissions"}),a.FeedItemView=b.Components.Layout.extend({tagName:"li",className:"feed-item",comments:null,commentInput:null,entityId:null,regions:{thumbnailRegion:".kx-feed-item-thumbnail",commentsRegion:".kx-feed-item-comments",itemContent:".kx-feed-item-content"},ui:{itemTime:".kx-feed-item-time",itemOptions:".kx-feed-item-delete",commentBtn:".kx-feed-item-comment-btn",feedItemUsername:".kx-feed-item-username",feedItemDelete:".kx-feed-item-delete"},events:{"click @ui.feedItemUsername":"routeToUserProfile","click @ui.commentBtn":"showComments","mouseover @ui.feedItemDelete":"itemOver",mouseover:"itemOver",mouseout:"itemOut"},triggers:{"click @ui.feedItemDelete":"hide:post"},routeToUserProfile:function(a){b.execute("profile:show",e(a.currentTarget).attr("id"))},initialize:function(){this.model.get("object")&&this.model.get("object").entityId&&(this.entityId=this.model.get("object").entityId)},_renderComments:function(){var a=this.model.get("object").comments;this.comments=b.request("new:comments:view",{collection:a,canManage:b.currentUser.id===this.options.userId,canComment:!b.request("auth:is:temp:user"),showNoCommentingCTALink:!0,commentOwnerCanManage:!0,inputCloseOnOtherInputOpen:!0,inputStartExpanded:this.model.get("object").comments.length}),this.listenTo(this.comments,"comments:contracted",function(){this.ui.commentBtn.show()}),this.commentsRegion.show(this.comments),a.length||this.ui.commentBtn.show()},onRender:function(){this.$el.addClass("kx-clearfix"),this.model.get("actor")&&b.currentUser.id!==this.model.get("actor").entityId&&!this.options.currentUserFeed&&this.ui.itemOptions.hide(),this.model.get("object")&&"note"===this.model.get("object").entityType&&this._renderComments(),this.ui.itemTime.timeago({locale:b.config.locale})},itemOver:function(){TweenLite.killTweensOf(this.ui.itemOptions),TweenLite.to(this.ui.itemOptions,.5,{opacity:1,clearProps:"transform"})},itemOut:function(){TweenLite.to(this.ui.itemOptions,.5,{opacity:0,clearProps:"transform"})},addComment:function(a){this.comments.trigger("append:comment",a)},showComments:function(){this.comments.trigger("show:comment:input"),this.ui.commentBtn.hide()}}),a.FeedItemFromAppView=a.FeedItemView.extend({events:f.extend({"click .kx-feed-item-appname":"routeToApp"},a.FeedItemView.prototype.events),routeToApp:function(a){var c=b.games.get(e(a.currentTarget).data("id"));b.execute("game:show",c.get("urlName")),e(window).scrollTop(0)}}),a.FeedItemRankedView=a.FeedItemFromAppView.extend({template:Templates["profile/activity_feed/activity-feed-item-ranked"],onRender:function(){this.thumbnailRegion.show(b.request("new:game:logo:view",this.model.get("object").hydrated.gameId)),a.FeedItemView.prototype.onRender.call(this)},serializeData:function(){var a=" is now "+this.model.get("object").hydrated.newRank+" on the "+this.model.get("object").hydrated.leaderboardName+" Leaderboard!";return{kxid:this.model.get("actor").hydrated.id,username:this.model.get("actor").hydrated.username,gameId:this.model.get("object").hydrated.gameId,leaderboardName:this.model.get("object").hydrated.leaderboardName,updatedAt:b.Common.Utils.DateUtils.isoString(this.model.get("updatedAt")),oldRank:this.model.get("object").hydrated.oldRank,newRank:this.model.get("object").hydrated.newRank,text:a}}}),a.FeedItemGiftView=a.FeedItemFromAppView.extend({template:Templates["profile/activity_feed/activity-feed-item-gift"],onRender:function(){var c=this.model.get("actor").hydrated;this.thumbnailRegion.show(b.request("new:avatar:view",c.id,{avatarMenu:b.Components.Avatar.avatarMenu.ON,size:"medium",color:"grey",model:b.request("new:user:entity",c)})),a.FeedItemView.prototype.onRender.call(this)},serializeData:function(){return{kxid:this.model.get("object").hydrated.from,username:this.model.get("actor").hydrated.username,text:this.model.get("object").hydrated.text,updatedAt:b.Common.Utils.DateUtils.isoString(this.model.get("updatedAt"))}}}),a.FeedItemBragView=a.FeedItemFromAppView.extend({template:Templates["profile/activity_feed/activity-feed-item-brag"],onRender:function(){this.thumbnailRegion.show(b.request("new:game:logo:view",this.model.get("object").hydrated.appId)),a.FeedItemView.prototype.onRender.call(this)},serializeData:function(){return{kxid:this.model.get("object").hydrated.from,username:this.model.get("actor").hydrated.username,text:this.model.get("object").hydrated.text,updatedAt:b.Common.Utils.DateUtils.isoString(this.model.get("updatedAt")),appTitle:this.model.get("object").hydrated.appTitle,appId:this.model.get("object").hydrated.appId}}}),a.FeedItemPostView=a.FeedItemView.extend({template:Templates["profile/activity_feed/activity-feed-item-default"],onRender:function(){var c=this.model.get("actor").hydrated;this.thumbnailRegion.show(b.request("new:avatar:view",c.id,{avatarMenu:b.Components.Avatar.avatarMenu.ON,size:"medium",color:"grey",model:b.request("new:user:entity",c)})),a.FeedItemView.prototype.onRender.call(this)},serializeData:function(){return{kxid:this.model.get("object").hydrated.from,username:this.model.get("actor").hydrated.username,text:this.model.get("object").hydrated.text,updatedAt:b.Common.Utils.DateUtils.isoString(this.model.get("updatedAt"))}}}),a.FeedItemNotificationImageView=d.ItemView.extend({template:Templates["profile/activity_feed/feed-item-image"],className:"kx-feed-item-image-wrapper",templateHelpers:function(){var a=this;return{url:function(){var b=a.options.url;return b.match(/^\/\/kxl-site-content/)?b:"/modules/header".concat(b)}}}}),a.FeedItemNotificationView=a.FeedItemView.extend({template:Templates["profile/activity_feed/system-notifications"],ui:f.extend({thumb:".kx-feed-item-thumbnail",moreInfo:".kx-feed-item-url"},a.FeedItemView.prototype.ui),onRender:function(){var c=this;this.thumbnailRegion.show(new a.FeedItemNotificationImageView({url:c.model.get("imageUrl")})),""!==this.model.get("url")?(this.ui.thumb.addClass("clickable"),this.ui.thumb.bind("click",function(){b.navigate(this.model.get("url"))})):this.ui.moreInfo.hide(),a.FeedItemView.prototype.onRender.call(this)},serializeData:function(){return{publishAt:b.Common.Utils.DateUtils.isoString(this.model.get("publishAt")),content:this.model.get("content"),url:this.model.get("url")}}}),a.ForumPostView=a.FeedItemView.extend({template:Templates["profile/activity_feed/activity-feed-item-forum-post"],onRender:function(){this.$el.addClass("kx-clearfix");var c=this.model.get("actor").hydrated;this.thumbnailRegion.show(b.request("new:avatar:view",c.id,{avatarMenu:b.Components.Avatar.avatarMenu.ON,size:"medium",color:"grey",model:b.request("new:user:entity",c)})),this.ui.itemTime.timeago({locale:b.config.locale}),a.FeedItemView.prototype.onRender.call(this)},serializeData:function(){return{kxid:this.model.get("object").hydrated.userId,username:this.model.get("actor").hydrated.username,title:this.model.get("object").hydrated.title,url:this.model.get("object").hydrated.url,text:this.model.get("object").hydrated.bodyText,updatedAt:b.Common.Utils.DateUtils.isoString(this.model.get("updatedAt"))}}}),a.ForumReplyView=a.FeedItemView.extend({template:Templates["profile/activity_feed/activity-feed-item-forum-reply"],onRender:function(){this.$el.addClass("kx-clearfix");var c=this.model.get("actor").hydrated;this.thumbnailRegion.show(b.request("new:avatar:view",c.id,{avatarMenu:b.Components.Avatar.avatarMenu.ON,size:"medium",color:"grey",model:b.request("new:user:entity",c)})),this.ui.itemTime.timeago({locale:b.config.locale}),a.FeedItemView.prototype.onRender.call(this)},serializeData:function(){return{usernameWhoCommentedId:this.model.get("actor").hydrated.id,usernameWhoCommented:this.model.get("actor").hydrated.username,usernameWhoPostedId:this.model.get("object").hydrated.discussionUserId,usernameWhoPosted:this.model.get("object").hydrated.discussionUserName,originalPostTitle:this.model.get("object").hydrated.title,originalPostUrl:this.model.get("object").hydrated.url,comment:this.model.get("object").hydrated.bodyText,updatedAt:b.Common.Utils.DateUtils.isoString(this.model.get("updatedAt"))}}}),a.NewFriendView=a.FeedItemView.extend({template:Templates["profile/activity_feed/activity-feed-item-new-friend"],onRender:function(){this.$el.addClass("kx-clearfix");var c=this.model.get("friendA").hydrated;this.thumbnailRegion.show(b.request("new:avatar:view",c.id,{avatarMenu:b.Components.Avatar.avatarMenu.ON,size:"medium",color:"grey",model:b.request("new:user:entity",c)})),this.ui.itemTime.timeago({locale:b.config.locale}),a.FeedItemView.prototype.onRender.call(this)},serializeData:function(){var a=this.model.get("actor"),c=this.model.get("object"),d=!0;return this.model.set({friendA:a}),this.model.set({friendB:c}),b.currentUser.id===a.hydrated.id&&this.options.currentUserFeed||b.currentUser.id===c.hydrated.id&&this.options.currentUserFeed?b.currentUser.id===a.hydrated.id&&(this.model.set({friendA:c}),this.model.set({friendB:a})):(d=!1,this.options.userId===a.hydrated.id&&(this.model.set({friendA:c}),this.model.set({friendB:a}))),this.model.get("friendB").hydrated.id===b.currentUser.id&&(this.model.get("friendB").hydrated.username=b.i18n.t("activityFeed.you")),{friendA:this.model.get("friendA"),friendB:this.model.get("friendB"),updatedAt:b.Common.Utils.DateUtils.isoString(this.model.get("updatedAt")),currentUserFeed:d}}}),a.CompositeView=d.CompositeView.extend({initialize:function(a){this.itemViewOptions={userId:a.userId,currentUserFeed:a.currentUserFeed}},template:Templates["profile/activity_feed/activity-feed-items"],className:"feed",emptyView:Templates["profile/activity_feed/activity-feed-empty"],itemViewContainer:".kx-feed-item-list",itemViewEventPrefix:"feed:item",itemAppend:!0,buildItemView:function(b,c,d){if(this.collection&&this.collection.length){var e=f.extend({model:b},d);switch(e.model.get("action")){case"friend":return new a.NewFriendView(e);case"forum-post":return new a.ForumPostView(e);case"forum-reply":return new a.ForumReplyView(e);case"bookmarked-reply":return new a.ForumReplyView(e);case"ranked":return new a.FeedItemRankedView(e);case"brag":return new a.FeedItemBragView(e);case"gift":return new a.FeedItemGiftView(e);case"notification":return new a.FeedItemNotificationView(e);case"post":default:return new a.FeedItemPostView(e)}}return new a.EmptyView},appendHtml:function(a,b){var c=a.getItemViewContainer(a);this.itemAppend?c.append(b.$el):(c.prepend(b.$el),TweenLite.fromTo(b.$el,1,{opacity:0,ease:"Power2.easeInOut"},{opacity:1,clearProps:"transform",ease:"Power2.easeInOut"}))}}),a.mainLayout=b.Components.Layout.extend({isLoading:!0,allItemsLoaded:!1,loadPostsOnClick:!1,loadPostsOnScroll:!1,initialize:function(){var a=this;"scroll"===this.options.previousPostsAction?(this.loadPostsOnScroll=!0,e(document).scroll(function(){a.checkScroll()})):"click"===this.options.previousPostsAction&&(this.loadPostsOnClick=!0)},template:Templates["profile/activity_feed/activity-feed"],className:"kx-activity-feed",regions:{messageInput:"#message-input-region",feed:"#feed-region",editPrivacy:"#edit-privacy-region"},ui:{preloader:".kx-more-loading",moreBtn:".kx-load-more-btn"},triggers:{"click .kx-load-more-btn":"load:previous:page"},checkScroll:function(){var a=100;!this.isLoading&&!this.allItemsLoaded&&e(document).scrollTop()+a>e(document).height()-e(window).height()&&(this.isLoading=!0,this.trigger("load:previous:page"))},showPreloader:function(){this.loadPostsOnClick&&this.ui.moreBtn.hide(),this.ui.preloader.show()},hidePreloader:function(a){var b={paging:null};this.options=f.defaults(a||{},b),this.ui.preloader.hide(),this.loadPostsOnClick&&this.options.paging&&this.options.paging.previous&&this.ui.moreBtn.show()},onClose:function(){this.loadPostsOnScroll&&e(document).unbind("scroll"),this.trigger("activityfeed:closed")}})}),KXL.module("ProfileApp.Bookmarks",function(a,b){a.Controller={getBookmarksView:function(c){var d={};b.currentUser&&b.currentUser.id===c&&(d.collection=b.request("forumbookmark:entities",c)._collection);var e=new a.View(d);return e.on("bookmarked:item:check:clicked",function(a){a.model.destroy()}),e.on("bookmarked:item:link:clicked",function(){b.execute("forum:show")}),e}}}),KXL.module("ProfileApp.Bookmarks",function(a,b,c,d){a.EmptyView=d.Layout.extend({template:Templates["profile/forum_bookmarks/_forum-bookmarks-empty"],className:"_forum-bookmarks-empty-template",events:{"click .kx-visit-forums":"visitForumsClicked"},visitForumsClicked:function(){b.execute("forum:show")},regions:{visitForumsRegion:".kx-visit-forums-region"},onRender:function(){var a=new b.Components.Button.View({label:b.i18n.t("profile.forum_bookmarks.visitForums"),theme:b.Components.Button.Themes.alt1,customClass:"kx-visit-forums"});this.visitForumsRegion.show(a)}}),a.BookmarkItem=d.ItemView.extend({model:b.Entities.Bookmark,template:Templates["profile/forum_bookmarks/_forum-bookmarks-item"],tagName:"li",triggers:{"click .kx-forum-bookmark-checkmark":"check:clicked","click .kx-forum-bookmark-link":"link:clicked"},events:{"click .kx-forum-bookmark-title":"bookmarkTitleClicked"},bookmarkTitleClicked:function(){b.execute("forum:show","discussion/"+this.model.id)}}),a.View=d.CollectionView.extend({itemView:a.BookmarkItem,emptyView:a.EmptyView,itemViewEventPrefix:"bookmarked:item",tagName:"ul",className:"kx-forum-bookmarks"})}),KXL.module("ProfileApp.Groups",function(a,b){a.Controller={getUserGroups:function(c){var d=new a.Layout;return b.asyncRequest("user:usergroups:entities",c).always(function(b){d.contentRegion.currentView?d.contentRegion.show(new a.View({collection:b})):d.on("show",function(){d.contentRegion.show(new a.View({collection:b}))})}),d}}}),KXL.module("ProfileApp.Groups",function(a,b,c,d){var e=d.Layout.extend({template:"#kx-profile-user-groups-empty-template",className:"kx-profile-user-groups-empty",events:{"click .kx-browse-groups":"browseGroupsClicked","click .kx-suggested-groups":"suggestedGroupsClicked","click .kx-create-group":"createGroupClicked"},browseGroupsClicked:function(){b.execute("group:show")},suggestedGroupsClicked:function(){b.execute("group:show:suggested")},createGroupClicked:function(){b.execute("group:create:show")},regions:{content:".kx-profile-user-groups-empty-container"}}),f=d.ItemView.extend({template:"#kx-profile-user-group-template",tagName:"li",events:{"click .kx-user-group-title":"visitGroupClicked","click .kx-avatar-wrapper":"visitGroupClicked"},visitGroupClicked:function(){b.execute("group:show",this.model.id)},serializeData:function(){var a=this.model.get("group").toJSON(),c=b.games.get(a.gameId),d=c&&c.get("urlName");return a.logoImageUrl=a.logo&&a.logo.small?a.logo.small:b.config.STATIC_BASE_URL+"/modules/common/images/group/"+(d||"default")+"_logo.png",a}});a.View=d.CompositeView.extend({template:"#kx-profile-user-groups-template",itemViewContainer:".kx-profile-user-groups-list",ui:{header:".kx-profile-user-groups-header",content:".kx-profile-user-groups-list",footer:".kx-profile-user-groups-footer",groupCounter:".kx-profile-user-groups-count"},collectionEvents:{"add remove reset":"updateGroupCount"},itemView:f,emptyView:e,tagName:"ul",className:"kx-profile-user-groups",initialize:function(){var a=this;this.listenTo(b.currentUserGroups,"add remove",function(){a.collection.length?a.ui.footer.show():a.ui.footer.hide()})},onRender:function(){this.updateGroupCount(),this.collection&&this.collection.length?this.ui.footer.show():this.ui.footer.hide()},updateGroupCount:function(){this.ui.groupCounter.text(this.collection&&this.collection.length?this.collection.length:0)},events:{"click .kx-profile-user-groups-footer-browse-groups":"visitGroupsClicked","click .kx-profile-user-groups-footer-create-group":"createGroupClicked"},visitGroupsClicked:function(){b.execute("group:show")},createGroupClicked:function(){b.execute("group:create:show")}}),a.Layout=d.Layout.extend({template:"#kx-profile-user-groups-layout-template",className:"kx-profile-user-groups-layout",regions:{contentRegion:".kx-profile-user-groups-content-region"},events:{"click .kx-visit-groups":"visitGroupsClicked"},visitGroupsClicked:function(){b.execute("group:show")
},onShow:function(){this.contentRegion.currentView||this.contentRegion.show(new b.Components.Loader.View)}})}),KXL.module("ProfileApp.GameStats",function(a,b,c,d,e,f){var g=d.Controller.extend({getGameStatsView:function(d,g,h,i){function j(){d.length&&(b.context&&d.get(b.context)&&!m.overrideGameContext?d.get(b.context).select():h&&d.findWhere({gameId:h})?d.findWhere({gameId:h}).select():d.first().select())}function k(){if(d.reset(d.filter(function(a){var c=b.games.get(a.get("gameId"));return c?-1!==m.commonNamesForDisplayedGames.indexOf(c.get("commonName")):!1})),d.length?j():d.fetched||d.listenToOnce(d,"sync",function(){j()}),d.length){var c=new a.View({user:g,collection:d});return c}var e=new a.EmptyView;return e}var l=e.Deferred(),m=f.extend({commonNamesForDisplayedGames:["bp","wc","vc","tome"]},i),n=new c.Picky.SingleSelect(d);return f.extend(d,n),b.vent.on("profile:shown",function(){d.sort(),b.context&&d.get(b.context.id)?d.get(b.context.id).select():d.first()&&d.first().select()}),this.listenTo(b.appModel,"change:context",function(a,b){d.get(b.id)&&d.get(b.id).select()}),l.resolve(k()),l}});a.Controller=new g}),KXL.module("ProfileApp.GameStats",function(a,b,c,d,e,f){var g=b.Components.ItemView.extend({tagName:"li",template:"#_home-game-stats-pager-item-template",triggers:{click:"clicked"},modelEvents:{selected:function(){this.$el.addClass("kx-pager-item-active"),b.vent.trigger("gamestats:game:selected",this.model.get("gameId"))},deselected:function(){this.$el.removeClass("kx-pager-item-active")}},onRender:function(){this.model.selected&&(this.$el.addClass("kx-pager-item-active"),b.vent.trigger("gamestats:game:selected",this.model.get("gameId")))},templateHelpers:{getGameIconImagePath:function(){var a=this.model.get("gameId");if(a){var c=b.games.get(this.model.get("gameId"));if(c)return b.config.STATIC_BASE_URL+"/modules/profile/game_stats/images/"+c.get("commonName")+"/pager_game_icon.png"}return""}},serializeData:function(){return{templateHelpers:this.templateHelpers,model:this.model}}}),h=d.CompositeView.extend({defaultOptions:{showPagerThreshold:5},template:"#home-game-stats-pager-template",className:"kx-gamestats-pager kx-no-text-selection",itemViewContainer:".kx-gamestats-pager-list",itemViewEventPrefix:"game:pager:item",itemView:g,collectionEvents:{"add remove":"onItemsCountChanged"},initialize:function(a){this.options=f.defaults(a,this.defaultOptions)},events:{"click .kx-gamestats-pager-left-arrow":function(){var a=this.collection.prev(this.collection.selected,!0);a&&a.select()},"click .kx-gamestats-pager-right-arrow":function(){var a=this.collection.next(this.collection.selected,!0);a&&a.select()}},onItemsCountChanged:function(){this.collection.length>1?this.$el.show():this.$el.hide(),this.collection.length>this.options.showPagerThreshold?this.$el.addClass("kx-gamestats-pager-showing-scroller-btns"):this.$el.removeClass("kx-gamestats-pager-showing-scroller-btns")},onGamePagerItemClicked:function(a){a.model.get("userId")===b.currentUser.id?b.asyncRequest("context:change",b.games.get(a.model.id)).then(function(){b.execute("home:show")}):a.model.select()}}),i=b.Components.Layout.extend({tagName:"ul",modelEvents:{change:"render"},className:function(){var a="kx-gamestats-values kx-clearfix kx-"+this.options.game.get("commonName");return a},serializeData:function(){var a=this.model.get("alliance");if(a&&a.name){this.$el.addClass("kx-show-alliance");var b=!0}var c=this.model.toJSON();return c.medals="undefined"!=typeof c.medals?c.medals:"-",c.infamy="undefined"!=typeof c.infamy?c.infamy:"-",c.sector&&c.sector<0&&(c.sector=""),{game:this.options.game?this.options.game.toJSON():{},userGame:c,alliance:b}},getTemplate:function(){if(this.options.game){var a="#home-game-stats-"+this.options.game.get("commonName")+"-template",b=e(a);if(b.length)return a}return"#home-game-stats-default-template"}}),j=b.Components.Layout.extend({userId:null,className:"kx-gamestats-item",template:"#_home-game-stats-item-template",templateHelpers:{getGameLogoImagePath:function(){return this.game?b.config.STATIC_BASE_URL+"/modules/profile/game_stats/images/"+this.game.commonName+"/logo.png":""}},regions:{statsRegion:".kx-gamestats-basic-stats",playBtnRegion:".kx-gamestats-playnow",editSectorRegion:".kx-edit-options-sector-region"},modelEvents:{selected:function(){this.$el.show()},deselected:function(){this.$el.hide()},change:"render"},initialize:function(a){this.model.selected?this.$el.show():this.$el.hide(),this.gameModel=b.games.get(this.model.id),this.userId=a.user.get("id"),this.listenTo(a.user,"change",function(){this.render()})},onRender:function(){var a=this;if(b.config.SHOW_GAMES){var c=b.staticGames.get(this.gameModel.get("urlName")),d=c&&c.has("steamUrl"),e=d?"profile.gamestats.play.steam":"profile.gamestats.playNow",f=new b.Components.Button.View({label:b.i18n.t(e),theme:b.Components.Button.Themes.alt7});f.on("click",function(){d?b.execute("game:navigate:steam",a.gameModel.get("urlName")):b.execute("game:play:load",a.gameModel.get("urlName"))}),this.playBtnRegion.show(f)}if(this.statsRegion.show(new i({model:a.model,game:a.gameModel})),b.currentUser&&b.currentUser.id===this.userId){var g={name:"sectoroptions",optionsTitle:b.i18n.t("profile.gamestats.sector.edit"),model:b.request("current:user:settings:entity"),modelAttr:"sectorPrivacy",modelSaveOnChange:!0,closeOnItemEvent:!0,optionItems:[{label:b.i18n.t("profile.gamestats.sector.public"),value:"public"},{label:b.i18n.t("profile.gamestats.sector.friends"),value:"friends"},{label:b.i18n.t("profile.gamestats.sector.private"),value:"private"}]},h=new b.Components.EditOptions.Controller.getEditOptions(g);this.editSectorRegion.show(h)}},serializeData:function(){var a=b.currentUser.id===this.model.get("userId")&&"tome"!=this.gameModel.get("commonName")?!0:!1,c=this.model.get("alias")&&this.model.get("alias").match(/default_[0-9a-fA-F]{16}/i)&&"tome"===this.gameModel.get("commonName")?"Initiate":this.model.get("alias")?this.model.get("alias"):this.options.user.get("username");return{renderMoreStats:a,templateHelpers:this.templateHelpers,game:this.gameModel?this.gameModel.toJSON():{},user:this.options.user.toJSON(),userGame:this.model.toJSON(),gameName:c}},ui:{moreStatsSection:".kx-gamestats-more-stats"},events:{"click .kx-gamestats-more-stats-lnk":"onMoreStatsToggleClicked","click .kx-gamestats-logo":"onMoreStatsToggleClicked"},onMoreStatsToggleClicked:function(){this.gameModel&&b.execute("game:show",this.gameModel.get("urlName"),"home")}}),k=d.CollectionView.extend({className:"kx-gamestats-items",itemView:j,itemViewOptions:function(){return{user:this.options.user}}});a.View=d.Layout.extend({template:"#profile-game-stats-template",className:"kx-gamestats",regions:{pager:".kx-gamestats-pager-wrapper",stats:".kx-gamestats-stats-region"},onRender:function(){this.pager.show(new h({collection:this.collection})),this.stats.show(new k({collection:this.collection,user:this.options.user}))}}),a.EmptyView=d.Layout.extend({template:"#home-game-stats-empty-view-template",className:"kx-gamestats-empty-view",events:{"click .kx-bp .kx-play-now":"playBP","click .kx-wc .kx-play-now":"playWC","click .kx-vc .kx-play-now":"playVC","click .kx-tome .kx-play-now":"playTOME"},playBP:function(){b.execute("game:play:load","battlepirates")},playWC:function(){b.execute("game:play:load","warcommander")},playVC:function(){b.execute("game:play:load","vegaconflict")},playTOME:function(){b.execute("game:navigate:steam","tomeimmortalarena")}})}),KXL.module("ProfileApp.Friends",function(a,b,c,d,e,f){var g=50,h=g;a.Controller={friendsView:null,userId:null,fetching:!1,fetchExhausted:!1,fetchMoreFriends:function(){var a=this;if(!this.fetching&&!this.fetchExhausted){this.fetching=!0;var c=b.request("user:friend:entities",this.userId,{promise:!0});e.when(c).done(function(b){b.each(function(b){a.friendsView.collection.add(b)}),a.fetching=!1,a.fetchExhausted=0===b.length})}},getFriendsView:function(d,e){var i=this;if(this.userId=d,this.fetchExhausted=!1,e=f.extend({id:d,isSelf:!1,showEditFriendsSettings:!1},e),e.showEditFriendsSettings=e.isSelf&&e.showEditFriendsSettings?!0:!1,e.isSelf){var j=b.request("current:user:friend:entities")._collection;e.collection=new c.Obscura(j),e.collection.setPerPage(50)}else e.collection||(e.collection=b.request("user:friend:entities",d,e)._collection);return this.friendsView=new a.View(e),this.friendsView.on("fetch:more:friends",f.debounce(function(){e.isSelf&&j?j.length!==e.collection.length&&(h+=g,e.collection.setPerPage(h)):i.fetchMoreFriends()},250)),this.friendsView}}}),KXL.module("ProfileApp.Friends",function(a,b,c,d,e,f){a.View=d.CompositeView.extend({template:"#profile-friends-template",className:"kx-profile-friends kx-clearfix",itemViewContainer:".kx-friends-list",buildItemView:function(a,c,d){return b.request("new:avatar:view",a.get("userId"),f.extend(d,{model:b.request("new:user:entity",a.get("user"))}))},itemViewOptions:{idAttribute:"userId",size:"medium",color:b.Components.Avatar.borderColors.GREY,avatarMenu:b.Components.Avatar.avatarMenu.ON},collectionEvents:{"add remove reset":"updateFriendCnt",destroy:"render"},ui:{friendCnt:".kx-friend-count",friendList:".kx-friends-list",privsPanel:".kx-friend-privileges",privsBtn:".kx-friend-privileges"},events:{"click .kx-friend-privileges":"privsBtnClicked"},checkScrollPosition:function(){this.ui.friendList[0].scrollHeight-this.ui.friendList.innerHeight()===this.ui.friendList.scrollTop()&&this.trigger("fetch:more:friends")},onRender:function(){var a=this;this.ui.friendList.scroll(function(){a.checkScrollPosition()}),this.updateFriendCnt()},privsBtnClicked:function(){this.ui.privsPanel.toggleClass("kx-friend-privileges-edit-active")},updateFriendCnt:function(){var a=b.request("get:service:friends:count",this.options.id);a&&this.ui.friendCnt.show().html(a)},serializeData:function(){return{options:this.options}}})}),KXL.module("ProfileApp.UserInfo",function(a,b){a.Controller={getUserInfoView:function(c){var d;d=b.currentUser&&c===b.currentUser.id?b.currentUser:b.request("user:entity",c)._model;var e=new a.View({model:b.request("forumprofile:entity",c)._model,user:d});return e}}}),KXL.vent.on("forum:message:received",_.throttle(function(){$.ajax({url:"/api/updateForumLastSeen",type:"PATCH",contentType:"application/json"})},5e3)),KXL.module("ProfileApp.UserInfo",function(a,b,c,d){a.View=d.Layout.extend({template:"#home-user-info-template",className:"kx-profile-user-info",modelEvents:{change:"render"},events:{"click .kx-avatar-edit":"editUserSettings","click .kx-forum-profile-posts":"goToPosts","click .kx-forum-profile-replies":"goToReplies"},goToPosts:function(){b.execute("forum:show","profile/"+this.options.user.id+"/discussions")},goToReplies:function(){b.execute("forum:show","profile/"+this.options.user.id+"/comments")},initialize:function(){var a=this,c=this.options.user;this.listenTo(c,"change",this.render),b.currentUser&&(this.friendsCollection=b.request("current:user:friend:entities")._collection,this.listenTo(this.friendsCollection,"add remove reset",function(){a.checkFriend(c.id)}),this.friend=this.friendsCollection.get(c.id))},regions:{avatar:".kx-profile-user-info-avatar",avatartBtnEditRegion:".kx-edit-btn-region",msgBtnRegion:".kx-msg-btn-region",chatBtnRegion:".kx-chat-btn-region",removeFriendBtnRegion:".kx-remove-friend-btn-region"},checkFriend:function(a){var b=this.friendsCollection.get(a);b!==this.friend&&(this.friend=b,this.render())},onRender:function(){var a=this,c=b.request("new:avatar:view",this.options.user.id,{size:"large",model:this.options.user,color:b.Components.Avatar.borderColors.NONE});if(this.avatar.show(c),b.currentUser.id===this.options.user.id){var d=new b.Components.Button.View({label:b.i18n.t("home.user.edit"),theme:b.Components.Button.Themes.alt3,customClass:"kx-avatar-edit"});this.avatartBtnEditRegion.show(d)}if(this.options.user.get("username")){var e=new b.Components.Button.View({label:b.i18n.t("home.user.chat"),theme:b.Components.Button.Themes.alt11});this.listenTo(e,"click",function(){b.request("auth:register:deferred:gate",{referrer:"profile-user-info-chat"})||b.execute("chat:start:private",a.options.user.id)}),this.chatBtnRegion.show(e)}if(this.friend){var f=new b.Components.Button.View({label:b.i18n.t("home.user.removefriend"),theme:b.Components.Button.Themes.alt11});this.listenTo(f,"click",function(){var c=b.request("show:confirm:dialog",{title:b.i18n.t("home.user.removefriend.dialog.label",{friendUserName:a.options.user.get("username")}),confirmButtonOptions:{label:b.i18n.t("home.user.removefriend.dialog.defriend")}});a.listenToOnce(c,"confirm:clicked",function(){c.trigger("start:loading"),b.request("is:user:ignored",this.options.user.id)||b.request("current:user:remove:friend",this.options.user.id),b.dialogRegion.close()})}),this.removeFriendBtnRegion.ensureEl(),this.removeFriendBtnRegion.$el.removeClass("kx-hidden"),this.removeFriendBtnRegion.show(f)}},serializeData:function(){var a=(this.options.user.id!==b.currentUser.id,!!this.options.user.get("username")&&this.options.user.id!==b.currentUser.id),c=this.options.user.has("lastSeen")&&b.Common.Utils.DateUtils.fuzzytime(1e3*this.options.user.get("lastSeen")),d=this.options.user.has("created")&&b.Common.Utils.DateUtils.fuzzytime(1e3*this.options.user.get("created"));return{buttonsEnabled:a,username:this.options.user.get("username"),haveTimestamps:!(!c||!d),createdAt:d,lastSeen:c,forumProfile:this.model.toJSON()}},editUserSettings:function(){b.request("auth:register:deferred:gate",{referrer:"profile-avatar-edit"})||b.execute("settings:show")}})}),KXL.module("ProfileApp.LatestPosts",function(a,b,c,d,e,f){a.Controller={getLatestPostsView:function(d){function e(){i&&i.selected&&j.latestPosts.show(new a.ForumPosts({collection:b.request("forumposts:entities",{titleId:i.selected.get("forumTitleId")})._collection}))}function g(a){var c=b.games.get(a);c&&(c=i.findWhere({urlName:c.get("urlName")}),c&&i.select(c))}var h=f.extend({},d),i=f.extend(b.staticGames,new c.PickThis.SingleSelect(b.staticGames,f.uniqueId("latest:posts:game:selector:games"))),j=new a.View,k=b.request("new:game:selector:view",{collection:i,defaultGameId:h.defaultGameId});return h.defaultGameId&&g(h.defaultGameId),j.on("show",function(){j.gameSwitcher.show(k),j.listenTo(i,"select:one",function(){e()}),e()}),b.vent.on("gamestats:game:selected",function(a){g(a)}),j}}}),KXL.module("ProfileApp.LatestPosts",function(a,b,c,d){a.View=d.Layout.extend({template:Templates["profile/latest_posts/home-latest-posts"],className:"kx-latest-posts",regions:{gameSwitcher:".kx-game-selector-region",latestPosts:".kx-latest-posts-list-region"}}),a.ForumPostItem=d.Layout.extend({template:Templates["profile/latest_posts/_home-latest-posts-item"],tagName:"li",regions:{avatar:".kx-avatar"},events:{"click .kx-post-title":"postTitleClicked"},postTitleClicked:function(){b.execute("forum:show","discussion/"+this.model.id)},onRender:function(){this.avatar.show(b.request("new:avatar:view",this.model.get("userId"),{model:new b.Entities.User({id:this.model.get("userId"),username:this.model.get("username")}),size:"medium",avatarMenu:b.currentUser?b.Components.Avatar.avatarMenu.ON:b.Components.Avatar.avatarMenu.OFF,color:"grey"}))},serializeData:function(){return{forumPost:this.model.toJSON(),postedDate:b.Common.Utils.DateUtils.fuzzytime(this.model.get("postedDate"))}}}),a.ForumPosts=d.CollectionView.extend({itemViewContainer:".kx-latest-posts-list-region",tagName:"ul",className:"kx-latest-posts-list",itemView:a.ForumPostItem,modelEvents:{change:"render"}})}),KXL.module("HomeApp.Carousel",function(a,b,c,d,e,f){a.CarouselConfig=b.Entities.Model.extend({defaults:{commonName:null,images:[],summary:null,href:null,playButtonLabel:null,playButtonTheme:null,showAppStoreButtons:null}}),a.CarouselConfigCollection=b.Entities.Collection.extend({model:a.CarouselConfig}),a.Controller={getCarousel:function(d,e){function g(a,b){var c=a;if(c){var d=new PxLoader,e=c.get("images");f.each(e,function(a){d.addImage(a)}),d.addCompletionListener(function(){b&&b()}),d.start()}else b&&b()}function h(){k&&(clearTimeout(k),k=null)}function i(){var a=d.indexOf(d.selected),b=d.at(a+1);b||(b=d.at(0)),b&&g(b,function(){b.select(),h(),k=f.delay(i,l)})}function j(){k||(k=f.delay(i,l))}f.extend(d,new c.Picky.SingleSelect(d));var k,l=6e3;e&&e.on("pager:item:clicked",function(){h()});var m=new a.View({collection:d});return m.on("start:requested",function(){j()}),m.on("stop:requested",function(){h()}),m.on("before:close",function(){h()}),m.on("render",function(){var a=d.first();a&&a.select(),d.length>1&&j()}),m.on("carousel:item:moused:over:content",function(){h()}),m.on("carousel:item:moused:out:content",function(){j()}),m.on("carousel:item:play:clicked",function(a){var c=a.model.get("commonName");switch(c){case"vc":b.execute(b.currentUser?"game:play:load":"auto:register",a.model.get("urlName"));break;case"tome":b.execute("game:navigate:steam","tomeimmortalarena");break;default:b.execute("game:show",a.model.get("urlName"),"home")}}),d.on("selected",function(a){function b(){g(a,function(){e.animateIn(),m.trigger("item:changed",a)})}var c=d.selected,e=m.children.findByModel(a);if(c){var f=m.children.findByModel(c);f&&f.animateOut(function(){b()})}else b()}),m}}}),KXL.module("HomeApp.Carousel",function(a,b,c,d,e,f){a.CarouselItem=d.Layout.extend({template:"#_carousel-item-template",className:function(){return"kx-carousel-item "+this.model.get("commonName")},carouselTimeline:null,DEFAULT_ANIMATION_DURATION:.85,regions:{playBtnRegion:".kx-carousel-item-btn-play-region",getNotifiedRegion:".kx-carousel-item-get-notified-region"},ui:{background:".kx-carousel-item-background",content:".kx-carousel-item-content"},triggers:{"mouseover .kx-carousel-item-content":"moused:over:content","mouseout .kx-carousel-item-content":"moused:out:content","click .kx-carousel-item-btn-play":"play:clicked","click .kx-carousel-item-anchor-play":"play:clicked"},initialize:function(a){this.options=f.defaults(a||{},{animationDuration:this.DEFAULT_ANIMATION_DURATION})},onRender:function(){var a=this;if(this.$el.hide(),this.playBtnRegion.show(new b.Components.Button.View({customClass:"kx-carousel-item-btn-play",label:a.model.get("playButtonLabel"),theme:a.model.get("playButtonTheme")})),this.model.get("showAppStoreButtons")){var c=b.staticGames.findWhere({commonName:this.model.get("commonName")});c&&b.asyncRequest("async:load:module","game/get_notified").then(function(){b.request("get:notified:new:view",{showPlayButtonInAppRegion:!1,storeBtnPreText:"",showPlayButton:!1,appleStoreBtnHref:c.get("appleStoreHref"),showAppleStoreBtn:!0,googleStoreBtnHref:c.get("googleStoreHref"),showGoogleStoreBtn:!0,steamStoreBtnHref:c.get("steamStoreHref"),showSteamStoreBtn:!0,email:b.currentUser?b.currentUser.get("email"):"",country:b.currentUser?b.currentUser.get("location"):"",gameUrlName:"vegaconflict",showNotifyBySMS:!1,showGetNotifiedForm:!1,finePrint:""}).done(function(b){a.getNotifiedRegion.show(b)})})}this.carouselTimeline=new TimelineLite({onStart:function(){a.$el.show()}}),this.ui.background.css("background-image","url("+this.model.get("background")+")"),this.carouselTimeline.add(TweenLite.fromTo(this.ui.background,this.options.animationDuration,{opacity:0,ease:this.easingStyle},{opacity:1,ease:"Power2.easeInOut",clearProps:"transform"})),this.carouselTimeline.add(TweenLite.fromTo(this.ui.content,this.options.animationDuration,{opacity:0,ease:this.easingStyle},{opacity:1,ease:"Power2.easeInOut",clearProps:"transform"}),"-=.85"),this.carouselTimeline.pause()},animateIn:function(){this.carouselTimeline.play()},animateOut:function(a){var b=this;b.carouselTimeline.eventCallback("onReverseComplete",null),b.carouselTimeline.reversed()?(b.$el.hide(),a&&a()):(b.carouselTimeline.eventCallback("onReverseComplete",function(){b.$el.hide(),a&&a()}),b.carouselTimeline.reverse())},serializeData:function(){return{item:this.model.toJSON()}}}),a.View=d.CollectionView.extend({itemView:a.CarouselItem,className:"kx-carousel",itemViewEventPrefix:"carousel:item",start:function(){this.trigger("start:requested")},stop:function(){this.trigger("stop:requested")},setSelectedItemByGameCommonName:function(a){var b=this.collection.findWhere({commonName:a});b&&b.select()}})}),KXL.module("HomeApp.Games",function(a,b,c,d,e,f){a.Game=d.ItemView.extend({template:"#_game-pile-item-template",tagName:"li",className:function(){var a=["kx-game-pile-item","kx-game-pile-"+this.model.get("commonName")];return(this.model.get("isMobile")||this.model.get("supportsMobile"))&&a.push("kx-mobile"),a.join(" ")},triggers:{click:"game:clicked"}}),a.View=d.CollectionView.extend({itemView:a.Game,tagName:"ul",itemViewEventPrefix:"game:pile:item",className:"kx-game-pile kx-clearfix"}),a.IconView=d.ItemView.extend({template:"#game-icon-template",tagName:"div",className:"kx-game-icon-avatar-wrapper",events:{click:"onClicked"},ui:{img:"img"},templateHelpers:function(){var a=this;return{size:function(){return a.options.size}}},onClicked:function(){b.execute("game:show",this.model.get("urlName"))},initialize:function(a){var b={size:"small"};this.options=f.defaults(a.options||{},b)}})}),KXL.module("HomeApp.Games",function(a,b,c,d,e,f){a.Controller={getGamesView:function(c){var d=new a.View({collection:c});return d.on("game:pile:item:game:clicked",function(a){b.execute("game:show",a.model.get("urlName"),"home")}),d},getLogoView:function(c,d){var e={size:"small"};d=f.defaults(d||{},e);var g=b.games.get(c),h=new a.IconView({model:g,options:d});return h}}}),KXL.module("HomeApp.Home",function(a,b,c,d){var e=d.Controller.extend({layout:null,showHome:function(c){var d=this;b.currentUser||this.layout&&!c?b.homeRegion.currentView||b.homeRegion.show(this.layout):(this.layout=new a.LoggedOutLayout,this.layout.on("show",function(){d.showStaticGames(),d.showForumPosts(),d.showCarousel(),b.animate.pageIn("home"),d.showSignUp()}),b.homeRegion.show(this.layout),this.layout.listenTo(b.vent,"auth:changed",function(){b.currentUser&&(b.homeRegion.close(),d.layout=null)}))},showCarousel:function(){var a="fr_FR"===b.config.locale?b.Components.Button.Themes.alt7:b.Components.Button.Themes.alt14,c=new b.HomeApp.Carousel.CarouselConfigCollection([{commonName:"vc",background:b.config.STATIC_BASE_URL+"/modules/home/carousel/images/vc/background.jpg",images:[b.config.STATIC_BASE_URL+"/modules/home/carousel/images/vc/background.jpg",b.config.STATIC_BASE_URL+"/modules/home/carousel/images/vc/logo.png"],href:"game/vegaconflict",urlName:"vegaconflict",playButtonLabel:b.i18n.t("home.game.vc.playBtnLabel"),playButtonTheme:a,showAppStoreButtons:!0},{commonName:"wcra",background:b.config.STATIC_BASE_URL+"/modules/home/carousel/images/wcra/background.jpg",images:[b.config.STATIC_BASE_URL+"/modules/home/carousel/images/wcra/background.jpg",b.config.STATIC_BASE_URL+"/modules/home/carousel/images/wcra/logo.png",b.config.STATIC_BASE_URL+"/modules/home/carousel/images/wcra/button.png"],href:"game/warcommanderrogueassault",urlName:"warcommanderrogueassault"},{commonName:"bp",background:b.config.STATIC_BASE_URL+"/modules/home/carousel/images/bp/background.jpg",images:[b.config.STATIC_BASE_URL+"/modules/home/carousel/images/bp/background.jpg",b.config.STATIC_BASE_URL+"/modules/home/carousel/images/bp/logo.png",b.config.STATIC_BASE_URL+"/modules/home/carousel/images/bp/button.png"],summary:b.i18n.t("home.game.bp.summary"),href:"game/battlepirates",urlName:"battlepirates"},{commonName:"wc",background:b.config.STATIC_BASE_URL+"/modules/home/carousel/images/wc/background.jpg",images:[b.config.STATIC_BASE_URL+"/modules/home/carousel/images/wc/background.jpg",b.config.STATIC_BASE_URL+"/modules/home/carousel/images/wc/logo.png",b.config.STATIC_BASE_URL+"/modules/home/carousel/images/wc/button.png"],summary:b.i18n.t("home.game.wc.summary"),href:"game/warcommander",urlName:"warcommander"},{commonName:"tome",background:b.config.STATIC_BASE_URL+"/modules/home/carousel/images/tome/background.jpg",images:[b.config.STATIC_BASE_URL+"/modules/home/carousel/images/tome/background.jpg",b.config.STATIC_BASE_URL+"/modules/home/carousel/images/tome/logo.png",b.config.STATIC_BASE_URL+"/modules/home/carousel/images/tome/button.png"],summary:b.i18n.t("home.game.tome.summary"),href:"game/tomeimmortalarena",urlName:"tomeimmortalarena"}]),d=b.request("new:pager:view",c);this.layout.pager.show(d);var e=b.HomeApp.Carousel.Controller.getCarousel(c,d);e.listenTo(b.vent,["dialog:opened","logged:out:chat:room:changed","logged:out:chat:interaction:started"].join(" "),function(){e.stop()}),e.listenTo(b.vent,["dialog:closed","logged:out:chat:interaction:completed"].join(" "),function(){e.start()}),e.listenTo(e,"item:changed",function(a){b.appModel.set("homePageCurrentGameCommonName",a.get("commonName"))}),e.listenTo(b.appModel,"change:homePageCurrentGameCommonName",function(a,b){e.setSelectedItemByGameCommonName(b)}),this.layout.carousel.show(e)},showStaticGames:function(){this.layout.staticGames.show(b.request("new:games:view",b.staticGames))},showForumPosts:function(){this.layout.latestPosts.show(b.request("new:contentpane:view",{contentView:b.request("new:forumposts:view",{curated:!0,limit:25})}))},showSignUp:function(){var a={trackControl:"widget",trackSource:"home"},c=b.request("new:inline:signup:form:view",{data:a,tooltipPos:"left"});this.listenTo(c,"register:submit",function(c){b.execute("show:register:dialog",{registration:c,step:b.AuthApp.RegisterSteps.CREATE_ACCOUNT,data:a})}),this.listenTo(c,"fb:api:authenticated",function(d){b.request("fblogin:submit",d,a).done(function(a,c){c&&b.execute("show:register:dialog",{step:b.AuthApp.RegisterSteps.IMPORT_FB_FRIENDS,fbAccessToken:d,isNew:c})}).fail(function(a){c.setErrorMsg(a instanceof b.Errors.EmailConflictError?b.i18n.t("auth.loginEmailConflictError",{email:a.detail.email}):a instanceof b.Errors.IOvationBlockedError||a instanceof b.Errors.DeviceFingerprintError?a.message:b.i18n.t("auth.registrationFailed"))})}),c.listenTo(b,"google:api:authenticated",function(d){b.request("googlelogin:submit",d,a).done(function(a,c,e){c&&(e?b.execute("show:register:dialog",{step:b.AuthApp.RegisterSteps.IMPORT_FB_GAMES_PROMPT,googleAccessToken:d,isNew:c}):b.execute("show:register:dialog",{step:b.AuthApp.RegisterSteps.IMPORT_FB_GAMES_PROMPT,googleAccessToken:d,isNew:c}))}).fail(function(a){c.setErrorMsg(a instanceof b.Errors.EmailConflictError?b.i18n.t("auth.loginEmailConflictError",{email:a.detail.email}):a instanceof b.Errors.IOvationBlockedError||a instanceof b.Errors.DeviceFingerprintError?a.message:b.i18n.t("auth.registrationFailed"))})}),this.listenTo(c,"steam:api:authenticated",function(a){a.fail(function(a){var d;switch(a){case"FAILED_FRAUD_CHECK":d=(new b.Errors.IOvationBlockedError).message;break;case"NO_DEVICE_FINGERPRINT":d=(new b.Errors.DeviceFingerprintError).message;break;default:d=b.i18n.t("auth.registrationFailed")}c.setErrorMsg(d)})}),this.layout.signup.show(c)}});a.Controller=new e}),KXL.module("HomeApp.Home",function(a,b){a.LoggedOutLayout=b.Components.Layout.extend({template:Templates["home/home-logged-out"],className:"kx-home-logged-out",regions:{carousel:".kx-home-masthead",pager:".kx-home-pager",signup:".kx-home-game-signup",staticGames:".kx-home-static-games",latestPosts:".kx-home-latest-posts"}})}),KXL.module("HomeApp",function(a,b,c,d){a.Router=d.AppRouter.extend({appRoutes:{"":"showHome",home:"showHome"}});var e={showHome:function(c){b.navigate("/"),b.currentUser?b.execute("profile:show",b.currentUser.id):(b.execute("page:show","home"),a.Home.Controller.showHome(c))},getGamesView:function(){return a.Games.Controller.getGamesView(b.staticGames)},getForumPostsView:function(a){return b.Components.ForumPosts.Controller.getForumPostsView(a)}};b.addInitializer(function(){new a.Router({controller:e})}),b.commands.setHandlers({"home:show":function(a){e.showHome(a)}}),b.reqres.setHandlers({"new:games:view":function(a){return e.getGamesView(a)},"new:forumposts:view":function(a){return e.getForumPostsView(a)}})}),KXL.module("GamesApp.Nav",function(a,b,c,d,e,f){var g=b.Entities.SingleSelectCollection.extend({model:b.Entities.Model});a.Controller={getNavView:function(c,d){function h(a){"logo"===a&&(a="home");var b=n.findWhere({id:a});b&&b.select()}function i(){var c=new a.View({collection:n,model:j});return c.on("set:active:section",function(a){h(a)}),c.on("nav:item:clicked",function(a){var c=a.model.id,d=a.model.get("url"),e=this.model.id;switch(c){case"guardians":case"blog":case"items":case"lore":case"leaderboards":case"home":b.execute("game:show",e,c);break;case"guide":b.asyncRequest("async:load:module","guide").then(function(){b.execute("guide:show",e)});break;case"strategy":case"forum":b.execute("forum:show",d);break;case"support":window.open(d);break;case"play":var g=b.context&&b.context.get("commonName");b.request("auth:is:temp:user")&&!f.has(b.config.autoRegCommonNames,g)?b.execute("auth:register:deferred:show",{referrer:e+"-play"}):b.currentUser?b.execute("game:play:load",e):b.execute("game:show",e,"home");break;case"logo":c="home",b.execute("game:show",e,c);break;default:d&&b.navigate(d,{trigger:!0,target:"tomebetacode"})}h(c)}),c.listenTo(b.vent,"beta:code:success",function(){b.asyncRequest("game:is:user:allowed").then(function(a){a&&n.remove(n.filter(function(a){return a.get("hideWithBetaAccess")}))})}),c}var j,k,l=c.get("commonName"),m={id:"logo",subnavText:"",subnavClassName:"kx-game-nav-item-logo"};if(l&&(j=b.staticGames.findWhere({commonName:c.get("commonName")}),j&&!j.get("hideSubnav"))){k=j.get("subMenuItems"),m.backgroundImage=j.get("subnavLogo")||"",m.url="/game/".concat(j.get("urlName"),"/home"),k.splice(Math.floor(k.length/2),0,m);var n=new g(k);if(d&&h(d),b.config.SHOW_GAMES&&b.currentUser||n.remove(n.get("play")),b.context.get("inviteOnly")){var o=e.Deferred();return b.asyncRequest("game:is:user:allowed").then(function(a){a&&n.remove(n.filter(function(a){return a.get("hideWithBetaAccess")})),o.resolve(i())}),o.promise()}return n.remove(n.filter(function(a){return a.get("requireBetaMode")})),e.Deferred().resolve(i()).promise()}}}}),KXL.module("GamesApp.Nav",function(a,b,c,d){a.NavItem=d.ItemView.extend({triggers:{click:"clicked"},modelEvents:{selected:function(){this.$el.addClass("kx-active")},deselected:function(){this.$el.removeClass("kx-active")}},onRender:function(){this.model.selected&&this.$el.addClass("kx-active")},getTemplate:function(){return"logo"===this.model.id?"#_game-nav-image-item-template":"#_game-nav-item-template"},className:function(){var a=["kx-game-nav-item",this.model.get("id")],b=this.model.get("subnavClassName")||"";return b&&a.push(b),a.join(" ")}}),a.View=d.CompositeView.extend({itemViewEventPrefix:"nav:item",template:"#game-nav-template",itemViewContainer:".kx-game-nav-inner",itemView:a.NavItem,className:function(){return this.model.get("commonName")},setActiveSection:function(a){this.trigger("set:active:section",a)}})}),KXL.module("GamesApp.Game",function(a,b,c,d,e,f){var g={bp:"battlepirates",wc:"warcommander",vc:"vegaconflict",wcra:"warcommanderrogueassault"},h=function(a){var d=new c.Collection([{commonName:"bp",headline:b.i18n.t("games.bp.headline"),summary:b.i18n.t("games.bp.summary"),points:"<ul><li>"+b.i18n.t("games.bp.points1")+"</li><li>"+b.i18n.t("games.bp.points2")+"</li><li>"+b.i18n.t("games.bp.points3")+"</li><li>"+b.i18n.t("games.bp.points4")+"</li><li>"+b.i18n.t("games.bp.points5")+"</li></ul>",numImages:6},{commonName:"wc",headline:b.i18n.t("games.wc.headline"),summary:b.i18n.t("games.wc.summary"),points:"<ul><li>"+b.i18n.t("games.wc.points1")+"</li><li>"+b.i18n.t("games.wc.points2")+"</li><li>"+b.i18n.t("games.wc.points3")+"</li><li>"+b.i18n.t("games.wc.points4")+"</li><li>"+b.i18n.t("games.wc.points5")+"</li></ul>",numImages:6},{commonName:"vc",headline:b.i18n.t("games.vc.headline"),summary:b.i18n.t("games.vc.summary"),points:"<ul><li>"+b.i18n.t("games.vc.points1")+"</li><li>"+b.i18n.t("games.vc.points2")+"</li><li>"+b.i18n.t("games.vc.points3")+"</li><li>"+b.i18n.t("games.vc.points4")+"</li><li>"+b.i18n.t("games.vc.points5")+"</li></ul>",numImages:4},{commonName:"wcra",headline:b.i18n.t("games.wcra.headline"),points:"<ul><li>"+b.i18n.t("games.wcra.points1")+"</li><li>"+b.i18n.t("games.wcra.points2")+"</li><li>"+b.i18n.t("games.wcra.points3")+"</li></ul>",numImages:5}]);
return d.findWhere({commonName:a})},i=function(a,c){var d=g[a],e=h(a),f=[];c&&f.push({type:"video",imgIconPath:b.config.STATIC_BASE_URL+"/modules/game/images/"+d+"/game_gallery/thumb_video.jpg",imgPath:null,imgLargePath:null});for(var i=1;i<=e.get("numImages");i++)f.push({type:"image",imgIconPath:b.config.STATIC_BASE_URL+"/modules/game/images/"+d+"/game_gallery/thumb_"+i+".jpg",imgPath:b.config.STATIC_BASE_URL+"/modules/game/images/"+d+"/game_gallery/preview_"+i+".jpg",imgLargePath:b.config.STATIC_BASE_URL+"/modules/game/images/"+d+"/game_gallery/large_"+i+".jpg"});return f},j=function(a){var d=!1;if(a.has("unsupportedBrowsers")){var e=new c.Collection(a.get("unsupportedBrowsers"));e.each(function(a){a.get("name")===b.config.browser.name&&(a.has("maxVersionSupported")||a.has("minVersionSupported")||(d=!0),a.has("maxVersionSupported")&&parseFloat(b.config.browser.version)>a.get("maxVersionSupported")&&(d=!0),a.has("minVersionSupported")&&parseFloat(b.config.browser.version)<a.get("minVersionSupported")&&(d=!0))})}return d},k=d.Controller.extend({pageLayout:null,homeLayout:null,leaderboardLayout:null,currentSection:null,homePageLoaded:!1,xFrameMessager:null,signupFormOptions:null,reset:function(){b.gameRegion&&b.gameRegion.close(),this.pageLayout=null},showGuide:function(a,c,d){b.asyncRequest("async:load:module","guide").then(function(){b.execute("guide:show",a.get("urlName"),d)})},showGame:function(c,d,g){function h(){q&&(i.nav&&i.nav.setActiveSection(d),i.currentSection&&i.pageLayout[i.currentSection]?(i.pageLayout[i.currentSection].ensureEl(),i.pageLayout[i.currentSection].$el.hide()):i.currentSection&&i.pageLayout.regions[i.currentSection]&&(i.pageLayout.regions[i.currentSection].ensureEl(),i.pageLayout.regions[i.currentSection].$el.hide()),i.currentSection=d,i.pageLayout[d].ensureEl(),i.pageLayout[d].$el.show(),b.vent.trigger("section:changed"))}var i=this,j=f.extend({},g),k="home",l=["home","play","blog","lore","items","guardians","guide","strategy","forum","support"],m=l,n=b.mobileGames.findWhere({commonName:c.get("commonName")}),o=c.get("commonName");j.hasOwnProperty("signupFormOptions")&&(this.signupFormOptions=j.signupFormOptions),b.currentUser||(m=f.without(m,"play"));var p=f.contains(m,d);if(!d||!p){if(b.currentUser&&!n)return void this.playGame(c,d,g);d=k}var q=i.currentSection!==d;switch(this.pageLayout&&b.gameRegion.currentView&&i.pageLayout.nav?h():(i.homePageLoaded=!1,i.pageLayout=new a.Layout({model:c}),i.pageLayout.on("show",function(){b.asyncRequest("new:nav:view",c,d).then(function(a){i.nav=a,i.nav&&i.pageLayout.nav.show(i.nav),h()})}),b.gameRegion.show(i.pageLayout)),d){case"home":if(e("body").removeClass("kx-organic-home"),i.showNavRegion(),b.execute("footer:show"),b.execute("playersonline:show"),!b.currentUser&&f.has(b.config.autoRegCommonNames,o)){var r=b.config.autoRegCommonNames[o].organicHome;r&&e("body").addClass("kx-organic-home");var s=b.config.autoRegCommonNames[o].displayNav;s||i.hideNavRegion()}"tome"===c.get("commonName")?i.showTomeHome():("wcra"===c.get("commonName")&&i.hideNavRegion(),i.homePageLoaded||(i.homePageLoaded=!0,i.showHome(c)));break;case"guardians":i.showNavRegion(),b.execute("footer:show"),b.execute("playersonline:show"),i.showGuardians(g.path);break;case"blog":i.showNavRegion(),b.execute("footer:show"),b.execute("playersonline:show"),i.showBlog(c,g);break;case"lore":i.showNavRegion(),b.execute("footer:show"),b.execute("playersonline:show"),i.showLore(g);break;case"items":i.showNavRegion(),b.execute("footer:show"),b.execute("playersonline:show"),i.showItems(g);break;case"guide":i.showNavRegion(),b.execute("footer:show"),b.execute("playersonline:show"),i.showGuide(c,g.guide,g.path)}b.execute("page:show","game")},playGame:function(a,c,f){var g=this,h=b.staticGames.get(a.get("urlName"));if(g.xFrameMessager||(g.xFrameMessager=new XFrameMessager,b.atom.set("game:xframe:ready",!0)),g.showHeader(),h&&j(h)){var i=b.request("new:play:message:unsupported:view",{logo:h.get("lrgLogo"),message:b.i18n.t("games.unsupported.message."+h.get("urlName"))});return b.playRegion.show(i),void b.execute("page:show","play")}a===b.context&&b.request("user:playing")?(b.execute("page:show","play"),b.atom.set("game:isopen",!0)):b.asyncRequest("get:game:iframe:url",a.get("urlName"),{path:c,queryParams:f}).then(function(c){if(c.length>0){var f=d.ItemView.extend({template:function(){return""}}),h=e("#kx-body-veil");b.playRegion.show(new f({className:"tomeimmortalarena"===a.get("urlName")?"game-iframe-wrapper game-iframe-wrapper-tome":"game-iframe-wrapper",id:"game-iframe-wrapper"})),b.execute("page:show","play"),h&&h.hasClass("kx-loader-veil")&&(h.hide(),h.removeClass("kx-loader-veil")),b.atom.set("game:isopen",!0),b.vent.trigger("info:game:load",a.get("urlName")),g.xFrameMessager.start("game-iframe-wrapper",c)}else b.execute("game:show",a.get("urlName"),"home")})},showLeaderboard:function(a){var c=e.Deferred();if(b.currentUser){var d=new b.Common.Views.ContentWithNav;b.asyncRequest("async:load:module","game/leaderboards").then(function(){d.on("show",function(){b.asyncRequest("new:nav:view",a,"leaderboards").then(function(a){d.navRegion.show(a),c.resolve()}),d.contentRegion.show(b.request("leaderboards:get:view",{stickyHeader:!0}))}),b.execute("page:show","leaderboard"),b.leaderboardRegion.show(d)})}else this.showHome(a),c.resolve();return c.promise()},showSteamLeaderboard:function(){var a=e.Deferred();if(b.currentUser){var c=new b.Common.Views.ContentWithNav;b.asyncRequest("async:load:module","game/leaderboards").then(function(){c.on("show",function(){c.contentRegion.show(b.request("leaderboards:get:view",{noShare:!0,stickyHeader:!1,noFriends:!0})),a.resolve()}),b.execute("page:show","leaderboard"),b.leaderboardRegion.show(c)})}else window.location="/game/tomeimmortalarena/home";return a.promise()},showGuardians:function(a){var c=this;b.asyncRequest("async:load:module","game/tome").then(function(){c.pageLayout.guardians.show(a?b.TomeApp.Controller.showGuardian(a):b.TomeApp.Controller.showGuardian())})},showBlog:function(a,c){function d(a){e.pageLayout.blog.show(a),a.on("blog:article:open",function(a){a&&a.model&&(e.pageLayout.blog.show(new b.Components.Loader.View),b.navigate("/game/tomeimmortalarena/blog/"+a.model.get("slug")),b.asyncRequest("async:load:module","common/components/blog").then(function(){b.asyncRequest("get:blog:index",f.extend(c,{article:a.model})).then(function(a){d(a)})}))})}var e=this;c||(c={}),c.stickyTags||(c.stickyTags=[]),c.stickyTags.push(a.get("commonName")),c.stickyTags.push(b.config.locale),c.path&&(c.slug=c.path),c.largeArticleFirst=!0,e.pageLayout.blog.show(new b.Components.Loader.View),b.asyncRequest("async:load:module","common/components/blog").then(function(){b.asyncRequest("get:blog:index",c).then(function(a){d(a)})})},showLore:function(a){this.pageLayout.lore.show(new b.TomeApp.Views.LoreLayout(a))},showItems:function(a){this.pageLayout.items.show(new b.TomeApp.Views.ItemsLayout(a))},showVideo:function(a){this.homeLayout.video.show(b.request("new:contentpane:view",{headingText:b.i18n.t("games.trailer"),contentView:b.request("new:video:view",{youTubeVideoId:a.get("youTubeVideoId"),autoPlay:1,muted:!0})}))},showGameProfile:function(a,c){var d=b.request("current:user:game:entities"),e=d.get(c);this.homeLayout.profile.show(b.request("new:contentpane:view",{headingText:b.i18n.t("games.profile"),topView:b.request("new:gameprofileheader:view",e),contentView:b.request("new:gameprofile:view",e)}))},showGameSiteContent:function(a){var c=this,d=[],e=b.request("get:game:site-contents",a.id);e.done(function(e){function f(){return-1!==d.indexOf(a.get("commonName"))}c.homeLayout.background.show(b.request("new:backgroundcms:view",{backgroundImageUrl:e.gameBackgroundImageUrl})),f()?b.asyncRequest("async:load:module","game/get_notified").then(function(){c.homeLayout.masthead.show(b.request("get:notified:new:cta:view",{caption:b.i18n.t("games.vega.getnotified.ctaView.caption")}))}):c.homeLayout.masthead.show(b.request("new:masthead:view",{bannerClickUrl:e.gameBannerClickUrl,bannerImageUrl:e.gameBannerImageUrl})),c.homeLayout.mediaScreenshot.show(b.request("new:contentpane:view",{headingText:b.i18n.t("games.media"),contentView:b.request("new:gamemediapreview:view",b.request("mediapreview:entity",{previewThumbSrc:e.gameScreenshotThumbUrl,previewSrc:e.gameScreenshotUrl,caption:b.i18n.t("games.media.preview.screenshotOfTheDay"),type:"image"}))})),c.homeLayout.mediaVideo.show(b.request("new:contentpane:view",{contentView:b.request("new:gamemediapreview:view",b.request("mediapreview:entity",{previewThumbSrc:e.gameVideoThumbUrl,previewSrc:e.gameVideoYoutubeUrl,caption:b.i18n.t("games.media.preview.videoOfTheDay"),type:"video",customClass:"youtube-game-contents"}))}))})},showAlliance:function(a){var c=this,d=b.request("usergame:entity",b.currentUser.id,a.get("id"));d.done(function(){d._model.get("allianceId")&&c.homeLayout.alliance.show(b.request("new:contentpane:view",{headingText:b.i18n.t("games.alliance"),contentView:b.request("new:alliance:view",a.get("id"),d._model.get("allianceId"))}))})},showScreenShots:function(a){var c="wcra"===a.get("commonName")?"":b.i18n.t("games.screenshots"),d=b.request("new:contentpane:view",{headingText:c}),e=this;b.asyncRequest("async:load:module","common/components/slider").then(function(){e.homeLayout.screenshots.show(d),d.setContentView(b.request("new:gallery:view",i(a.get("commonName"),!1),a))})},showStory:function(a){var c=a.get("commonName"),d=h(c),e="wcra"===c?"":b.i18n.t("games.info"),f=b.request("new:contentpane:view",{headingText:e});this.homeLayout.story.show(f),f.setContentView(b.request("new:story:view",{model:d}))},setupWCRAMobileHomeLoggedOut:function(c){var d=this,e=["NZ","DK","NL","NO","ZA","SE","CH","CHE","?"],f=b.staticGames.findWhere({commonName:c.get("commonName")}),g=this.homeLayout=new a.HomeWCRAMobileLoggedOutLayout({appStoreLinkUrl:f.get("appleStoreHref")});g.on("show",function(){function a(){g.appstore.show(b.request("new:loader:view")),b.asyncRequest("async:load:module","game/get_notified").then(function(){b.request("get:notified:new:view",{gameUrlName:c.get("urlName"),showNotifyBySMS:!1}).done(function(a){g.appstore.show(a)})})}if(d.showGameSiteBackground(),e.length){var f=b.request("geo:location:entity");f.fetch().done(function(){var b=f.get("countryShortName");b&&-1!==e.indexOf(b)?g.toggleAppStoreItems(!0):a()}).fail(function(){a()})}else g.toggleAppStoreItems(!0);d.showScreenShots(c),d.showStory(c),b.animate.pageIn("gameloggedout")})},setupMobileHomeLoggedOut:function(a){var b=a.get("urlName");"warcommanderrogueassault"===b&&this.setupWCRAMobileHomeLoggedOut(a)},setupOrganicHomeLoggedOut:function(c){var d,e={lp:"d"};d="vc"===c.get("commonName")?new b.GamesApp.VegaConflict.Views.HomeVegaConflictLoggedOutLayout({game:c,queryParams:e.lp}):new a.HomeOrganicLoggedOutLayout({game:c,queryParams:e.lp}),this.homeLayout=new b.LandingPageApp.LandingPage.View({model:c}),this.homeLayout.$el.addClass(e.lp),d.$el.addClass(e.lp),d.$el.addClass(c.get("commonName")),this.homeLayout.on("show",function(){this.contentRegion.show(d)})},setupHomeLoggedOut:function(c){var d=this;this.homeLayout=new a.HomeLoggedOutLayout,this.homeLayout.on("show",function(){var a=c.get("urlName"),e=f.defaults({},d.signupFormOptions?d.signupFormOptions.trackingData:null,{trackControl:"widget",trackSource:a}),g=!0;d.signupFormOptions&&d.signupFormOptions.hasOwnProperty("captchaRequired")&&(g=d.signupFormOptions.captchaRequired);var h=b.request("new:inline:signup:form:view",{data:e});h.on("register:submit",function(c){b.execute("show:register:dialog",{registration:c,step:b.AuthApp.RegisterSteps.CREATE_ACCOUNT,contextGameUrlName:a,data:e,captchaRequired:g})}),h.on("fb:api:authenticated",function(a){b.request("fblogin:submit",a,e).done(function(d,e){e&&b.execute("show:register:dialog",{step:b.AuthApp.RegisterSteps.IMPORT_FB_FRIENDS,contextGameUrlName:c.get("urlName"),fbAccessToken:a,isNew:e})}).fail(function(a){h.setErrorMsg(a instanceof b.Errors.EmailConflictError?b.i18n.t("auth.loginEmailConflictError",{email:a.detail.email}):b.i18n.t("auth.registrationFailed"))})}),h.listenTo(b,"google:api:authenticated",function(a){b.request("googlelogin:submit",a,e).done(function(c,d,e){d&&(e?b.execute("show:register:dialog",{step:b.AuthApp.RegisterSteps.IMPORT_FB_GAMES_PROMPT,googleAccessToken:a,isNew:d}):b.execute("show:register:dialog",{step:b.AuthApp.RegisterSteps.IMPORT_FB_GAMES_PROMPT,googleAccessToken:a,isNew:d}))}).fail(function(a){h.setErrorMsg(a instanceof b.Errors.EmailConflictError?b.i18n.t("auth.loginEmailConflictError",{email:a.detail.email}):b.i18n.t("auth.registrationFailed"))})}),this.listenTo(h,"steam:api:authenticated",function(a){a.fail(function(a){var c;switch(a){case"FAILED_FRAUD_CHECK":c=(new b.Errors.IOvationBlockedError).message;break;case"NO_DEVICE_FINGERPRINT":c=(new b.Errors.DeviceFingerprintError).message;break;default:c=b.i18n.t("auth.registrationFailed")}h.setErrorMsg(c)})}),d.homeLayout.signUp.show(h),d.showVideo(c),d.showScreenShots(c),d.showStory(c),b.animate.pageIn("gameloggedout")})},showTomeHome:function(){var a=this,c=new b.TomeApp.Views.HomeLayout;b.asyncRequest("async:load:module","common/components/blog").then(function(){blogArticleList=b.request("get:blog:article:list",{stickyTags:["tome","home",b.config.locale]}),carousel=b.request("get:carousel",["tome"]),a.pageLayout.home.show(new b.Components.Loader.View),e.when(blogArticleList,carousel).done(function(d,e){c.on("render",function(){c.blogRegion.show(d),c.carouselRegion.show(e)}),a.pageLayout.home.show(c),d.on("blog:article:open",function(a){a&&a.model&&b.navigate("/game/tomeimmortalarena/blog/"+a.model.get("slug"),{trigger:!0})})})})},showHome:function(c){function d(){f.has(b.config.autoRegCommonNames,h)?"vc"===h?b.asyncRequest("async:load:module","game/vega_conflict").then(function(){g.setupOrganicHomeLoggedOut(c),g.pageLayout.home.show(g.homeLayout)}):(g.setupOrganicHomeLoggedOut(c),g.pageLayout.home.show(g.homeLayout)):(g.setupHomeLoggedOut(c),g.pageLayout.home.on("show",function(){g.showGameSiteBackground()}),g.pageLayout.home.show(g.homeLayout))}function e(){g.showGameSiteContent(c),g.homeLayout=new a.HomeLoggedInLayout,g.homeLayout.on("show",function(){g.showGameProfile(b.currentUser.id,c.id),g.homeLayout.leaderboard.show(b.request("new:contentpane:view",{headingText:b.i18n.t("games.leaderboard"),contentView:b.request("new:leaderboard:view",{userId:b.currentUser.id,gameId:c.id})})),g.homeLayout.latestPosts.show(b.request("new:contentpane:view",{headingText:b.i18n.t("games.latestPosts"),contentView:b.request("new:forumposts:view",{titleId:c.get("commonName")})})),g.homeLayout.battlelog.show(b.request("new:contentpane:view",{headingText:b.i18n.t("games.battleLog"),contentView:b.request("new:battlelog:view",b.currentUser.id,c.get("id"),c.get("commonName"))})),g.showAlliance(c),b.animate.pageIn("gameloggedin")}),g.pageLayout.home.show(g.homeLayout)}var g=this,h=c.get("commonName");if(b.mobileGames.get(c.id))this.setupMobileHomeLoggedOut(c),g.pageLayout.home.show(g.homeLayout);else if(b.currentUser){var i=b.request("usergame:entity",b.currentUser.id,c.get("id"));i.then(function(){e()}).fail(function(){"vc"===h?(d(),g.hideNavRegion()):(g.setupHomeLoggedOut(c),g.homeLayout.on("show",function(){g.showGameSiteBackground(),g.homeLayout.signUp.show(b.request("new:contentpane:view",{headingText:b.i18n.t("games.leaderboard"),contentView:b.request("new:leaderboard:view",{userId:b.currentUser.id,gameId:c.id})}))}),g.pageLayout.home.show(g.homeLayout))})}else d()},showGameSiteBackground:function(){this.homeLayout.background.show(b.request("new:background:view"))},hideNavRegion:function(){this.pageLayout.nav.ensureEl(),this.pageLayout.nav.$el.hide()},showNavRegion:function(){this.pageLayout.nav.ensureEl(),this.pageLayout.nav.$el.show()},hideHeader:function(){var a=b.headerRegion;a.ensureEl(),a.$el.is(":visible")&&a.$el.hide()},showHeader:function(){var a=b.headerRegion;a.ensureEl(),a.$el.is(":hidden")&&a.$el.show()}});a.Controller=new k,b.reqres.setHandlers({"get:game:gallery:item:data":function(a,b){return i(a,b)}}),b.atom.once("game:xframe:ready",function(){function c(b){a.Controller.xFrameMessager.emit("adyenBuyCredits",b),a.Controller.xFrameMessager.emit("kxlBuyCredits",b)}a.Controller.xFrameMessager.on("kxlRegistrationBegin",function(){if(b.currentUser){var a=b.currentUser.get("status");if("active"===a)return void b.vent.trigger("registration:complete:message");"temp"===a&&b.request("show:delayed:register:form:banner",{referrer:"game",referringGameUrlName:b.context&&b.context.get("urlName")})}}),b.vent.on("registration:failure:message",function(b){a.Controller.xFrameMessager.emit("kxlRegistrationFailed",b),a.Controller.xFrameMessager.emit("kxlPopupClose",{})}),b.vent.on("registration:complete:message",function(b){a.Controller.xFrameMessager.emit("kxlRegistrationComplete",b)}),a.Controller.xFrameMessager.on("sendgift",function(a,c,d){b.asyncRequest("async:load:module","gifting").then(function(){b.execute("show:gifting:dialog",c,d)})}),a.Controller.xFrameMessager.on("sendinvite",function(c,d){b.asyncRequest("async:load:module","invites").then(function(){b.execute("show:invites:dialog",d,a.Controller.xFrameMessager.emit.bind(a.Controller.xFrameMessager),"invitesent")})}),a.Controller.xFrameMessager.on("invitefriends",function(c,d){b.asyncRequest("async:load:module","invites").then(function(){b.execute("show:invites:dialog",d,a.Controller.xFrameMessager.emit.bind(a.Controller.xFrameMessager),"invitefriends")})}),a.Controller.xFrameMessager.on("openForumTab",function(a,c){var d=c&&c.path?c.path:null;b.execute("forum:show",d)}),a.Controller.xFrameMessager.on("openGuideTab",function(a,c){c&&c.guideName&&("battlepirates"===c.guideName?b.asyncRequest("async:load:module","guide").then(function(){b.execute("guide:show",c.guideName)}):b.asyncRequest("async:load:module","game/guide").then(function(){b.execute("oldGuide:show",c.guideName,"guide")}))}),a.Controller.xFrameMessager.on("displayLightbox",function(){}),a.Controller.xFrameMessager.on("adyenBuyCredits",function(a,c,d){b.vent.trigger("payment:start",a,c,d)}),a.Controller.xFrameMessager.on("kxlBuyCredits",function(a,c,d){b.vent.trigger("payment:start",a,c,d)}),a.Controller.xFrameMessager.on("gameEvent",function(a,c){b.vent.trigger("game:event",c)}),a.Controller.xFrameMessager.on("topupShown",function(a,c){b.vent.trigger("game:event:showtopup",c)}),a.Controller.xFrameMessager.on("clientLoadComplete",function(a,c){b.vent.trigger("game:event:clientloadcomplete",c)}),b.vent.on("payment:success",c),b.vent.on("payment:pending",c),b.vent.on("payment:cancelled",c),b.vent.on("payment:modal:closed",function(){a.Controller.xFrameMessager.emit("kxlPopupClose",{})}),b.vent.on("nav:overlay:open",function(){a.Controller.xFrameMessager.emit("hideFlashCallback","opened")}),b.vent.on("nav:overlay:closed",function(){a.Controller.xFrameMessager.emit("hideFlashCallback","closed")})})}),KXL.module("GamesApp.Game",function(a,b,c,d,e,f){a.GameSectionRegion=d.Region.extend({open:function(a){this.$el.hide(),this.$el.html(a.el),this.$el.show()}}),a.Layout=b.Components.Layout.extend({template:"#game-template",className:function(){return"kx-game "+this.model.get("commonName")},regions:{nav:".game-nav-region",leaderboards:a.GameSectionRegion.extend({el:".game-leaderboards-region"}),guardians:a.GameSectionRegion.extend({el:".game-guardians-region"}),blog:a.GameSectionRegion.extend({el:".game-blog-region"}),lore:a.GameSectionRegion.extend({el:".game-lore-region"}),items:a.GameSectionRegion.extend({el:".game-items-region"}),home:a.GameSectionRegion.extend({el:".game-home-region"}),guide:a.GameSectionRegion.extend({el:".game-guide-region"}),strategy:a.GameSectionRegion.extend({el:".game-strategy-region"}),forum:a.GameSectionRegion.extend({el:".game-forum-region"}),support:a.GameSectionRegion.extend({el:".game-support-region"}),play:a.GameSectionRegion.extend({el:".game-play-region"})}}),a.HomeMobileLoggedOutLayout=b.Components.Layout.extend({template:"#game-home-mobile-logged-out-template",className:"kx-game-home-mobile-logged-out",regions:{background:".game-background-region",video:".game-video-region",appstore:".game-mobile-appstore-region",story:".game-story-region",latestPosts:".game-latest-posts-region",screenshots:".game-screenshots-region"}}),a.HomeWCRAMobileLoggedOutLayout=b.Components.Layout.extend({template:"#game-home-wcra-mobile-logged-out-template",className:"kx-game-home-mobile-logged-out",regions:{background:".game-background-region",appstore:".game-mobile-appstore-region",story:".game-story-region",screenshots:".game-screenshots-region"},toggleAppStoreItems:function(a){this.$el.toggleClass("kx-available",a)},serializeData:function(){return{options:this.options}}}),a.HomeLoggedOutLayout=b.Components.Layout.extend({template:"#game-home-logged-out-template",className:"kx-game-home-logged-out",regions:{background:".game-background-region",video:".game-video-region",signUp:".game-signup-region",ticker:".game-ticker-region",story:".game-story-region",screenshots:".game-screenshots-region"}}),a.HomeLoggedInLayout=b.Components.Layout.extend({template:"#game-home-logged-in-template",className:"kx-game-home-logged-in",regions:{background:".game-background-region",profile:".game-profile-region",leaderboard:".game-leaderboard-region",latestPosts:".game-latest-posts-region",mediaScreenshot:".game-media-screenshot-region",mediaVideo:".game-media-video-region",battlelog:".game-battlelog-region",masthead:".game-masthead-region",alliance:".game-alliance-region"}}),a.HomeOrganicLoggedOutLayout=b.Components.Layout.extend({className:"kx-organic-logged-out-homepage",defaults:{showSignUpForm:!1,signupFormOptions:null,showGameLogoSection:!1},regions:{signUpRegion:".kx-inline-signup-region",videoRegion:".kx-video-region",playersOnlineRegion:".kx-players-online-region",mastheadPlayBtnRegion:".kx-masthead-play-button-region",screenshotsRegion:".kx-game-screenshots-region"},ui:{signUpSection:".kx-inline-signup-section",modalSignUpSection:".kx-modal-signup-section",gameLogoSection:".kx-game-logo-section"},events:{"click .kx-masthead-play-button-region":"topCtaClick","click .kx-play-button2-region":"bottomCtaClick","click .kx-login-now-cta":"loginHereClick","click .kx-login-now-bottom-cta":"loginHereClick","click .kx-tos-blurb span":"tosClicked"},initialize:function(a){this.options=opts=f.defaults({},a,this.defaults)},getTemplate:function(){return"#game-home-logged-out-template-"+this.options.game.get("urlName")},getSignUpFormOptions:function(){return{}},ctaClick:function(a,c){c.preventDefault();var d=b.context&&b.context.get("urlName");d&&b.execute("show:register:dialog",{step:b.AuthApp.RegisterSteps.IMPORT_FB_GAMES_PROMPT,startNowUrlName:d,registrationHeaderText:b.i18n.t("auth.autoStart.registrationHeaderText")}),b.vent.trigger("info:gameCTA:click",{cta:a,game:d||"unknowngame"})},topCtaClick:function(a){this.ctaClick("top",a)},bottomCtaClick:function(a){this.ctaClick("bottom",a)},loginHereClick:function(){var a=b.context&&b.context.get("urlName"),c={};a&&(c.loginUrlName=a),b.execute("show:login:dialog",c)},_showMediaSlider:function(){function a(a){for(var c=[],d=1;4>=d;d++)c.push({type:"image",imgIconPath:b.config.STATIC_BASE_URL+"/modules/landing_page/d/images/"+a+"/gallery/"+d+"thumb.jpg",imgPath:b.config.STATIC_BASE_URL+"/modules/landing_page/d/images/"+a+"/gallery/"+d+"large.jpg",imgLargePath:b.config.STATIC_BASE_URL+"/modules/landing_page/d/images/"+a+"/gallery/"+d+"large.jpg"});return c}var c=this;b.asyncRequest("async:load:module","common/components/slider").then(function(){c.screenshotsRegion.show(b.request("new:gallery:grid:view",a(c.options.game.get("urlName"))))})},_showVideoRegion:function(){this.videoRegion.show(b.request("new:video:view",{youTubeVideoId:this.options.game.get("youTubeVideoId"),autoPlay:1,muted:!0,height:292,width:471}))},_showSignUpSection:function(){this.playersOnlineRegion.show(b.request("new:playersonline:view")),this.ui.modalSignUpSection.show()},onShow:function(){var a=this;a._showVideoRegion(),a._showMediaSlider(),a._showSignUpSection(),a.options.showGameLogoSection&&(a.$el.addClass("kx-showing-game-logo-section"),a.ui.gameLogoSection.show())},serializeData:function(){return{baseUrl:b.config.BASE_URL,staticBaseUrl:b.config.STATIC_BASE_URL,urlName:this.options.game.get("urlName")}},tosClicked:function(){b.execute("show:TOS")}})}),KXL.module("GamesApp.Alliance",function(a,b){a.Controller={allianceLayout:null,getAlliance:function(c,d){var e=this,f=b.request("alliance:entity",c,d);return f.fail(function(){e.allianceLayout.topRegion.reset(),e.allianceLayout.topRegion.show(new a.EmptyView),e.allianceLayout.leaderRegion.reset(),e.allianceLayout.membersRegion.reset()}),this.allianceLayout=new a.View({model:f._model}),this.allianceLayout.on("render",function(){var b=this,c=new a.AllianceTopView({model:f._model});b.topRegion.show(c);var d=new a.AllianceLeaderView({model:f._model});b.leaderRegion.show(d);var e=new a.MembersListView({collection:f._model.membersList});b.membersRegion.show(e)}),this.allianceLayout}}}),KXL.module("GamesApp.Alliance",function(a,b,c,d){a.View=d.Layout.extend({template:"#kx-alliance-layout-template",className:"kx-alliance",regions:{topRegion:".kx-alliance-region-top",leaderRegion:".kx-alliance-region-leader",membersRegion:".kx-alliance-region-members"}}),a.EmptyView=d.Layout.extend({template:"#kx-alliance-empty-template",className:"kx-alliance-empty-template"}),a.AllianceTopView=d.ItemView.extend({template:"#kx-alliance-top-template",className:"kx-top",tagName:"div",modelEvents:{change:"render"}}),a.AllianceLeaderView=d.Layout.extend({template:"#kx-alliance-leader-template",regions:{leaderAvatar:".kx-leader-avatar"},modelEvents:{change:"render"},onRender:function(){var a=this.model.get("leader"),c=a?a.userId:"",d=a?a.profile:"",e=d?d.alias:"";this.leaderAvatar.show(b.request("new:avatar:view",c,{model:new b.Entities.User({id:c,username:e}),size:"medium",color:"grey",avatarMenu:b.Components.Avatar.avatarMenu.ON}))}}),a.MemberItemView=d.Layout.extend({template:"#kx-member-template",tagName:"li",className:"kx-member",regions:{memberAvatar:".kx-member-avatar"},onRender:function(){var a=this.model.get("userId"),c=this.model.get("profile"),d=c?c.alias:"";this.memberAvatar.show(b.request("new:avatar:view",this.model.get("userId"),{model:new b.Entities.User({id:a,username:d}),size:"medium",color:"grey",avatarMenu:b.Components.Avatar.avatarMenu.ON}))}}),a.MembersListView=d.CompositeView.extend({template:"#kx-alliance-members-layout-template",itemViewContainer:"ul",itemView:a.MemberItemView,collectionEvents:{"add remove reset":"updateCount"},ui:{memberCount:".kx-member-count"},updateCount:function(){this.ui.memberCount.html(this.collection.length)}})}),KXL.module("GamesApp.Background",function(a){a.Controller={getBackground:function(b){return new a.View(b)},getBackgroundCMS:function(b){return new a.CMSView(b)}}}),KXL.module("GamesApp.Background",function(a,b,c,d){a.View=d.ItemView.extend({template:"#kx-background",className:"kx-background",serializeData:function(){return this.options}}),a.CMSView=d.ItemView.extend({template:"#kx-background-cms",className:"kx-background-cms",serializeData:function(){return this.options}})}),KXL.module("GamesApp.Battlelog",function(a,b){a.Controller={battleLogLayout:null,getBattlelog:function(c,d,e){var f;switch(e){case"bp":f=a.BattlelogBattlePiratesItem;break;case"wc":f=a.BattlelogWarCommanderItem;break;case"vc":f=a.BattlelogVegaConflictItem;break;default:f=a.EmptyView}var g=b.request("get:services:battlelog",d);return g||(g=b.request("battlelog:entities",c,d)._collection,b.currentUser.id===c&&b.request("set:services:battlelog",g,d)),this.battleLogLayout=new a.View,this.battleLogLayout.on("show",function(){var b=this,c=new a.CollectionView({collection:g,itemView:f});b.battlelogListRegion.show(c)}),this.battleLogLayout}}}),KXL.module("GamesApp.Battlelog",function(a,b,c,d,e,f){a.EmptyView=d.Layout.extend({template:"#kx-battlelog-empty-template",tagName:"li",className:"kx-battlelog-empty"}),a.View=d.Layout.extend({template:"#kx-battlelog-layout-template",regions:{battlelogListRegion:".kx-battlelog-list-region"}}),a.BattlelogBattlePiratesItem=d.Layout.extend({template:"#kx-battlelog-battlepirates-item-template",tagName:"li",regions:{avatar:".kx-opponent-avatar"},onRender:function(){this.avatar.show(b.request("new:avatar:view",this.model.get("opponentUserId"),{avatarMenu:b.Components.Avatar.avatarMenu.ON,size:"medium",color:"grey"})),this.$el.find(".kx-number").each(function(){e(this).addClass(e(this).text()>=0?"kx-won-resources":"kx-lost-resources")});var a=this.model.get("result");"win"===a?this.$el.addClass("kx-victory"):"loss"===a&&this.$el.addClass("kx-defeat"),this.$el.find(".kx-percent").text((this.model.get("damage")||0).toFixed(1).concat("%"))},serializeData:function(){return{battlelog:this.model.toJSON(),objective:b.i18n.t("games.battlelog."+this.model.get("objective")),attackDate:b.Common.Utils.DateUtils.fuzzytime(this.model.get("end"))}}}),a.BattlelogWarCommanderItem=d.Layout.extend({template:"#kx-battlelog-warcommander-item-template",tagName:"li",regions:{avatar:".kx-opponent-avatar"},onRender:function(){var a;a=this.model&&"rogueFaction"===this.model.get("objective")?b.request("new:avatar:view",null,{avatarUrl:"/modules/game/battlelog/images/wc_rogue_faction.png",avatarMenu:b.Components.Avatar.avatarMenu.OFF,size:"medium",color:"grey",clickable:!1,suppressDefaultClickAction:!0}):b.request("new:avatar:view",this.model.get("opponentUserId"),{avatarMenu:b.Components.Avatar.avatarMenu.ON,size:"medium",color:"grey"}),this.avatar.show(a),this.$el.find(".kx-number").each(function(){e(this).addClass(e(this).text()>=0?"kx-won-resources":"kx-lost-resources")});var c=this.model.get("result");"win"===c?this.$el.addClass("kx-victory"):"loss"===c&&this.$el.addClass("kx-defeat"),this.$el.find(".kx-percent").text(this.model.get("damage").toFixed(1).concat("%"))},serializeData:function(){return{battlelog:this.model.toJSON(),objective:b.i18n.t("games.battlelog."+this.model.get("objective")),attackDate:b.Common.Utils.DateUtils.fuzzytime(this.model.get("end"))}}}),a.BattlelogVegaConflictItem=d.Layout.extend({template:"#kx-battlelog-vegaconflict-item-template",tagName:"li",regions:{avatar:".kx-opponent-avatar"},onRender:function(){this.avatar.show(b.request("new:avatar:view",this.model.get("opponentUserId"),{avatarMenu:b.Components.Avatar.avatarMenu.ON,size:"medium",color:"grey"})),this.$el.find(".kx-number").each(function(){e(this).addClass(e(this).text()>=0?"kx-won-resources":"kx-lost-resources")});var a=this.model.get("result");"win"===a?this.$el.addClass("kx-victory"):"loss"===a&&this.$el.addClass("kx-defeat"),this.$el.find(".kx-percent").text(this.model.get("damage").toFixed(1).concat("%"))},serializeData:function(){return{battlelog:this.model.toJSON(),objective:b.i18n.t("games.battlelog."+this.model.get("objective")),attackDate:b.Common.Utils.DateUtils.fuzzytime(this.model.get("end"))}}}),a.CollectionView=d.CollectionView.extend({template:f.template(""),tagName:"ul",className:"kx-battles",emptyView:a.EmptyView,collectionEvents:{add:"render"}})}),KXL.module("GamesApp.LoadingRibbon",function(a,b,c,d){a.View=d.Layout.extend({template:"#kx-loading-ribbon-layout-template",className:"kx-loading-ribbon",events:{"click .kx-close-ribbon":"closeClicked"},getTemplate:function(){return"#kx-loading-ribbon-template-"+this.model.get("urlName")},closeClicked:function(){this.trigger("close:clicked")}})}),KXL.module("GamesApp.LoadingRibbon",function(a,b){a.Controller={getLoadingRibbon:function(c){var d,e=b.request("get:game:by:gameurl",b.games,c.gameId);return d=new a.View({model:e}),d.$el.addClass(e.get("commonName")),d}}}),KXL.module("GamesApp.Masthead",function(a){a.Controller={getMasthead:function(b){return new a.View(b)}}}),KXL.module("GamesApp.Masthead",function(a,b,c,d){a.View=d.ItemView.extend({template:"#kx-masthead",className:"kx-masthead",serializeData:function(){return this.options
}})}),KXL.module("GamesApp.PlayMessage",function(a,b,c){var d=new c.Collection([{name:"Safari",icon:"/modules/game/play_message/images/safari_logo.png",link:"http://support.apple.com/downloads/#safari"},{name:"Firefox",icon:"/modules/game/play_message/images/firefox_logo.png",link:"https://www.mozilla.org/en-US/firefox/new/"},{name:"Chrome",icon:"/modules/game/play_message/images/chrome_logo.png",link:"https://www.google.ca/chrome/"}]);a.Controller={getPlayMessageUnsupported:function(e){var f=new c.FilteredCollection(null,{collection:d});f.setFilter(function(a){return a.get("name")!==b.config.browser.name});var g={logo:e.logo,messageText:e.message,supportedBrowsers:f},h=new a.PlayMessageUnsupportedLayout(g);return h}}}),KXL.module("GamesApp.PlayMessage",function(a,b,c,d){a.PlayMessageBrowserLogoItem=b.Components.ItemView.extend({tagName:"li",template:"#kx-play-game-message-browser-logo",className:"kx-play-game-message-supported-logo",serializeData:function(){return{logoUrl:b.config.STATIC_BASE_URL+this.model.get("icon"),link:this.model.get("link")}}}),a.PlayMessageSupportedBrowserLogos=d.CollectionView.extend({tagName:"ul",className:"kx-play-game-message-supported-logos",itemView:a.PlayMessageBrowserLogoItem,buildItemView:function(b){var c=new a.PlayMessageBrowserLogoItem({model:b});return c}}),a.PlayMessageUnsupportedLayout=b.Components.Layout.extend({template:"#play-game-message-unsupported",className:"kx-play-game-message kx-play-game-message-unsupported",regions:{browserLogosRegion:".kx-browser-logos-region"},_renderSupportedBrowsers:function(){var b=new c.Collection([{name:"iOS",icon:"/modules/game/play_message/images/ios_logo.png",link:"https://itunes.apple.com/ca/app/vega-conflict/id898383017"},{name:"Android",icon:"/modules/game/play_message/images/android_logo.png",link:"https://play.google.com/store/apps/details?id=com.kixeye.vegaconflict"},{name:"Steam",icon:"/modules/game/play_message/images/steam_logo.png",link:"http://store.steampowered.com/app/339600/"}]),d=new a.PlayMessageSupportedBrowserLogos({collection:b});this.browserLogosRegion.show(d)},onRender:function(){this.options.supportedBrowsers&&this.options.supportedBrowsers.length&&this._renderSupportedBrowsers()},serializeData:function(){return{logo:this.options.logo,messageText:this.options.messageText}}})}),KXL.module("GamesApp.Story",function(a){a.Controller={getStory:function(b){return new a.View(b)}}}),KXL.module("GamesApp.Story",function(a,b,c,d){a.View=d.ItemView.extend({template:"#game-story-template"})}),KXL.module("GamesApp.Gallery",function(a){a.Controller={getGallery:function(){return new a.View}}}),KXL.module("GamesApp.Gallery",function(a,b,c,d){a.View=d.ItemView.extend({template:"#game-gallery-template"})}),KXL.module("GamesApp.MediaPreview",function(a){a.Controller={getMediaPreview:function(b){return new a.View({model:b})}}}),KXL.module("GamesApp.MediaPreview",function(a,b,c,d,e){a.View=d.ItemView.extend({template:"#preview-template",className:"kx-preview-wrapper",ui:{previewItem:".kx-preview",previewThumb:".kx-preview-thumb",previewHoverIcon:".kx-preview-hover-icon",previewCaption:".kx-preview-caption"},events:{"click .kx-preview-hover-icon.image":"thumbClickHandler","click .kx-preview-hover-icon.video":"videoClickHandler"},onRender:function(){""===this.model.get("caption")&&(this.model.get("type")===a.Type.image?this.model.set("caption",b.i18n.t("games.media.preview.screenshotOfTheDay")):this.model.get("type")===a.Type.video&&this.model.set("caption",b.i18n.t("games.media.preview.videoOfTheDay"))),this.model.get("customClass")&&this.$el.addClass(this.model.get("customClass")),this.model.get("type")===a.Type.video?this.ui.previewHoverIcon.addClass("video"):this.model.get("type")===a.Type.image&&this.ui.previewHoverIcon.addClass("image")},thumbClickHandler:function(){this.$el.colorbox({href:this.model.get("previewSrc"),rel:this.model.get("className"),width:this.model.get("width"),height:this.model.get("height"),transition:"fade",opacity:.6,onComplete:function(){e("#cboxTitle").hide()}})},videoClickHandler:function(){var a=this.model.get("previewSrc");-1===a.indexOf("?rel=0")&&(a+="?rel=0"),this.$el.colorbox({closeButton:!1,href:a,iframe:!0,innerWidth:640,innerHeight:390})}}),a.Type={image:"image",video:"video"}}),KXL.module("GamesApp",function(a,b,c,d,e,f){a.Router=d.AppRouter.extend({appRoutes:{"game/shadowforge(/)":"showShadowForge","game/:gameUrl/register(/)(:referrer)(/)(:experiment)":"registerGame","game/:gameUrl/autoregister(/)(:experiment)":"autoRegister","game/:gameUrl/invite(/*path)":"processInvite","game/:gameUrl/leaderboards":"showLeaderboard","game/:gameUrl/steamconnect(/)":"showTomeSteamConnect","game/:gameUrl(/:section)(/*path)":"showGame","warcommander(/:canvasPathAddOn)(/)":"gameRedirect","battlepirates(/:canvasPathAddOn)(/)":"gameRedirect","tome(/:canvasPathAddOn)(/)":"gameRedirect","vegaconflict(/:canvasPathAddOn)(/)":"gameRedirect"}});var g={showShadowForge:function(){b.execute("context:set",null);b.asyncRequest("async:load:module","game/shadow_forge").then(function(){var c=new b.Common.Views.ContentWithNav,d=new a.ShadowForge.Controller({showContent:function(a){c.contentRegion.show(a)}});b.gameRegion.show(c),b.execute("page:show","game"),d.showPage()})},gameRedirect:function(a,d){var e=c.history.fragment.replace(/[\/\?].*/g,"");"tome"===e&&(e="tomeimmortalarena");var f=b.mobileGames.findWhere({urlName:e});b.currentUser&&!f?(b.navigate("game/"+e),g.playGame(e,a,d)):(b.navigate("game/"+e+"/home"),g.showGame(e,"home"))},processInvite:function(a,c){function d(a,c){e.showGame(a,"home",null,{errorObject:{code:c,text:b.i18n.t("games.invalidCode")}})}var e=this;if(this.showGame(a,"home"),b.currentUser)if(b.request("auth:is:temp:user"))b.execute("show:delayed:register:dialog",{referrer:"invitelink"});else{var f=new b.Entities.GameInvite({inviteCode:c});f.save().done(function(e){e?b.execute("game:play:load",a):d(a,c)}).fail(function(){d(a,c)})}else b.execute("show:register:dialog",{contextGameUrlName:a,suppressSuccessStep:!0})},registerGame:function(a){if(b.currentUser)this.showGame(a,"play");else{var c={suppressSuccessStep:!0,contextGameUrlName:a,captchaRequired:!0};b.execute("show:register:dialog",c)}},autoRegister:function(a){function c(a){var b=e.Deferred();return e.ajax({url:"/api/game-bypassed",success:function(c){return b.resolve(a.get("commonName")===c?!0:!1)}}),b}var d=this,f=b.request("get:game:by:gameurl",b.games,a),g=b.staticGames.get(a),h=g&&g.get("autoRegistration");return h?void(f.get("inviteOnly")&&!b.currentUser?c(f).then(function(c){c?b.execute("auto:register",a):d.showGame(a,"play");var e="game/"+a;b.vent.trigger("info:page:nav","/"+e+"/autoregister"),b.navigate(e)}):f.get("inviteOnly")||b.currentUser?d.showGame(a,"play"):b.execute("auto:register",a)):void b.navigate("game/"+a+"/home")},playGame:function(d,g,h){function i(){var a=c.Model.extend({url:b.config.API_URL+"/authorizations"}),d=e.Deferred(),g=new a;return g.fetch({data:{userId:b.currentUser.id},success:function(a,b){var c="tomeLimited";f.contains(f.pluck(b,"roleId"),c)?d.resolve({}):d.reject({})},error:function(){d.reject()}}),d.promise()}var j=this,k=b.request("get:game:by:gameurl",b.games,d);b.request("async:load:module","special_offer"),b.currentUser&&(!b.request("auth:is:temp:user")||b.request("auth:is:temp:user")&&f.has(b.config.autoRegCommonNames,k.get("commonName")))?k.get("inviteOnly")&&b.switches.secondaryInviteCheck?i().then(function(){a.Game.Controller.playGame(k,g,h)}).fail(function(){b.asyncRequest("async:load:module","game/beta_notice").then(function(){b.request("show:default:dialog",new a.BetaNotice.ThanksForPlayingView),j.showGame(d,"home")})}):a.Game.Controller.playGame(k,g,h):this.showGame(d,"home")},showTomeSteamConnect:function(c){var d=this,e=b.games.findWhere({urlName:c});b.asyncRequest("context:change",e).then(function(){function e(){b.asyncRequest("async:load:module","game/steam_connect").then(function(){var c=new b.Common.Views.ContentWithNav,d=new a.SteamConnect.Controller({showContent:function(a){c.contentRegion.show(a)}});c.on("show",function(){b.asyncRequest("new:nav:view",b.context).then(function(a){c.navRegion.show(a)})}),b.gameRegion.show(c),b.execute("page:show","game"),d.showSteamConnect()})}b.currentUser?e():(b.execute("show:login:dialog"),b.vent.on("dialog:closed",function(){b.currentUser||d.showGame(c,"home"),b.vent.off("dialog:closed",arguments.callee)}))})},showLeaderboard:function(c){var d=this,e=b.games.findWhere({urlName:c});b.asyncRequest("context:change",e).then(function(){d.isUserAllowedToPlayGame().always(function(f){f?(b.navigate("game/".concat(c,"/leaderboards")),a.Game.Controller.showLeaderboard(e)):d.showGame(c)})})},showGame:function(c,d,e,h){var i=b.games.findWhere({urlName:c});return i?void b.asyncRequest("context:change",i).then(function(){if("tomeimmortalarena"!==c||d&&"play"!==d||(d="home"),d){var j=b.mobileGames.findWhere({urlName:c});if(j&&(d||(d="home")),"play"===d||!d&&b.currentUser)return void g.playGame(c,e,h);b.vent.trigger("info:game:page",c,d);var k="game/"+c+(d?"/"+d+(e?"/"+e:""):"");"tomeimmortalarena"===c?b.asyncRequest("async:load:module","game/tome").then(function(){var c=b.request("tome:get:guardian",d);c?(e=d,d="guardians",b.navigate("/game/tomeimmortalarena/"+d+"/"+e,{replace:!0})):(b.navigate(k),h=f.extend({},h,{path:e}),a.Game.Controller.showGame(i,d,h))}):(b.navigate(k),h=f.extend({},h,{path:e}),a.Game.Controller.showGame(i,d,h))}else g.playGame(c,e,h)}):void b.execute("home:show")},isUserAllowedToPlayGame:function(){var a=e.Deferred(),c=new b.Entities.GameInvite;if(!b.context.get("inviteOnly"))return a.resolve(!0,c),a;var d=b.request("get:game:invites",c);return d.then(function(d){d?a.resolve(f.contains(d.get("gameInvites"),b.context.id),c):a.resolve(!1,c)}).fail(function(){a.resolve(!1,c)}),a},getNavView:function(b,c){return a.Nav.Controller.getNavView(b,c)},getStoryView:function(b){return a.Story.Controller.getStory(b)},getGalleryView:function(a,c,d){return b.Components.Slider.Controller.getSlider(a,c,d)},getMediaPreview:function(b){return a.MediaPreview.Controller.getMediaPreview(b)},getBattlelogView:function(b,c,d){return a.Battlelog.Controller.getBattlelog(b,c,d)},getMastheadView:function(b){return a.Masthead.Controller.getMasthead(b)},getPlayMessageUnsupportedView:function(b){return a.PlayMessage.Controller.getPlayMessageUnsupported(b)},getBackgroundView:function(b){return a.Background.Controller.getBackground(b)},getBackgroundCMSView:function(b){return a.Background.Controller.getBackgroundCMS(b)},getAppStoreView:function(b){return a.AppStore.Controller.getAppStore(b)},getAllianceView:function(b,c){return a.Alliance.Controller.getAlliance(b,c)},getLoadingRibbonView:function(b){return a.LoadingRibbon.Controller.getLoadingRibbon(b)},getGameInvites:function(a){var d=e.Deferred();return b.currentUser?a.fetch({success:function(a){d.resolve(a)}}):d.resolve(new c.Collection),d.promise()},showGetNotifedBanner:function(a){var c=e.Deferred();return b.asyncRequest("async:load:module","game/get_notified").then(function(){b.request("get:notified:new:view",f.extend(a||{},{email:b.currentUser?b.currentUser.get("email"):"",country:b.currentUser?b.currentUser.get("location"):"",gameUrlName:b.context&&b.context.get("urlName"),showNotifyBySMS:!1})).done(function(a){a.on("layout:changed show",function(){b.vent.trigger("request:header:height:change:check")});var d=b.request("banner:create",{bannerId:"getNotified",view:a,closable:!0});c.resolve(d)})}),c}};b.commands.setHandlers({"game:show":function(a,b,c,d){g.showGame(a,b,c,d)},"game:play:load":function(a,c,d){var e=b.games.findWhere({urlName:a});b.asyncRequest("context:change",e).then(function(){"tomeimmortalarena"===a?b.execute("game:show",a,"home"):(b.navigate("game/"+a),g.playGame(a,c,d))})},"game:play:unload":function(){b.execute("page:close","play")},"game:play:reload":function(){var a=b.context&&b.context.get("urlName");b.execute("game:play:unload"),a&&b.execute("game:play:load",a)},"game:navigate:steam":function(a){var c=b.staticGames.get(a),d=c&&c.get("steamUrl");d&&b.navigate(d,{target:"_blank"})},"game:register":function(a,b,c){g.registerGame(a,b,c)},"game:autoregister":function(a,b){g.autoRegister(a,b)},"game:leaderboard:show":function(a){g.showLeaderboard(a)}}),b.addInitializer(function(){new a.Router({controller:g}),b.appModel.on("change:currentUser",function(){a.Game.Controller.reset()}),b.appModel.on("change:context",function(){a.Game.Controller.reset()})}),b.reqres.setHandlers({"game:is:user:allowed":function(){return g.isUserAllowedToPlayGame()},"new:nav:view":function(a,b){return g.getNavView(a,b)},"new:story:view":function(a){return g.getStoryView(a)},"new:gallery:view":function(a,b,c){return g.getGalleryView(a,b,c)},"new:gamemediapreview:view":function(a){return g.getMediaPreview(a)},"new:battlelog:view":function(a,b,c){return g.getBattlelogView(a,b,c)},"new:masthead:view":function(a){return g.getMastheadView(a)},"new:play:message:unsupported:view":function(a){return g.getPlayMessageUnsupportedView(a)},"new:background:view":function(a){return g.getBackgroundView(a)},"new:backgroundcms:view":function(a){return g.getBackgroundCMSView(a)},"new:appstore:view":function(a){return g.getAppStoreView(a)},"new:alliance:view":function(a,b){return g.getAllianceView(a,b)},"new:game:loading:ribbon:view":function(a){return g.getLoadingRibbonView(a)},"get:game:invites":function(a){return g.getGameInvites(a)},"show:get:notified:banner":function(a){return g.showGetNotifedBanner(a)}})}),KXL.module("LandingPageApp.LandingPage.Default",function(a,b){a.View=b.Components.Layout.extend({template:"#landing-page-template-default",className:"kx-landing-page-default",regions:{background:".game-background-region",quote:".game-quote-region",signUp:".game-signup-region",screenshots:".game-screenshots-region"},initialize:function(a){this.game=a.game,this.queryParams=a.queryParams},onShow:function(){function a(){var a=b.request("new:contentpane:view",{});b.asyncRequest("async:load:module","common/components/slider").then(function(){c.screenshots.show(a),a.setContentView(b.request("new:gallery:view",b.request("get:game:gallery:item:data",d.get("commonName"),!0),d))})}this.$el.addClass(this.queryParams.lp);var c=this,d=c.game,e=d.get("urlName"),f={trackControl:"widget",trackSource:e+".lp"};c.signUp.show(b.request("new:landing:page:signup:form:view",d,{data:f})),c.quote.show(b.request("new:game:quote:view",d)),a(d),c.background.show(b.request("new:background:view"))}})}),KXL.module("LandingPageApp.LandingPage.d",function(a,b,c,d,e,f){a.View=d.Layout.extend({className:"kx-landing-page-d",defaults:{showSignUpForm:!1,signupFormOptions:null,showGameLogoSection:!1},regions:{signUpRegion:".kx-inline-signup-region",videoRegion:".kx-video-region",playersOnlineRegion:".kx-players-online-region",mastheadPlayBtnRegion:".kx-masthead-play-button-region",screenshotsRegion:".kx-game-screenshots-region",playBtn2Region:".kx-play-button2-region"},ui:{signUpSection:".kx-inline-signup-section",modalSignUpSection:".kx-modal-signup-section",gameLogoSection:".kx-game-logo-section"},events:{"click .kx-masthead-play-button-region":"topCtaClick","click .kx-play-button2-region":"bottomCtaClick","click .kx-tos-blurb span":"tosClicked"},initialize:function(a){this.options=opts=f.defaults({},a,this.defaults)},getTemplate:function(){return"#landing-page-template-d-"+this.options.game.get("urlName")},getSignUpFormOptions:function(){return{}},ctaClick:function(a){if(_gaq){var b,c=e(".kx-masthead-play-button-region a"),d=c&&c.attr("href")||"",f=/\d+$/,g=d.match(f),h=g&&1===g.length&&g[0],i=window.optimizely&&window.optimizely.data&&window.optimizely.data.state;h&&i&&i.variationNamesMap&&(b=i.variationNamesMap[h]);var j=["/landingpage",this.options.game.get("urlName"),h||"unknownexperiment",b||"unknownvariant","ctaclick",a];_gaq.push(["_trackPageview",j.join("/")])}},topCtaClick:function(){this.ctaClick("top")},bottomCtaClick:function(){this.ctaClick("bottom")},onShow:function(){function a(){for(var a=[],c=1;4>=c;c++)a.push({type:"image",imgIconPath:b.config.STATIC_BASE_URL+"/modules/landing_page/d/images/"+d.options.game.get("urlName")+"/gallery/"+c+"thumb.jpg",imgPath:b.config.STATIC_BASE_URL+"/modules/landing_page/d/images/"+d.options.game.get("urlName")+"/gallery/"+c+"large.jpg",imgLargePath:b.config.STATIC_BASE_URL+"/modules/landing_page/d/images/"+d.options.game.get("urlName")+"/gallery/"+c+"large.jpg"});return a}function c(){b.asyncRequest("async:load:module","common/components/slider").then(function(){d.screenshotsRegion.show(b.request("new:gallery:grid:view",a()))})}{var d=this;d.options.game.get("urlName")}d.videoRegion.show(b.request("new:video:view",{youTubeVideoId:d.options.game.get("youTubeVideoId"),autoPlay:1,muted:!0,height:292,width:471})),d.playersOnlineRegion.show(b.request("new:playersonline:view")),d.options.showGameLogoSection&&(d.$el.addClass("kx-showing-game-logo-section"),d.ui.gameLogoSection.show()),d.ui.modalSignUpSection.show(),c(),d._usesLocalizedPlayNowBtn()&&(d.mastheadPlayBtnRegion.show(new b.Components.Button.View({label:b.i18n.t("games.page.playNowBtnLabel"),customClass:"kx-play-btn"})),d.playBtn2Region.show(new b.Components.Button.View({label:b.i18n.t("games.page.playNowBtnLabel"),customClass:"kx-play-btn"})))},_usesLocalizedPlayNowBtn:function(){return"vegaconflict"===this.options.game.get("urlName")},serializeData:function(){return{baseUrl:b.config.BASE_URL,staticBaseUrl:b.config.STATIC_BASE_URL,urlName:this.options.game.get("urlName")}},tosClicked:function(){b.execute("show:TOS")}})}),KXL.module("LandingPageApp.LandingPage",function(a,b,c,d){a.View=b.Components.Layout.extend({template:"#landing-page-main-template",className:function(){return"kx-landing-page "+this.model.get("commonName")},regions:{contentRegion:".kx-landing-page-content-region"}}),a.GameQuoteView=d.ItemView.extend({template:"#game-home-quote",tagName:"div",className:"col-md-11",currGame:null,initialize:function(a){this.currGame=a.game},templateHelpers:function(){var a={},c=this.currGame.get("commonName");return a.quoteString=c?b.i18n.t("games.lp."+c+".quote"):!1,a}}),b.reqres.setHandlers({"new:game:quote:view":function(b){return new a.GameQuoteView({game:b})}})}),KXL.module("LandingPageApp.LandingPage",function(a,b){a.Controller={showLandingPage:function(c,d){var e,f;b.execute("header:hide"),b.execute("footer:hide"),b.execute("playersonline:hide"),d.lp="d",f=new a[d.lp].View({game:c,queryParams:d}),e=new a.View({model:c}),e.$el.addClass(d.lp),f.$el.addClass(d.lp),f.$el.addClass(c.get("commonName")),e.on("show",function(){e.contentRegion.show(f)}),b.landingPageRegion.show(e)}}}),KXL.module("LandingPageApp",function(a,b,c,d){a.Router=d.AppRouter.extend({appRoutes:{"game/:gameUrl/lp/:lpParam":"handleRoute"}});var e={handleRoute:function(c,d){if(b.currentUser&&window.location===window.parent.location)b.execute("game:show",c);else{var e={};d&&(e={lp:d}),b.execute("page:show","landing");var f=b.request("get:game:by:gameurl",b.games,c);b.execute("context:set",f),a.LandingPage.Controller.showLandingPage(f,e)}},getGalleryGridView:function(a){return new b.Components.Slider.Controller.getGridSlider(a)},getLandingPageSignUpForm:function(a,c){var d=b.request("new:inline:signup:form:view",c);return d.on("register:submit",function(d){b.execute("show:register:dialog",{registration:d,step:b.AuthApp.RegisterSteps.CREATE_ACCOUNT,contextGameUrlName:a.get("urlName"),captchaRequired:!1,data:c.data})}),d.on("fb:api:authenticated",function(c){b.request("fblogin:submit",c,data).done(function(d,e){e&&b.execute("show:register:dialog",{step:b.AuthApp.RegisterSteps.IMPORT_FB_FRIENDS,contextGameUrlName:a.get("urlName"),fbAccessToken:c,isNew:e,captchaRequired:!1})}).fail(function(a){d.setErrorMsg(a instanceof b.Errors.EmailConflictError?b.i18n.t("auth.loginEmailConflictError",{email:a.detail.email}):b.i18n.t("auth.registrationFailed"))})}),d.listenTo(b,"google:api:authenticated",function(c){b.request("googlelogin:submit",c,data).done(function(d,e,f){e&&(f?b.execute("show:register:dialog",{step:b.AuthApp.RegisterSteps.IMPORT_FB_GAMES_PROMPT,contextGameUrlName:a.get("urlName"),googleAccessToken:c,isNew:e,captchaRequired:!1}):b.execute("show:register:dialog",{step:b.AuthApp.RegisterSteps.IMPORT_FB_GAMES_PROMPT,contextGameUrlName:a.get("urlName"),googleAccessToken:c,isNew:e,captchaRequired:!1}))}).fail(function(a){d.setErrorMsg(a instanceof b.Errors.EmailConflictError?b.i18n.t("auth.loginEmailConflictError",{email:a.detail.email}):b.i18n.t("auth.registrationFailed"))})}),this.listenTo(d,"steam:api:authenticated",function(a){a.fail(function(a){var c;switch(a){case"FAILED_FRAUD_CHECK":c=(new b.Errors.IOvationBlockedError).message;break;case"NO_DEVICE_FINGERPRINT":c=(new b.Errors.DeviceFingerprintError).message;break;default:c=b.i18n.t("auth.registrationFailed")}d.setErrorMsg(c)})}),d}};b.vent.on("auth:changed",function(){b.request("get:current:user")&&(b.execute("header:show"),b.landingPageRegion.close())}),b.addInitializer(function(){new a.Router({controller:e})}),b.reqres.setHandlers({"new:gallery:grid:view":function(a){return e.getGalleryGridView(a)},"new:landing:page:signup:form:view":function(a,b){return e.getLandingPageSignUpForm(a,b)}})}),KXL.module("AuthApp.DeferredReg",function(a,b,c,d,e,f){a.View=b.Components.Layout.extend({template:"#banner-deferred-reg-template",className:"kx-banner-deferred-reg",regions:{message:".kx-banner-message",bannerActionButton:".kx-banner-action-button"},actionButton:null,initialize:function(a){this.options=f.defaults({},a,{ctaButtonOptions:{},message:""}),this.options.ctaButtonOptions&&(this.options.ctaButtonOptions=f.defaults({},a.ctaButtonOptions,{label:"",theme:b.Components.Button.Themes.alt4o}))},getActionButton:function(){return this.isClosed?null:this.actionButton},onShow:function(){var a=this;if(this.options.ctaButtonOptions){var c=this.actionButton=new b.Components.Button.View(this.options.ctaButtonOptions);c.on("click",function(){a.trigger("cta:clicked")}),this.bannerActionButton.show(c)}},serializeData:function(){return{options:this.options}}}),a.BannerSignUpView=b.Components.Layout.extend({template:"#banner-deferred-reg-form-template",className:"kx-banner-deferred-reg-form",regions:{left:".kx-banner-reg-panel.kx-left",center:".kx-banner-reg-panel.kx-center",right:".kx-banner-reg-panel.kx-right"},showLeftView:function(a){this.left.show(a)},showCenterView:function(a){this.center.show(a)},showRightView:function(a){this.right.show(a)}})}),KXL.module("AuthApp.Login",function(a,b,c,d,e,f){a.LoginModel=b.Entities.Model.extend({defaults:function(){return{username:null,password:null,state:a.LoginModel.NOT_AUTH,stateDetails:""}},validation:function(){return{username:{required:!0,msg:b.i18n.t("auth.login.validation.required.username")},password:{required:!0,msg:b.i18n.t("auth.login.validation.required.password")}}}}),a.LoginModel.NOT_AUTH="Not Authenticated",a.LoginModel.PENDING="Pending Authentication",a.LoginModel.SUCCESS="Authentication Success",a.LoginModel.FAIL="Authentication Failure",a.LoginModel.UNKNOWN="Authentication Unknown",a.LoginModel.VALIDATION_ERRORS="Validation Errors";var g=d.Controller.extend({getLogin:function(c){var d=new a.LoginModel,g=f.extend({},c);g=f.extend(g,{model:d});var h=new a.View(g);return this.listenTo(h,"fb:api:authenticated",function(a){b.request("fblogin:submit",a,{trackControl:"dialog",trackSource:"login"}).done(function(b,c){h.trigger("fb:authenticated",a,b,c)}).fail(function(a){h.setSocialErrorMsg(a instanceof b.Errors.EmailConflictError?b.i18n.t("auth.loginEmailConflictError",{email:a.detail.email}):a.message)})}),h.listenTo(b,"google:api:authenticated",function(a){b.request("googlelogin:submit",a,{trackControl:"dialog",trackSource:"login"}).done(function(b,c){h.trigger("google:authenticated",a,b,c)}).fail(function(a){h.setSocialErrorMsg(a.message)})}),this.listenTo(h,"steam:api:authenticated",function(a){a.done(function(){h.trigger("steam:authenticated")}).fail(function(a){var c;switch(a){case"FAILED_FRAUD_CHECK":c=(new b.Errors.IOvationBlockedError).message;break;case"NO_DEVICE_FINGERPRINT":c=(new b.Errors.DeviceFingerprintError).message;break;default:c=(new b.Errors.UnexpectedError).message}h.setSocialErrorMsg(c)})}),this.listenTo(h,"login:submit",function(c){if(c.get("state")!==a.LoginModel.PENDING&&c.get("state")!==a.LoginModel.SUCCESS){c.set("state",a.LoginModel.PENDING);var d=c.validate(),f=c.isValid();if(f){var g=b.request("login:submit",c.get("username"),c.get("password"));e.when(g).done(function(){c.set("state",a.LoginModel.SUCCESS),h.trigger("authenticated")}).fail(function(b){h.setErrorMsg(b.message),c.set("state",a.LoginModel.FAIL)})}else c.set("validationErrors",d),c.set("state",a.LoginModel.VALIDATION_ERRORS)}}),h}});a.Controller=new g}),KXL.module("AuthApp.Login",function(a,b,c,d,e,f){a.View=b.Components.Layout.extend({template:"#login-template",className:"kx-login",events:{"click .kx-login-forgot":"triggerForgotPass"},triggers:{"click .kx-register-link":"register:link:clicked"},ui:{loginBtn:".kx-login-btn",authErrorMessage:".kx-login-auth-error-msg",socialAuthErrorMessage:".kx-social-login-auth-error-msg",header:".kx-header"},modelEvents:{"change:state":"handleStateChange"},regions:{usernameRegion:".kx-txt-login-username-region",passwordRegion:".kx-login-password-region",loginBtnRegion:".kx-login-btn-region",fbConnnectBtnRegion:".kx-btn-fb-login-region",googleBtnRegion:".kx-btn-google-login-region",steamBtnRegion:".kx-btn-steam-login-region"},initialize:function(a){this.fields={},this.options=f.defaults(a,{steamLoginEnabled:b.switches.steamLoginEnabled})},triggerForgotPass:function(){b.execute("show:forgot:password:dialog")},onRender:function(){function a(){d.setErrorMsg("")}function c(){d.model.set("username",d.fields.username.val()),d.model.set("password",d.fields.password.val()),d.trigger("login:submit",d.model)}var d=this;this.fields.username=new b.Components.TextBox.View({model:this.model,modelAttr:"username",placeHolder:b.i18n.t("auth.usernameEmail"),showSuccess:!1}),this.listenTo(this.fields.username,"change",a),this.listenTo(this.fields.username,"submit",c),this.usernameRegion.show(this.fields.username),this.fields.password=b.Components.MaskInput.Controller.getMaskInput({model:this.model,modelAttr:"password",customClass:"kx-txt-login-pwd",placeHolder:b.i18n.t("auth.password"),showSuccess:!1}),this.listenTo(this.fields.password,"change",a),this.listenTo(this.fields.password,"submit",c),this.passwordRegion.show(this.fields.password);var e=new b.Components.Button.View({label:b.i18n.t("auth.logIn"),theme:b.Components.Button.Themes.alt7,customClass:"kx-login-btn"});e.on("click",c),this.loginBtnRegion.show(e);var f=new b.Components.Button.View({theme:b.Components.Button.Themes.alt8,customClass:"kx-btn-fb-login"});f.on("click",function(){d.setSocialErrorMsg(""),d.setErrorMsg(""),b.vent.trigger("info:fblogin:start",{trackControl:"dialog",trackSource:"login"}),FB.login(function(a){"connected"===a.status&&d.trigger("fb:api:authenticated",a.authResponse.accessToken)},{scope:"email"})}),this.fbConnnectBtnRegion.show(f);var g=new b.Components.Button.View({theme:b.Components.Button.Themes.alt17,customClass:"kx-btn-google-login"});if(this.listenTo(g,"click",function(){d.setSocialErrorMsg(""),d.setErrorMsg(""),b.vent.trigger("info:googlelogin:start",{trackControl:"dialog",trackSource:"login"}),gapi.auth.signIn({callback:googleAuthHandler})}),this.googleBtnRegion.show(g),this.options.steamLoginEnabled){var h=new b.Components.Button.View({theme:b.Components.Button.Themes.alt26,customClass:"kx-btn-steam-login"});this.listenTo(h,"click",function(){d.setSocialErrorMsg(""),d.setErrorMsg(""),b.execute("steamlogin:start",d,{trackControl:"dialog",trackSource:"login"})}),this.steamBtnRegion.show(h)}this.handleStateChange(),this.$el.find("input").placeholder()},setErrorMsg:function(a){a?this.ui.authErrorMessage.html(a).show():this.ui.authErrorMessage.html("").hide()},setSocialErrorMsg:function(a){a?this.ui.socialAuthErrorMessage.html(a).show():this.ui.socialAuthErrorMessage.html("").hide()},handleStateChange:function(){switch(this.model.get("state")){case a.LoginModel.NOT_AUTH_STATE:this.fields.username.focus();break;case a.LoginModel.VALIDATION_ERRORS:this.$el.find("input").prop("disabled",!1),this.$el.find(".kx-login-btn").removeClass("kx-login-disabled");var b=this.model.get("validationErrors"),c=this;f.each(b,function(a,b){c.fields[b]&&c.fields[b].showError(a)});break;case a.LoginModel.PENDING:this.$el.find("input").prop("disabled",!0),this.$el.find(".kx-login-btn").addClass("kx-login-disabled");break;case a.LoginModel.FAIL:this.$el.find("input").prop("disabled",!1),this.$el.find(".kx-login-btn").removeClass("kx-login-disabled"),this.fields.password.focus();break;case a.LoginModel.SUCCESS:}},onShow:function(){var a=this;setTimeout(function(){a.fields.username&&a.fields.username.focus()},0)},serializeData:function(){var a=this.options;return a.logInFacebookConnect=b.i18n.t("auth.logInFacebookConnect"+(b.switches.steamLoginEnabled?"":"NoSteam")),a}})}),KXL.module("AuthApp.Register.Common",function(a,b,c,d,e,f){a.ConfirmPrompt=b.Components.Layout.extend({template:"#register-confirm-prompt-template",className:"kx-register-confirm-prompt",regions:{confirmBtnRegion:".kx-confirm-btn-region",cancelBtnRegion:".kx-cancel-btn-region"},initialize:function(a){var c={confirmBtnLabel:b.i18n.t("auth.register.common.confirmPrompt.confirmBtnLabel"),cancelBtnLabel:b.i18n.t("auth.register.common.confirmPrompt.cancelBtnLabel"),showConfirmBtn:!0};this.options=f.defaults({},a,c)},renderButtons:function(){var a=this,c=new b.Components.Button.View({label:this.options.confirmBtnLabel,theme:b.Components.Button.Themes.alt4});c.on("click",function(){a.trigger("confirm:clicked")}),this.confirmBtnRegion.show(c);var d=new b.Components.Button.View({label:this.options.cancelBtnLabel,theme:b.Components.Button.Themes.alt4});d.on("click",function(){a.trigger("cancel:clicked")}),this.cancelBtnRegion.show(d)},onShow:function(){this.renderButtons()},serializeData:function(){return{heading:this.options.heading,showConfirmBtn:this.options.showConfirmBtn}}})}),KXL.module("AuthApp.Register.Wizard",function(a,b){a.View=b.Components.Layout.extend({loader:null,template:"#register-wizard-template",className:"kx-register-wizard",regions:{currentStep:".kx-current-step",loaderRegion:".kx-loader-region"},ui:{errors:".kx-errors",headerText:".kx-header-text",subHeaderText:".kx-subheader-text"},initialize:function(){this.atom=new atom},toggleLoadingState:function(a){var c=this;this.atom.once("shown",function(){c.currentStep&&(c.currentStep.ensureEl(),c.loaderRegion.ensureEl(),a?(c.loader||(c.loader=b.request("new:loader:view"),c.loaderRegion.show(c.loader)),c.currentStep.$el.hide(),c.loaderRegion.$el.show()):(c.currentStep.$el.show(),c.loaderRegion.$el.hide()))})},onShow:function(){this.options.headerText&&this.setHeaderText(this.options.headerText),this.atom.set("shown")},setHeaderText:function(a){var b=this;this.atom.once("shown",function(){b.ui.headerText.html(a)})},setSubHeaderText:function(a){var b=this;this.atom.once("shown",function(){a?b.ui.subHeaderText.show():b.ui.subHeaderText.hide(),b.ui.subHeaderText.html(a)})},showStep:function(a){var b=this;this.atom.once("shown",function(){b.toggleLoadingState(!1),b.currentStep.show(a)})},showError:function(a){this.ui.errors.html(a),this.ui.errors.show()},clearError:function(){this.ui.errors.empty&&this.ui.errors.empty(),this.ui.errors.empty&&this.ui.errors.hide()}})}),KXL.module("AuthApp.Register.Deferred",function(a,b){a.Controller={start:function(){var a=this.getSplit();a&&"timer"===a.substr(0,5)?this.startTimer(1e3*parseInt(a.substr(5),10)*60,!0):this.setGameEventListener()},restart:function(){if(b.request("auth:is:temp:user")){var a=this.getSplit();if("timer"!==a.substr(0,5))return this.setGameEventListener();var c=parseInt(b.Common.Utils.CookieUtils.getCookie("kxl-dr-cookie"),10)||0,d=Date.now();c>d?c-=d:c=5e3,this.startTimer(c,!1)
}},gameEventHandler:function(a){if(b.request("auth:is:temp:user")&&-1!==["tutorialCompletion","levelUp"].indexOf(a.event)){var c=a.event;"levelUp"===c&&(c=c.concat(a.level));var d=this.getSplit();return d!==c?this.checkEventPassed(a,d):this.show({referrer:"deferred-reg-event-"+d})}},startTimer:function(a,b){if(b){var c=Date.now()+a;document.cookie="kxl-dr-cookie="+c}window.clearTimeout(this.deferredRegistrationTimer),this.deferredRegistrationTimer=setTimeout(this.show.bind(this,{referrer:"deferred-reg-timer"}),a)},cancelTimer:function(){this.deferredRegistrationTimer&&window.clearTimeout(this.deferredRegistrationTimer),document.cookie="kxl-dr-cookie=; expires=Thu, 01 Jan 1970 00:00:00 GMT"},checkGameAllowsTimedRegPopup:function(a){var c=b.context&&b.context.get("commonName");return c&&!b.config.autoRegCommonNames[c].allowTimedRegPopUp&&"deferred-reg-timer"===a.referrer?!1:!0},show:function(a){this.cancelTimer(),b.request("auth:is:temp:user")&&this.checkGameAllowsTimedRegPopup(a)&&(b.appModel.get("deferredRegDialogOverridden")||b.execute("show:delayed:register:dialog",a),b.vent.trigger("delayed:register:dialog:shown"))},gate:function(a){return b.request("auth:is:temp:user")?(this.show(a),!0):!1},getSplit:function(){return"timer10"},setGameEventListener:function(){var c=!1;return function(){c||(c=!0,b.vent.on("game:event",a.Controller.gameEventHandler.bind(a.Controller)))}}(),checkEventPassed:function(a,c){"levelUp"!==a.event||b.appModel.get("deferredRegBarShowing")||"tutorialCompletion"===c&&a.level<=2||"levelUp"===c.substr(0,7)&&a.level<parseInt(c.substr(7),10)||this.show({referrer:"deferred-reg-event-passed-"+c})}}}),KXL.module("AuthApp.Register.SignupForm",function(a,b,c,d,e,f){a.View=b.Components.Layout.extend({template:"#signup-form-template",className:"kx-signup-form",emailSignupSelected:null,socialSignupSelected:null,initialize:function(a){function c(a,c){if(a){b.vent.trigger("info:register:cancel",g.trackData);var d=b.request("new:deferred:reg:banner:view",{ctaButtonOptions:{label:b.i18n.t("banner.cta")},message:b.i18n.t("banner.saveProgressMesssage")});if(d.listenTo(d,"cta:clicked",function(){b.request("banner:hide","delayedRegBanner",!0),b.execute("show:delayed:register:dialog",{referrer:"banner"})}),!c&&g.options.delayedRegistration){var e=b.request("banner:create",{bannerId:"delayedRegBanner",view:d});b.appModel.set("deferredRegBarShowing",!0),b.vent.listenToOnce(e,"close",function(){b.appModel.set("deferredRegBarShowing",!1)})}}}var d={tooltipPos:"right",emailTooltip:"",socialSignUpPlacementLeft:!1,useToggledSections:!1,useLargeSocialButtons:!1,showLoginLink:!0,strings:{registerBtnLabel:b.i18n.t("auth.signup.regBtnLabel"),notPostOnWall:b.i18n.t("auth.signup.notPostOnWall"),facebookWillBeImported:b.i18n.t("auth.signup.facebookWillBeImported"),changeUsernameAvatarLater:b.i18n.t("auth.signup.changeUsernameAvatarLater"),registerUsingFacebook:b.i18n.t("auth.signup.registerUsingFacebook"+(b.switches.steamLoginEnabled?"":"NoSteam")),regOr:b.i18n.t("auth.signup.regOr"),regFinePrint:b.i18n.t("auth.signup.regFinePrint"+(b.switches.steamLoginEnabled?"":"NoSteam"))},registerBtnTheme:b.Components.Button.Themes.alt7,steamLoginEnabled:b.switches.steamLoginEnabled},e=this.options=f.defaults({},a,d);this.options.strings=f.defaults({},a.strings,d.strings),e.useToggledSections&&(e=f.defaults(e,{socialSignupSelected:!0,emailSignupSelected:!1}),this.emailSignupSelected=e.emailSignupSelected,this.socialSignupSelected=e.socialSignupSelected),this.fields={},this.registration=e.registration,this.trackData=f.defaults({},e.data,{trackControl:"dialog",trackSource:"navbar"});var g=this;this.listenTo(b.vent,"dialog:closed",function(a,b){b&&"registerDialog"===b.dialogId&&c()}),this.listenTo(b.vent,"banner:hidden",function(a){a=f.defaults(a||{},{manual:!1}),c(a.manual,"delayedRegFormBanner"!==a.bannerId)})},ui:{errorMessages:".error-messages",emailSignupSection:".kx-email-signup",socialSignupSection:".kx-social-signup",toggleToSocial:".kx-toggle-to-social",toggleToEmail:".kx-toggle-to-email",loginLink:".kx-login"},modelEvents:{"change:state":"update"},triggers:{"click .tos span":"tos:clicked"},events:{"click .kx-login-link":"loginLinkClick","click .kx-toggle-section-ctrls a":"toggleSignupMethodClicked"},regions:{usernameRegion:".kx-username-region",emailRegion:".kx-email-region",passwordRegion:".kx-password-region",registerBtnRegion:".kx-register-btn-region",fbconnectBtnRegion:".kx-btn-fb-login-region",googleBtnRegion:".kx-btn-google-login-region",steamBtnRegion:".kx-btn-steam-login-region"},toggleSignupMethodClicked:function(a){a&&(a.preventDefault,a.stopPropagation),this.trigger("toggle:signup:method")},signupInteraction:function(){this.interaction||(this.interaction=!0,b.vent.trigger("info:register:start",this.trackData))},loginLinkClick:function(){b.vent.trigger("info:register:cancel",this.trackData),this.trigger("login:link:clicked")},triggerRegister:function(){this.registration.set({username:this.fields.username.val(),password:this.fields.password.val(),email:this.fields.email.val()}),this.trigger("register:clicked",this.trackData)},update:function(){var b=a.Model.states;switch(this.$el.find("input").prop("disabled",!1),this.model.get("state")){case b.NOT_REG:this.fields.username.focus();break;case b.PENDING:this.$el.find("input").prop("disabled",!0),this.fields.registerBtn.label("Registering...")}},showValidationErrors:function(a){var b=this;f.each(a,function(a,c){b.fields[c]&&b.fields[c].showError(a)})},setErrorMsg:function(a){a?(this.ui.errorMessages.html(a),this.ui.errorMessages.show()):(this.ui.errorMessages.empty(),this.ui.errorMessages.hide())},toggleEmailSignupSection:function(a){a?(this.ui.toggleToSocial.show(),this.ui.toggleToEmail.hide(),this.ui.emailSignupSection.show(),this.ui.socialSignupSection.hide(),this.emailSignupSelected=!0,this.socialSignupSelected=!1):(this.ui.toggleToSocial.hide(),this.ui.toggleToEmail.show(),this.ui.emailSignupSection.hide(),this.ui.socialSignupSection.show(),this.emailSignupSelected=!1,this.socialSignupSelected=!0),this.trigger("signup:method:updated")},toggleSocialSignupSection:function(a){this.toggleEmailSignupSection(!a)},onRender:function(){var a=this;this.options.socialSignUpPlacementLeft&&this.$el.addClass("kx-social-signup-placement-left"),this.options.useToggledSections&&(this.$el.addClass("kx-toggled-sections"),this.toggleEmailSignupSection(this.options.emailSignupSelected)),this.options.hideSocialToggle&&this.ui.toggleToSocial.hide(),this.fields.username=new b.Components.TextBox.View({model:this.registration,modelAttr:"username",customClass:"txt-username",maxLength:20,placeHolder:b.i18n.t("auth.signup.usernamePlaceholder"),tooltipPos:this.options.tooltipPos}),this.listenTo(this.fields.username,"submit",this.triggerRegister.bind(this)),this.listenTo(this.fields.username,"show",function(){this.fields.username.val()&&this.registration.trigger("change:username")}),this.usernameRegion.show(this.fields.username);var c=this.fields.email=new b.Components.TextBox.View({model:this.registration,modelAttr:"email",customClass:"txt-email",placeHolder:b.i18n.t("auth.signup.emailPlaceholder"),tooltipPos:this.options.tooltipPos});this.options.emailTooltip&&c.listenTo(c,"show",function(){c.showTooltip(a.options.emailTooltip,{noWrap:!1,width:300,fadeOut:!0,fadeOutAfter:1e4})}),this.listenTo(this.fields.email,"show",function(){this.fields.email.val()&&this.registration.trigger("change:email")}),this.listenTo(this.fields.email,"submit",this.triggerRegister.bind(this)),this.emailRegion.show(this.fields.email),this.fields.password=b.Components.MaskInput.Controller.getMaskInput({model:this.registration,modelAttr:"password",customClass:"txt-pwd",maxLength:20,placeHolder:b.i18n.t("auth.signup.passwordPlaceholder"),tooltipPos:this.options.tooltipPos}),this.listenTo(this.fields.password,"submit",this.triggerRegister.bind(this)),this.passwordRegion.show(this.fields.password),this.fields.registerBtn=new b.Components.Button.View({label:this.options.strings.registerBtnLabel,theme:this.options.registerBtnTheme,customClass:"btn-register"}),this.listenTo(this.fields.registerBtn,"click",this.triggerRegister.bind(this)),this.registerBtnRegion.show(this.fields.registerBtn);var d={customClass:"btn-fbconnect",theme:b.Components.Button.Themes.alt8};this.options.useLargeSocialButtons&&(this.$el.addClass("kx-showing-large-social-btns"),d=f.extend(d,{theme:b.Components.Button.Themes.fbalt1,label:b.i18n.t("auth.signup.largeSocialFbBtnLabel")})),this.fields.fbconnectBtn=new b.Components.Button.View(d),this.fields.fbconnectBtn.on("click",function(){b.vent.trigger("info:fblogin:start",a.trackData),FB.login(function(b){"connected"===b.status&&a.trigger("fb:api:authenticated",b.authResponse.accessToken,a.trackData)},{scope:"email"})}),this.fbconnectBtnRegion.show(this.fields.fbconnectBtn);var e={customClass:"kx-btn-google-login",theme:b.Components.Button.Themes.alt17};this.options.useLargeSocialButtons&&(e=f.extend(e,{theme:b.Components.Button.Themes.gplusalt1,label:b.i18n.t("auth.signup.largeSocialGoogleBtnLabel")})),this.fields.googleBtn=new b.Components.Button.View(e),this.listenTo(this.fields.googleBtn,"click",function(){b.vent.trigger("info:googlelogin:start",a.trackData),gapi.auth.signIn({callback:googleAuthHandler})}),this.googleBtnRegion.show(this.fields.googleBtn),this.options.steamLoginEnabled&&(this.fields.steamBtn=new b.Components.Button.View({theme:b.Components.Button.Themes.alt26,customClass:"kx-btn-steam-login"}),this.listenTo(this.fields.steamBtn,"click",function(){b.execute("steamlogin:start",a,a.trackData)}),this.steamBtnRegion.show(this.fields.steamBtn)),this.options.showLoginLink||this.ui.loginLink.hide(),this.update(),this.$el.find("input").placeholder()},onShow:function(){b.request("banner:hide","delayedRegBanner",!0),this.signupInteraction()},serializeData:function(){return{options:this.options}}}),a.InlineView=a.View.extend({template:"#signup-form-inline-template",className:"kx-signup-form kx-inline-signup-form",initialize:function(a){var c=this,d={tooltipPos:"right",emailTooltip:"",useToggledSections:!1,useLargeSocialButtons:!1,strings:{registerBtnLabel:b.i18n.t("auth.signup.regBtnLabel"),notPostOnWall:b.i18n.t("auth.signup.notPostOnWall"),facebookWillBeImported:b.i18n.t("auth.signup.facebookWillBeImported"),changeUsernameAvatarLater:b.i18n.t("auth.signup.changeUsernameAvatarLater"),registerUsingFacebook:b.i18n.t("auth.signup.registerUsingFacebook"+(b.switches.steamLoginEnabled?"":"NoSteam")),regOr:b.i18n.t("auth.signup.regOr"),regFinePrint:b.i18n.t("auth.signup.regFinePrint"+(b.switches.steamLoginEnabled?"":"NoSteam"))},registerBtnTheme:b.Components.Button.Themes.alt7,steamLoginEnabled:b.switches.steamLoginEnabled},e=this.options=f.defaults({},a,d);this.options.strings=f.defaults({},a.strings,d.strings),e.useToggledSections&&(e=f.defaults(e,{socialSignupSelected:!0,emailSignupSelected:!1}),this.emailSignupSelected=e.emailSignupSelected,this.socialSignupSelected=e.socialSignupSelected),this.fields={},this.registration=e.registration,this.listenTo(b.vent,"page:shown",function(){c.interaction=!1}),this.trackData=f.defaults({},e.data,{trackControl:"widget"})},triggers:{"click .kx-login-link":"login:link:clicked"},events:{"click .tos span":"tosClicked","keyup .kx-username-region .kx-textbox":"signupInteraction","keyup .kx-email-region .kx-textbox":"signupInteraction","keyup .kx-password-region .kx-textbox":"signupInteraction","click .kx-toggle-section-ctrls a":"toggleSignupMethodClicked"},tosClicked:function(){this.trigger("tos:clicked"),this.signupInteraction()},onShow:function(){this.$el.find("input").placeholder()},serializeData:function(){return{options:this.options}}})}),KXL.module("AuthApp.Register.SignupForm",function(a,b,c,d,e,f){function g(c,d){function g(){var a=e.Deferred(),c=k.get("username");return m(c)?(b.request("validate:username",k.get("username")).done(function(c,d,e){d?(k.trigger("valid:username"),a.resolve()):(f.contains(e,"isTaken")?k.trigger("invalid:username",b.i18n.t("auth.signup.errUsernameNotAvailable")):k.trigger("invalid:username",b.i18n.t("auth.signup.errInvalidUsername")),a.reject())}),a):(k.trigger("invalid:username",b.i18n.t("auth.signup.errInvalidUsername")),a.reject())}function i(){var a=e.Deferred(),c=k.get("email");return m(c)&&c.toString().match(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i)?(b.request("validate:email",c).done(function(c,d,e){d?(k.trigger("valid:email"),a.resolve()):(e instanceof b.Errors.EmailInUseError?k.trigger("invalid:email",b.i18n.t("auth.signup.errEmailInUseError")):k.trigger("invalid:email",b.i18n.t("auth.signup.errInvalidEmail")),a.reject())}),a):(k.trigger("invalid:email",b.i18n.t("auth.signup.errInvalidEmail")),a.reject())}function j(){var a=e.Deferred();return k.isValid("password")?(k.trigger("valid:password"),a.resolve()):(k.trigger("invalid:password",b.i18n.t("auth.signup.errInvalidPassword")),a.reject()),a}d=d||{},d.registration=d.registration||new b.Entities.Registration,d.model=d.model||new a.Model;var k=d.registration,l=new c(d),m=function(a){return!(f.isNull(a)||f.isUndefined(a)||f.isString(a)&&""===e.trim(a)||f.isArray(a)&&f.isEmpty(a))};return k.on("change:username",f.debounce(function(){g()}),300),k.on("change:email",f.debounce(function(){i()}),300),k.on("change:password",f.debounce(function(){j()}),300),l.on("tos:clicked",function(){b.execute("show:TOS")}),l.on("toggle:signup:method",function(){l.toggleEmailSignupSection(l.emailSignupSelected?!1:!0)}),l.on("register:clicked",function(a){h||(h=!0,e.when(g(),i(),j()).done(function(){b.vent.trigger("info:register:submit",a),l.trigger("register:submit",k,a),h=!1}))}),l}a.Model=c.Model.extend({defaults:function(){return{username:"",password:"",email:"",state:a.Model.states.NOT_REG,stateDetails:""}}});var h=(a.Model.states={NOT_REG:"Not Registered",PENDING:"Pending Registration",VALIDATING:"Validating",VALIDATION_ERRORS:"Validation Errors",SUCCESS:"Registration Success",UNKNOWN:"Registration Unknown"},!1);a.Controller={getInlineSignupForm:function(b){return g(a.InlineView,b)},getSignupForm:function(b){return g(a.View,b)}}}),KXL.module("AuthApp",function(a,b,c,d,e,f){function g(a){b.currentUser=b.request("new:user:entity",a);var c=b.request("usergame:entities",b.currentUser.id);return c.then(function(){b.currentUserGames&&b.currentUserGames.length&&!b.appModel.get("context")&&null!==b.appModel.get("context")&&b.execute("context:set",b.games.get(b.currentUserGames.first().id))}),b.currentUserGames=c._collection,b.currentUserGroups=new b.Group.Entities.UserGroups,b.currentUserGroups.fetch({parse:!0}).always(function(){b.fetchingCurrentUserGroups.resolve(b.currentUserGroups)}),b.appModel.set("currentUser",b.currentUser),b.vent.trigger("app:reset"),b.vent.trigger("auth:changed"),b.currentUser}function h(a){var c;b.currentUser&&(c={kxid:b.currentUser.id,username:b.currentUser.get("username")}),b.vent.trigger(a,c)}function i(a,c){if(a&&a.user){g(a.user),b.execute("forum:login"),f.has(a),c.resolve(b.currentUser,a.isNew,a.hasAvatar);var d=b.currentUser.get("settings");d&&d.locale&&d.locale!==b.config.locale&&b.execute("set:locale",d.locale)}else c.reject(a)}function j(){b.request("banner:hide"),b.request("banner:remove","delayedRegFormBanner"),b.request("banner:create",{bannerId:"delayedRegFormBanner",view:new b.HeaderApp.Header.SimpleRibbon({message:b.i18n.t("auth.success")}),className:(b.currentUser&&b.currentUser.get("acTitleId")||"")+" kx-success-state"}),f.delay(function(){b.vent.trigger("completed:deferred:registration"),b.request("banner:hide","delayedRegFormBanner",!0)},6e3)}function k(a){return e.ajax({url:b.config.API_URL+"/email-changes",data:JSON.stringify({newEmail:a}),type:"POST",contentType:"application/json"})}var l;a.Router=d.AppRouter.extend({appRoutes:{"login(/)":"showLoginDialog","logout(/)":"logout","register(/)(:options)":"parseRegisterOptions",tos:"showTOS",gamealerts:"showGA","help/tos":"showTOS",privacypolicy:"showPP","help/privacypolicy":"showPP",cookiepolicy:"showCP","help/cookiepolicy":"showCP","forgot-password-reset/:token":"showForgotPasswordResetDialog","confirm-email-change/:token":"showEmailChangeConfirmationDialog","email-verification/:token":"handleEmailVerification"}}),a.RegisterSteps={SIGNUP_FORM:"display sign up form",IMPORT_FB_GAMES_PROMPT:"display import fb games prompt",FB_SYNC:"do fb sync",CONFIRM_FB_GAMES:"display confirm fb games",IMPORT_FB_FRIENDS:"display import facebook friends step",CAPTCHA:"display captcha step",CREATE_ACCOUNT:"creating the account",SUCCESS:"display success step",LOGIN_FORM:"display login form",FB_MERGE_CONFLICT_PROMPT:"facebook account already used",FACEBOOK_REGISTER:"perform facebook registration",COMPLETE_FACEBOOK_REGISTER:"complete a facebook register",VERIFY_EMAIL:"verifying email"},a.STEAM_LOGIN_URL="/auth/steam?login",a.STEAM_CREDS_CHECK_URL="/auth/steam/credentials";var m=b.Facades.Kixeye,n=b.Facades.Facebook,o=d.Controller.extend({showTOS:function(){window.open(b.config.LEGAL_URL)},showPP:function(){b.execute("show:TOS",{legal:"showPrivacyPolicy"})},showCP:function(){b.execute("show:TOS",{legal:"showCookiePolicy"})},showGA:function(){b.execute("show:TOS",{legal:"showGameAlerts"})},showImportFacebookFriendsDialog:function(){b.asyncRequest("async:load:module","auth/register/import_friends").then(function(){b.request("show:default:dialog",b.AuthApp.Register.ImportFriends.Controller.getView(b.currentUser.id),{showCloseButton:!1})})},showLoginDialog:function(c){b.currentUser||(c=f.extend(c||{},{step:a.RegisterSteps.LOGIN_FORM}),this.showRegisterDialog(c))},logout:function(a){var c={suppressFbLogout:!1,reload:!0};return a=f.defaults({},a,c),a.suppressFbLogout||n.logout(),b.execute("forum:logout"),m.logout().done(function(){a.reload?location.href="/":(b.currentUser=null,b.appModel.set("userSettings",b.request("new:user:settings:entity",{})),b.appModel.set("currentUser",null),b.vent.trigger("app:reset"),b.vent.trigger("auth:changed"))})},autoRegister:function(a){var c=b.request("auto:register:submit",a);return c.done(function(){b.execute("auth:register:deferred:start");var c=b.webGames.findWhere({urlName:a}),d=c&&c.get("commonName");d&&f.has(b.config.autoRegCommonNames,d)&&b.execute("game:play:load",a)})},doFbLogin:function(a,c){var d=e.Deferred(),g=f.extend({},c);return m.fbLogin(a).done(function(a){g.response=a,b.vent.trigger("info:fblogin:success",g),i(a,d)}).fail(function(a){g.error=a,b.vent.trigger("info:fblogin:error",g),d.reject(a)}),d},doGoogleLogin:function(a,c){var d=e.Deferred(),g=f.extend({},c);return m.googleLogin(a).done(function(a){g.response=a,b.vent.trigger("info:googlelogin:success",g),i(a,d)}).fail(function(a){g.error=a,b.vent.trigger("info:googlelogin:error",g),d.reject(a)}),d},doSteamLogin:function(a,c){var d=e.Deferred();if(a&&a.user){var g=f.extend({response:a},a,c);b.vent.trigger("info:steamlogin:success",g),i(g,d)}else d.reject(a);return d},doLoginCall:function(a,c){var d=e.Deferred();return m.login(a,c).done(function(a){if(a&&a.error){var c;c=429===a.error?new b.Errors.TooManyLoginAttemptsError:"invalid_request"===a.error||f.contains([404,401],a.error)?a.detail&&!a.detail.deviceFingerprint?new b.Errors.DeviceFingerprintError:a.detail&&a.detail.deviceFingerprintCheck===!1?new b.Errors.IOvationBlockedError:new b.Errors.InvalidCredentialsError:new b.Errors.GenericLoginError,d.reject(c)}else a&&a.user?d.resolve(a):d.reject(new b.Errors.GenericLoginError)}).fail(function(){d.reject(new b.Errors.GenericLoginError)}),d.promise()},checkCredentials:function(a,b){var c=e.Deferred();return this.doLoginCall(a,b).done(function(a){c.resolve(a.user)}).fail(function(a){c.reject(a)}),c.promise()},doLogin:function(a,c){var d=e.Deferred();return this.doLoginCall(a,c).done(function(a){b.vent.trigger("info:login:success"),i(a,d)}).fail(function(a){b.vent.trigger("info:login:error",{error:a}),d.reject(a)}),d.promise()},showForgotPasswordDialog:function(){var a=this;b.asyncRequest("async:load:module","auth/forgot_password").then(function(){a.forgotPasswordModel=new b.AuthApp.ForgotPassword.ForgotPasswordModel;var c=b.AuthApp.ForgotPassword.Controller.getView({model:a.forgotPasswordModel});b.request("show:default:dialog",c)})},sendForgotPassword:function(){var a=this.forgotPasswordModel.save();return a},showForgotPasswordConfirmationDialog:function(){b.asyncRequest("async:load:module","auth/forgot_password").then(function(){var a=b.AuthApp.ForgotPassword.Controller.getConfirmationView();b.request("show:default:dialog",a)})},showEmailChangeConfirmationDialog:function(a){m.changeEmailLogin(a).done(function(a){a&&a.user?(g(a.user),b.execute("settings:email:change:success")):b.execute("settings:show")})},handleEmailVerification:function(c){var d=this;l||(l=!0,this.verifyEmail(c).done(function(c){if("unavailable"==b.currentUser.get("presence")&&c.get("verificationRequired")&&c.get("acTitleId")){var e=b.webGames.where({titleId:c.get("acTitleId")})[0];b.execute("game:play:load",e.get("urlName")),d.showDelayedRegisterFormBanner({step:a.RegisterSteps.SUCCESS,suppressSuccessStep:!1}),b.GamesApp.Game.Controller.xFrameMessager.on("xfm_ready",function(){h("registration:complete:message"),b.vent.trigger("info:register:success",f.extend({wasDeferred:!0,trackSource:"email",trackControl:"ribbon"},b.currentUser.toJSON()))})}else b.execute("settings:email:verify:success")}).fail(function(){b.execute("settings:show")}))},verifyEmail:function(a){var b=e.Deferred();return m.emailVerificationLogin(a).done(function(a){b.resolve(g(a))}).fail(b.reject),b},isTempUser:function(){return b.currentUser&&"temp"===b.currentUser.get("status")},isUnverifiedUser:function(){return this.isTempUser()&&b.currentUser.get("hasPassword")},hasGroupSuperAdmin:function(a){return a.where({roleId:"group-administrators"}).length>0},showForgotPasswordResetDialog:function(a){b.currentUser||m.forgotPasswordLogin(a).done(function(a){if(a&&a.user){g(a.user);var c=new b.Entities.User({userId:b.currentUser.id});b.asyncRequest("async:load:module","auth/forgot_password").then(function(){var a=b.AuthApp.ForgotPassword.Controller.getResetPasswordView({model:c});b.request("show:default:dialog",a)})}})},showPasswordResetCompleteDialog:function(){b.asyncRequest("async:load:module","auth/forgot_password").then(function(){var a=b.AuthApp.ForgotPassword.Controller.getResetCompleteView();b.request("show:default:dialog",a)})},showFbSyncDialog:function(a){b.asyncRequest("async:load:module","auth/register/import_fb_games_prompt").then(function(){function c(){o.showError(b.i18n.t("auth.registrationFailed")),d()}function d(){o.toggleLoadingState(!1)}function f(){o.toggleLoadingState(!0)}function h(){b.asyncRequest("async:load:module","auth/register/confirm_games").then(function(){var a=new b.AuthApp.Register.ConfirmGames.Controller.getView({collection:p,userId:b.currentUser.id});o.showStep(a),a.on("submit",function(){l()})})}function i(d){var e=new b.AuthApp.Register.ImportFbGamesPrompt.ImportFbMergeConflictPromptExistingAccount({heading:b.i18n.t("auth.fbgames.mergeConflict.heading"),confirmBtnLabel:b.i18n.t("auth.fbgames.mergeConflict.continueBtnLabel"),model:d});e.on("confirm:clicked",function(){m.logout({suppressFbLogout:!0,reload:!1}).then(function(){return m.fbLogin(a).done(function(a){a&&a.user&&g(a.user)}).fail(function(){c()})}).done(function(){b.dialogRegion.closeDialog()})}),e.on("cancel:clicked",function(){b.dialogRegion.close()}),o.showStep(e)}function j(a){var c=new b.AuthApp.Register.Common.ConfirmPrompt({heading:b.i18n.t("auth.loginEmailConflictError",{email:a}),showConfirmBtn:!1});c.on("cancel:clicked",function(){b.dialogRegion.close()}),o.showStep(c)}function k(){var a=new b.AuthApp.Register.Common.ConfirmPrompt({heading:b.i18n.t("auth.fbgames.caution.heading"),confirmBtnLabel:b.i18n.t("auth.fbgames.caution.continueBtnLabel")});a.on("confirm:clicked",function(){n()}),a.on("cancel:clicked",function(){b.dialogRegion.close()}),o.showStep(a)}function l(){var a=b.request("get:facebook:friends:on:KXL:entities",b.currentUser.id),g=b.request("user:friend:request:entities",b.currentUser.id,{sent:!0,recieved:!1});f(),e.when(a,g).done(function(){if(d(),a._collection.length){var c=new b.Entities.FacebookFriends(a._collection.filter(function(a){return!g._collection.findWhere({targetId:a.get("userId")})}),{id:b.currentUser.id});if(c.length)return void b.asyncRequest("async:load:module","auth/register/import_friends").then(function(){var a=b.AuthApp.Register.ImportFriends.Controller.getView(b.currentUser.id,{collection:c});a.on("submit",function(){b.dialogRegion.closeDialog()}),o.showStep(a)})}b.dialogRegion.closeDialog()}).fail(c)}function n(){f(),m.facebookMerge(b.currentUser.id,a).then(function(a){return a&&a.destinationUser&&g(a.destinationUser),b.request("usergame:entities",b.currentUser.id).then(function(a){d(),p=a,p&&p.length?h():l()})}).fail(function(a){a instanceof b.Errors.FacebookMergeConflictError?i(new b.Entities.User({id:a.detail.id,username:a.detail.username})):a instanceof b.Errors.EmailConflictError?j(a.detail.email):c()}).always(function(){d()})}var o=new b.AuthApp.Register.Wizard.View({headerText:b.i18n.t("auth.fbgames.dialog.heading")});b.request("show:default:dialog",o);var p=b.request("current:user:game:entities");p.length?k():n()})},parseRegisterOptions:function(a){var c={};a&&"string"==typeof a&&(c.signupFormOptions=f.chain(a.split("&")).map(function(a){var b=a.split("="),c=decodeURIComponent(b[1]);return"true"===c.toLowerCase()?c=!0:"false"===c.toLowerCase()&&(c=!1),[b[0],c]}).object().value(),b.navigate("register")),b.appModel.get("pages").selected||b.execute("home:show"),this.showRegisterDialog(c)},showDelayedRegisterFormBanner:function(d){function e(){i.tomeDelayedReg||b.request("banner:hide","delayedRegFormBanner",!1,{manual:!0,disableRegBanner:!1})}var g=d||{},i=this;if(!b.appModel.get("deferredRegFormBannerShowing")){var k=new b.AuthApp.Register.Wizard.View({}),l=b.request("new:deferred:reg:banner:signup:view"),m=new c.Wreqr.EventAggregator,n={bannerId:"delayedRegFormBanner",view:l,removeOnClose:!1,show:!0};b.context?n.className=b.context.get("titleId"):b.currentUser&&b.currentUser.get("acTitleId")&&(n.className=b.currentUser.get("acTitleId")),b.request("banner:hide");var o=b.request("banner:create",n),q=a.RegisterSteps;o.listenTo(m,"performing:step",function(a){switch(a){case q.CAPTCHA:case q.SIGNUP_FORM:case q.SUCCESS:case q.LOGIN_FORM:case q.VERIFY_EMAIL:o.toggleClosable(!0);break;case q.CONFIRM_FB_GAMES:case q.FB_MERGE_CONFLICT_PROMPT:case q.IMPORT_FB_FRIENDS:o.toggleClosable(!1);break;case q.IMPORT_FB_GAMES_PROMPT:o.toggleClosable(g.startNowUrlName&&g.startNowUrlName.length)}}),o.on("removed",function(){o.stopListening(m,"performing:step"),b.appModel.set("deferredRegFormBannerShowing",!1)}),o.on("hidden",function(){b.appModel.set("deferredRegFormBannerShowing",!1)}),l.listenTo(b.appModel.get("pages"),"select:one",e),l.listenTo(b.appModel,["change:currentProfilePageUserId","change:context"].join(" "),e),l.listenTo(m,"registration:form:closable",o.toggleClosable),l.listenTo(m,"registration:wizard:close",function(){b.request("banner:hide","delayedRegFormBanner",!0)}),l.listenTo(b.vent,"info:register:success",function(){h("registration:complete:message"),b.request("banner:hide","delayedRegFormBanner",!0),i.tomeDelayedReg&&j()}),l.listenTo(b.vent,"info:register:cancel",function(){h("registration:failure:message"),b.request("banner:hide","delayedRegFormBanner",!0)}),l.showCenterView(k),b.appModel.set("deferredRegFormBannerShowing",!0),g.data=f.defaults({},g.data,{trackControl:"ribbon",trackSource:g.referrer||"sourceunknown",trackGameUrlName:g.referringGameUrlName||b.context&&b.context.get("urlName")}),p.setupDelayedRegisterWizard(k,m,g)}return b.request("banner:get","delayedRegFormBanner")},setupDelayedRegisterWizard:function(c,d,e){e=e||{};var g=this,h=b.i18n.t("auth.delayedRegistrationSaveProgressRegister"),i=new b.Entities.DelayedRegistration,j=!1;e.verifyEmailOptions=e.verifyEmailOptions||{};var k=b.Common.Utils.CookieUtils.getCookie("organicStartNow"),l=b.currentUser&&b.currentUser.id,m=k&&l&&k===l;b.context&&"tome"==b.context.get("commonName")||this.isUnverifiedUser()?(this.tomeDelayedReg=!0,b.request("banner:get","delayedRegFormBanner").currentView&&b.request("banner:get","delayedRegFormBanner").currentView.on("close:clicked",function(){b.appModel.set("deferredRegFormBannerShowing",!1);var a=new b.HeaderApp.Header.SimpleRibbon({message:b.i18n.t("auth.delayedRegistrationPlayLiveMatches")});a.on("click",function(){b.request("banner:hide","promptUserToReg"),g.showDelayedRegisterFormBanner()}),b.request("banner:create",{bannerId:"promptUserToReg",view:a,className:b.context.get("titleId")})}),e.suppressSuccessStep=!1,e.verifyEmailHeaderText=b.i18n.t("auth.delayedRegistrationVerify"),h=b.i18n.t("auth.delayedRegistrationPlayLiveMatches"),e.verifyEmailOptions.toggledFormFields=!0,j=b.switches&&b.switches.tomeEmailVerificationEnabled,j&&this.isUnverifiedUser()&&(e.step=a.RegisterSteps.VERIFY_EMAIL)):e&&e.referrer&&"deferred-reg-"!==e.referrer.substr(0,13)&&"banner"!==e.referrer&&(h=b.i18n.t("auth.delayedRegistrationAccountRequired")),e=f.extend({suppressSuccessStep:!0,captchaRequired:m,registration:i,skipFbGamesPrompt:!0,registrationHeaderText:h,emailSignupSubHeaderText:""},e),e.signupFormOptions=f.extend({},{useToggledSections:!0,hideSocialToggle:!0,emailSignupSelected:!0,showLoginLink:!1,delayedRegistration:!0,registerBtnTheme:b.Components.Button.Themes.alt22,emailVerificationRequired:j,strings:{registerBtnLabel:b.i18n.t("auth.signup.createAccount.button"),notPostOnWall:b.i18n.t("auth.signup.notPostOnWall"),facebookWillBeImported:b.i18n.t("auth.signup.facebookWillBeImported"),registerUsingFacebook:b.i18n.t("auth.signup.registerUsingFacebook"+(b.switches.steamLoginEnabled?"":"NoSteam")),regOr:b.i18n.t("auth.signup.regOr"),regFinePrint:b.i18n.t("auth.signup.regFinePrintOnlyEmail"),emailVerification:b.i18n.t("auth.signup.emailVerification")}},e.signupFormOptions),p.setupRegisterWizard(c,d,e)},showRegisterDialog:function(d,e){var f=new b.AuthApp.Register.Wizard.View({}),g=b.request("show:default:dialog",f,{dialogId:"registerDialog"}),h=new c.Wreqr.EventAggregator,i=a.RegisterSteps;return g.listenTo(h,"performing:step",function(a){switch(a){case i.CAPTCHA:case i.SIGNUP_FORM:case i.SUCCESS:case i.LOGIN_FORM:case i.VERIFY_EMAIL:g.toggleClosable(!0);break;case i.CONFIRM_FB_GAMES:case i.FB_MERGE_CONFLICT_PROMPT:case i.IMPORT_FB_FRIENDS:g.toggleClosable(!1);break;case i.IMPORT_FB_GAMES_PROMPT:d&&d.startNowUrlName?(g.options.clickVeilToClose=!1,g.toggleClosable(!0)):g.toggleClosable(!1)}}),g.listenTo(h,"registration:form:closable",function(a){g.toggleClosable(a)}),g.listenTo(h,"registration:wizard:close",function(){b.dialogRegion.closeDialog()}),e?void p.setupDelayedRegisterWizard(f,h,d):void p.setupRegisterWizard(f,h,d)},setupRegisterWizard:function(d,h,i){function k(){d.showError(b.i18n.t("auth.registrationFailed")),l()}function l(){d.toggleLoadingState(!1)}function n(){d.toggleLoadingState(!0)}function o(a){function c(){n(),h.trigger("performing:step",D.CREATE_ACCOUNT);var c=p.doRegister(F.get("username"),F.get("password"),F.get("email"),{data:a,registration:F});
c.done(function(a){if((a.get("user").acTitleId="tome-immortal-arena")&&b.Facades.Kixeye.verifyEmail(),B.isTempUser())q(d);else{G.set("isNew",!0);var c=!0;C.contextGameUrlName&&"fb"!==b.webGames.findWhere({urlName:C.contextGameUrlName}).get("platform")&&(c=!1),c&&!C.skipFbGamesPrompt?t():u()}}).fail(function(a){r(a instanceof b.Errors.UsernameConflictError?{validationErrors:{username:a.message}}:a instanceof b.Errors.RegistrationAuthorizationError?{errorMsg:a.message}:{errorMsg:b.i18n.t("auth.registrationFailed")})})}H?(n(),h.trigger("performing:step",D.CAPTCHA),d.setHeaderText(E),b.asyncRequest("async:load:module","auth/register/captcha").then(function(){var e=b.AuthApp.Register.Captcha.Controller.getCaptcha();e.on("validated",function(){c()}),d.showStep(e),b.vent.trigger("info:register:captcha:start",a)})):(F.set("validated",!0),c())}function q(){n(),b.asyncRequest("async:load:module","auth/register/verify").then(function(){h.trigger("performing:step",D.VERIFY_EMAIL),d.setHeaderText(C.verifyEmailHeaderText);var a=new b.AuthApp.Register.Verify.Layout(f.extend(C.verifyEmailOptions||{},{model:b.currentUser}));d.showStep(a),a.on("verify:send:verification:email:failed",function(a){d.showError(a)}),a.on("verify:email:changed",function(){d.clearError()})})}function r(a){var c=f.extend({},a);h.trigger("performing:step",D.SIGNUP_FORM),d.setHeaderText(E),d.setSubHeaderText(C.registrationSubHeaderText);var e=c.data;e||(c.referrer?(e={referrer:c.referrer,trackSource:c.referrer},"game"==c.referrer&&b.context&&(e.game=b.context.get("commonName"))):c.contextGameUrlName&&(e={trackSource:c.contextGameUrlName}));var g=f.extend({registration:F,data:e},C.signupFormOptions),i=b.AuthApp.Register.SignupForm.Controller.getSignupForm(g);i.on("show",function(){c.errorMsg&&i.setErrorMsg(c.errorMsg),c.validationErrors&&i.showValidationErrors(c.validationErrors)}),i.on("signup:method:updated",function(){i.socialSignupSelected?d.setSubHeaderText(C.registrationSubHeaderText):void 0!==C.emailSignupSubHeaderText&&d.setSubHeaderText(C.emailSignupSubHeaderText)}),d.showStep(i),i.on("register:completed",function(){t()}),i.on("login:link:clicked",function(){w()}),i.on("fb:api:authenticated",function(a,c){G.set("fbAccessToken",a),y(c).fail(function(a){h.trigger("registration:form:closable",!0),a instanceof b.Errors.EmailConflictError?d.showError(b.i18n.t("auth.loginEmailConflictError",{email:a.detail.email})):a instanceof b.Errors.IOvationBlockedError||a instanceof b.Errors.DeviceFingerprintError?(d.showError(a.message),l()):k()})}),i.listenTo(b,"google:api:authenticated",function(a){G.set("googleAccessToken",a),p.doGoogleLogin(a).done(function(a,b){b?t():h.trigger("registration:wizard:close")}).fail(function(a){h.trigger("registration:form:closable",!0),a instanceof b.Errors.IOvationBlockedError||a instanceof b.Errors.DeviceFingerprintError?(d.showError(a.message),l()):k()})}),i.on("steam:api:authenticated",function(a){a.done(function(){h.trigger("registration:wizard:close")}).fail(function(){h.trigger("registration:form:closable",!0),k()})}),i.on("register:submit",function(a,b){F.set("username",a.get("username")),F.set("email",a.get("email")),F.set("password",a.get("password")),o(b)})}function s(){h.trigger("performing:step",D.CONFIRM_FB_GAMES),d.setHeaderText(E),n();var a=G.get("userGames")||b.request("current:user:game:entities");b.asyncRequest("async:load:module","auth/register/confirm_games").then(function(){var c=new b.AuthApp.Register.ConfirmGames.Controller.getView({collection:a,userId:b.currentUser.id});d.showStep(c),c.on("submit",function(){A()})})}function t(){h.trigger("performing:step",D.IMPORT_FB_GAMES_PROMPT),d.setHeaderText(E),n();var a={};if(C.startNowUrlName){var c=b.webGames.findWhere({urlName:C.startNowUrlName});a.startNowUrlName=C.startNowUrlName,a.startNowGameName=c.get("name")}b.asyncRequest("async:load:module","auth/register/import_fb_games_prompt").then(function(){var c=new b.AuthApp.Register.ImportFbGamesPrompt.View(a);d.showStep(c),c.on("import:games:selected",function(a){G.set("fbAccessToken",a),z()}),c.on("new:game:selected",function(){if(C.startNowUrlName){b.dialogRegion.close();var a=e("#kx-body-veil");return a.addClass("kx-loader-veil"),a.show(),void p.autoRegister(C.startNowUrlName).done(function(a){var c=a&&a.get("user");c&&c.id&&b.Common.Utils.CookieUtils.setCookie("organicStartNow",c.id,365)})}u()})})}function u(){function a(a){b.asyncRequest("async:load:module","auth/register/success").then(function(){b.AuthApp.Register.Success.Controller.getView({collection:a}).done(function(a){d.showStep(a)})})}function e(c){return c?(b.execute("game:play:load",c.get("urlName")),void b.dialogRegion.close()):void a(b.webGames)}if(C.signupFormOptions&&C.signupFormOptions.delayedRegistration)return void v();if(C.suppressSuccessStep)return void b.dialogRegion.close();h.trigger("performing:step",D.SUCCESS),d.setHeaderText(E);var f=G.get("userGames");if(n(),C.contextGameUrlName)e(b.webGames.findWhere({urlName:C.contextGameUrlName}));else if(f&&f.length)if(1===f.length)e(b.webGames.get(f.first().get("gameId")));else{var g;g=new c.FilteredCollection(null,{collection:b.webGames}),g.setFilter(function(a){return f.findWhere({gameId:a.id})}),a(g)}else a(b.webGames)}function v(){b.currentUser&&"tome-immortal-arena"==b.currentUser.get("acTitleId")?j():(b.vent.trigger("completed:deferred:registration"),b.dialogRegion.close()),C&&C.referrer&&C.paymentData&&(C.paymentData.specialOfferId?b.vent.trigger("payment:specialoffer:start",C.paymentData.orderInfo,C.paymentData.specialOfferId):b.vent.trigger("payment:start",null,C.paymentData.orderInfo))}function w(){h.trigger("performing:step",D.LOGIN_FORM),d.setHeaderText(b.i18n.t("auth.loginHeaderText"));var a=b.request("new:login:view");a.on("authenticated",function(){h.trigger("registration:wizard:close"),C&&C.loginUrlName&&b.execute("game:play:load",C.loginUrlName)}),a.on("fb:authenticated",function(a,c,d){G.set("fbAccessToken",a),d?(G.set("isNew",d),A()):h.trigger("registration:wizard:close"),C&&C.loginUrlName&&b.execute("game:play:load",C.loginUrlName)}),a.on("google:authenticated",function(a,c,d){G.set("googleAccessToken",a),d?(G.set("isNew",d),t()):(h.trigger("registration:wizard:close"),C&&C.loginUrlName&&b.execute("game:play:load",C.loginUrlName))}),a.on("steam:authenticated",function(){h.trigger("registration:wizard:close"),C&&C.loginUrlName&&b.execute("game:play:load",C.loginUrlName)}),a.on("register:link:clicked",function(){r()}),d.showStep(a)}function x(a,c){h.trigger("performing:step",D.FB_MERGE_CONFLICT_PROMPT),d.setHeaderText(E),n(),b.asyncRequest("async:load:module","auth/register/import_fb_games_prompt").then(function(){var e=new b.AuthApp.Register.ImportFbGamesPrompt.ImportFbMergeConflictPrompt({conflictedUser:new b.Entities.User({id:a,username:c})});d.showStep(e),e.on("submit",function(){var a=e.val();"yes"===a?m.logout({suppressFbLogout:!0,reload:!1}).then(function(){return m.fbLogin(G.get("fbAccessToken")).done(function(a){a&&a.user&&g(a.user)}).fail(function(){k()})}).done(function(){h.trigger("registration:wizard:close")}):u()})})}function y(a){return h.trigger("registration:form:closable",!1),n(),p.doFbLogin(G.get("fbAccessToken"),a).done(function(a,b){b?(G.set("isNew",b),A()):h.trigger("registration:wizard:close")})}function z(){return h.trigger("performing:step",D.FB_SYNC),C.startNowUrlName?void m.fbLogin(G.get("fbAccessToken")).done(function(a){var c=e("#kx-body-veil");a&&a.user&&(b.vent.trigger("info:startnow:fb:success",C.startNowUrlName),g(a.user),b.execute("game:play:load",C.startNowUrlName)),h.trigger("registration:wizard:close"),c.addClass("kx-loader-veil"),c.show()}).fail(function(){k()}):(d.setHeaderText(E),m.facebookMerge(b.currentUser.id,G.get("fbAccessToken")).then(function(a){return a&&a.destinationUser&&g(a.destinationUser),b.request("usergame:entities",b.currentUser.id).then(function(a){G.set("userGames",a),a&&a.length?s():A()})}).fail(function(a){a instanceof b.Errors.FacebookMergeConflictError?x(a.detail.id,a.detail.username):k()}))}function A(){function a(){G.get("isNew")?u():h.trigger("registration:wizard:close")}var c=b.request("get:facebook:friends:on:KXL:entities",b.currentUser.id),f=b.request("user:friend:request:entities",b.currentUser.id,{sent:!0,recieved:!1});n(),e.when(c,f).done(function(){if(c._collection.length){var e=new b.Entities.FacebookFriends(c._collection.filter(function(a){return!f._collection.findWhere({targetId:a.get("userId")})}),{id:b.currentUser.id});if(e.length)return h.trigger("performing:step",D.IMPORT_FB_FRIENDS),d.setHeaderText(E),void b.asyncRequest("async:load:module","auth/register/import_friends").then(function(){var c=b.AuthApp.Register.ImportFriends.Controller.getView(b.currentUser.id,{collection:e});c.on("submit",function(){a()}),d.showStep(c)})}a()}).fail(k)}var B=this,C=f.extend({captchaRequired:!0,contextGameUrlName:null,fbAccessToken:null,isNew:null,suppressSuccessStep:!1,signupFormOptions:{},registrationHeaderText:b.i18n.t("auth.registrationHeaderText"),registrationSubHeaderText:"",emailSignupSubHeaderText:void 0,verifyEmailHeaderText:b.i18n.t("auth.verifyEmailHeaderText")},i),D=a.RegisterSteps,E=C.registrationHeaderText,F=C.registration||new b.Entities.Registration,G=new b.Entities.Model({step:C.step||D.SIGNUP_FORM,userGames:null,fbAccessToken:C.fbAccessToken,isNew:C.isNew}),H=C.captchaRequired&&(b.switches.captchaReCaptchaEnabled||b.switches.captchaAyahEnabled);switch(d.listenTo(h,"performing:step",function(a){G.set("step",a),d.clearError(),d.setHeaderText(E),d.setSubHeaderText("")}),G.get("step")){case D.CREATE_ACCOUNT:o(C&&C.data);break;case D.VERIFY_EMAIL:q();break;case D.IMPORT_FB_GAMES_PROMPT:t();break;case D.FB_SYNC:E=b.i18n.t("auth.fbConnectHeaderText"),z();break;case D.FB_MERGE_CONFLICT_PROMPT:x();break;case D.CONFIRM_FB_GAMES:s();break;case D.IMPORT_FB_FRIENDS:A();break;case D.COMPLETE_FACEBOOK_REGISTER:y({});break;case D.SUCCESS:u();break;case D.LOGIN_FORM:w();break;default:r(C)}},doRegister:function(a,c,d,g){function h(a){j._saveUser(a,{data:k.data}).then(function(a){m.resolve(a)}).fail(function(a){m.reject(a)}).always(function(){j.registerInProgress=!1})}if(!this.registerInProgress&&!this.autoRegisterInProgress){this.registerInProgress=!0;var i,j=this,k=f.defaults({},g,{data:void 0,registration:void 0}),l=k.registration;i=l&&l.has("username")&&l.has("email")&&l.has("password")?l:new b.Entities.Registration({username:a,email:d,password:c,validated:l&&l.get("validated")||!1});var m=e.Deferred();return b.execute("fraud:fingerprint:get",function(a){i.set({deviceFingerprint:a}),h(i)}),m.promise()}},_saveUser:function(a,c){var d=f.defaults({},c,{data:{}}),h=e.Deferred(),i=this;try{var j=b.request("auth:is:temp:user"),k=f.extend({wasDeferred:j},d.data);a.bind("validated:invalid",function(a,b){h.reject(a,b)}),a.save(null,{success:function(a,c){try{if(c&&c.user)g(c.user),"temp"!=b.currentUser.get("status")?(f.extend(k,c.user),b.vent.trigger("info:register:success",k)):i.listenToOnce(b.currentUser,"change:status",function(){"active"==b.currentUser.get("status")&&(f.extend(k,c.user),b.vent.trigger("info:register:success",k))}),h.resolve(a);else if(c&&"authorization_failed"===c.state){var d,e;d=b.i18n.t(a.get("deviceFingerprint")?"auth.authorizationFailed":"auth.authorizationDenied"),e=new b.Errors.RegistrationAuthorizationError(d),k.error=e,b.vent.trigger("info:register:error",k),h.reject(e)}else k.error={error:"conflict"},b.vent.trigger("info:register:error",k),h.reject(a)}catch(e){h.reject(e)}},error:function(a,c){try{var d;switch(c.status){case 409:d=new b.Errors.UsernameConflictError;break;default:d=new b.Errors.BaseError}k.error=d,b.vent.trigger("info:register:error",k),h.reject(d)}catch(d){h.reject(d)}}})}catch(l){h.reject(l)}return h.promise()},doAutoRegister:function(a){var c=this;if(!this.autoRegisterInProgress&&!this.registerInProgress){this.autoRegisterInProgress=!0;var d=b.webGames.findWhere({urlName:a}),h={verificationRequired:!1,validated:!0};d&&(h.titleId=d.get("titleId"),"tome"==d.get("commonName")&&b.switches&&f.isBoolean(b.switches.tomeEmailVerificationEnabled)&&(h.verificationRequired=b.switches.tomeEmailVerificationEnabled));var i=new b.Entities.AutoRegistration(h),j={},k=e.Deferred();return i.save(null,{success:function(d,e){e&&e.user?(g(e.user,a,!0),b.vent.trigger("info:register:autoreg",a),k.resolve(d)):(j.error={error:"conflict"},k.reject(d)),c.autoRegisterInProgress=!1},error:function(d,e){var f;switch(e.status){case 409:f=new b.Errors.UsernameConflictError,b.vent.trigger("autoreg:error",f,a);break;default:f=new b.Errors.BaseError,b.vent.trigger("autoreg:error",f,a)}j.error=f,k.reject(f),c.autoRegisterInProgress=!1}}),k.promise()}},startSteamLogin:function(c,d,g){var h=this;if(this.steamViewListener=c,this.steamTrackData=d,b.vent.trigger("info:steamlogin:start",d),this.steamLoginWindow&&!this.steamLoginWindow.closed)return void this.steamLoginWindow.focus();var i=g?a.STEAM_CREDS_CHECK_URL:a.STEAM_LOGIN_URL;b.execute("fraud:fingerprint:get",function(a){return e.ajax({url:"/api/setDeviceFingerprint",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify({deviceFingerprint:a})}).then(function(){h.steamLoginWindow=window.open(i,"steamLoginWindow"),h.steamLoginWindow&&!h.boundSteamListener&&(h.steamLoginWindow.focus(),h.boundSteamListener=!0,h.listenToOnce(b.vent,"steam:auth:result",function(a){if(h.boundSteamListener=!1,h.steamLoginWindow&&!h.steamLoginWindow.closed&&(h.steamLoginWindow.close(),h.steamLoginWindow=void 0,!f.contains(["invalid","cancel"],a))){try{a=JSON.parse(a)}catch(c){}var d;g?(d=e.Deferred(),d.resolve(a)):(d=h.doSteamLogin(a,h.steamTrackData),d.fail(function(a){var c=f.extend(h.steamTrackData,{error:(a||"unknown_error").replace(/\s+/g,"_")});b.vent.trigger("info:steamlogin:error",c)})),h.steamViewListener&&!h.steamViewListener.isClosed&&h.steamViewListener.trigger("steam:api:authenticated",d)}},!1))})})}}),p=new o;b.addInitializer(function(){new a.Router({controller:p}),b.commands.setHandlers({"show:login:dialog":function(a){p.showLoginDialog(a)},logout:function(a){p.logout(a)},"auto:register":function(a){p.autoRegister(a)},"show:fb:sync:dialog":function(a){return p.showFbSyncDialog(a)},"show:register:dialog":function(a){p.showRegisterDialog(a)},"show:delayed:register:dialog":function(a){if(b.context){var c=b.context.get("commonName"),d=b.staticGames&&b.staticGames.findWhere({commonName:c});if(d&&"banner"===d.get("registration"))return void p.showDelayedRegisterFormBanner(a)}else if(b.currentUser.get("hasPassword"))return void p.showDelayedRegisterFormBanner();p.showRegisterDialog(a,!0)},"show:forgot:password:dialog":function(a){p.showForgotPasswordDialog(a)},"show:TOS":function(a){p.showTOS(a)},"show:forgot:password:confirmation":function(){p.showForgotPasswordConfirmationDialog()},"show:password:reset:complete":function(){p.showPasswordResetCompleteDialog()},"auth:register:deferred:start":function(){a.Register.Deferred.Controller.start()},"auth:register:deferred:show":function(b){a.Register.Deferred.Controller.show(b)},"auth:register:deferred:restart":function(){a.Register.Deferred.Controller.restart()},"steamlogin:start":function(a,b,c){p.startSteamLogin(a,b,c)}}),b.reqres.setHandlers({"validate:username":function(a,b){return m.validateUsername(a,b)},"validate:email":function(a){return m.validateEmail(a)},"auth:create:email:verification:token":function(a){return k(a)},"fblogin:submit":function(a,b){return p.doFbLogin(a,b)},"googlelogin:submit":function(a,b){return p.doGoogleLogin(a,b)},"new:login:view":function(b){return a.Login.Controller.getLogin(b)},"new:signup:form:view":function(b){return a.Register.SignupForm.Controller.getSignupForm(b)},"new:inline:signup:form:view":function(b){return a.Register.SignupForm.Controller.getInlineSignupForm(b)},"register:submit":function(a,b,c,d){return p.doRegister(a,b,c,d)},"auto:register:submit":function(a){return p.doAutoRegister(a)},"login:submit":function(a,b){return p.doLogin(a,b)},"check:credentials":function(a,b){return p.checkCredentials(a,b)},"send:forgot:password":function(){return p.sendForgotPassword()},"auth:register:deferred:gate":function(b){return a.Register.Deferred.Controller.gate(b)},"new:deferred:reg:banner:view":function(a){return new b.AuthApp.DeferredReg.View(a)},"new:deferred:reg:banner:signup:view":function(a){return new b.AuthApp.DeferredReg.BannerSignUpView(a)},"show:delayed:register:form:banner":function(a){return p.showDelayedRegisterFormBanner(a)},"auth:verify:email":function(a){return p.verifyEmail(a)},"auth:is:temp:user":function(){return p.isTempUser()},"auth:has:group:super:admin":function(a){return p.hasGroupSuperAdmin(a)}})})}),KXL.module("FraudApp",function(a,b,c,d,e,f){var g=this;a.OriginEvents={LOGIN:"login",PLAY:"play",PAYMENT:"payment"},g.defaultOptions={installActiveX:!1,installFlash:!1,activeXExcludesBitmask:12,realIPs:!0,javascriptUrl:null,javascriptLoadTimeout:1e4},g.atom=atom(),a.atom=g.atom,b.on("start",function(a){g.options=f.extend(g.defaultOptions,a.fraud)}),g.atom.provide("deviceFingerprint",function(a){b.execute("fraud:javascript:render"),g.atom.once("complete",function(){a(g.atom.get("deviceFingerprint"))}).once("failed",function(){a(void 0)})}),b.vent.on("info:game:load",function(){b.execute("fraud:fingerprint:get",e.noop)}),g.API={renderJavascript:function(){if(!g.atom.get("javascriptRendered")){var a=f.template('                var io_install_stm = <%= installActiveX %>;                var io_install_flash = <%= installFlash %>;                var io_exclude_stm = <%= activeXExcludesBitmask %>;                var io_enable_rip = <%= realIPs %>;                                /**                 * Callback that is called by the ioVation JS when the device fingerprint is updated.                 *                 * @param deviceFingerprint - the device fingerprint.                 * @param complete - boolean, whether all the collection methods have completed.                 */                var io_bb_callback = function (deviceFingerprint, complete) {                    KXL.execute(                        "fraud:fingerprint:update",                        deviceFingerprint,                        complete                    );                };',g.options);e.globalEval(a),e.ajax({url:g.options.javascriptUrl,dataType:"script",crossDomain:!0,timeout:g.options.javascriptLoadTimeout,success:function(){g.atom.set("javascriptLoaded",!0)},error:function(){g.atom.set("failed",!0)}}),g.atom.set("javascriptRendered",!0)}},updateFingerprint:function(a,b){g.atom.set("partialDeviceFingerprint",a),b&&g.atom.set({deviceFingerprint:a,complete:!0})},sendFingerprint:function(a,c,d){b.Facades.Kixeye.deviceFingerprints(a,c,d)},getFingerprint:function(a){g.atom.need("deviceFingerprint",function(b){a(b)})},getFingerprintPromise:function(){var a=e.Deferred();return g.API.getFingerprint(function(b){a.resolve(b)}),a.promise()}},b.commands.setHandlers({"fraud:javascript:render":g.API.renderJavascript,"fraud:fingerprint:update":g.API.updateFingerprint,"fraud:fingerprint:send":g.API.sendFingerprint,"fraud:fingerprint:get":g.API.getFingerprint}),b.reqres.setHandlers({"fraud:fingerprint:promise:get":g.API.getFingerprintPromise})}),KXL.module("Chat",function(a,b,c,d,e,f){a.InterfaceBase=c.Wreqr.EventAggregator.extend({PRESENCE:{AVAILABLE:"available",UNAVAILABLE:"unavailable",UNSUBSCRIBE:"unsubscribe",UNKNOWN:"unknown"},CONNECTION_STATUS:{0:"ERROR",1:"CONNECTING",2:"CONNFAIL",3:"AUTHENTICATING",4:"AUTHFAIL",5:"CONNECTED",6:"DISCONNECTED",7:"DISCONNECTING",8:"ATTACHED",9:"REBINDFAILED"},SUBDOMAIN:"kxl",WEBSOCKET_HEARTBEAT_INTERVAL:2e4,RETRY_DELAY:3e3,_connection:null,_jabberId:null,_bareJabberId:null,_locked:!1,_presenceEventQueue:[],_messageEventQueue:[],isConnected:function(){return this._connection&&this._connection.connected&&this._connection.authenticated?!0:!1},ping:function(){this.isConnected()&&this._connection.send($iq({}).c("ping",{xmlns:"urn:xmpp:ping"}))},_lock:function(){this._locked=!0},_unlock:function(){this._locked=!1,this._processEventQueues()},_emptyEventQueues:function(){this._presenceEventQueue=[],this._messageEventQueue=[]},_enqueuePresence:function(a){return this._presenceEventQueue.push(a),!0},_enqueueMessage:function(a){return this._messageEventQueue.push(a),!0},_processEventQueues:function(){var a=this,b=f.clone(a._presenceEventQueue),c=f.clone(a._messageEventQueue);a._emptyEventQueues(),f.each(b,function(b){a._onPresence(b)}),f.each(c,function(b){a._onMessage(b)})},_getFirstTokenFromResource:function(a){var b=Strophe.getResourceFromJid(a);return b&&-1!==b.indexOf("~")?b.split("~")[0]:b},_getSecondTokenFromResource:function(a){var b=Strophe.getResourceFromJid(a);return b&&-1!==b.indexOf("~")?b.split("~")[1]:b},_sendMessageStanza:function(a,b,c){if(b&&this.isConnected()){var d=$msg({to:a,type:c}).c("body").t(b);this._connection.send(d)}}}),a.User=function(a,b){this.userId=a,this.status=b,this._resources=[]},a.User.prototype._addResource=function(a){this._resources=f.union(this._resources,[a])},a.User.prototype._removeResource=function(a){this._resources=f.without(this._resources,a)},a.User.prototype._clearResources=function(){this._resources=[]},a.Message=function(a,b){this._interface=a,this.timestamp=null,this.userId=null,this.username=null,this.type=null,this.body="",this.errorCode=null,this.me=!1,this.parseStanza(b)},a.Message.prototype.parseStanza=function(a){var c=this;c.type=a.getAttribute("type");var d=a.getAttribute("from"),f=!1;if(e(a).find("delay").each(function(){var a=e(this).attr("stamp"),b=new Date(a);c.timestamp=b.getTime(),f=!0}),c.timestamp||(c.timestamp=b.Common.Utils.DateUtils.now()),e(a).find("body").each(function(){c.body=e("<div></div>").html(Strophe.getText(this)).text()}),"error"===c.type)e(a).find("error").each(function(){c.errorCode=parseInt(e(this).attr("code"),null)||-1});else if(d){var g=Strophe.getResourceFromJid(d),h=Strophe.getDomainFromJid(d),i=-1!==h.indexOf(c._interface.SUBDOMAIN);g&&(i?f&&-1===g.indexOf("~")?(c.username=g,e(a).find("address").each(function(){var a=e(this).attr("jid");c.userId=c._interface._getUserIdFromJid(a)})):(c.userId=c._interface._getFirstTokenFromResource(d),c.username=c._interface._getSecondTokenFromResource(d)):(c.userId=Strophe.getNodeFromJid(d),c.username=c._interface._getFirstTokenFromResource(d)),c.me=c.userId===c._interface._userId)}},a.Room=function(a,b){this._interface=a,this.id=b.id,this.jabberId=b.jabberId,this.type=b.type,this.title=b.title,this.members=b.members,this.lastMessageAt=b.lastMessageAt,this.users={}},a.Room.prototype._update=function(a){var b=f.pluck(a.members,"userId");this.title=a.title,this.lastMessageAt=a.lastMessageAt,this.members=a.members;var c=f.pluck(this.members,"userId"),d=f.difference(c,b);this.users=f.omit(this.users,d)},a.Room.prototype._onMessage=function(c){if(!this.isIgnoredChat()){var d=new a.Message(this._interface,c);b.request("is:user:ignored",d.userId)||this._interface.trigger("room:message",this,d)}},a.Room.prototype._onPresence=function(b,c){var d=this.users[b];d||(d=new a.User(b),this.users[b]=d),c===this._interface.PRESENCE.AVAILABLE?d.status!==c&&(d.status=c,this.isIgnoredChat()||this._interface.trigger("room:presence",this,d)):c===this._interface.PRESENCE.UNAVAILABLE&&(d.status=c,this.isIgnoredChat()||this._interface.trigger("room:presence",this,d))},a.Room.prototype.isIgnoredChat=function(){if("private"===this.type){var a=f.pluck(this.members,"userId"),c=f.first(f.without(a,this._interface._userId));if(b.request("is:user:ignored",c))return!0}else if("restricted"===this.type)return!0;return!1},a.Room.prototype._callOfflineMessageEmails=f.debounce(function(a,c){("private"===a.type||"group"===a.type)&&e.ajax({type:"POST",url:b.config.API_URL.concat("/chats/",a.id,"/offline-message-emails"),contentType:"application/json",data:JSON.stringify({content:c})})},1e3),a.Room.prototype.sendMessage=function(a){var c=f.find(this.members,function(a){return!a.active});if(c){var d={type:"message",chatId:this.id};e.ajax({type:"POST",url:b.config.API_URL+"/chat-room-events",contentType:"application/json",data:JSON.stringify(d)})}this._callOfflineMessageEmails(this,a),this._interface._sendMessageStanza(this.jabberId,a,"groupchat")}}),KXL.module("Chat",function(a,b,c,d,e,f){a.KXLInterface=a.InterfaceBase.extend({_userId:null,_contacts:{},_rooms:{},_autoRetry:!0,_defaultRooms:{},_domain:null,connect:function(){var c=this;c._autoRetry=!0;var d=b.request("get:current:user");return d?(c._userId=d.id,void e.ajax({type:"POST",url:b.config.API_URL+"/users/"+c._userId+"/chat-sessions",contentType:"application/json",data:JSON.stringify({resource:Date.now().toString()}),success:function(b){c._domain=Strophe.getDomainFromJid(b.jid),b.defaultChatRooms&&(f.each(b.defaultChatRooms,function(b){var d=b.node+"@"+c.SUBDOMAIN+"."+c._domain,e=new a.Room(c,{id:b.node,jabberId:d,type:"default",title:b.name,members:[]});b.groupKey?(e.groupKey=b.groupKey,e.groupType=b.groupType):(e.settingsKey=b.settingsKey,e.commonName=b.commonName),c._defaultRooms[d]=e}),f.each(b.rooms,function(b){var d=new a.Room(c,b);c._rooms[b.jabberId]=d}));var d="wss://"+b.server+":443";c._jabberId=b.jid,c._bareJabberId=Strophe.getBareJidFromJid(c._jabberId),c._connection?c._connection.reset():c._connection=new Strophe.Connection(d),c._connection.connect(c._jabberId,b.password,c._connectionCallback.bind(c))}}).fail(function(){c.trigger("connection:failed"),c._autoRetry&&c._retry()})):c._reset()},disconnect:function(){this._reset(),this._autoRetry=!1,this.isConnected()&&this._connection.disconnect()},getUserPresence:function(a){if(this.isConnected()){var b=this._contacts[a];if(b)return b.status}return this.PRESENCE.UNKNOWN},createChat:function(c){var d=this,g=e.Deferred(),h={members:f.union(c,[d._userId])};return d._lock(),e.ajax({type:"POST",url:b.config.API_URL+"/chat-rooms",contentType:"application/json",data:JSON.stringify(h),success:function(b){var c=d._rooms[b.jabberId];c||(c=new a.Room(d,b),d._rooms[b.jabberId]=c),g.resolve(c)}}).fail(function(){g.reject()}).always(function(){d._unlock()}),g},getDefaultRooms:function(){return this._defaultRooms},getDefaultRoomBySettingsKey:function(a){return this.isConnected()?f.find(this._defaultRooms,function(b){return a===b.settingsKey?!0:void 0}):!1},markChatAsRead:function(a){var c=this,d=e.Deferred(),f=b.config.API_URL+"/chat-rooms/"+a+"/members/"+c._userId,g={lastMessageAt:Date.now()};return e.ajax({type:"PATCH",url:f,contentType:"application/json",data:JSON.stringify(g),success:function(a){var b=c._rooms[a.jabberId];b&&(b._update(a),c.trigger("room:reset:unread:messages",b)),d.resolve(b)}}).fail(d.reject),d},leaveChat:function(a){var c=this,d=e.Deferred(),f=b.config.API_URL+"/chat-rooms/"+a+"/members/"+c._userId,g={active:!1};return e.ajax({type:"PATCH",url:f,contentType:"application/json",data:JSON.stringify(g),success:function(){c.trigger("unread:messages:updated"),d.resolve()}}).fail(d.reject),d},addUsersToRoom:function(c,d){var f=this,g=e.Deferred(),h={members:d};return f._lock(),e.ajax({type:"PATCH",url:b.config.API_URL+"/chat-rooms/"+c+"/members",contentType:"application/json",data:JSON.stringify(h),success:function(b){var c=f._rooms[b.jabberId]||f._defaultRooms[b.jabberId];c&&"default"!==b.type?c._update(b):"default"!==b.type&&(c=new a.Room(f,b),f._rooms[b.jabberId]=c),g.resolve(c)}}).fail(function(){g.reject()}).always(function(){f._unlock()}),g},removeUserFromRoom:function(a,c){var d=e.Deferred(),f=b.config.API_URL+"/chat-rooms/"+a+"/members/"+c;return e.ajax({type:"DELETE",url:f,success:function(){d.resolve()}}).fail(function(){d.reject()}),d},joinDefaultChatRoom:function(a){return this.isConnected()?this.addUsersToRoom(a,[this._userId]):void 0},leaveDefaultChatRoom:function(a){return this.isConnected()?this.removeUserFromRoom(a,this._userId):void 0},sendPrivateMessage:function(a,b){var c=this,d=f.find(c._rooms,function(b){return"private"===b.type&&f.contains(b.members,a)});return d?d.sendMessage(b):void c.createChat([a]).then(function(a){a.sendMessage(b)})},sendMessageToRoom:function(a,b){var c=f.find(this._rooms,function(b){return b.id===a})||f.find(this._defaultRooms,function(b){return b.id===a});c&&c.sendMessage(b)},sendMessageToRoomByJabberId:function(a,b){var c=this._rooms[a];c&&c.sendMessage(b)},setRoomTitle:function(a,c){var d=this,f=e.Deferred(),g={title:c};return d._lock(),e.ajax({type:"PATCH",url:b.config.API_URL+"/chat-rooms/"+a,contentType:"application/json",data:JSON.stringify(g),success:function(){f.resolve()}}).fail(function(){f.reject()}).always(function(){d._unlock()}),f},getActionHistory:function(){var a=e.Deferred(),c=this,d=b.config.API_URL+"/users/"+c._userId+"/chat-actions";return e.ajax({type:"GET",url:d,dataType:"json",success:function(b){a.resolve(b)}}).fail(function(){a.reject()}),a},enableDefaultGroupRoom:function(a,c,d){if(a&&c&&b.currentUserGroups){var e=a+"/"+c,f=b.currentUserGroups.get(e),g=f&&f.get("group"),h=g&&g.get("members"),i=h&&h.get(b.currentUser.id);if(i){var j=i.get("settings")||{};j.disableChat=!d,i.save({settings:j},{patch:!0,wait:!0})}}},leaveDefaultGroupRoom:function(a){var b=this._defaultRooms[a];if(b){var c=b.id;this.enableDefaultGroupRoom(b.groupType,b.groupKey,!1),delete this._defaultRooms[a],this.trigger("default:room:removed",c)}},_connectionCallback:function(a){var b=this,c=b.CONNECTION_STATUS[a];a===Strophe.Status.CONNECTED||a===Strophe.Status.ATTACHED?(b._connection.addHandler(b._onMessage.bind(b),null,"message"),this._connection.addHandler(b._onPresence.bind(b),null,"presence"),b._connection.send($pres({})),b._lock(),b._getContacts().then(function(){b.trigger("connection","ONLINE"),b._unlock()})):(b.trigger("connection",c),(a===Strophe.Status.ERROR||a===Strophe.Status.CONNFAIL||a===Strophe.Status.AUTHFAIL||a===Strophe.Status.DISCONNECTED)&&(b._markContactsAsUnavailable(),b._autoRetry&&b._retry()))},_reset:function(){this._markContactsAsUnavailable(),this._userId=null,this._jabberId=null,this._contacts={},this._emptyEventQueues()},_retry:function(){this.disconnect(),console.log("KXLChatInterface: Retrying in "+this.RETRY_DELAY/1e3+" seconds..."),f.delay(this.connect.bind(this),this.RETRY_DELAY)},_markContactsAsUnavailable:function(){var a=this;f.each(a._contacts,function(b){b.status=a.PRESENCE.UNAVAILABLE,a.trigger("presence",b)})},_getUserIdFromJid:function(a){var b=Strophe.getNodeFromJid(a),c=b.split(".");return c.length>0?c.length>1?c[1]:c[0]:b},_getContacts:function(){var b=this,c=e.Deferred();return this.isConnected()?(b._connection.sendIQ($iq({type:"get"}).c("query",{xmlns:Strophe.NS.ROSTER}),function(d){e(d).find("item").each(function(){var c=e(this).attr("jid"),d=b._getUserIdFromJid(c);b._contacts[d]||(b._contacts[d]=new a.User(d,b.PRESENCE.UNAVAILABLE))}),c.resolve(b._contacts)},c.reject),c):c.reject()},_onNotification:function(b){var c=this,d=b.type;if(d)if("update"===d){var e=b.chatId;if(!e)return;c._lock(),c._getRoomInfo(null,e).then(function(a){var b=a.jabberId,d=c._rooms[b];d&&(d._update(a),d.isIgnoredChat()||c.trigger("room:update",d))}).fail(function(){console.log("KXLChatInterface error: can't get room info",bareJabberId)}).always(function(){c._unlock()})}else if("chat.removed"===d){var f=b.jabberId,g=c._rooms[f];g&&(c.trigger("room:left",g),c._rooms[f]&&delete c._rooms[f])}else if("default.chat.added"===d){var f=b.jabberId,g=c._defaultRooms[f],e=b.chatId;g||(g=new a.Room(c,{id:e,type:"default",jabberId:f,title:b.name,members:[]}),g.groupType=b.groupType,g.groupKey=b.groupKey,c._defaultRooms[f]=g,c.trigger("default:room:added",g))}else if("default.chat.removed"===d){var e=b.chatId,f=b.jabberId;c._defaultRooms[f]&&(delete c._defaultRooms[f],c.trigger("default:room:removed",e))}},_onMessage:function(b){if(this._locked)return this._enqueueMessage(b);var c=b.getAttribute("type");if("notification"===c){var d="";e(b).find("body").each(function(){d=Strophe.getText(this)});try{var f=JSON.parse(d);this._onNotification(f)}catch(g){this.trigger("error",g)}}else{var h=b.getAttribute("from"),i=Strophe.getDomainFromJid(h);
if(0===i.indexOf(this.SUBDOMAIN)&&"error"!==c){var j=Strophe.getBareJidFromJid(h),k=this._rooms[j]||this._defaultRooms[j];k&&k._onMessage(b)}else{var l=new a.Message(this,b);this.trigger("message",l)}}return!0},_onPresence:function(a){if(this._locked)return this._enqueuePresence(a);var b=a.getAttribute("from"),c=a.getAttribute("to"),d=Strophe.getDomainFromJid(b),e=a.getAttribute("type")||this.PRESENCE.AVAILABLE,f=Strophe.getBareJidFromJid(b);return-1!==d.indexOf(this.SUBDOMAIN)?this._onRoomPresence(b,f,e,a):c===this._jabberId&&f!==this._bareJabberId&&this._onUserPresence(b,e),!0},_onRoomPresence:function(b,c,d,f){var g=this,h=g._getFirstTokenFromResource(b),i=g._rooms[c]||g._defaultRooms[c];if("error"===d)return void(i&&(g.leaveChat(i.id),g._rooms[c]&&delete g._rooms[c]));var j=[];e(f).find("status").each(function(){j.push(e(this).attr("code"))}),e(f).find("item").each(function(){var b=-1!==j.indexOf("110")||h===g._userId;b&&d===g.PRESENCE.UNAVAILABLE?(g.trigger("room:left",i),g._rooms[c]&&delete g._rooms[c]):i?i._onPresence(h,d):(g._lock(),g._getRoomInfo(c).then(function(b){i=new a.Room(g,b),g._rooms[c]=i,i._onPresence(h,d)}).fail(function(){console.log("KXLChatInterface error: can't get room info",c)}).always(function(){g._unlock()}))})},_onUserPresence:function(b,c){var d=Strophe.getResourceFromJid(b);if(!d)return void console.warn("KXLChatInterface: _onUserPresence: missing resource",b);var e=this._getUserIdFromJid(b),f=this._contacts[e];f||(f=new a.User(e),this._contacts[e]=f),c===this.PRESENCE.AVAILABLE?(f._addResource(d),f.status!==c&&(f.status=c,this.trigger("presence",f))):c===this.PRESENCE.UNAVAILABLE?(f._removeResource(d),0===f._resources.length&&(f.status=c,this.trigger("presence",f))):(f._clearResources(),f.status=c,this.trigger("presence",f),delete this._contacts[e])},_getRoomInfo:function(a,c){var d=e.Deferred(),f=this,g=b.config.API_URL+"/chat-rooms?userId="+f._userId;return a&&(g+="&jabberId="+a),c&&(g+="&chatId="+c),e.ajax({type:"GET",url:g,dataType:"json",success:function(a){return 1===a.length?d.resolve(a[0]):void d.reject()}}).fail(function(){d.reject()}),d},getRoom:function(a){return f.findWhere(this._rooms,{id:a})}})}),KXL.module("Chat.ChatApp.Entities",function(a,b,c,d,e,f){a.Message=c.Model.extend({defaults:{userId:null,username:null,body:null,timestamp:null}}),a.MessagesCollection=c.Collection.extend({model:a.Message,initialize:function(){var a=this;a.listenTo(a,"add",function(){for(var c;a.models.length>b.config.chatHistoryLimit;)c=a.shift(),c.destroy()})}}),a.ThreadMember=c.Model.extend({idAttribute:"userId",defaults:{userId:null,username:null,active:null,createdAt:null,status:"unavailable"}}),a.ThreadMembersCollection=c.Collection.extend({model:a.ThreadMember}),a.Thread=b.Entities.Model.extend({defaults:{id:null,jabberId:null,type:null,title:null,members:null,messages:null,lastMessageAt:null,unreadMessages:0},initialize:function(){var b=this,c=new a.ThreadMembersCollection,d=new a.MessagesCollection;b.set("members",c),b.set("messages",d)},initializeMembers:function(a){var b=f.map(a.members,function(b){var c=f.pick(b,"userId","username","active","createdAt"),d=a.users[c.userId];return d&&(c.status=d.status),c});this.get("members").set(b,{silent:!0})},update:function(a){this.get("title")!==a.title&&this.set("title",a.title),this.get("lastMessageAt")!==a.lastMessageAt&&this.set("lastMessageAt",a.lastMessageAt),this.get("members").set(f.map(a.members,function(b){var c=f.pick(b,"userId","username","active","createdAt"),d=a.users[c.userId];return d&&(c.status=d.status),c}))},updateUserPresence:function(a){var b=this.get("members").get(a.userId);b&&b.get("status")!==a.status&&b.set("status",a.status)}}),a.DefaultThread=a.Thread.extend({initialize:function(c){var d=a.Thread.prototype.initialize.call(this,c),e=b.request("get:chat:interface");return this.on("selected",function(a){b.currentUser&&(this.get("messages").reset(),e.joinDefaultChatRoom(a.id))}),this.on("deselected",function(a){b.currentUser&&(this.get("messages").reset(),e.leaveDefaultChatRoom(a.id))}),d}}),a.DefaultThreadsCollection=b.Entities.SingleSelectCollection.extend({model:a.DefaultThread}),a.ThreadsCollection=b.Entities.SingleSelectCollection.extend({model:a.Thread})}),KXL.module("Chat.ChatApp",function(a,b,c,d,e,f){a.View=d.Layout.extend({template:"#chat-template",className:"kx-chat-app",horizontalSplitterDragging:!1,verticalSplitterDragging:!1,topPanelButtonsEl:null,topPanelSettingsEl:null,triggers:{"click .start-chat":"chat:start:thread","click .chat-go-online":"chat:go:online"},ui:{loading:".chat-loading",offline:".chat-offline",topPanelWrapper:".chat-top-wrapper",topPanel:".chat-top-panel",threadsContainer:".chat-threads-container",defaultThreads:".chat-default-threads",chatThreads:".chat-user-threads",conversation:".chat-conversation",horizGrippy:".chat-divider",vertGrippy:".vert-chat-divider",startChatBtn:".start-chat"},regions:{topPanel:".chat-top-panel",settingsPanel:".chat-top-panel-settings",defaultThreads:".chat-default-threads",chatThreads:".chat-user-threads",conversation:".chat-conversation",horizGrippy:".chat-divider"},initialize:function(){b.request("current:user:settings:entity")},onRender:function(){var a=this;this.ui.sidebarButton=e(document).find(".kx-user-chats-wrapper"),b.vent.on("chat:update:ui",function(){a.ui.conversationMessageBoxHeight=a.ui.conversation.find(".compose-message-region"),a.ui.conversationHeader=a.ui.conversation.find(".recipient-region"),a.options.vent&&a.options.vent.trigger("content:size:adjust")}),this.on("container:size:adjust",function(b){a.sizeAdjust(b)})},onShow:function(){this.ui.threadsContainer.addClass("visible")},sizeAdjust:function(a){this.$el.css("height",a+"px"),this.options.vent&&(this.chatThreads.currentView&&this.options.vent.trigger("content:isolate:scrolling",this.ui.threadsContainer),this.conversation.currentView&&this.options.vent.trigger("content:isolate:scrolling",this.conversation.currentView.$el.find(".kx-chat-message-list")))}}),a.RecipientFooterCTAView=d.ItemView.extend({template:"#chat-footer-cta-template",className:"kx-chat-footer-cta",triggers:{"click .kx-cancel-button":"cancel:clicked","click .kx-done-button":"done:clicked"},onCancelClicked:function(){a.trigger("chat:conversation:footer:recipient:cancel")},onDoneClicked:function(){a.trigger("chat:conversation:footer:recipient:done")}}),a.TopPanelButtonsView=d.ItemView.extend({template:"#chat-top-panel-buttons",triggers:{"click .kx-start-chat-button":"chat:start:thread","click .kx-settings-button":"settings:clicked"},onSettingsClicked:function(){a.trigger("settings:clicked")},onChatStartThread:function(){a.trigger("chat:start:thread")},templateHelpers:function(){var a={};return this.options.title&&(a.headingText=this.options.title),a}}),a.TopPanelBreadcrumbView=d.ItemView.extend({template:"#chat-top-panel-breadcrumb",triggers:{"click .kx-settings-button":"settings:clicked","click .kx-sidebar-close-button":"close:clicked","click .kx-breadcrumb-back-button":"back:clicked"},ui:{title:".kx-heading-title > span",settingsBtn:".kx-settings-button"},enableSettings:!0,initialize:function(a){(!a.thread||"default"===a.thread.get("type")||a.thread.has("groupType"))&&(this.enableSettings=!1)},onSettingsClicked:function(){a.trigger("sub:settings:clicked",this.options.thread)},onCloseClicked:function(){a.trigger("close:clicked")},onBackClicked:function(){a.trigger("back:clicked")},templateHelpers:function(){var a={};return this.options.title&&(a.headingText=this.options.title),a.enableSettings=this.enableSettings,a}}),a.GroupChatOptionView=b.Components.CheckBox.View.extend({className:"kx-checkbox kx-setting-checkbox default",template:"#checkbox-template",initialize:function(a){var c=this,d=a.model&&a.model.get("group"),e=a.model&&a.model.get("settings"),g=e&&e.get("disableChat"),h=b.i18n.t("chat.settings.showDefaultGroupChat",{title:d.get("title")});this.options=f.extend(a,{label:h,checked:!g});var i=b.request("get:chat:interface");this.on("change",function(){i.enableDefaultGroupRoom(d.get("type"),d.get("key"),!!c.getValue())}),this.listenTo(i,"default:room:added",function(a){a.groupType===d.get("type")&&a.groupKey===d.get("key")&&c.showState(!0)}),this.listenTo(i,"default:room:removed",function(a){var b=a.split("-");b.length<2||b[0]===d.get("type")&&b[1]===d.get("key")&&c.showState(!1)})}}),a.GroupChatOptionsView=d.CollectionView.extend({template:"#chat-group-chat-options-template",itemView:a.GroupChatOptionView}),a.ConvoSettingsView=d.Layout.extend({getTemplate:function(){return this.options.thread&&"private"===this.options.thread.get("type")?"#chat-conversation-private-settings-template":"#chat-conversation-group-settings-template"},className:"kx-chat-conversation-settings",tagName:"div",triggers:{"click .kx-convo-settings-button":"convo:clicked","click .kx-convo-leave-room-button":"leave:clicked"},onConvoClicked:function(){a.trigger("chat:conversation:settings:clicked")},onLeaveClicked:function(){a.trigger("chat:conversation:leave:room:clicked")}}),a.SettingsView=d.Layout.extend({template:"#chat-settings-template",className:"kx-chat-settings-template",regions:{showOnlineStatusAsRegion:".kx-show-online-status-as-region",showKIXEYEChatRegion:".kx-show-kixeye-chat-region",showBattlePiratesChatRegion:".kx-show-battle-pirate-chat-region",showVEGAConflictChatRegion:".kx-show-vega-conflict-chat-region",showWarCommanderChatRegion:".kx-show-war-commander-chat-region",showTOMEChatRegion:".kx-show-tome-chat-region",showProfanityFilterRegion:".kx-show-profanity-filter-region",playSoundRegion:".kx-play-sound-region",groupChatOptionsRegion:".kx-group-chat-options-region"},initialize:function(){var a=this;this.settingsModel=b.request("current:user:settings:entity"),this.listenTo(this.settingsModel,["change:showOnlineStatusAs"].join(" "),function(){a.render()});var c=b.request("get:chat:interface");this.listenTo(c,"connection",function(b){"ONLINE"===b&&a.adjustDefaultRoomCheckboxes()})},adjustDefaultRoomCheckboxes:function(){var a=this,c=b.request("get:chat:interface");f.each(["showKIXEYEChat","showBattlePiratesChat","showVEGAConflictChat","showWarCommanderChat","showTOMEChat"],function(b){c.getDefaultRoomBySettingsKey(b)?a.showCheckbox(b):a.hideCheckbox(b)}),b.vent.trigger("chat:update:ui")},showCheckbox:function(a){var b=a+"Region",c=this[b];c&&c.$el.show()},hideCheckbox:function(a){var b=a+"Region",c=this[b];c&&c.$el.hide()},renderGroupChatOptions:function(){if(b.currentUserGroups&&0!==b.currentUserGroups.length){var d=new c.FilteredCollection(null,{collection:b.currentUserGroups});d.setFilter(function(a){var c=a&&a.get("group"),d=c&&c.get("members");return!(!d||!d.get(b.currentUser.id))});var e=new a.GroupChatOptionsView({collection:d});this.groupChatOptionsRegion.show(e)}},onRender:function(){var a=this;a.showOnlineStatusAsRegionRadioGroup=new b.Components.RadioButton.Controller.getRadioButtonGroup([{value:"online",label:b.i18n.t("chat.settings.online"),checked:"online"===a.settingsModel.get("showOnlineStatusAs")?!0:!1},{value:"offline",label:b.i18n.t("chat.settings.offline"),checked:"offline"===a.settingsModel.get("showOnlineStatusAs")?!0:!1}]),a.showOnlineStatusAsRegionRadioGroup.on("change:selected",function(b){a.settingsModel.set("showOnlineStatusAs",b.value),a.settingsModel.save()}),a.showOnlineStatusAsRegion.show(a.showOnlineStatusAsRegionRadioGroup);var c=new b.Components.CheckBox.View({label:b.i18n.t("chat.settings.showKIXEYEChat"),model:this.settingsModel,modelAttr:"showKIXEYEChat",customClass:"kx-setting-checkbox"});this.showKIXEYEChatRegion.show(c),c.on("change",function(){a.settingsModel.save()});var d=new b.Components.CheckBox.View({label:b.i18n.t("chat.settings.showBattlePiratesChat"),model:this.settingsModel,modelAttr:"showBattlePiratesChat",customClass:"kx-setting-checkbox"});this.showBattlePiratesChatRegion.show(d),d.on("change",function(){a.settingsModel.save()});var e=new b.Components.CheckBox.View({label:b.i18n.t("chat.settings.showVEGAConflictChat"),model:this.settingsModel,modelAttr:"showVEGAConflictChat",customClass:"kx-setting-checkbox"});this.showVEGAConflictChatRegion.show(e),e.on("change",function(){a.settingsModel.save()});var f=new b.Components.CheckBox.View({label:b.i18n.t("chat.settings.showWarCommanderChat"),model:this.settingsModel,modelAttr:"showWarCommanderChat",customClass:"kx-setting-checkbox"});this.showWarCommanderChatRegion.show(f),f.on("change",function(){a.settingsModel.save()});var g=new b.Components.CheckBox.View({label:b.i18n.t("chat.settings.showTOMEChat"),model:this.settingsModel,modelAttr:"showTOMEChat",customClass:"kx-setting-checkbox"});this.showTOMEChatRegion.show(g),g.on("change",function(){a.settingsModel.save()});var h=new b.Components.CheckBox.View({label:b.i18n.t("chat.settings.filterProfanity"),model:this.settingsModel,modelAttr:"filterProfanity",customClass:"kx-setting-checkbox"});this.showProfanityFilterRegion.show(h),h.on("change",function(){a.settingsModel.save()});var i=new b.Components.CheckBox.View({label:b.i18n.t("chat.settings.playSound"),model:this.settingsModel,modelAttr:"chatPlaySound",customClass:"kx-setting-checkbox"});this.playSoundRegion.show(i),i.on("change",function(){a.settingsModel.save()}),a.adjustDefaultRoomCheckboxes(),a.renderGroupChatOptions()}}),a.settingsVisible=!1,a.TopPanelView=d.Layout.extend({template:"#chat-top-panel-template",className:"kx-chat-top-panel",regions:{buttons:".chat-top-panel-buttons",settings:".chat-top-panel-settings"},ui:{settingsPanel:".chat-top-panel-settings"},topPanelButtonView:null,initialize:function(){function c(){a.settingsVisible=!1,d.ui.settingsPanel.removeClass&&d.ui.settingsPanel.removeClass("visible"),d.settings.reset(),b.vent.trigger("chat:update:ui",this)}var d=this;this.listenTo(a,"settings:clicked",function(){a.settingsVisible?d.ui.settingsPanel.removeClass("visible"):d.ui.settingsPanel.addClass("visible"),a.settingsVisible=!a.settingsVisible,d.settings.show(new a.SettingsView),b.vent.trigger("chat:update:ui",this)}),d.listenTo(d.settings,"show",function(){b.vent.trigger("chat:update:ui",this),a.settingsVisible&&d.settings.currentView.adjustDefaultRoomCheckboxes&&d.settings.currentView.adjustDefaultRoomCheckboxes()}),this.listenTo(a,"sub:settings:clicked",function(b){a.settingsVisible?d.ui.settingsPanel.removeClass("visible"):d.ui.settingsPanel.addClass("visible"),a.settingsVisible=!a.settingsVisible,d.settings.show(new a.ConvoSettingsView({thread:b}))}),this.listenTo(b.vent,"chat:settings:hide",c),this.listenTo(a,"back:clicked breadcrumb:show leave:room:clicked",c)},onRender:function(){this.settings.show(new a.SettingsView),a.settingsVisible||this.ui.settingsPanel.removeClass("visible")}}),a.ThreadAvatarView=d.ItemView.extend({template:"#chat-thread-avatar-view-template",className:"kx-group-avatar-wrapper",tagName:"div",templateHelpers:function(){var a={};return this.options.groupLogo&&(a.logoImage=this.options.groupLogo),a}}),a.ThreadView=d.Layout.extend({template:"#chat-thread-template",className:"kx-chat-thread",triggers:{click:"click","click .kx-chat-thread-remove":"remove:click"},ui:{title:".kx-chat-thread-title",snippet:".kx-chat-thread-snippet",timestamp:".kx-chat-thread-ts"},regions:{avatar:".kx-chat-thread-avatar-region"},modelEvents:{change:"render",blink:"startBlink","blink:twice":"blinkForTwoSeconds","blink:stop":"stopBlink"},blinkInterval:null,lastMessageModel:null,initialize:function(){var a=this;a.settingsModel=b.request("current:user:settings:entity");b.request("get:chat:interface"),this.model.get("type"),this.model.get("members"),this.model.get("messages");b.currentUser&&a.listenTo(a.settingsModel,"change:filterProfanity",function(){a.render()})},getGameIdForRoom:function(a){var c,d,e,g=null,h=b.request("get:chat:interface")._defaultRooms;return a&&(d=f.findWhere(h,{id:a}),d&&(g=d.commonName,e=b.games.findWhere({commonName:g}),e&&(c=e.get("id")))),c},updateGroupAvatar:function(c,d){var e=c.get("logo")&&c.get("logo").small||b.Group.Helpers.getDefaultLogoIconForGroup(c);if(d){var f=new a.ThreadAvatarView({groupLogo:e});d.show(f)}},updatePublicAvatar:function(a){if(a){var c=b.request("new:game:logo:view",a,{size:"xsmall"});this.avatar.show(c)}},updateAvatar:function(a){try{var c=null,d=this.model.get("type");if("private"===d){var e=this.model.get("members"),f=e.find(function(a){return a.get("userId")!==b.request("get:current:user").id});f&&(c=f.id)}else{var g=a;g&&g.has("userId")&&(c=g.get("userId"))}if(c){var h=b.request("new:avatar:view",c,{avatarMenu:b.Components.Avatar.avatarMenu.OFF,presence:b.Components.Avatar.presence.CHAT,size:"small",color:"black"});this.avatar&&this.avatar.show(h)}}catch(i){}},updateSnippet:function(a){try{var c=a&&a.has("body")?a.get("body"):null,d=100;c&&(e.trim(c),c.length>d&&(c=c.substr(0,d-3),c=c.concat("...")),this.settingsModel.get("filterProfanity")===!0&&(c=b.Common.Utils.StringUtils.filterMessage(c)),this.ui.snippet instanceof jQuery&&this.ui.snippet.text(c))}catch(f){}},startBlink:function(){var a=this;return this.blinkInterval?!1:(a.$el.addClass("kx-blink"),this.blinkInterval=setInterval(function(){a.$el.toggleClass("kx-blink")},b.config.chatFlashInterval),!0)},stopBlink:function(){this.blinkInterval&&(clearInterval(this.blinkInterval),this.blinkInterval=null,this.$el.removeClass("kx-blink"))},blinkForTwoSeconds:function(){var a=this;a.startBlink()&&f.delay(function(){a.stopBlink()},4*b.config.chatFlashInterval)},setTimestamp:function(){if(this.ui.timestamp instanceof jQuery){var a=f.max(this.model.get("messages").pluck("timestamp"));a===-1/0?this.ui.timestamp.addClass("infinity"):this.ui.timestamp.html(b.Common.Utils.DateUtils.fuzzytime2(a))}},onRender:function(){function a(a){var b=e.$el;b&&(a?b.addClass("selected"):b.removeClass("selected"))}var c=this.model.get("type"),d=this.model.get("title")||"",e=this,g=this.model.get("type"),h=this.model.get("members"),i=this.model.get("messages");if(e.setTimestamp(),"private"===g?i&&(this.listenToOnce(i,"all",function(a,b){"add"===a&&(e.updateAvatar(b),e.updateSnippet(b))}),i.length>0&&(e.updateSnippet(i.last()),e.updateAvatar(i.last()))):"default"===g?this.model.has("groupKey")?b.asyncRequest("group:get",this.model.get("groupType")+"/"+this.model.get("groupKey")).then(function(a){e.updateGroupAvatar(a,e.avatar)}):e.updatePublicAvatar(e.getGameIdForRoom(e.model.get("id"))):"group"===g&&i&&(this.listenToOnce(i,"all",function(a,b){"add"===a&&(e.updateAvatar(b),e.updateSnippet(b))}),i.length>0&&(e.updateSnippet(i.last()),e.updateAvatar(i.last()))),this.model.on("selected",function(){a(!0),e.stopBlink(),b.execute("chat:update:icon:blink:status")}),this.model.on("deselected",function(){a(!1)}),a(this.model.selected?!0:!1),!d.length){if(h=this.model.get("members"),"group"===c)f.each(h.models,function(a){d.length?d+=", "+a.get("username"):d=a.get("username")});else if("private"===c){var j=h.find(function(a){return a.get("userId")!==b.request("get:current:user").id});j&&(d=j.get("username"))}this.ui.title.text(d)}},onShow:function(){b.vent.trigger("chat:update:ui",this)}}),a.ThreadsView=d.CollectionView.extend({template:"#chat-threads-template",itemView:a.ThreadView,itemViewEventPrefix:"chat:thread",onItemRemoved:function(){b.vent.trigger("chat:update:ui",this)},initialize:function(){this.listenTo(this.collection,"sort",this.render)}}),a.EmptyStateView=d.ItemView.extend({template:function(){return""}})}),KXL.module("Chat.ChatApp.Views",function(a,b,c,d,e,f){a.Conversation=d.Layout.extend({messageInput:null,messageInputOpened:!1,muzzledView:null,template:"#chat-conversation-template",regions:{editOptions:".options-region",recipients:".recipient-region",conversation:".conversation-region",composeMessage:".compose-message-region"},ui:{conversation:".conversation-region",recipientInput:".recipient-input",recipientRegion:".recipient-region"},triggers:{"mousedown .recipient-input":"chat:recipient:focus","blur input":"chat:recipient:blur"},prevHeight:76,initialize:function(a){if(!a.model)throw"No conversation has been selected.";a.recipients&&(this.prePopulateRecipients=a.recipients),this.isPrivate=a.isPrivate||!1},createTitle:function(c){var d=this;if(this.recipients){var f=new a.ChatTitle({model:this.model,title:c});"private"!==this.model.get("type")&&f.on("clicked",function(){var a=[];this.model.get("members").length&&this.model.get("members").each(function(c){a.push(b.request("user:entity",c.get("userId")))}),a.length&&e.when.apply(e,a).then(function(){d.createRecipientInput(arguments)})}),this.recipients.show(f),this.recipients.$el&&this.adjustConversationTopPosition(this.recipients.$el.outerHeight(!0))}},createThumbnails:function(){var b=new c.Collection;if(b.reset(this.model.get("members").first(10)),this.recipients&&b&&b.length){var d=new a.ChatRecipients({collection:b});this.recipients.show(d)}},editTitle:function(){var c=this,d=new a.EditChatTitle;d.on("submit",function(a){c.createThumbnails(),b.request("get:chat:interface").setRoomTitle(c.model.get("id"),a),this.recipients.$el&&c.adjustConversationTopPosition(this.recipients.$el.outerHeight(!0))}),this.recipients.show(d),this.recipients.$el&&this.adjustConversationTopPosition(this.recipients.$el.outerHeight(!0))},createRecipientInput:function(a){function c(){d.recipientInput.recipientList.length?(d.messageInput.enable(),d.isPrivate&&d.messageInput.focus()):d.messageInput.disable()}var d=this;if(a&&a.length&&(a=f.filter(a,function(a){return a.id!==b.request("get:current:user").id})),"private"!==d.model.get("type")){var e=!1;!d.model.isNew()&&a&&a.length&&(e=!0),d.recipientInput=b.request("new:recipient:input:view",{focus:!d.isPrivate,recipients:a,dismissOnOutClick:e,placeholderText:b.i18n.t("chat.conversation.recipient.placeholder"),prePlaceholderText:b.i18n.t("chat.conversation.recipient.to.placeholder")}),d.ui.recipientInput=d.recipientInput.$el,d.listenTo(d.recipients,"show",function(){var a=d.recipients.$el?d.recipients.$el.outerHeight(!0):0;d.adjustConversationTopPosition(a)}),d.recipientInput.on("recipient:add",function(a){d.trigger("recipient:add",a),c();var b=d.recipients.$el?d.recipients.$el.outerHeight(!0):0;d.adjustConversationTopPosition(b+10)}),d.recipientInput.on("recipient:remove",function(a){d.trigger("recipient:remove",a),c()}),d.recipientInput.on("recipient:input:update",function(){var a=d.recipients.$el?d.recipients.$el.outerHeight(!0):0;d.adjustConversationTopPosition(a+10)}),d.recipientInput.on("dismissed",function(){var a=0;d.model.get("members").length>2?(a=d.ui.recipientRegion&&d.editOptions.$el?d.editOptions.$el.outerHeight(!0):0,d.createThumbnails()):a=d.recipients.$el?d.recipients.$el.outerHeight(!0):0,a=41>a?41:a,d.editOptions.$el&&d.model.get("members").length>10?(d.editOptions.$el.show(),d.adjustConversationTopPosition(a)):d.editOptions.$el&&d.adjustConversationTopPosition(a),b.Chat.ChatApp.trigger("footer:hide")}),d.recipients&&(d.recipients.show(d.recipientInput),c())}},adjustConversationTopPosition:function(a){this.ui.conversation&&this.ui.conversation.css&&this.ui.conversation.css("top",a+"px")},adjustConversationBotPosition:function(a){this.ui.conversation&&this.ui.conversation.css&&this.ui.conversation.css("bottom",a+"px")},_renderMuzzledView:function(a){var c=this;c.muzzledView=b.request("new:chat:muzzled:view",a),c.composeMessage.show(c.muzzledView)},_renderMessageInput:function(){var a=this,c=a.isPrivate||"default"===a.model.get("type")||a.model.get("members").length,d=a.messageInput=b.request("new:messageinput:view",{focus:c,disabled:"default"!==a.model.get("type")&&!a.model.get("members").length,startMinimized:!0,showLoader:!1,submitBtnStyle:"kx-alt-chat-ctas",inputHeight:90,disableAutosize:!0});d.on("submit",function(b){f.isEmpty(b)||(a.model.id?a.trigger("send:message",b):a.recipientInput&&a.recipientInput.recipientList.length&&a.trigger("start:thread",b,a.recipientInput.recipientList),this.isClosed||(this.reset(),this.focus()))}),a.listenTo(d,"all",function(b){("expanded:changed"===b||"resized"===b||"click"===b)&&setTimeout(function(){if(a.composeMessage&&a.composeMessage.$el.height()){a.composeMessage.ensureEl(),"click"===b&&a.composeMessage.currentView.ui.messageInputTextarea.css("height","90px"),a.adjustConversationBotPosition(a.composeMessage.$el.height());var c=f.max([a.composeMessage.$el.height()-a.prevHeight,0]);a.composeMessage.currentView.expanded&&a.messageInputOpened===!1&&"click"===b&&(a.conversation.currentView.updateThreadScrollPosition({diffUserHeight:c}),a.messageInputOpened=!0)}},0)}),a.listenTo(d,"minimized",function(){var b=0-f.max([a.composeMessage.$el.height()-a.prevHeight,0]);a.composeMessage.currentView.ui.messageInputTextarea.css("height",""),a.conversation.currentView.updateThreadScrollPosition({diffUserHeight:b}),a.messageInputOpened=!1}),a.composeMessage.show(d)},_renderMessageList:function(){var b=new a.MessageList({collection:this.model.get("messages"),type:this.model.get("type")});this.conversation.show(b)},_renderConversationOptions:function(){var c=this,d=this.model.get("type"),f="kx-alt15";if("group"===d||"private"===d){var g=[{label:b.i18n.t("group"===d?"chat.conversation.option.add.people":"chat.conversation.option.start.group"),itemEvent:"conversation:add:people"}];"group"===d&&(g.push({label:b.i18n.t("chat.conversation.option.rename"),itemEvent:"conversation:rename:room"},{label:b.i18n.t("chat.conversation.option.leave"),itemEvent:"conversation:leave:room"}),f="kx-alt15-group-chat"),this.conversationOptions=new a.ViewAllRecipientsView,this.listenTo(b.Chat.ChatApp,"chat:conversation:settings:clicked chat:conversation:view:all:recipients:click",function(){c.conversationOptions.trigger("conversation:add:people")}),this.listenTo(b.Chat.ChatApp,"chat:conversation:leave:room:clicked",function(){c.conversationOptions.trigger("conversation:leave:room")}),this.conversationOptions.on("conversation:add:people",function(){var a=[];c.model.get("members").length&&c.model.get("members").each(function(c){a.push(b.request("user:entity",c.get("userId")))}),a.length&&e.when.apply(e,a).then(function(){"private"===d?b.execute("chat:start:conversation",arguments):(c.createRecipientInput(arguments),c.editOptions.$el&&c.editOptions.$el.hide())}),b.Chat.ChatApp.trigger("footer:show")}),this.conversationOptions.on("conversation:leave:room",function(){b.execute("chat:leave:room",c.model),c.trigger("leave:room",c.model),b.Chat.ChatApp.trigger("leave:room:clicked")}),this.conversationOptions.on("conversation:rename:room",function(){c.editTitle()}),this.listenTo(this.editOptions,"show",function(){this.model.get("members").length>10?this.editOptions.$el.show():this.editOptions.$el.hide()}),this.editOptions.show(this.conversationOptions)}},onRender:function(){var a=this;if(a.listenTo(a,"chat:recipient:focus",function(){a.ui.recipientInput.hasClass("focused")||a.ui.recipientInput.addClass("focused")}),a.listenTo(a,"chat:recipient:blur",function(){a.ui.recipientInput.hasClass("focused")&&a.ui.recipientInput.removeClass("focused")}),a.listenTo(b.Chat.ChatApp,"chat:conversation:footer:recipient:cancel",function(){a.model.has("members")&&a.model.get("members").length>0?a.recipientInput.trigger("dismissed"):(b.Chat.ChatApp.trigger("footer:hide"),b.Chat.ChatApp.trigger("breadcrumb:hide"))}),a.listenTo(b.Chat.ChatApp,"chat:conversation:footer:recipient:done",function(){a.recipientInput.trigger("dismissed")}),a.listenTo(b.Chat.ChatApp,"chat:recipient:hide",function(){a.ui.recipientRegion.hide();a.ui.recipientRegion?a.ui.recipientRegion.outerHeight(!0):0;a.adjustConversationTopPosition(0)}),a.listenTo(b.Chat.ChatApp,"chat:recipient:show",function(){a.ui.recipientRegion.show();var b=a.ui.recipientRegion?a.ui.recipientRegion.outerHeight(!0):0;b=41>b?41:b,a.adjustConversationTopPosition(b)}),this._renderConversationOptions(),this._renderMessageList(),b.currentUser&&b.currentUser.get("chatMuzzle")&&b.currentUser.get("chatMuzzle")!==!1?this._renderMuzzledView(b.currentUser.get("chatMuzzle")):this._renderMessageInput(),"default"!==this.model.get("type")){var c=this.model.isNew(),d=[],g=[];this.model.get("members").length?this.model.get("members").each(function(a){g.push(b.request("user:entity",a.get("userId")))}):this.prePopulateRecipients&&f.each(this.prePopulateRecipients,function(a){if(f.isObject(a))d.push(a);else{if(!f.isString(a))throw"Unrecognized user type to add to recipient list";g.push(b.request("user:entity",a))}}),g.length?e.when.apply(e,g).then(function(){c?a.createRecipientInput(arguments):a.createThumbnails()}):d.length?c?this.createRecipientInput(d):a.createThumbnails():this.createRecipientInput(null)}}}),a.MessageBody=d.ItemView.extend({template:"#chat-message-body-template",className:"kx-message-body-inner",settingsModel:null,type:null,initialize:function(a){this.settingsModel=b.request("current:user:settings:entity"),this.type=a.type},serializeData:function(){function a(a){return b.Common.Utils.DateUtils.fuzzytime2(a)}var c=this.model.toJSON();return c.showUsernames=!0,b.currentUser&&this.settingsModel?(this.settingsModel.get("filterProfanity")===!0&&(c.body=b.Common.Utils.StringUtils.filterMessage(c.body)),c.messageDate=a(c.timestamp),c.showTimestamps=!0):c.showTimestamps=!1,c.body=new Handlebars.SafeString(e.fn.urlize(Handlebars.Utils.escapeExpression(c.body))),c}}),a.Message=d.Layout.extend({template:"#chat-message-template",className:"kx-message-body-wrapper",regions:{avatar:".avatar-region",body:".message-body"},avatarView:null,messageBodyView:null,initialize:function(c){var d=f.extend({},c),e=new b.Entities.User({id:this.model.get(d.userIdModelAttr),username:this.model.get("username")}),g=f.defaults({},d.avatarOptions,{model:e,size:"small",color:"grey"});b.currentUser&&(g=f.extend(g,{avatarMenu:b.Components.Avatar.avatarMenu.ON,menuPosition:"lock-bottom-right-avatar"})),this.avatarView=b.request("new:avatar:view",this.model.get(this.options.userIdModelAttr),g),this.messageBodyView=new a.MessageBody({model:this.model,type:d.type})},serializeData:function(){return{title:b.Common.Utils.DateUtils.fuzzytime2(this.model.get("timestamp"))}},isNewMessageGroup:function(a){if(a.collection.length<=1)return!1;var b=a.collection.at(a.collection.indexOf(a)-1);if(!b)return!1;var c=a.get("userId"),d=b.get("userId");if(c!==d)return!1;var e=a.get("timestamp"),f=b.get("timestamp");return e-f>6e4?!1:!0},onRender:function(){this.avatar.show(this.avatarView),this.body.show(this.messageBodyView),b.currentUser&&b.currentUser.id==this.model.get(this.options.userIdModelAttr)&&this.$el.addClass("kx-current-user"),this.isNewMessageGroup(this.model)&&this.$el.addClass("kx-message-group")}}),a.MessageList=d.CollectionView.extend({SCROLL_TO_BOTTOM_THRESHOLD:5,threadAtBottomScroll:!0,userScrollPos:null,className:"kx-chat-message-list",itemView:a.Message,debouncedUpdateThreadScrollPosition:void 0,itemViewOptions:function(){return{type:this.options.type,userIdModelAttr:this.options.userIdModelAttr,avatarOptions:this.options.avatarOptions}},settingsModel:null,initialize:function(a){var b={userIdModelAttr:"userId",type:null};this.debouncedUpdateThreadScrollPosition=f.debounce(this.updateThreadScrollPosition.bind(this),100),this.options=f.defaults({},a,b)},saveThreadScrollState:function(){if(this.$el.is(":visible")){var a=this.$el.prop("scrollHeight"),b=this.$el.prop("scrollTop"),c=this.$el.outerHeight(!0),d=a-b;this.threadAtBottomScroll=d<=c+this.SCROLL_TO_BOTTOM_THRESHOLD,this.userScrollPos=this.threadAtBottomScroll?null:b}},scrollThreadToBottom:function(){try{this.$el.prop("scrollTop",this.$el.prop("scrollHeight"))}catch(a){}this.threadAtBottomScroll=!0,this.userScrollPos=null},updateThreadScrollPosition:function(a){if(this.threadAtBottomScroll)this.scrollThreadToBottom();else if(this.userScrollPos){var b=this.userScrollPos;a&&a.diffUserHeight&&e.isNumeric(a.diffUserHeight)&&(b+=a.diffUserHeight),this.$el.prop("scrollTop",b)}},onBeforeItemAdded:function(){this.saveThreadScrollState()},onAfterItemAdded:function(a){var c=b.request("get:current:user");c&&a.model.get(this.options.userIdModelAttr)===c.id?this.scrollThreadToBottom():this.updateThreadScrollPosition()
},onClose:function(){e(window).off("resize",this.debouncedUpdateThreadScrollPosition),this.$el.off("scroll")},onRender:function(){var a=this;f.delay(function(){a.scrollThreadToBottom()},0),a.$el.on("scroll",a.saveThreadScrollState.bind(this)),e(window).on("resize",a.debouncedUpdateThreadScrollPosition)}}),a.ConversationInit=d.ItemView.extend({template:"#chat-conversation-init-template",className:"chat-thread-init"}),a.ConversationInitFailed=d.ItemView.extend({template:"#chat-conversation-init-failed-template",className:"chat-thread-init chat-thread-init-failed"}),a.ChatTitle=d.ItemView.extend({template:"#chat-title-template",className:function(){var a="chat-title";return"private"===this.model.get("type")&&(a+=" private-chat-title"),a},triggers:{click:"clicked"},serializeData:function(){var a,c="",d=this.model.get("members"),e=b.request("get:current:user");return this.options.title?c=this.options.title:this.model.get("title")?c=this.model.get("title"):(a="private"!==this.model.get("type")?d.models:d.filter(function(a){return a.id!=e.id}),f.each(a,function(a){c.length?c+=", "+a.get("username"):c=a.get("username")})),{title:c}}}),a.ChatRecipient=d.Layout.extend({template:"#chat-recipient-thumbnail-template",tagName:"li",className:"kx-chat-recipient-mini-avatar",regions:{avatarRegion:".recipient-avatar-region"},initialize:function(a){var c=f.extend({},a),d=new b.Entities.User({id:this.model.get("userId"),username:this.model.get("username")}),e=f.defaults({},c.avatarOptions,{model:d,size:"xsmall",color:"grey",bgMode:!0,borderColors:"none",avatarMenu:b.Components.Avatar.avatarMenu.ON,menuPosition:"lock-bottom-right-avatar"});this.avatarView=b.request("new:avatar:view",this.model.get("userId"),e)},onRender:function(){this.avatarRegion.show(this.avatarView)}}),a.ChatRecipients=d.CollectionView.extend({tagName:"ul",className:"chat-recipients-thumbnails",itemView:a.ChatRecipient}),a.ViewAllRecipientsView=d.ItemView.extend({template:"#chat-conversation-recipient-view-all-template",tagName:"span",className:"kx-recipient-all-link",triggers:{click:"clicked"},onClicked:function(){b.Chat.ChatApp.trigger("chat:conversation:view:all:recipients:click")}}),a.EditChatTitle=d.ItemView.extend({template:"#chat-edit-title-template",className:"chat-edit-title",events:{"keydown .room-name-input":"inputKeyDown"},ui:{input:".room-name-input"},inputKeyDown:function(a){if(13===a.keyCode&&""!==this.ui.input.val()){var b=this.ui.input.val();this.ui.input.val(""),this.trigger("submit",b)}}})}),KXL.module("Chat.ChatApp",function(a,b,c,d,e,f){function g(){var a=[b.asyncRequest("async:load:module","common/components/recipient_input"),b.asyncRequest("async:load:module","common/components/radio_button")];a.push(b.currentUser&&b.currentUser.get("chatMuzzle")&&b.currentUser.get("chatMuzzle")!==!1?b.asyncRequest("async:load:module","chat/muzzled"):b.asyncRequest("async:load:module","common/components/message_input"));var c=e.Deferred();return e.when.apply(e,a).then(function(){c.resolve()}),c.promise()}var h,i=d.Controller.extend({layout:null,currentSelectedThread:null,sidebarBreadcrumb:!1,sidebarViews:{topBarView:null,contentView:null,headerCTAView:null,headerCTABreadcrumbView:null},setNextThread:function(a){var c=b.request("get:chat:threads").get(a);if(c)this._selectThread(c);else{var d=b.request("current:user:settings:entity");d.set("lastChatId",a),d.save()}},_selectThread:function(a,c){if(this.currentSelectedThread!==a&&(!this.creatingConversation||c)){this.creatingConversation&&c&&(this.creatingConversation=!1);var d=b.request("current:user:settings:entity"),e=d&&d.get("lastChatId");a.id!==e&&(d.set("lastChatId",a.id),d.save()),a.select()}},startPrivateChat:function(a,c){var d=this;if(!Array.isArray(a)){var e=[];return e.push(a),void this.startConversation(e,!0)}this.toggleChat(!0);var f=b.request("get:chat:interface"),g=function(){f.createChat([a]).then(function(a){d.setNextThread(a.id),c&&f.sendMessageToRoom(a.id,c)})};if(f&&f.isConnected())g();else{var h=function(a){"ONLINE"===a&&(b.stopListening(f,"connection",h),g())};d.listenTo(f,"connection",h)}},startConversation:function(c,d){var g=this;d=d||!1,g.creatingConversation=!0,g.currentSelectedThread&&g.currentSelectedThread.deselect(),g.currentSelectedThread=null,g.sidebarViews.contentView.conversation.ensureEl(),g.sidebarViews.contentView.conversation.reset();var h=new a.Views.Conversation({model:new a.Entities.Thread,recipients:c,isPrivate:d});g.listenTo(h,"start:thread",function(c,d){g.sidebarViews.contentView.conversation.show(new a.Views.ConversationInit),b.request("get:chat:interface").createChat(d.pluck("id")).then(function(a){function d(){i>100&&j.reject(),h=b.request("get:chat:threads").get(a.id),h?(b.request("get:chat:interface").sendMessageToRoom(a.id,c),g.creatingConversation=!1,g._selectThread(h),j.resolve(h)):(i++,f.delay(d,100))}var h,i=0,j=e.Deferred();return d(),j}).fail(function(){g.sidebarViews.contentView.conversation.show(new a.Views.ConversationInitFailed)})}),g.sidebarViews.contentView.conversation.show(h)},showChat:function(){function d(a){a&&s.push(a),"ONLINE"===a?(p.sidebarViews.contentView.ui.loading.fadeOut(1e3),p.sidebarViews.contentView.ui.offline.fadeOut(1e3)):"CONNECTING"===a?(p.sidebarViews.contentView.ui.loading.fadeIn(1e3),p.sidebarViews.contentView.ui.offline.is(":visible")&&p.sidebarViews.contentView.ui.offline.fadeOut(1e3)):"DISCONNECTED"===a?"DISCONNECTING"===s[s.length-2]&&(p.sidebarViews.contentView.ui.loading.fadeOut(1e3),p.sidebarViews.contentView.ui.offline.fadeIn(1e3)):!a&&s.length>0||"OFFLINE"===a?(p.sidebarViews.contentView.ui.loading.fadeOut(1e3),p.sidebarViews.contentView.ui.offline.fadeIn(1e3)):p.sidebarViews.contentView.ui.loading.is(":visible")||p.sidebarViews.contentView.ui.loading.fadeIn(1e3)}function e(a){var c=b.request("current:user:settings:entity");if(c){var d=c.get("lastChatId");a.id===d&&b.Chat.ChatApp.trigger("removed:from:room")}}function g(c){p.sidebarViews.contentView.conversation.ensureEl(),p.sidebarViews.contentView.conversation.reset();var d=new a.Views.Conversation({model:c}),e=b.request("get:chat:interface");d.listenTo(e,"connected",function(){var a,d=e.getRoom(c.id);d&&(a=b.request("get:thread:for:chat:room",d)),a?j(a):i()}),p.listenTo(d,"send:message",function(a){b.request("get:chat:interface").sendMessageToRoom(c.id,a)}),p.listenTo(d,"recipient:add",function(a){b.request("get:chat:interface").addUsersToRoom(c.id,[a.id])}),p.listenTo(d,"recipient:remove",function(a){b.request("get:chat:interface").removeUserFromRoom(c.id,a.id)}),p.listenTo(d,"leave:room",function(a){n(a)}),p.sidebarViews.contentView.conversation.show(d)}function h(c,d){d&&!c?(p.sidebarViews.contentView.ui.conversation.addClass("visible"),a.trigger("breadcrumb:show",{defaultTitle:b.i18n.t("chat.title")}),p.sidebarViews.contentView.ui.threadsContainer.removeClass("visible")):c&&c.selected!==!1?c.selected===!0&&(p.sidebarViews.contentView.ui.conversation.addClass("visible"),a.trigger("breadcrumb:show",{thread:c,defaultTitle:b.i18n.t("chat.title")}),p.sidebarViews.contentView.ui.threadsContainer.removeClass("visible")):(p.sidebarViews.contentView.ui.conversation.removeClass("visible"),a.trigger("breadcrumb:hide",{thread:c,defaultTitle:b.i18n.t("chat.title")}),p.sidebarViews.contentView.ui.threadsContainer.addClass("visible"))}function i(){var a=null;f.each(q.models,function(b){b.deselect(),p.currentSelectedThread===b&&(a=b)}),f.each(r.models,function(b){b.deselect(),p.currentSelectedThread===b&&(a=b)}),p.currentSelectedThread=null,h(a)}function j(a){p.currentSelectedThread=a,g(a),h(a)}function k(){p.sidebarViews.contentView.conversation.show(new a.EmptyStateView)}function l(){return q.length+r.length}function m(a,b){f.each(a,function(a){a.deselect()}),p._selectThread(b,!0)}function n(a){a.selected&&a.deselect(),b.vent.trigger("chat:update:ui",this)}var o=new c.Wreqr.EventAggregator;if(b.vent.trigger("chat:settings:hide"),this.sidebarViews.contentView)b.atom.once("sidebar",function(){b.request("sidebar:show:content","chat")});else{var p=this,q=b.request("get:chat:default:threads"),r=b.request("get:chat:threads");q.comparator=function(a,b){var c=1;return a.has("groupType")&&(c=b.has("groupType")?0:-1),c},r.comparator=function(a,b){var c=0;return a.timestamp>b.timestamp?c=-1:a.timestamp<b.timestamp&&(c=1),c},p.listenTo(q,"add remove",function(){q.sort()}),p.listenTo(r,"add remove resort",function(){r.sort()}),this.sidebarViews.contentView=new a.View({vent:o});var s=[];p.listenTo(p.sidebarViews.contentView,"show",function(){d(b.request("get:chat:status"))}),p.listenTo(b.request("get:chat:interface"),"connection",d),p.sidebarViews.topBarView=new a.TopPanelView,p.sidebarViews.headerCTAView=a.TopPanelButtonsView,p.sidebarViews.headerCTABreadcrumbView=a.TopPanelBreadcrumbView,p.sidebarViews.footerCTAView=a.RecipientFooterCTAView;var t=new a.ThreadsView({collection:q}),u=new a.ThreadsView({collection:r});t.on("chat:thread:click",function(a){f.each(t.collection.models,function(a){a.deselect()}),p._selectThread(a.model,!0)}),p.listenTo(q,"remove",e),p.listenTo(r,"remove",e),p.listenTo(a,"chat:start:thread",function(){p.startConversation()}),p.listenTo(p.sidebarViews.contentView,"chat:go:online",function(){var a=b.request("current:user:settings:entity");a.set("showOnlineStatusAs","online"),a.save()}),p.listenTo(a,"back:clicked sub:back:clicked leave:room:clicked removed:from:room",function(){i()}),p.listenTo(p.sidebarViews.contentView.conversation,"show",function(){p.currentSelectedThread||h(null,!0)}),b.atom.once("sidebar",function(){b.request("sidebar:create:content",{contentId:"chat",contentView:p.sidebarViews.contentView,topBarView:p.sidebarViews.topBarView,topBarBreadCrumb:p.sidebarBreadcrumb,headerCTAViewPointer:p.sidebarViews.headerCTAView,headerCTABreadcrumbViewPointer:p.sidebarViews.headerCTABreadcrumbView,footerCTAViewPointer:p.sidebarViews.footerCTAView,modulePointer:a,title:b.i18n.t("chat.title"),show:!0})}),p.listenTo(q,"select:one",j),p.listenTo(r,"select:one",j),p.listenTo(r,"remove",function(){l()<1&&k()}),p.listenTo(q,"remove",function(){l()<1&&k()}),p.sidebarViews.contentView.chatThreads.show(u),p.sidebarViews.contentView.defaultThreads.show(t),p.listenTo(t,"chat:thread:remove:click",function(a){var c=a.model,d=b.request("get:chat:interface"),e=c.get("jabberId"),f=d._defaultRooms[e];if(f)if(f.groupKey)d.leaveDefaultGroupRoom(e);else{var g=b.request("current:user:settings:entity");g.set(f.settingsKey,!1),g.save()}n(c)}),p.listenTo(u,"chat:thread:click",function(a){m(u.collection.models,a.model)}),p.listenTo(u,"chat:thread:remove:click",function(a){var c=a.model;b.request("get:chat:interface").leaveChat(c.id),n(c)}),q.sort(),r.sort()}b.vent.trigger("chat:update:ui")},hideChat:function(){b.atom.once("sidebar",function(){b.request("sidebar:hide:content","chat")})},toggleChat:f.debounce(function(a){function c(){g.hideChat()}function d(){b.request("auth:register:deferred:gate",{referrer:"chat"})||g.showChat()}var e=(b.request("current:user:settings:entity"),b.appModel.get("sideBarState")),f="open"===e||"chat"===e,g=this;void 0===a?f?c():d():a?d():c()},200,!0),leaveRoom:function(a){b.request("get:chat:interface").removeUserFromRoom(a.id,b.request("get:current:user").id)},debouncedMessageAudio:f.debounce(function(){if(!h){var a=e("#kx-chat-audio");a.length&&(h=a[0])}h&&h.play()},200,!0),playMessageAudio:function(){var a=b.request("current:user:settings:entity");a.get("chatPlaySound")&&this.debouncedMessageAudio()}});a.Controller=new i,b.reqres.setHandlers({"chat:show":function(c){var d=e.Deferred();return b.switches.chatEnabled?g().then(function(){a.Controller.showChat(c),d.resolve()}):d.reject(),d.promise()}}),b.commands.setHandlers({"chat:show":function(){var c=e.Deferred();return b.switches.chatEnabled?g().then(function(){a.Controller.showChat(),c.resolve()}):c.reject(),c.promise()},"chat:hide":function(c){b.switches.chatEnabled&&a.Controller.hideChat(c)},"chat:toggle":function(c){b.switches.chatEnabled&&g().then(function(){a.Controller.toggleChat(c)})},"chat:leave:room":function(c){b.switches.chatEnabled&&a.Controller.leaveRoom(c)},"chat:start:conversation:private":function(c,d){b.switches.chatEnabled&&a.Controller.startPrivateChat(c,d)},"chat:start:conversation":function(c){b.switches.chatEnabled&&a.Controller.startConversation(c)},"chat:play:message:audio":function(){b.switches.chatEnabled&&a.Controller.playMessageAudio()}})}),KXL.module("Chat.ChatApp",function(a,b,c,d,e,f){function g(){function c(a){var b=a.get("messages").models;return b[b.length-1]}function d(a){B||(B=setInterval(function(){A=!A;var d;if(A){var e=c(a);d=e.get("username")+" "+b.i18n.t("chat.says")}else{d=b.config.siteName;var f=n();f>0&&(d+=" ("+f+")")}document.title=d},b.config.chatFlashInterval))}function g(){B&&(clearInterval(B),B=null,A=!1,document.title=b.config.siteName)}function k(){var a=e(".kx-chat-btn");return z?!1:(a.addClass("kx-blink"),z=setInterval(function(){a.toggleClass("kx-blink")},b.config.chatFlashInterval),!0)}function l(){var a=e(".kx-chat-btn");z&&(clearInterval(z),z=null,a.removeClass("kx-blink"))}function m(){k()&&f.delay(function(){l()},4*b.config.chatFlashInterval)}function n(){var a=0;return v.each(function(b){a+=b.get("unreadMessages")>0?1:0}),a}function o(){var a=n();0===a&&(l(),g())}function p(){f.each(w,function(a){x.off(a.eventName,a.callback)}),w=[],u.reset(),v.reset(),C={},l()}function q(a){var b=a.id;u.get(b)||u.add(f.pick(a,"id","jabberId","type","title","groupKey","groupType"))}function r(a){u.get(a)&&u.remove(a)}function s(b){if("default"===b.type)return u.get(b.id);var c=v.get(b.id);return c||(c=new a.Entities.Thread(f.pick(b,"id","jabberId","type","title","lastMessageAt")),c.initializeMembers(b),c.listenTo(c,"selected",function(){var a=c.get("unreadMessages");a&&a>0&&h.markChatAsRead(c.id)}),v.add(c)),c}function t(){if(b.currentUser){var a=x.get("showOnlineStatusAs");"online"!==a||h.isConnected()||h.connect()}else h.isConnected()&&h.disconnect(),p()}var u=new a.Entities.DefaultThreadsCollection,v=new a.Entities.ThreadsCollection,w=[],x=b.request("current:user:settings:entity"),y=null,z=null,A=!1,B=null,C={},D=f.debounce(function(){f.each(C,function(a,b){h.markChatAsRead(b),a.trigger("blink:stop")}),C={}},3e3);b.appModel.on("change:sideBarState",function(a,b){("open"===b&&h.isConnected()||"chat"===b&&h.isConnected())&&D()}),h.on("unread:messages:updated",function(){var a=0;v.each(function(b){a+=b.get("unreadMessages")>0?1:0}),b.vent.trigger("user:userChats:count:changed",a),o()}),h.on("connection",function(a){if(i=a,"ONLINE"===a){var c=h.getDefaultRooms(),d=[];f.each(c,function(a){var c=a.id;if(a.groupKey)d.push(f.pick(a,"id","jabberId","type","title","groupKey","groupType"));else{x.get(a.settingsKey)&&d.push(f.pick(a,"id","jabberId","type","title"));var e={eventName:"change:"+a.settingsKey,callback:function(d,e){e&&!u.get(c)?u.add(f.pick(a,"id","jabberId","type","title")):(b.currentUser&&h.leaveDefaultChatRoom(c),u.remove(c))}};x.on(e.eventName,e.callback),w.push(e)}}),u.add(d),y=setInterval(function(){h.ping()},h.WEBSOCKET_HEARTBEAT_INTERVAL),h.trigger("connected")}else"DISCONNECTED"===a&&(clearInterval(y),p())}),h.on("room:presence",function(a,b){var c=s(a);"default"===a.type&&b.userId===h._userId?c.trigger("default:room:ready",c):c.updateUserPresence(b)}),h.on("room:update",function(a){var b=s(a);b.update(a)}),h.on("default:room:added",function(a){q(a)}),h.on("default:room:removed",function(a){r(a)}),h.on("room:reset:unread:messages",function(a){var b=s(a);b.get("lastMessageAt")!==a.lastMessageAt&&b.set("lastMessageAt",a.lastMessageAt,{silent:!0}),0!=b.get("unreadMessages")&&(b.set("unreadMessages",0),h.trigger("unread:messages:updated"))}),h.on("room:left",function(a){a&&"default"!==a.type&&v.remove(a.id)});var E=f.throttle(function(a){a.collection.trigger("resort")},100,{leading:!1});h.on("room:message",function(c,e){var g=s(c),i=g.get("messages"),k=b.Common.Utils.DateUtils.now()-e.timestamp<1e3,l=new a.Entities.Message(f.pick(e,"userId","username","body","timestamp"));if(i.add(l),g.timestamp=l.get("timestamp"),"default"!==g.get("type")){var n=b.appModel.get("sideBarState"),o="open"===n||"chat"===n;if(g.selected&&o)C[g.id]=g,D(),k&&!e.me&&g.trigger("blink:twice");else{var p=1e3*Math.floor((g.get("lastMessageAt")-j)/1e3),q=i.filter(function(a){return a.get("timestamp")>p}).length;g.get("unreadMessages")!==q&&(g.set("unreadMessages",q),h.trigger("unread:messages:updated"),!o&&g.selected&&(C[g.id]=g),k&&b.execute("chat:play:message:audio"),q>0&&(d(g),g.trigger("blink"),o||m()))}E(g)}}),b.vent.on("auth:changed",function(){t()}),b.addInitializer(function(){b.request("current:user:settings:entity").bind("change:showOnlineStatusAs",function(a,b){"online"!==b||h.isConnected()?"offline"===b&&h.isConnected()&&h.disconnect():h.connect()})}),b.reqres.setHandlers({"get:thread:for:chat:room":function(a){return s(a)},"get:chat:default:threads":function(){return u},"get:chat:threads":function(){return v}}),b.commands.setHandlers({"chat:update:icon:blink:status":function(){b.switches.chatEnabled&&o()}})}var h=new b.Chat.KXLInterface,i="OFFLINE",j=200;b.reqres.setHandlers({"get:chat:interface":function(){return h},"get:chat:status":function(){return i}}),b.commands.setHandlers({"chat:initialize":function(){b.switches.chatEnabled&&g()}})}),KXL.module("FriendsPanelApp",function(a,b){var c={getFriendsPanelView:function(b){return a.Controller.getFriendsPanelView(b)}};b.addInitializer(function(){b.reqres.setHandler("get:friendspanel:view",function(a){return c.getFriendsPanelView(a)})}),b.vent.on("auth:changed",function(){b.currentUser||a.Controller.destroyFriendsPanelView()})}),KXL.module("FriendsPanelApp",function(a,b,c,d,e,f){a.ButtonsView=b.Components.ItemView.extend({template:"#friends-panel-buttons-template",templateHelpers:function(){var a={};return this.options.title&&(a.headingText=this.options.title),a}}),a.AdvancedSearchParamView=b.Components.Layout.extend({template:"#friends-panel-advanced-search-param-template",tagName:"div",className:"kx-friends-panel-advanced-search-param",regions:{paramCheckBoxRegion:".kx-search-param-checkbox-region",paramInputRegion:".kx-search-param-input-region"},modelEvents:{"change:value":function(){this.model.get("checked")&&this.triggerSearch()},"change:checked":function(){this.model.get("value")&&this.triggerSearch()}},triggerSearch:f.debounce(function(){this.options.vent&&this.options.vent.trigger("search:trigger")},300),onRender:function(){var a=new b.Components.CheckBox.View({label:this.model.get("label"),model:this.model,modelAttr:"checked",customClass:"kx-search-param-checkbox"});this.paramCheckBoxRegion.show(a);var c=new b.Components.TextBox.View({customClass:"kx-search-param-input",model:this.model,modelAttr:"value",showSuccess:!1,maxLength:6});this.paramInputRegion.show(c)}}),a.AdvancedSearchParamsView=d.CollectionView.extend({template:function(){return""},tagName:"div",className:"kx-friends-panel-advanced-search-params",itemView:a.AdvancedSearchParamView,itemViewOptions:function(a){return{model:a,vent:this.options.vent}}}),a.AdvancedSearchView=b.Components.Layout.extend({template:"#friends-panel-advanced-search-template",className:"kx-friends-panel-advanced-search",regions:{advancedSearchParamsRegion:".kx-friend-advanced-search-params-region"},ui:{advancedSearchToggleBtn:".kx-friend-search-advanced-toggle",ctaSpacer:".kx-friend-search-header-spacer",clearBtn:".kx-friend-search-clear-btn",resultsTxt:".kx-friend-search-matched-results-txt"},events:{"click @ui.advancedSearchToggleBtn":"_toggleAdvancedSearchParams","click @ui.clearBtn":function(){this.options.vent.trigger("clear:player:search")}},modelEvents:{"change:context":function(){this._displayAdvancedIfContextSupports()},"change:mode":function(){var a=this.model.previous("mode"),c=b.i18n.t("friends.panel."+a);this.ui.advancedSearchToggleBtn.html(c)},"change:resultsTxt":"_renderResultsTxt"},_toggleAdvancedSearchParams:function(){var a=this.model.get("mode");"simple"===a?this._renderAdvancedSearchParams():this._closeAdvancedSearchParams(),this.model.hasAdvancedParams()&&this.triggerSearch()},triggerSearch:f.debounce(function(){this.options.vent&&this.options.vent.trigger("search:trigger")},300),_closeAdvancedSearchParams:function(){this.model.set("mode","simple"),this.advancedSearchParamsRegion.close(),this.options.vent&&this.options.vent.trigger("content:size:adjust")},_displayAdvancedIfContextSupports:function(){var a=this.model.contextGetAdvancedParams(),b=this.model.get("mode");a?(this.ui.advancedSearchToggleBtn.show(),this.ui.ctaSpacer.show()):(this.ui.advancedSearchToggleBtn.hide(),this.ui.ctaSpacer.hide()),"advanced"===b&&a?this._renderAdvancedSearchParams():"advanced"!==b||a||this._closeAdvancedSearchParams()},_renderAdvancedSearchParams:function(){this.model.set("mode","advanced");var b=this.model.contextGetAdvancedParams();if(b){var c=new a.AdvancedSearchParamsView({collection:b.get("params"),vent:this.options.vent});this.advancedSearchParamsRegion.show(c)}this.options.vent&&this.options.vent.trigger("content:size:adjust")},_renderResultsTxt:function(){this.ui.resultsTxt.html(this.model.get("resultsTxt"))},onRender:function(){this._displayAdvancedIfContextSupports(),this._renderResultsTxt()}}),a.SearchView=b.Components.Layout.extend({template:"#friends-panel-search-layout-template",className:"kx-friends-panel",regions:{requestsList:".friends-panel-requests-list",friendsList:".friends-panel-friends-list",searchInputRegion:".friends-panel-search-input-region",advancedSearchRegion:".friends-panel-advanced-search-region",searchResults:".friends-panel-search-results"},ui:{heading:".kx-heading",listsWrapper:".friends-panel-lists-wrapper",friendsPanelSearch:".friends-panel-search",searchResults:".friends-panel-search-results"},topBarView:null,requestsListView:null,friendsListView:null,searchInputRegion:null,initialize:function(c){var d=this;this.options=f.defaults({},c,{showSearch:!0,minimumCharacterTriggerSearch:3}),this.searchModel=this.options.searchModel,b.vent.on("user:friend:request:sent",function(a){var c=d.requestsListView.collection.collection.findWhere({userId:a});c&&b.request("user:friend:request:accept",c.get("id"),c.get("userId")).then(function(){d.options.requestsCollection.collection.remove(c),d.requestsListView.render()})}),d.requestsListView=new a.FriendRequestsListView({collection:this.options.requestsCollection,searchModel:this.searchModel,vent:this.options.vent}),this.listenTo(this.options.vent,"friend:request:remove",function(a){d.options.requestsCollection.collection.remove(a.get("requestId")),d.requestsListView.render()}),d.friendsListView=new a.FriendsListView({collection:this.options.friendsCollection,searchModel:this.searchModel}),d.friendsListView.on("friendcard:username:clicked",function(a,c){b.execute("profile:show",c.get("id"))})},_createSearch:function(){var a=this;b.asyncRequest("async:load:module","common/components/search_input").then(function(){a.searchInput=b.request("searchinput:get:view",{className:"kx-search-wrapper",model:a.searchModel,modelAttr:"term"}),a.searchInput.on("context:change",function(c){a.searchModel.set("context",b.games.findWhere({id:c}).get("commonName")),a._resetSearch(),a._triggerSearch()}),a.listenTo(a.options.vent,"search:trigger",function(){a._resetSearch(),a._triggerSearch()}),b.vent.on("close:friendsearch",function(){a._closeSearchResults()}),a.searchInputRegion.show(a.searchInput)})},_triggerSearch:f.debounce(function(){var a=this.searchResults.currentView,c=this.searchInput.ui.searchBox.val(),d=this.searchModel.get("scope"),e=this.searchModel.contextGetAdvancedParam("planet")||null,f=this.searchModel.contextGetAdvancedParam("sector")||null,g=this.searchModel.contextGetAdvancedParam("minLevel")||null,h=this.searchModel.contextGetAdvancedParam("maxLevel")||null,i=[],j=this.searchModel.get("offset"),k=this.searchModel.get("limit"),l=this.searchModel.get("source"),m=this;return""===c?void this._closeSearchResults():c.length<this.options.minimumCharacterTriggerSearch?void(this.searchInput&&this.searchInput.hideLoader()):("secondary"===l&&(i=this.searchModel.get("ignoreUserIds")),this.searchInput.showLoader(),void(a?(a.trigger("search:triggered",{limit:k,offset:j,source:l,searchTerm:c,restrictByAppIds:d,planet:e,sector:f,minLevel:g,maxLevel:h,ignoreUserIds:i,displayResultTitles:!0}),m.sizeAdjust()):b.asyncRequest("async:load:module","friend_search").then(function(){a=b.request("get:friendsearch:flyout"),m.searchResults.show(a),a.listenTo(a,"usersearch:results:returned",function(a){m.searchInput.hideLoader(),m.ui.searchResults.show();var c=m.searchModel.get("ignoreUserIds");if(0!==m.searchModel.get("offset")||c.length||m.ui.searchResults.scrollTop(0),a&&a.length&&"primary"===m.searchModel.get("source")&&c.length<m.searchModel.get("ignoreUserLimit")&&a.each(function(a){c.push(a.get("id"))}),a.length<m.searchModel.get("limit")&&"secondary"!==m.searchModel.get("source")&&"kxl"!==m.searchModel.get("context")&&!m.searchModel.hasAdvancedParams()){m.searchModel.set("source","secondary"),m.searchModel.set("offset",0);var e=[],f=b.request("static:webgames:entities");f.each(function(a){d[0]!==a.get("gameId")&&e.push(b.games.findWhere({commonName:a.get("commonName")}).get("id"))}),e.push(b.games.findWhere({commonName:"kxl"}).get("id")),m.searchModel.set("scope",e),m._triggerSearch()}else a.length<m.searchModel.get("limit")&&m.searchModel.set("allResultsReturned",!0);var g=m.searchModel.get("numResultsReturned")+a.length;m.searchModel.set("numResultsReturned",g);var h=b.i18n.t("friends.panel.displayingPlayerResult",{smart_count:g});m.searchModel.set("resultsTxt",h),m.ui.listsWrapper.hide()}),a.on("username:clicked",function(a){b.execute("profile:show",a.get("id"))}),a.trigger("search:triggered",{limit:k,offset:j,source:l,searchTerm:c,restrictByAppIds:d,planet:e,sector:f,minLevel:g,maxLevel:h,ignoreUserIds:i,displayResultTitles:!0}),m.sizeAdjust()})))},300),_resetSearch:function(){this.searchModel.set("offset",0),this.searchModel.set("numResultsReturned",0),this.searchModel.set("source","primary"),this.searchModel.set("ignoreUserIds",[]),this.searchModel.set("allResultsReturned",!1),this.searchModel.set("scope",this.searchInput.getAppScope())},_closeSearchResults:function(){this.ui.searchResults.hide(),this.searchResults.close(),this.ui.listsWrapper.show(),this.searchInput&&this.searchInput.hideLoader(),this.searchModel.set("resultsTxt",b.i18n.t("friends.panel.displayingAllFriends")),this._resetSearch()},_createAdvancedSearch:function(){var b=new a.AdvancedSearchView({model:this.searchModel,vent:this.options.vent});this.advancedSearchRegion.show(b)},onRender:function(){var a=this;this.requestsList.show(this.requestsListView),this.friendsList.show(this.friendsListView),this.$el.find("input").placeholder(),this.options.showSearch&&(this._createSearch(),this._createAdvancedSearch()),this.sizeAdjust(),this.on("container:size:adjust",function(b){a.containerHeight=b,a.sizeAdjust(b)}),this.listenTo(this.options.vent,"clear:player:search",function(){a._closeSearchResults(),a.searchModel&&a.searchModel.clearCurrentContextAdvancedParams(),a.searchModel.set("term","")}),this.listenTo(this.searchModel,"change:term",function(){a._resetSearch(),a._triggerSearch()}),this.ui.searchResults.scroll(function(){a._checkScrollingAtBottom(a.ui.searchResults)&&a.getNextSearchPage()}),this.ui.listsWrapper.scroll(function(){a._checkScrollingAtBottom(a.ui.listsWrapper)&&a.trigger("friends:panel:get:more")})},onShow:function(){this.sizeAdjust()},sizeAdjust:function(a){var b=a||this.containerHeight;if(b||(b=this.$el.outerHeight(!0)),b){var c=73;"advanced"===this.searchModel.get("mode")&&(c+=132),this.ui.listsWrapper.css("height",b-c+"px"),this.options.vent.trigger("content:isolate:scrolling",this.ui.listsWrapper);var d=this.ui.searchResults;if(d){var e=d.find(".kx-friend-search-flyout");e&&e.css("min-height",b-c+"px"),d.css("height",b-c+"px"),d.css("top",c-4+"px"),this.options.vent.trigger("content:isolate:scrolling",d)}}},getRequestsListView:function(){return this.requestsListView},getFriendsListView:function(){return this.friendsListView},getNextSearchPage:f.debounce(function(){var a=this.searchModel.get("allResultsReturned");if(!a){var b=this.searchModel.get("limit"),c=this.searchModel.get("offset");this.searchModel.set("offset",c+=b),this._triggerSearch()}},300),_checkScrollingAtBottom:function(a){var b=0;return a.scrollTop()+a.innerHeight()>=a.prop("scrollHeight")-b?!0:void 0}}),a.FriendRequestsListView=d.CollectionView.extend({template:function(){return""},tagName:"ul",className:"kx-friends-panel-list",itemView:b.Components.FriendCard.FriendRequestView,itemViewOptions:function(){return{userType:"friends",hoverCard:"avatar",cardType:"request",displayScopedGameName:!1,appScope:this.options.searchModel&&this.options.searchModel.get("scope"),vent:this.options.vent}}}),a.EmptyView=b.Components.ItemView.extend({template:"#friends-panel-empty-template",tagName:"li",className:"kx-friends-panel-empty"}),a.FriendsListView=d.CollectionView.extend({template:function(){return""},tagName:"ul",className:"kx-friends-panel-list",emptyView:a.EmptyView,settingsModel:null,collectionEvents:{sort:"sortEvent",destroy:"render",add:"collectionModified"},initialize:function(){var a=this;a.searchModel=a.options.searchModel||null,a.listenTo(a.searchModel,"change:scope",function(){a.options.searchModel.get("scope")!==a.options.searchModel.previous("scope")&&1===a.options.searchModel.get("scope").length&&a.render()})},collectionModified:function(){var a=this;f.debounce(function(){a.collection.sort()},1e3)},sortEvent:function(){this.render()},itemViewEventPrefix:"friendcard",itemView:b.Components.FriendCard.View,itemViewOptions:function(){return{userType:"friends",hoverCard:"avatar",appScope:this.options.searchModel&&this.options.searchModel.get("scope"),cardType:"friend",displayChatBtn:!0,expandable:!0}}})}),KXL.module("FriendsPanelApp",function(a,b,c,d,e,f){a.Controller={layout:null,sidebarViews:{topBarView:null,contentView:null,headerCTAView:null},getFriendsPanelView:function(){var d=this,e=50,g=e;if(!this.sidebarViews.contentView){var h=new c.Wreqr.EventAggregator,i=new c.Model({mode:"simple",context:"kxl",scope:[],term:"",ignoreUserIds:[],limit:20,offset:0,source:"primary",ignoreUserLimit:99,resultsTxt:b.i18n.t("friends.panel.displayingAllFriends"),allResultsReturned:!1,numResultsReturned:0,advancedSearchParams:new c.Collection([{id:"wc",params:new c.Collection([{id:"sector",label:b.i18n.t("friends.panel.inSector"),checked:!1,value:null},{id:"minLevel",label:b.i18n.t("friends.panel.minLevel"),checked:!1,value:null},{id:"maxLevel",label:b.i18n.t("friends.panel.maxLevel"),checked:!1,value:null}])},{id:"bp",params:new c.Collection([{id:"sector",label:b.i18n.t("friends.panel.inSector"),checked:!1,value:null},{id:"minLevel",label:b.i18n.t("friends.panel.minLevel"),checked:!1,value:null},{id:"maxLevel",label:b.i18n.t("friends.panel.maxLevel"),checked:!1,value:null}])},{id:"vc",params:new c.Collection([{id:"planet",label:b.i18n.t("friends.panel.inPlanet"),checked:!1,value:null},{id:"minLevel",label:b.i18n.t("friends.panel.minLevel"),checked:!1,value:null},{id:"maxLevel",label:b.i18n.t("friends.panel.maxLevel"),checked:!1,value:null}])}])});i.contextGetAdvancedParams=function(){var a=this.get("context"),b=this.get("advancedSearchParams").get(a);return b},i.contextGetAdvancedParam=function(a){var b=this.contextGetAdvancedParams();return b&&b.get("params").get(a)&&b.get("params").get(a).get("checked")&&"advanced"===this.get("mode")?b.get("params").get(a).get("value"):null},i.hasAdvancedParams=function(){var a=this.contextGetAdvancedParams(),b=!1;return a?(a.get("params").each(function(a){a.has("value")&&a.get("checked")&&(b=!0)}),b):!1},i.clearCurrentContextAdvancedParams=function(){var a=this.contextGetAdvancedParams();a&&a.get("params").each(function(a){a.set("checked",!1),a.set("value","")})},b.context&&i.set("scope",[b.games.findWhere({urlName:b.context.get("urlName")}).id]);
var j=new c.FilteredCollection(null,{collection:b.request("current:user:received:friend:request:entities")._collection});j.collection.on("add remove destroy",function(a){b.vent.trigger("user:userFriendRequests:count:changed",a.collection.length)});var k=b.module("Websocket");k.on("friend-request",function(a){j.collection.unshift(a)});var l=b.request("current:user:friend:entities")._collection,m=new c.FilteredCollection(null,{collection:l,comparator:function(a,b){var c=a.get("user"),d=b.get("user"),e=c.username.toLowerCase(),f=d.username.toLowerCase(),g=a.get("presence")||"unavailable",h=b.get("presence")||"unavailable";if(g===h){if("available"===g)return e>f?1:f>e?-1:0;var i=c.lastSeen||0,j=d.lastSeen||0;return j>i?1:i>j?-1:e>f?1:f>e?-1:0}return g>h?1:-1}});m.on("filter-complete",f.debounce(function(){m.sort()},3e4)),l.on("reset",function(){l.fetchComplete&&l.sortOnFetchComplete&&(l.sortOnFetchComplete=!1,m.sort())});var n=new c.Obscura(m);n.setPerPage(e);var o={friendsCollection:n,requestsCollection:j,searchModel:i,vent:h};d.sidebarViews.contentView=new a.SearchView(o),d.sidebarViews.contentView.on("friends:panel:get:more",f.debounce(function(){m.length!==n.length&&(g+=e,n.setPerPage(g))},250)),d.sidebarViews.headerCTAView=a.ButtonsView}return this.sidebarViews},destroyFriendsPanelView:function(){this.sidebarViews.contentView&&(this.sidebarViews.contentView.close(),this.sidebarViews.contentView=null)}}}),KXL.vent.on("info:game:load",function(){KXL.asyncRequest("async:load:module","payment").then(function(){KXL.vent.trigger("payment:preinitialize")})}),KXL.module("InboxApp",function(a,b,c,d){a.Router=d.AppRouter.extend({appRoutes:{"inbox(/)":"showInbox","inbox(/:threadId)(/)":"showThread"}});var e={showInbox:function(){b.execute("page:show","inbox"),b.navigate("/inbox"),a.Controller.showInbox()},showThread:function(c,d,e){b.execute("page:show","inbox");var f="/inbox",g=e||!1;c&&(f+="/"+c),b.navigate(f),a.Controller.showThread(c,d,g)},startThread:function(c){b.execute("page:show","inbox"),b.navigate("/inbox/compose"),a.Controller.startThread(c)},markThreadRead:function(b){a.Controller.markThreadRead(b)},markThreadUnread:function(b){a.Controller.markThreadUnread(b)},deleteThread:function(b){a.Controller.deleteThread(b)},getPanelView:function(){return a.Controller.getInboxPanelView()}};b.addInitializer(function(){new a.Router({controller:e}),b.reqres.setHandler("inbox:panel:get:view",function(){return e.getPanelView()})}),b.commands.setHandlers({"inbox:show":function(){e.showInbox()},"inbox:show:thread":function(a,b){e.showThread(a,b)},"inbox:show:thread:from:panel":function(a,b){e.showThread(a,b,!0)},"inbox:thread:markread":function(a){e.markThreadRead(a)},"inbox:thread:markunread":function(a){e.markThreadUnread(a)},"inbox:thread:delete":function(a){e.deleteThread(a)}})}),KXL.module("InboxApp.Views",function(a,b,c,d,e,f){a.Layout=b.Components.Layout.extend({template:Templates["inbox/inbox"],className:"kx-inbox",regions:{recipient:".recipient-region",actions:".actions-region",preloader:".preloader-region",participants:".participants-region",threadList:".thread-list-region",threadBody:".thread-body-region"},events:{"click .kx-inbox-deprecated-notice a":"deprecatedMoreInfo"},deprecatedMoreInfo:function(a){a.preventDefault(),b.navigate(e(a.target).attr("href"),{trigger:!0})}}),a.Message=d.Layout.extend({template:Templates["inbox/inbox-message"],className:"message",regions:{avatarRegion:".kx-message-avatar"},ui:{messageBody:".kx-text-body"},onRender:function(){var a=this.model.get("from");a=a.split("@"),a=a.length>0?a[0]:null,this.$el.addClass(a!==b.currentUser.id?"msgFrom":"msgTo");var c=b.request("new:avatar:view",a,{avatarMenu:b.Components.Avatar.avatarMenu.ON,size:"medium",color:"grey"});this.avatarRegion.show(c)},onShow:function(){var a=e(".thread-body-region");a[0].scrollTop=a[0].scrollHeight},serializeData:function(){var a=this.model.toJSON();return a.date=b.Common.Utils.DateUtils.kixDateStringFormat1(a.createdAt),a}}),a.Actions=d.ItemView.extend({template:Templates["inbox/inbox-actions"],className:"inbox-actions",events:{"click .start-thread":"startChat"},startChat:function(){b.execute("chat:start:group")}}),a.EmptyThread=d.ItemView.extend({template:function(){return""}}),a.Participants=d.Layout.extend({template:Templates["inbox/inbox-participants"],className:"inbox-participants",serializeData:function(){var a=this.model.toJSON(),c=[];return f.each(a.participants,function(a){a.id!==b.request("get:current:user").id&&c.push(a.name)}),a.participantsTitle=c.join(", "),a}}),a.Thread=d.CompositeView.extend({model:b.Entities.Inbox.Thread,collection:b.Entities.Inbox.Messages,emptyView:a.EmptyThread,itemView:a.Message,itemViewContainer:".messages",template:Templates["inbox/inbox-thread"],appendHtml:function(a,b){var c;return c=a.collection.indexOf(b.model),a.$(".messages").insertAt(c,b.$el)},events:{"click .message-compose-region":"replyThread"},replyThread:function(){var a=[];f.each(this.model.get("participants"),function(c){c.id!==b.currentUser.id&&a.push(c.id)}),1===a.length?b.execute("chat:start:private",a[0]):a.length>1&&b.execute("chat:start:group",a)}}),a.ThreadItem=d.Layout.extend({template:Templates["inbox/inbox-thread-item"],model:b.Entities.Inbox.Thread,unread:!1,ui:{title:"h5",snippet:"p",avatar:".kx-avatar-container",messageSummary:".kx-message-summary"},regions:{editMenu:".kx-edit-menu"},initialize:function(){var a=this;a.listenTo(a.model,"change",this.render),a.listenTo(a.model,"selected",function(){a.$el.addClass("kx-selected")}),a.listenTo(a.model,"deselected",function(){a.$el.removeClass("kx-selected")})},onRender:function(){var a=this;a.ui.messageSummary.on("click",function(){b.execute("inbox:show:thread",a.model.id,!0)});var c,d=a.model.get("participants");if(d.length<3)c=f.find(d,function(a){return a&&a.id&&a.id!==b.currentUser.id?!0:!1}),c&&b.request("new:avatar:view",c.id,{size:"medium",color:b.Components.Avatar.borderColors.NONE,el:a.ui.avatar,avatarMenu:b.Components.Avatar.avatarMenu.ON});else if("user"===a.model.get("origin")){var e=a.model.has("snippetAddress")?b.request("inbox:strip:suffix",a.model.get("snippetAddress")):b.currentUser.id;e!==b.currentUser.id&&b.request("is:user:ignored",e)&&(e=b.currentUser.id),b.request("new:avatar:view",e,{size:"medium",color:b.Components.Avatar.borderColors.NONE,el:a.ui.avatar,avatarMenu:b.Components.Avatar.avatarMenu.OFF})}var g=a.model.get("lastMessageAt")||0,h=a.model.get("lastReadAt")||0;g>h?(a.$el.addClass("kx-unread"),a.unread=!0):(a.$el.removeClass("kx-unread"),a.unread=!1),a.model.selected&&a.$el.addClass("kx-selected");var i=new b.Components.EditOptions.Controller.getEditOptions({name:"itemoptions",buttonText:"",buttonStyle:"kx-alt14",optionItems:[{label:b.i18n.t("inbox.itemOptions.delete"),value:"delete",itemEvent:"inbox:thread:delete"},{label:b.i18n.t("inbox.itemOptions.markAsUnread"),value:"unread",itemEvent:"inbox:thread:markunread",itemState:a.unread}]});i.on("inbox:thread:markread",function(){b.execute("inbox:thread:markread",a.model.get("id"))}),i.on("inbox:thread:markunread",function(){a.unread?b.execute("inbox:thread:markread",a.model.get("id")):b.execute("inbox:thread:markunread",a.model.get("id"))}),i.on("inbox:thread:delete",function(){b.execute("inbox:thread:delete",a.model.get("id"))}),a.editMenu.show(i)},serializeData:function(){var a=this.model.toJSON(),c=[];return f.each(a.participants,function(a){a.id!==b.request("get:current:user").id&&c.push(a.name)}),a.dateTimestamp=b.Common.Utils.DateUtils.kixDateStringFormat1(a.lastMessageAt),a.title=c.join(", "),a}}),a.EmptyInbox=d.ItemView.extend({template:Templates["inbox/inbox-empty-inbox"]}),a.NoThreadSelected=d.ItemView.extend({template:Templates["inbox/inbox-no-thread-selected"]}),a.Threads=d.CompositeView.extend({template:Templates["inbox/inbox-thread-list"],emptyView:a.EmptyInbox,itemView:a.ThreadItem,itemViewContainer:".threads",collection:b.Entities.Inbox.Threads,ui:{threadItems:".threads"},initialize:function(){this.collection.on("sort",this.render)},fetchMore:f.throttle(function(a){this.collection.fetch({remove:!1,data:{offset:a,limit:10},sort:!1})},500,{trailing:!1}),checkScrollPosition:function(){var a=this.ui.threadItems,b=this.collection&&this.collection.length;b>=10&&!(b%10)&&a[0].scrollHeight-a.innerHeight()===a.scrollTop()&&this.fetchMore(b)},onRender:function(){var a=this;this.ui.threadItems.scroll(function(){a.checkScrollPosition()})}})}),KXL.module("InboxApp",function(a,b,c,d,e,f){var g=d.Controller.extend({threadsRequest:null,threads:null,layout:null,panelLayout:null,threadsView:null,previousMessageScrollTop:0,initialize:function(){var a=this;b.vent.on("inbox:more:messages:fetched",function(){a.hidePreloader(),a.scrollToTop()}),b.vent.on("inbox:more:messages:fetching",function(){a.showPreloader()})},scrollToBottom:function(){var a=e(".thread-body-region");a[0]&&(a[0].scrollTop=a[0].scrollHeight)},scrollToTop:function(){var a=e(".thread-body-region");a[0]&&(a[0].scrollTop=2)},setupLayout:function(){this.layout=new a.Views.Layout,b.inboxRegion.show(this.layout)},updateUnreadCount:function(){var a=0,c=b.request("current:user:settings:entity"),d=c.get("inboxPanelLastViewed");this.threads.each(function(b){var c=2e3;(!b.get("lastReadAt")||b.get("lastReadAt")<b.get("lastMessageAt"))&&(!d||d<b.get("lastMessageAt")+c)&&a++}),b.vent.trigger("user:userInbox:unread:count:changed",a)},getInboxPanelView:function(){var c=this;return c.panelLayout?c.loadInboxMessages(null,null,!0):(c.panelLayout=new a.InboxPanel.Views.MainLayout,c.listenToOnce(b.vent,"app:reset",function(){c.panelLayout=null}),c.panelLayout.on("show",function(){c.loadInboxMessages(null,null,!0)})),this.panelLayout},showInbox:function(c,d){if(!b.appModel.get("currentUser"))return b.execute("home:show");if(this.layout||this.setupLayout(),!this.layout.actions.currentView){var e=new a.Views.Actions;this.layout.actions.show(e)}this.loadInboxMessages(c,d)},loadInboxMessages:function(d,e,g){var h=this,i=g||!1;h.threadsRequest?h.threadsRequest.then(function(){if(g||h.threadsView||(h.threadsView=new a.Views.Threads({collection:h.threads})),h.layout&&!h.layout.threadList.currentView&&h.layout.threadList.show(h.threadsView),h.panelLayout){var b=new a.InboxPanel.Views.MessageItemsView({collection:h.threads});h.panelLayout.threadList.show(b)}e||h.selectThread(d,i)}):(h.listenToOnce(b.vent,"app:reset",function(){h.threadsRequest=null}),h.threadsRequest=b.request("inbox:get:threads",{data:{limit:10}}),h.threadsRequest.then(function(j){if(h.threads=f.extend(j,new c.Picky.SingleSelect(j)),h.threads.comparator=function(a,b){return a.get("lastMessageAt")>b.get("lastMessageAt")?-1:1},h.threads.on("change",function(a,b){b.suppressSort||this.sort()}),g||h.threadsView||(h.threadsView=new a.Views.Threads({collection:h.threads})),h.layout&&!h.layout.threadList.currentView&&h.layout.threadList.show(h.threadsView),e||h.selectThread(d,i),h.panelLayout){var k=new a.InboxPanel.Views.MessageItemsView({collection:h.threads});h.panelLayout.threadList.show(k)}b.vent.on("reset:available:inboxMessages",function(){var a=b.request("current:user:settings:entity");a.set("inboxPanelLastViewed",Date.now()),a.save(),b.vent.trigger("user:userInbox:unread:count:changed",0)})}),b.currentUser&&b.currentUser.id&&b.execute("inbox:subscribe",h.addMessageToThread.bind(h)))},showPreloader:function(){var a=new b.Components.Loader.View;this.layout.preloader.show(a)},hidePreloader:function(){var a=this;f.delay(function(){a.layout.preloader.close()},500)},showThread:function(b,c,d){var e=this;e.previousMessageScrollTop=0;if(!this.threads||!this.threads.get(b)||d)return void this.showInbox(b);var f=this.threads.get(b);f.get("messages")||(e.showPreloader(),f.getMessages());var g=f.get("messages");g.on("sync",function(){e.hidePreloader()}),e.layout.recipient.close(),f.select();var h=f.get("lastReadAt"),i=f.get("lastMessageAt");i>h&&(f.set({lastReadAt:i},{suppressSort:!0}),f.save());var j=new a.Views.Thread({model:f,collection:g});e.layout.threadBody.show(j);var k=new a.Views.Participants({model:f});e.layout.participants.show(k),e.layout.threadBody.$el.off("scroll"),e.layout.threadBody.$el.scroll(function(){e.checkScrollPosition(e.layout.threadBody.$el,f)}),e.markThreadRead(b),e.scrollToBottom()},checkScrollPosition:function(a,b){var c=b.get("messages")&&b.get("messages").length,d=a.scrollTop();0===d&&0!==this.previousMessageScrollTop&&(!b.has("moreMessages")||b.get("moreMessages"))&&b.getMoreMessages(c,10),this.previousMessageScrollTop=d},startThread:function(c){var d=this;d.threads&&d.layout||d.showInbox(null,!0);var e=!0,f=[];c&&(e=!1,f=[c]),b.asyncRequest("async:load:module","common/components/recipient_input").then(function(){var c=b.request("new:recipient:input:view",{focus:e,recipients:f,customClass:"inbox",placeholderText:"Type Player Name"}),g=c.recipientList;b.asyncRequest("async:load:module","common/components/message_input").then(function(){var a=b.request("new:messageinput:view",{tabindex:3,focus:!e,enterSubmit:!1});a.on("submit",function(a){if(g.length>0){var c=b.request("inbox:send:message",a,{recipients:g.map(function(a){return a.id})});c.then(function(a){var c=new b.Entities.Inbox.Thread(a.get("thread"));d.addThread(c),d.showThread(a.get("threadId"),!0)})}}),d.layout.messageCompose.show(a)}),d.layout.recipient.show(c),d.layout.threadBody.show(new a.Views.EmptyThread),d.layout.participants.close()})},addThread:function(a){this.threads.get(a.get("id"))||this.threads.add(a)},addMessageToThread:function(a){var c=this.threads.get(a.get("threadId")),d=a.get("thread");if(c&&d){var e={lastMessageAt:a.get("createdAt"),snippet:a.get("body"),snippetAddress:d.snippetAddress||b.request("inbox:add:suffix",b.currentUser.id)},f="inbox"===b.appModel.get("pages").selected.id;c.selected&&f&&(e.lastReadAt=a.get("createdAt")),c.set(e);var g=c.get("messages");g&&g.add(a)}else{var h=new b.Entities.Inbox.Thread(a.get("thread"));this.addThread(h)}this.updateUnreadCount(),this.scrollToBottom()},selectThread:function(b,c){var d,c=c||!1;b&&(d=this.threads.get(b)),!d&&this.threads.length&&(d=this.threads.first()),c?d&&(d.select(),d.get("messages")||d.getMessages()):d?this.showThread(d.id,!1):(this.layout.threadBody.show(new a.Views.NoThreadSelected),this.layout.messageCompose.close()),this.updateUnreadCount()},markThreadRead:function(a){var b=this.threads.get(a);b&&(b.set({lastReadAt:b.get("lastMessageAt")},{suppressSort:!0}),b.save(),this.updateUnreadCount())},markThreadUnread:function(a){var b=this.threads.get(a);b&&(b.set({lastReadAt:b.get("createdAt")-1},{suppressSort:!0}),b.save(),this.updateUnreadCount())},deleteThread:function(a){var b=this.threads.get(a);b&&(b.destroy(),this.selectThread())}});a.Controller=new g}),KXL.module("InboxApp.InboxPanel.Views",function(a,b,c,d,e,f){a.MainLayout=d.Layout.extend({template:Templates["inbox/inbox-panel-layout"],className:"kx-megaflyout-panel",regions:{threadList:".kx-items-list-region"},events:{"click .kx-footing":"seeAll","click .kx-start-new-message":"startNewMessage","click .kx-inbox-deprecated-notice a":"deprecatedMoreInfo"},deprecatedMoreInfo:function(a){a.preventDefault(),b.navigate(e(a.target).attr("href"),{trigger:!0})},seeAll:function(){b.execute("inbox:show")},startNewMessage:function(){b.execute("chat:start:group")}}),a.EmptyView=d.Layout.extend({template:Templates["inbox/inbox-panel-empty"]}),a.MessageItemView=d.Layout.extend({template:Templates["inbox/inbox-panel-message-item"],tagName:"li",className:"kx-megaflyout-panel-item",snippetLength:100,regions:{avatar:".kx-icon",body:".kx-message-body",cta:".kx-cta"},ui:{title:".kx-title",snippet:".kx-message-body",avatar:".kx-icon"},triggers:{"click .kx-cta-button":"ctaClicked",click:"clicked"},initialize:function(){var a=this;a.model.on("change",this.render)},onCtaClicked:function(){var a=[];f.each(this.model.get("participants"),function(c){c.id!==b.currentUser.id&&a.push(c.id)}),1===a.length?b.execute("chat:start:private",a[0]):a.length>1&&b.execute("chat:start:group",a)},onClicked:function(){b.execute("inbox:show:thread:from:panel",this.model.id,!1)},onRender:function(){var a,c=this,d=c.model.get("participants");if(d.length<3)a=f.find(d,function(a){return a&&a.id&&a.id!==b.currentUser.id?!0:!1}),a&&b.request("new:avatar:view",a.id,{size:"medium",color:b.Components.Avatar.borderColors.NONE,el:c.ui.avatar,avatarMenu:b.Components.Avatar.avatarMenu.OFF});else if("user"===c.model.get("origin")){var e=c.model.has("snippetAddress")?b.request("inbox:strip:suffix",c.model.get("snippetAddress")):b.currentUser.id;e!==b.currentUser.id&&b.request("is:user:ignored",e)&&(e=b.currentUser.id),b.request("new:avatar:view",e,{size:"medium",color:b.Components.Avatar.borderColors.NONE,el:c.ui.avatar,avatarMenu:b.Components.Avatar.avatarMenu.OFF})}var g=c.model.get("lastMessageAt")||0,h=c.model.get("lastReadAt")||0;g>h?c.$el.addClass("kx-unread"):c.$el.removeClass("kx-unread")},templateHelpers:function(){var a=this.model.toJSON(),c=[];f.each(a.participants,function(a){a.id!==b.request("get:current:user").id&&c.push(a.name)});var d=f.has(a,"snippetAddress")?b.request("inbox:strip:suffix",a.snippetAddress):b.currentUser.id;return d!==b.currentUser.id&&b.request("is:user:ignored",d)?a.snippet="":(e.trim(a.snippet),a.snippet.length>this.snippetLength&&(a.snippet=a.snippet.substr(0,this.snippetLength-3),a.snippet=a.snippet.concat("..."))),a.title=c.join(", "),a}}),a.MessageItemsView=d.CollectionView.extend({className:"kx-megaflyout-panel-item-list",tagName:"ul",itemView:a.MessageItemView,emptyView:a.EmptyView,itemViewEventPrefix:"inbox:panel:message:item",fetchMore:f.throttle(function(a){this.collection.fetch({remove:!1,data:{offset:a,limit:10}})},500,{trailing:!1}),initialize:function(){this.collection.on("sort",this.render)},checkScrollPosition:function(){var a=this.collection&&this.collection.length;a>=10&&!(a%10)&&this.$el.scrollTop()+this.$el.innerHeight()>=this.$el.prop("scrollHeight")&&this.fetchMore(a)},onRender:function(){var a=this;this.$el.scroll(function(){a.checkScrollPosition()})}})}),KXL.module("Routes",function(a,b,c,d,e,f){function g(a){return function(){return b.asyncRequest("async:load:module",a)}}function h(a){f.any(c.history.handlers,function(b,d){return b.route.toString()==c.Router.prototype._routeToRegExp(a).toString()?(c.history.handlers.splice(d,1),!0):void 0})}a.Router=d.AppRouter.extend({appRoutes:{"forum(/*path)":"forumRoute","settings(/)(:section)":"settingsRoute","press(/)(:section)":"pressRoute","groups(/)(*path)":"groupRoute","guide(/*game)":"oldGuides","game/tomeimmortalarena/guides/beginners":"oldGuides","game/tomeimmortalarena/beginners-guide-106":"oldGuides","game/tomeimmortalarena/guides/advanced":"oldGuides","game/tomeimmortalarena/advanced-guide-105":"oldGuides"}});var i={forumRoute:function(a){b.execute("forum:show",a)},settingsRoute:function(a){b.execute("settings:show",{},a)},groupRoute:function(){if(h("groups(/)(*path)"),b.currentUser)b.asyncRequest("async:load:module","group").then(function(){b.navigate(b.getCurrentRoute(),{trigger:!0})});else{var a=b.getCurrentRoute();b.navigate("login"),b.vent.on("auth:changed",function(){b.asyncRequest("async:load:module","group").then(function(){b.navigate(a,{trigger:!0})})}),b.execute("show:login:dialog")}},pressRoute:function(a){b.asyncRequest("async:load:module","press").then(function(){var c="show:Press";a&&(c+=":"+a),b.execute(c)})},oldGuides:function(a){b.navigate("game/"+(a?a:"tomeimmortalarena")+"/guide/",{target:"_blank",trigger:!0})}};b.addInitializer(function(){new a.Router({controller:i});var c={"forum:*":g("forum"),"game/tomeimmortalarena:*":g("game/tomeimmortalarena"),"groups:*":g("forum"),"settings:*":g("settings"),"sidebar:*":g("sidebar"),"group:*":function(){var a=e.Deferred();return b.currentUser?(h("groups(/)(*path)"),b.asyncRequest("async:load:module","group").then(function(){a.resolve()}),a.promise()):a.reject()}};b.commands.setHandlers(c),b.reqres.setHandlers(c)})});
(function (A) {
  'function' === typeof define ? define(A)  : 'object' === typeof exports ? A(void 0, exports)  : 'undefined' !== typeof ses ? ses.ok() && (ses.makeQ = function () {
    return A(void 0, {
    })
  })  : A(void 0, Q = {
  })
}) (function (AY, Aj) {
  function AK(A) {
    var B = Error.prepareStackTrace;
    Error.prepareStackTrace = function (C, D) {
      return D.filter(function (E) {
        E = E.getFileName();
        return 'module.js' !== E && 'node.js' !== E && E !== AJ
      })
    };
    A = A.stack;
    Error.prepareStackTrace = B;
    return A
  }
  function Af() {
    function B(F) {
      if (E) {
        return C = Ae(F),
        AU(E, function (G, H) {
          Ag(function () {
            C.promiseSend.apply(C, H)
          })
        }, void 0),
        E = void 0,
        C
      }
    }
    var E = [
    ],
    C,
    D = AR(Af.prototype),
    A = AR(Ad.prototype);
    A.promiseSend = function () {
      var F = Ai(arguments);
      E ? E.push(F)  : Ag(function () {
        C.promiseSend.apply(C, F)
      })
    };
    A.valueOf = function () {
      return E ? A : C.valueOf()
    };
    Error.captureStackTrace && Error.captureStackTrace(A, Af);
    AX(A);
    D.promise = A;
    D.resolve = B;
    D.reject = function (F) {
      return B(Ab(F))
    };
    return D
  }
  function Ad(B, E, C, D) {
    void 0 === E && (E = function (F) {
      return Ab(Error('Promise does not support operation: ' + F))
    });
    var A = AR(Ad.prototype);
    A.promiseSend = function (J, K) {
      var G = Ai(arguments, 2),
      F;
      try {
        F = B[J] ? B[J].apply(A, G)  : E.apply(A, [
          J
        ].concat(G))
      } catch (H) {
        F = Ab(H)
      }
      K(F)
    };
    C && (A.valueOf = C);
    D && (A.exception = D);
    AX(A);
    return A
  }
  function AZ(A) {
    return Object(A) !== A ? A : A.valueOf()
  }
  function AT(A) {
    return A && 'function' === typeof A.promiseSend
  }
  function AI(A) {
    return !AT(AZ(A))
  }
  function AH(A) {
    A = AZ(A);
    return AT(A) && 'exception' in A
  }
  function Ab(A) {
    var A = A || Error(),
    B = Ad({
      when: function (D) {
        if (D) {
          var C = a(AQ, this);
          - 1 !== C && (AP.splice(C, 1), AQ.splice(C, 1))
        }
        return D ? D(A)  : Ab(A)
      }
    }, function () {
      return Ab(A)
    }, function () {
      return this
    }, A);
    AQ.push(B);
    AP.push(A);
    return B
  }
  function Ae(A) {
    if (AT(A)) {
      return A
    }
    if (A && 'function' === typeof A.then) {
      var B = Af();
      A.then(B.resolve, B.reject);
      return B.promise
    }
    return Ad({
      when: function () {
        return A
      },
      get: function (C) {
        return A[C]
      },
      put: function (D, C) {
        return A[D] = C
      },
      del: function (C) {
        return delete A[C]
      },
      post: function (D, C) {
        return A[D].apply(A, C)
      },
      apply: function (D, C) {
        return A.apply(D, C)
      },
      fapply: function (C) {
        return A.apply(void 0, C)
      },
      viewInfo: function () {
        function E(F) {
          D[F] || (D[F] = typeof C[F])
        }
        for (var C = A, D = {
        }; C; ) {
          Object.getOwnPropertyNames(C).forEach(E),
          C = Object.getPrototypeOf(C)
        }
        return {
          type: typeof A,
          properties: D
        }
      },
      keys: function () {
        return AG(A)
      }
    }, void 0, function () {
      return A
    })
  }
  function AF(A, B) {
    A = Ae(A);
    return B ? Ad({
      viewInfo: function () {
        return B
      }
    }, function (D) {
      var C = Ai(arguments);
      return AW.apply(void 0, [
        A
      ].concat(C))
    }, function () {
      return AZ(A)
    })  : AW(A, 'viewInfo')
  }
  function Ah(B, G, E) {
    function A(H) {
      try {
        return G ? G(H)  : H
      } catch (J) {
        return Ab(J)
      }
    }
    function C(H) {
      try {
        return E ? E(H)  : Ab(H)
      } catch (J) {
        return Ab(J)
      }
    }
    var F = Af(),
    D = !1;
    Ag(function () {
      Ae(B).promiseSend('when', function (H) {
        D || (D = !0, Ae(H).promiseSend('when', function (J) {
          F.resolve(A(J))
        }, function (J) {
          F.resolve(C(J))
        }))
      }, function (H) {
        D || (D = !0, F.resolve(C(H)))
      })
    });
    return F.promise
  }
  function AE(A) {
    return function (C) {
      var B = Ai(arguments, 1);
      return AW.apply(void 0, [
        C,
        A
      ].concat(B))
    }
  }
  function AW(B, D) {
    var C = Af(),
    A = Ai(arguments, 2),
    B = Ae(B);
    Ag(function () {
      B.promiseSend.apply(B, [
        D,
        C.resolve
      ].concat(A))
    });
    return C.promise
  }
  function AD(B, D, C) {
    var A = Af(),
    B = Ae(B);
    Ag(function () {
      B.promiseSend.apply(B, [
        D,
        A.resolve
      ].concat(C))
    });
    return A.promise
  }
  function Ac(A) {
    return function (C) {
      var B = Ai(arguments, 1);
      return AD(C, A, B)
    }
  }
  function AC(B, C) {
    var A = Ai(arguments, 2);
    return AO(B, C, A)
  }
  function AB(A) {
    var B = Ai(arguments, 1);
    return AN(A, B)
  }
  function AA(A) {
    return Ah(A, function (C) {
      var B = C.length;
      if (0 === B) {
        return Ae(C)
      }
      var D = Af();
      AU(C, function (F, G, E) {
        Ah(G, function (H) {
          C[E] = H;
          0 === --B && D.resolve(C)
        }).fail(D.reject)
      }, void 0);
      return D.promise
    })
  }
  function AS(B, C, A) {
    return t(B, C).apply(void 0, A)
  }
  function t(B) {
    if (1 < arguments.length) {
      var D = arguments[1],
      A = Ai(arguments, 2),
      C = B,
      B = function () {
        var E = A.concat(Ai(arguments));
        return C.apply(D, E)
      }
    }
    return function () {
      var F = Af(),
      E = Ai(arguments);
      E.push(F.makeNodeResolver());
      AN(B, E).fail(F.reject);
      return F.promise
    }
  }
  var AM = function () {
  },
  AX = Object.freeze || AM;
  'undefined' !== typeof cajaVM && (AX = cajaVM.def);
  var Ag;
  if ('undefined' !== typeof process) {
    Ag = process.nextTick
  } else {
    if ('function' === typeof msSetImmediate) {
      Ag = msSetImmediate.bind(window)
    } else {
      if ('function' === typeof setImmediate) {
        Ag = setImmediate
      } else {
        if ('undefined' !== typeof MessageChannel) {
          var j = new MessageChannel,
          AV = {
          },
          f = AV;
          j.port1.onmessage = function () {
            AV = AV.next;
            var A = AV.task;
            delete AV.task;
            A()
          };
          Ag = function (A) {
            f = f.next = {
              task: A
            };
            j.port2.postMessage(0)
          }
        } else {
          Ag = function (A) {
            setTimeout(A, 0)
          }
        }
      }
    }
  }
  var Aa;
  Function.prototype.bind ? (Aa = Function.prototype.bind, Aa = Aa.bind(Aa.call))  : Aa = function (A) {
    return function (B) {
      return A.call.apply(A, arguments)
    }
  };
  var Ai = Aa(Array.prototype.slice),
  AU = Aa(Array.prototype.reduce || function (B, D) {
    var A = 0,
    C = this.length;
    if (arguments.length === 1) {
      do {
        if (A in this) {
          D = this[A++];
          break
        }
        if (++A >= C) {
          throw new TypeError
        }
      } while (1)
    }
    for (; A < C; A++) {
      A in this && (D = B(D, this[A], A))
    }
    return D
  }),
  a = Aa(Array.prototype.indexOf || function (A) {
    for (var B = 0; B < this.length; B++) {
      if (this[B] === A) {
        return B
      }
    }
    return - 1
  }),
  e = Aa(Array.prototype.map || function (B, D) {
    var A = this,
    C = [
    ];
    AU(A, function (G, F, E) {
      C.push(B.call(D, F, E, A))
    }, void 0);
    return C
  }),
  AR = Object.create || function (A) {
    function B() {
    }
    B.prototype = A;
    return new B
  },
  AG = Object.keys || function (B) {
    var C = [
    ],
    A;
    for (A in B) {
      C.push(A)
    }
    return C
  },
  I = Object.prototype.toString,
  AL;
  AL = 'undefined' !== typeof ReturnValue ? ReturnValue : function (A) {
    this.value = A
  };
  var AJ;
  Error.captureStackTrace && (AJ = function () {
    var A,
    B = Error.prepareStackTrace;
    Error.prepareStackTrace = function (D, C) {
      A = C[0].getFileName()
    };
    Error().stack;
    Error.prepareStackTrace = B;
    return A
  }());
  Aj.nextTick = Ag;
  Aj.defer = Af;
  Af.prototype.node = Af.prototype.makeNodeResolver = function () {
    var A = this;
    return function (C, B) {
      C ? A.reject(C)  : arguments.length > 2 ? A.resolve(Ai(arguments, 1))  : A.resolve(B)
    }
  };
  Aj.promise = function (A) {
    var B = Af();
    AC(A, void 0, B.resolve, B.reject).fail(B.reject);
    return B.promise
  };
  Aj.makePromise = Ad;
  Ad.prototype.then = function (A, B) {
    return Ah(this, A, B)
  };
  AU('isResolved,isFulfilled,isRejected,when,spread,send,get,put,del,post,invoke,keys,apply,call,bind,fapply,fcall,fbind,all,allResolved,view,viewInfo,timeout,delay,catch,finally,fail,fin,end'.split(','), function (A, B) {
    Ad.prototype[B] = function () {
      return Aj[B].apply(Aj, [
        this
      ].concat(Ai(arguments)))
    }
  }, void 0);
  Ad.prototype.toSource = function () {
    return this.toString()
  };
  Ad.prototype.toString = function () {
    return '[object Promise]'
  };
  AX(Ad.prototype);
  Aj.nearer = AZ;
  Aj.isPromise = AT;
  Aj.isResolved = function (A) {
    return AI(A) || AH(A)
  };
  Aj.isFulfilled = AI;
  Aj.isRejected = AH;
  var AQ = [
  ],
  AP = [
  ];
  'undefined' !== typeof window && window.console && console.log('Should be empty:', AP);
  Aj.reject = Ab;
  Aj.begin = Ae;
  Aj.resolve = Ae;
  Aj.ref = Ae;
  Aj.master = function (A) {
    return Ad({
      isDef: function () {
      }
    }, function (C) {
      var B = Ai(arguments);
      return AW.apply(void 0, [
        A
      ].concat(B))
    }, function () {
      return AZ(A)
    })
  };
  Aj.viewInfo = AF;
  Aj.view = function (A) {
    return AF(A).when(function (D) {
      var B;
      B = D.type === 'function' ? function () {
        return AO(A, void 0, arguments)
      }
       : {
      };
      var C = D.properties || {
      };
      AG(C).forEach(function (E) {
        C[E] === 'function' && (B[E] = function () {
          return c(A, E, arguments)
        })
      });
      return Ae(B)
    })
  };
  Aj.when = Ah;
  Aj.spread = function (B, C, A) {
    return Ah(B, function (D) {
      return C.apply(void 0, D)
    }, A)
  };
  Aj.async = function (A) {
    return function () {
      function E(F, J) {
        var H;
        try {
          H = B[F](J)
        } catch (G) {
          return I(G) === '[object StopIteration]' || G instanceof AL ? G.value : Ab(G)
        }
        return Ah(H, C, D)
      }
      var B = A.apply(this, arguments),
      C = E.bind(E, 'send'),
      D = E.bind(E, 'throw');
      return C()
    }
  };
  Aj['return'] = function (A) {
    throw new AL(A)
  };
  Aj.sender = AE;
  Aj.Method = AE;
  Aj.send = AW;
  Aj.dispatch = AD;
  Aj.dispatcher = Ac;
  Aj.get = Ac('get');
  Aj.put = Ac('put');
  Aj['delete'] = Aj.del = Ac('del');
  var c = Aj.post = Ac('post');
  Aj.invoke = function (B, C) {
    var A = Ai(arguments, 2);
    return c(B, C, A)
  };
  var AO = Aj.apply = Ac('apply'),
  AN = Aj.fapply = Ac('fapply');
  Aj.call = AC;
  Aj['try'] = AB;
  Aj.fcall = AB;
  Aj.bind = function (B, C) {
    var A = Ai(arguments, 2);
    return function () {
      var D = A.concat(Ai(arguments));
      return AO(B, C, D)
    }
  };
  Aj.fbind = function (A) {
    var B = Ai(arguments, 1);
    return function () {
      var C = B.concat(Ai(arguments));
      return AN(A, C)
    }
  };
  Aj.keys = Ac('keys');
  Aj.all = AA;
  Aj.allResolved = function (A) {
    return Ah(A, function (B) {
      return Ah(AA(e(B, function (C) {
        return Ah(C, AM, AM)
      })), function () {
        return e(B, Ae)
      })
    })
  };
  Aj['catch'] = Aj.fail = function (A, B) {
    return Ah(A, void 0, B)
  };
  Aj['finally'] = Aj.fin = function (A, B) {
    return Ah(A, function (C) {
      return Ah(B(), function () {
        return C
      })
    }, function (C) {
      return Ah(B(), function () {
        return Ab(C)
      })
    })
  };
  Aj.end = function (A) {
    Ah(A, void 0, function (B) {
      Ag(function () {
        if (Error.captureStackTrace) {
          var V = AK(B),
          T = AK(A),
          V = V.concat('From previous event:', T),
          U,
          T = [
          ];
          try {
            T.push(B.toString())
          } catch (S) {
            try {
              T.push('<error: ' + S + '>')
            } catch (P) {
              T.push('<error>')
            }
          }
          for (var M = 0; M < V.length; M++) {
            var O = V[M];
            if (typeof O === 'string') {
              T.push(O)
            } else {
              try {
                var R = '';
                if (O.isNative()) {
                  R = 'native'
                } else {
                  if (O.isEval()) {
                    R = 'eval at ' + O.getEvalOrigin()
                  } else {
                    var L = O.getFileName();
                    if (L) {
                      var R = R + L,
                      J = O.getLineNumber();
                      if (J !== null) {
                        var R = R + (':' + J),
                        H = O.getColumnNumber();
                        H && (R = R + (':' + H))
                      }
                    }
                  }
                }
                R || (R = 'unknown source');
                var N = '',
                K = O.getFunction().name,
                F = true,
                E = O.isConstructor();
                if (!O.isToplevel() && !E) {
                  var G = O.getMethodName(),
                  N = N + (O.getTypeName() + '.');
                  if (K) {
                    N = N + K;
                    G && G !== K && (N = N + (' [as ' + G + ']'))
                  } else {
                    N = N + (G || '<anonymous>')
                  }
                } else {
                  if (E) {
                    N = N + ('new ' + (K || '<anonymous>'))
                  } else {
                    if (K) {
                      N = N + K
                    } else {
                      N = N + R;
                      F = false
                    }
                  }
                }
                F && (N = N + (' (' + R + ')'));
                U = N
              } catch (D) {
                try {
                  U = '<error: ' + D + '>'
                } catch (C) {
                  U = '<error>'
                }
              }
              T.push('    at ' + U)
            }
          }
          U = T.join('\n');
          B.stack = U
        }
        throw B
      })
    })
  };
  Aj.timeout = function (B, C) {
    var A = Af();
    Ah(B, A.resolve, A.reject);
    setTimeout(function () {
      A.reject(Error('Timed out after ' + C + 'ms'))
    }, C);
    return A.promise
  };
  Aj.delay = function (B, A) {
    if (A === void 0) {
      A = B;
      B = void 0
    }
    var C = Af();
    setTimeout(function () {
      C.resolve(B)
    }, A);
    return C.promise
  };
  Aj.napply = AS;
  Aj.ncall = function (B, A) {
    var C = Ai(arguments, 2);
    return AS(B, A, C)
  };
  Aj.nbind = t;
  Aj.npost = function (B, A, C) {
    return AS(B[A], A, C)
  };
  Aj.ninvoke = function (B, A) {
    var C = Ai(arguments, 2);
    return AS(B[A], A, C)
  };
  AX(Aj)
});
(function (q, D, P, n, K, j) {
  var B = this;
  var N = Math.floor(Math.random() * 10000);
  var R = Function.prototype;
  var t = /^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/;
  var u = /[\-\w]+\/\.\.\//;
  var g = /([^:])\/\//g;
  var l = '';
  var O = {
  };
  var p = q.easyXDM;
  var x = 'easyXDM_';
  var f;
  var Z = false;
  var I;
  var H;
  function d(AA, AC) {
    var AB = typeof AA[AC];
    return AB == 'function' || (!!(AB == 'object' && AA[AC])) || AB == 'unknown'
  }
  function V(AA, AB) {
    return !!(typeof (AA[AB]) == 'object' && AA[AB])
  }
  function S(AA) {
    return Object.prototype.toString.call(AA) === '[object Array]'
  }
  function C() {
    try {
      var AA = new ActiveXObject('ShockwaveFlash.ShockwaveFlash');
      I = Array.prototype.slice.call(AA.GetVariable('$version').match(/(\d+),(\d+),(\d+),(\d+)/), 1);
      H = parseInt(I[0], 10) > 9 && parseInt(I[1], 10) > 0;
      AA = null;
      return true
    } catch (AB) {
      return false
    }
  }
  var W,
  Y;
  if (d(q, 'addEventListener')) {
    W = function (AC, AA, AB) {
      AC.addEventListener(AA, AB, false)
    };
    Y = function (AC, AA, AB) {
      AC.removeEventListener(AA, AB, false)
    }
  } else {
    if (d(q, 'attachEvent')) {
      W = function (AA, AC, AB) {
        AA.attachEvent('on' + AC, AB)
      };
      Y = function (AA, AC, AB) {
        AA.detachEvent('on' + AC, AB)
      }
    } else {
      throw new Error('Browser not supported')
    }
  }
  var z = false,
  m = [
  ],
  o;
  if ('readyState' in D) {
    o = D.readyState;
    z = o == 'complete' || (~navigator.userAgent.indexOf('AppleWebKit/') && (o == 'loaded' || o == 'interactive'))
  } else {
    z = !!D.body
  }
  function T() {
    if (z) {
      return
    }
    z = true;
    for (var AA = 0; AA < m.length; AA++) {
      m[AA]()
    }
    m.length = 0
  }
  if (!z) {
    if (d(q, 'addEventListener')) {
      W(D, 'DOMContentLoaded', T)
    } else {
      W(D, 'readystatechange', function () {
        if (D.readyState == 'complete') {
          T()
        }
      });
      if (D.documentElement.doScroll && q === top) {
        var G = function () {
          if (z) {
            return
          }
          try {
            D.documentElement.doScroll('left')
          } catch (AA) {
            n(G, 1);
            return
          }
          T()
        };
        G()
      }
    }
    W(q, 'load', T)
  }
  function h(AB, AA) {
    if (z) {
      AB.call(AA);
      return
    }
    m.push(function () {
      AB.call(AA)
    })
  }
  function M() {
    var AC = parent;
    if (l !== '') {
      for (var AA = 0, AB = l.split('.'); AA < AB.length; AA++) {
        AC = AC[AB[AA]]
      }
    }
    return AC.easyXDM
  }
  function E(AA) {
    q.easyXDM = p;
    l = AA;
    if (l) {
      x = 'easyXDM_' + l.replace('.', '_') + '_'
    }
    return O
  }
  function a(AA) {
    return AA.match(t) [3]
  }
  function F(AA) {
    return AA.match(t) [4] || ''
  }
  function J(AC) {
    var AA = AC.toLowerCase().match(t);
    var AD = AA[2],
    AE = AA[3],
    AB = AA[4] || '';
    if ((AD == 'http:' && AB == ':80') || (AD == 'https:' && AB == ':443')) {
      AB = ''
    }
    return AD + '//' + AE + AB
  }
  function c(AA) {
    AA = AA.replace(g, '$1/');
    if (!AA.match(/^(http||https):\/\//)) {
      var AB = (AA.substring(0, 1) === '/') ? '' : P.pathname;
      if (AB.substring(AB.length - 1) !== '/') {
        AB = AB.substring(0, AB.lastIndexOf('/') + 1)
      }
      AA = P.protocol + '//' + P.host + AB + AA
    }
    while (u.test(AA)) {
      AA = AA.replace(u, '')
    }
    return AA
  }
  function s(AA, AD) {
    var AF = '',
    AC = AA.indexOf('#');
    if (AC !== - 1) {
      AF = AA.substring(AC);
      AA = AA.substring(0, AC)
    }
    var AE = [
    ];
    for (var AB in AD) {
      if (AD.hasOwnProperty(AB)) {
        AE.push(AB + '=' + j(AD[AB]))
      }
    }
    return AA + (Z ? '#' : (AA.indexOf('?') == - 1 ? '?' : '&')) + AE.join('&') + AF
  }
  var v = (function (AA) {
    AA = AA.substring(1).split('&');
    var AC = {
    },
    AD,
    AB = AA.length;
    while (AB--) {
      AD = AA[AB].split('=');
      AC[AD[0]] = K(AD[1])
    }
    return AC
  }(/xdm_e=/.test(P.search) ? P.search : P.hash));
  function U(AA) {
    return typeof AA === 'undefined'
  }
  var r = function () {
    var AB = {
    };
    var AC = {
      a: [
        1,
        2,
        3
      ]
    },
    AA = '{"a":[1,2,3]}';
    if (typeof JSON != 'undefined' && typeof JSON.stringify === 'function' && JSON.stringify(AC).replace((/\s/g), '') === AA) {
      return JSON
    }
    if (Object.toJSON) {
      if (Object.toJSON(AC).replace((/\s/g), '') === AA) {
        AB.stringify = Object.toJSON
      }
    }
    if (typeof String.prototype.evalJSON === 'function') {
      AC = AA.evalJSON();
      if (AC.a && AC.a.length === 3 && AC.a[2] === 3) {
        AB.parse = function (AD) {
          return AD.evalJSON()
        }
      }
    }
    if (AB.stringify && AB.parse) {
      r = function () {
        return AB
      };
      return AB
    }
    return null
  };
  function w(AA, AB, AC) {
    var AE;
    for (var AD in AB) {
      if (AB.hasOwnProperty(AD)) {
        if (AD in AA) {
          AE = AB[AD];
          if (typeof AE === 'object') {
            w(AA[AD], AE, AC)
          } else {
            if (!AC) {
              AA[AD] = AB[AD]
            }
          }
        } else {
          AA[AD] = AB[AD]
        }
      }
    }
    return AA
  }
  function A() {
    var AB = D.body.appendChild(D.createElement('form')),
    AA = AB.appendChild(D.createElement('input'));
    AA.name = x + 'TEST' + N;
    f = AA !== AB.elements[AA.name];
    D.body.removeChild(AB)
  }
  function b(AA) {
    if (U(f)) {
      A()
    }
    var AC;
    if (f) {
      AC = D.createElement('<iframe name="' + AA.props.name + '"/>')
    } else {
      AC = D.createElement('IFRAME');
      AC.name = AA.props.name
    }
    AC.id = AC.name = AA.props.name;
    delete AA.props.name;
    if (AA.onLoad) {
      W(AC, 'load', AA.onLoad)
    }
    if (typeof AA.container == 'string') {
      AA.container = D.getElementById(AA.container)
    }
    if (!AA.container) {
      w(AC.style, {
        position: 'absolute',
        top: '-2000px'
      });
      AA.container = D.body
    }
    var AB = AA.props.src;
    delete AA.props.src;
    w(AC, AA.props);
    AC.border = AC.frameBorder = 0;
    AC.allowTransparency = true;
    AA.container.appendChild(AC);
    AC.src = AB;
    AA.props.src = AB;
    return AC
  }
  function y(AD, AC) {
    if (typeof AD == 'string') {
      AD = [
        AD
      ]
    }
    var AB,
    AA = AD.length;
    while (AA--) {
      AB = AD[AA];
      AB = new RegExp(AB.substr(0, 1) == '^' ? AB : ('^' + AB.replace(/(\*)/g, '.$1').replace(/\?/g, '.') + '$'));
      if (AB.test(AC)) {
        return true
      }
    }
    return false
  }
  function L(AC) {
    var AH = AC.protocol,
    AB;
    AC.isHost = AC.isHost || U(v.xdm_p);
    Z = AC.hash || false;
    if (!AC.props) {
      AC.props = {
      }
    }
    if (!AC.isHost) {
      AC.channel = v.xdm_c;
      AC.secret = v.xdm_s;
      AC.remote = v.xdm_e;
      AH = v.xdm_p;
      if (AC.acl && !y(AC.acl, AC.remote)) {
        throw new Error('Access denied for ' + AC.remote)
      }
    } else {
      AC.remote = c(AC.remote);
      AC.channel = AC.channel || 'default' + N++;
      AC.secret = Math.random().toString(16).substring(2);
      if (U(AH)) {
        if (J(P.href) == J(AC.remote)) {
          AH = '4'
        } else {
          if (d(q, 'postMessage') || d(D, 'postMessage')) {
            AH = '1'
          } else {
            if (AC.swf && d(q, 'ActiveXObject') && C()) {
              AH = '6'
            } else {
              if (navigator.product === 'Gecko' && 'frameElement' in q && navigator.userAgent.indexOf('WebKit') == - 1) {
                AH = '5'
              } else {
                if (AC.remoteHelper) {
                  AC.remoteHelper = c(AC.remoteHelper);
                  AH = '2'
                } else {
                  AH = '0'
                }
              }
            }
          }
        }
      }
    }
    AC.protocol = AH;
    switch (AH) {
      case '0':
        w(AC, {
          interval: 100,
          delay: 2000,
          useResize: true,
          useParent: false,
          usePolling: false
        }, true);
        if (AC.isHost) {
          if (!AC.local) {
            var AF = P.protocol + '//' + P.host,
            AA = D.body.getElementsByTagName('img'),
            AG;
            var AD = AA.length;
            while (AD--) {
              AG = AA[AD];
              if (AG.src.substring(0, AF.length) === AF) {
                AC.local = AG.src;
                break
              }
            }
            if (!AC.local) {
              AC.local = q
            }
          }
          var AE = {
            xdm_c: AC.channel,
            xdm_p: 0
          };
          if (AC.local === q) {
            AC.usePolling = true;
            AC.useParent = true;
            AC.local = P.protocol + '//' + P.host + P.pathname + P.search;
            AE.xdm_e = AC.local;
            AE.xdm_pa = 1
          } else {
            AE.xdm_e = c(AC.local)
          }
          if (AC.container) {
            AC.useResize = false;
            AE.xdm_po = 1
          }
          AC.remote = s(AC.remote, AE)
        } else {
          w(AC, {
            channel: v.xdm_c,
            remote: v.xdm_e,
            useParent: !U(v.xdm_pa),
            usePolling: !U(v.xdm_po),
            useResize: AC.useParent ? false : AC.useResize
          })
        }
        AB = [
          new O.stack.HashTransport(AC),
          new O.stack.ReliableBehavior({
          }),
          new O.stack.QueueBehavior({
            encode: true,
            maxLength: 4000 - AC.remote.length
          }),
          new O.stack.VerifyBehavior({
            initiate: AC.isHost
          })
        ];
        break;
      case '1':
        AB = [
          new O.stack.PostMessageTransport(AC)
        ];
        break;
      case '2':
        AB = [
          new O.stack.NameTransport(AC),
          new O.stack.QueueBehavior(),
          new O.stack.VerifyBehavior({
            initiate: AC.isHost
          })
        ];
        break;
      case '3':
        AB = [
          new O.stack.NixTransport(AC)
        ];
        break;
      case '4':
        AB = [
          new O.stack.SameOriginTransport(AC)
        ];
        break;
      case '5':
        AB = [
          new O.stack.FrameElementTransport(AC)
        ];
        break;
      case '6':
        if (!I) {
          C()
        }
        AB = [
          new O.stack.FlashTransport(AC)
        ];
        break
    }
    AB.push(new O.stack.QueueBehavior({
      lazy: AC.lazy,
      remove: true
    }));
    return AB
  }
  function e(AD) {
    var AE,
    AC = {
      incoming: function (AG, AF) {
        this.up.incoming(AG, AF)
      },
      outgoing: function (AF, AG) {
        this.down.outgoing(AF, AG)
      },
      callback: function (AF) {
        this.up.callback(AF)
      },
      init: function () {
        this.down.init()
      },
      destroy: function () {
        this.down.destroy()
      }
    };
    for (var AB = 0, AA = AD.length; AB < AA; AB++) {
      AE = AD[AB];
      w(AE, AC, true);
      if (AB !== 0) {
        AE.down = AD[AB - 1]
      }
      if (AB !== AA - 1) {
        AE.up = AD[AB + 1]
      }
    }
    return AE
  }
  function X(AA) {
    AA.up.down = AA.down;
    AA.down.up = AA.up;
    AA.up = AA.down = null
  }
  w(O, {
    version: '2.4.15.118',
    query: v,
    stack: {
    },
    apply: w,
    getJSONObject: r,
    whenReady: h,
    noConflict: E
  });
  O.DomHelper = {
    on: W,
    un: Y,
    requiresJSON: function (AA) {
      if (!V(q, 'JSON')) {
        D.write('<script type="text/javascript" src="' + AA + '"></script>')
      }
    }
  };
  (function () {
    var AA = {
    };
    O.Fn = {
      set: function (AB, AC) {
        AA[AB] = AC
      },
      get: function (AC, AB) {
        var AD = AA[AC];
        if (AB) {
          delete AA[AC]
        }
        return AD
      }
    }
  }());
  O.Socket = function (AB) {
    var AA = e(L(AB).concat([{
      incoming: function (AE, AD) {
        AB.onMessage(AE, AD)
      },
      callback: function (AD) {
        if (AB.onReady) {
          AB.onReady(AD)
        }
      }
    }
    ])),
    AC = J(AB.remote);
    this.origin = J(AB.remote);
    this.destroy = function () {
      AA.destroy()
    };
    this.postMessage = function (AD) {
      AA.outgoing(AD, AC)
    };
    AA.init()
  };
  O.Rpc = function (AC, AB) {
    if (AB.local) {
      for (var AE in AB.local) {
        if (AB.local.hasOwnProperty(AE)) {
          var AD = AB.local[AE];
          if (typeof AD === 'function') {
            AB.local[AE] = {
              method: AD
            }
          }
        }
      }
    }
    var AA = e(L(AC).concat([new O.stack.RpcBehavior(this, AB),
    {
      callback: function (AF) {
        if (AC.onReady) {
          AC.onReady(AF)
        }
      }
    }
    ]));
    this.origin = J(AC.remote);
    this.destroy = function () {
      AA.destroy()
    };
    AA.init()
  };
  O.stack.SameOriginTransport = function (AB) {
    var AC,
    AE,
    AD,
    AA;
    return (AC = {
      outgoing: function (AG, AH, AF) {
        AD(AG);
        if (AF) {
          AF()
        }
      },
      destroy: function () {
        if (AE) {
          AE.parentNode.removeChild(AE);
          AE = null
        }
      },
      onDOMReady: function () {
        AA = J(AB.remote);
        if (AB.isHost) {
          w(AB.props, {
            src: s(AB.remote, {
              xdm_e: P.protocol + '//' + P.host + P.pathname,
              xdm_c: AB.channel,
              xdm_p: 4
            }),
            name: x + AB.channel + '_provider'
          });
          AE = b(AB);
          O.Fn.set(AB.channel, function (AF) {
            AD = AF;
            n(function () {
              AC.up.callback(true)
            }, 0);
            return function (AG) {
              AC.up.incoming(AG, AA)
            }
          })
        } else {
          AD = M().Fn.get(AB.channel, true) (function (AF) {
            AC.up.incoming(AF, AA)
          });
          n(function () {
            AC.up.callback(true)
          }, 0)
        }
      },
      init: function () {
        h(AC.onDOMReady, AC)
      }
    })
  };
  O.stack.FlashTransport = function (AD) {
    var AF,
    AA,
    AE,
    AG,
    AB,
    AH;
    function AI(AK, AJ) {
      n(function () {
        AF.up.incoming(AK, AG)
      }, 0)
    }
    function AC(AK) {
      var AJ = AD.swf + '?host=' + AD.isHost;
      var AM = 'easyXDM_swf_' + Math.floor(Math.random() * 10000);
      O.Fn.set('flash_loaded' + AK.replace(/[\-.]/g, '_'), function () {
        O.stack.FlashTransport[AK].swf = AB = AH.firstChild;
        var AN = O.stack.FlashTransport[AK].queue;
        for (var AO = 0; AO < AN.length; AO++) {
          AN[AO]()
        }
        AN.length = 0
      });
      if (AD.swfContainer) {
        AH = (typeof AD.swfContainer == 'string') ? D.getElementById(AD.swfContainer)  : AD.swfContainer
      } else {
        AH = D.createElement('div');
        w(AH.style, H && AD.swfNoThrottle ? {
          height: '20px',
          width: '20px',
          position: 'fixed',
          right: 0,
          top: 0
        }
         : {
          height: '1px',
          width: '1px',
          position: 'absolute',
          overflow: 'hidden',
          right: 0,
          top: 0
        });
        D.body.appendChild(AH)
      }
      var AL = 'callback=flash_loaded' + AK.replace(/[\-.]/g, '_') + '&proto=' + B.location.protocol + '&domain=' + a(B.location.href) + '&port=' + F(B.location.href) + '&ns=' + l;
      AH.innerHTML = '<object height=\'20\' width=\'20\' type=\'application/x-shockwave-flash\' id=\'' + AM + '\' data=\'' + AJ + '\'><param name=\'allowScriptAccess\' value=\'always\'></param><param name=\'wmode\' value=\'transparent\'><param name=\'movie\' value=\'' + AJ + '\'></param><param name=\'flashvars\' value=\'' + AL + '\'></param><embed type=\'application/x-shockwave-flash\' FlashVars=\'' + AL + '\' allowScriptAccess=\'always\' wmode=\'transparent\' src=\'' + AJ + '\' height=\'1\' width=\'1\'></embed></object>'
    }
    return (AF = {
      outgoing: function (AK, AL, AJ) {
        AB.postMessage(AD.channel, AK.toString());
        if (AJ) {
          AJ()
        }
      },
      destroy: function () {
        try {
          AB.destroyChannel(AD.channel)
        } catch (AJ) {
        }
        AB = null;
        if (AA) {
          AA.parentNode.removeChild(AA);
          AA = null
        }
      },
      onDOMReady: function () {
        AG = AD.remote;
        O.Fn.set('flash_' + AD.channel + '_init', function () {
          n(function () {
            AF.up.callback(true)
          })
        });
        O.Fn.set('flash_' + AD.channel + '_onMessage', AI);
        AD.swf = c(AD.swf);
        var AK = a(AD.swf);
        var AJ = function () {
          O.stack.FlashTransport[AK].init = true;
          AB = O.stack.FlashTransport[AK].swf;
          AB.createChannel(AD.channel, AD.secret, J(AD.remote), AD.isHost);
          if (AD.isHost) {
            if (H && AD.swfNoThrottle) {
              w(AD.props, {
                position: 'fixed',
                right: 0,
                top: 0,
                height: '20px',
                width: '20px'
              })
            }
            w(AD.props, {
              src: s(AD.remote, {
                xdm_e: J(P.href),
                xdm_c: AD.channel,
                xdm_p: 6,
                xdm_s: AD.secret
              }),
              name: x + AD.channel + '_provider'
            });
            AA = b(AD)
          }
        };
        if (O.stack.FlashTransport[AK] && O.stack.FlashTransport[AK].init) {
          AJ()
        } else {
          if (!O.stack.FlashTransport[AK]) {
            O.stack.FlashTransport[AK] = {
              queue: [
                AJ
              ]
            };
            AC(AK)
          } else {
            O.stack.FlashTransport[AK].queue.push(AJ)
          }
        }
      },
      init: function () {
        h(AF.onDOMReady, AF)
      }
    })
  };
  O.stack.PostMessageTransport = function (AD) {
    var AF,
    AG,
    AB,
    AC;
    function AA(AH) {
      if (AH.origin) {
        return J(AH.origin)
      }
      if (AH.uri) {
        return J(AH.uri)
      }
      if (AH.domain) {
        return P.protocol + '//' + AH.domain
      }
      throw 'Unable to retrieve the origin of the event'
    }
    function AE(AI) {
      var AH = AA(AI);
      if (AH == AC && AI.data.substring(0, AD.channel.length + 1) == AD.channel + ' ') {
        AF.up.incoming(AI.data.substring(AD.channel.length + 1), AH)
      }
    }
    return (AF = {
      outgoing: function (AI, AJ, AH) {
        AB.postMessage(AD.channel + ' ' + AI, AJ || AC);
        if (AH) {
          AH()
        }
      },
      destroy: function () {
        Y(q, 'message', AE);
        if (AG) {
          AB = null;
          AG.parentNode.removeChild(AG);
          AG = null
        }
      },
      onDOMReady: function () {
        AC = J(AD.remote);
        if (AD.isHost) {
          var AH = function (AI) {
            if (AI.data == AD.channel + '-ready') {
              AB = ('postMessage' in AG.contentWindow) ? AG.contentWindow : AG.contentWindow.document;
              Y(q, 'message', AH);
              W(q, 'message', AE);
              n(function () {
                AF.up.callback(true)
              }, 0)
            }
          };
          W(q, 'message', AH);
          w(AD.props, {
            src: s(AD.remote, {
              xdm_e: J(P.href),
              xdm_c: AD.channel,
              xdm_p: 1
            }),
            name: x + AD.channel + '_provider'
          });
          AG = b(AD)
        } else {
          W(q, 'message', AE);
          AB = ('postMessage' in q.parent) ? q.parent : q.parent.document;
          AB.postMessage(AD.channel + '-ready', AC);
          n(function () {
            AF.up.callback(true)
          }, 0)
        }
      },
      init: function () {
        h(AF.onDOMReady, AF)
      }
    })
  };
  O.stack.FrameElementTransport = function (AB) {
    var AC,
    AE,
    AD,
    AA;
    return (AC = {
      outgoing: function (AG, AH, AF) {
        AD.call(this, AG);
        if (AF) {
          AF()
        }
      },
      destroy: function () {
        if (AE) {
          AE.parentNode.removeChild(AE);
          AE = null
        }
      },
      onDOMReady: function () {
        AA = J(AB.remote);
        if (AB.isHost) {
          w(AB.props, {
            src: s(AB.remote, {
              xdm_e: J(P.href),
              xdm_c: AB.channel,
              xdm_p: 5
            }),
            name: x + AB.channel + '_provider'
          });
          AE = b(AB);
          AE.fn = function (AF) {
            delete AE.fn;
            AD = AF;
            n(function () {
              AC.up.callback(true)
            }, 0);
            return function (AG) {
              AC.up.incoming(AG, AA)
            }
          }
        } else {
          if (D.referrer && J(D.referrer) != v.xdm_e) {
            q.top.location = v.xdm_e
          }
          AD = q.frameElement.fn(function (AF) {
            AC.up.incoming(AF, AA)
          });
          AC.up.callback(true)
        }
      },
      init: function () {
        h(AC.onDOMReady, AC)
      }
    })
  };
  O.stack.NameTransport = function (AE) {
    var AF;
    var AH,
    AL,
    AD,
    AJ,
    AK,
    AB,
    AA;
    function AI(AO) {
      var AN = AE.remoteHelper + (AH ? '#_3' : '#_2') + AE.channel;
      AL.contentWindow.sendMessage(AO, AN)
    }
    function AG() {
      if (AH) {
        if (++AJ === 2 || !AH) {
          AF.up.callback(true)
        }
      } else {
        AI('ready');
        AF.up.callback(true)
      }
    }
    function AM(AN) {
      AF.up.incoming(AN, AB)
    }
    function AC() {
      if (AK) {
        n(function () {
          AK(true)
        }, 0)
      }
    }
    return (AF = {
      outgoing: function (AO, AP, AN) {
        AK = AN;
        AI(AO)
      },
      destroy: function () {
        AL.parentNode.removeChild(AL);
        AL = null;
        if (AH) {
          AD.parentNode.removeChild(AD);
          AD = null
        }
      },
      onDOMReady: function () {
        AH = AE.isHost;
        AJ = 0;
        AB = J(AE.remote);
        AE.local = c(AE.local);
        if (AH) {
          O.Fn.set(AE.channel, function (AO) {
            if (AH && AO === 'ready') {
              O.Fn.set(AE.channel, AM);
              AG()
            }
          });
          AA = s(AE.remote, {
            xdm_e: AE.local,
            xdm_c: AE.channel,
            xdm_p: 2
          });
          w(AE.props, {
            src: AA + '#' + AE.channel,
            name: x + AE.channel + '_provider'
          });
          AD = b(AE)
        } else {
          AE.remoteHelper = AE.remote;
          O.Fn.set(AE.channel, AM)
        }
        AL = b({
          props: {
            src: AE.local + '#_4' + AE.channel
          },
          onLoad: function AN() {
            var AO = AL || this;
            Y(AO, 'load', AN);
            O.Fn.set(AE.channel + '_load', AC);
            (function AP() {
              if (typeof AO.contentWindow.sendMessage == 'function') {
                AG()
              } else {
                n(AP, 50)
              }
            }())
          }
        })
      },
      init: function () {
        h(AF.onDOMReady, AF)
      }
    })
  };
  O.stack.HashTransport = function (AC) {
    var AF;
    var AK = this,
    AI,
    AD,
    AA,
    AG,
    AP,
    AE,
    AO;
    var AJ,
    AB;
    function AN(AR) {
      if (!AO) {
        return
      }
      var AQ = AC.remote + '#' + (AP++) + '_' + AR;
      ((AI || !AJ) ? AO.contentWindow : AO).location = AQ
    }
    function AH(AQ) {
      AG = AQ;
      AF.up.incoming(AG.substring(AG.indexOf('_') + 1), AB)
    }
    function AM() {
      if (!AE) {
        return
      }
      var AQ = AE.location.href,
      AS = '',
      AR = AQ.indexOf('#');
      if (AR != - 1) {
        AS = AQ.substring(AR)
      }
      if (AS && AS != AG) {
        AH(AS)
      }
    }
    function AL() {
      AD = setInterval(AM, AA)
    }
    return (AF = {
      outgoing: function (AQ, AR) {
        AN(AQ)
      },
      destroy: function () {
        q.clearInterval(AD);
        if (AI || !AJ) {
          AO.parentNode.removeChild(AO)
        }
        AO = null
      },
      onDOMReady: function () {
        AI = AC.isHost;
        AA = AC.interval;
        AG = '#' + AC.channel;
        AP = 0;
        AJ = AC.useParent;
        AB = J(AC.remote);
        if (AI) {
          AC.props = {
            src: AC.remote,
            name: x + AC.channel + '_provider'
          };
          if (AJ) {
            AC.onLoad = function () {
              AE = q;
              AL();
              AF.up.callback(true)
            }
          } else {
            var AS = 0,
            AQ = AC.delay / 50;
            (function AR() {
              if (++AS > AQ) {
                throw new Error('Unable to reference listenerwindow')
              }
              try {
                AE = AO.contentWindow.frames[x + AC.channel + '_consumer']
              } catch (AT) {
              }
              if (AE) {
                AL();
                AF.up.callback(true)
              } else {
                n(AR, 50)
              }
            }())
          }
          AO = b(AC)
        } else {
          AE = q;
          AL();
          if (AJ) {
            AO = parent;
            AF.up.callback(true)
          } else {
            w(AC, {
              props: {
                src: AC.remote + '#' + AC.channel + new Date(),
                name: x + AC.channel + '_consumer'
              },
              onLoad: function () {
                AF.up.callback(true)
              }
            });
            AO = b(AC)
          }
        }
      },
      init: function () {
        h(AF.onDOMReady, AF)
      }
    })
  };
  O.stack.ReliableBehavior = function (AB) {
    var AD,
    AF;
    var AE = 0,
    AA = 0,
    AC = '';
    return (AD = {
      incoming: function (AI, AG) {
        var AH = AI.indexOf('_'),
        AJ = AI.substring(0, AH).split(',');
        AI = AI.substring(AH + 1);
        if (AJ[0] == AE) {
          AC = '';
          if (AF) {
            AF(true)
          }
        }
        if (AI.length > 0) {
          AD.down.outgoing(AJ[1] + ',' + AE + '_' + AC, AG);
          if (AA != AJ[1]) {
            AA = AJ[1];
            AD.up.incoming(AI, AG)
          }
        }
      },
      outgoing: function (AI, AG, AH) {
        AC = AI;
        AF = AH;
        AD.down.outgoing(AA + ',' + (++AE) + '_' + AI, AG)
      }
    })
  };
  O.stack.QueueBehavior = function (AC) {
    var AF,
    AG = [
    ],
    AJ = true,
    AD = '',
    AI,
    AA = 0,
    AB = false,
    AE = false;
    function AH() {
      if (AC.remove && AG.length === 0) {
        X(AF);
        return
      }
      if (AJ || AG.length === 0 || AI) {
        return
      }
      AJ = true;
      var AK = AG.shift();
      AF.down.outgoing(AK.data, AK.origin, function (AL) {
        AJ = false;
        if (AK.callback) {
          n(function () {
            AK.callback(AL)
          }, 0)
        }
        AH()
      })
    }
    return (AF = {
      init: function () {
        if (U(AC)) {
          AC = {
          }
        }
        if (AC.maxLength) {
          AA = AC.maxLength;
          AE = true
        }
        if (AC.lazy) {
          AB = true
        } else {
          AF.down.init()
        }
      },
      callback: function (AL) {
        AJ = false;
        var AK = AF.up;
        AH();
        AK.callback(AL)
      },
      incoming: function (AN, AL) {
        if (AE) {
          var AM = AN.indexOf('_'),
          AK = parseInt(AN.substring(0, AM), 10);
          AD += AN.substring(AM + 1);
          if (AK === 0) {
            if (AC.encode) {
              AD = K(AD)
            }
            AF.up.incoming(AD, AL);
            AD = ''
          }
        } else {
          AF.up.incoming(AN, AL)
        }
      },
      outgoing: function (AO, AL, AN) {
        if (AC.encode) {
          AO = j(AO)
        }
        var AK = [
        ],
        AM;
        if (AE) {
          while (AO.length !== 0) {
            AM = AO.substring(0, AA);
            AO = AO.substring(AM.length);
            AK.push(AM)
          }
          while ((AM = AK.shift())) {
            AG.push({
              data: AK.length + '_' + AM,
              origin: AL,
              callback: AK.length === 0 ? AN : null
            })
          }
        } else {
          AG.push({
            data: AO,
            origin: AL,
            callback: AN
          })
        }
        if (AB) {
          AF.down.init()
        } else {
          AH()
        }
      },
      destroy: function () {
        AI = true;
        AF.down.destroy()
      }
    })
  };
  O.stack.VerifyBehavior = function (AE) {
    var AF,
    AD,
    AB,
    AC = false;
    function AA() {
      AD = Math.random().toString(16).substring(2);
      AF.down.outgoing(AD)
    }
    return (AF = {
      incoming: function (AI, AG) {
        var AH = AI.indexOf('_');
        if (AH === - 1) {
          if (AI === AD) {
            AF.up.callback(true)
          } else {
            if (!AB) {
              AB = AI;
              if (!AE.initiate) {
                AA()
              }
              AF.down.outgoing(AI)
            }
          }
        } else {
          if (AI.substring(0, AH) === AB) {
            AF.up.incoming(AI.substring(AH + 1), AG)
          }
        }
      },
      outgoing: function (AI, AG, AH) {
        AF.down.outgoing(AD + '_' + AI, AG, AH)
      },
      callback: function (AG) {
        if (AE.initiate) {
          AA()
        }
      }
    })
  };
  O.stack.RpcBehavior = function (AG, AB) {
    var AD,
    AI = AB.serializer || r();
    var AH = 0,
    AF = {
    };
    function AA(AJ) {
      AJ.jsonrpc = '2.0';
      AD.down.outgoing(AI.stringify(AJ))
    }
    function AE(AJ, AL) {
      var AK = Array.prototype.slice;
      return function () {
        var AM = arguments.length,
        AO,
        AN = {
          method: AL
        };
        if (AM > 0 && typeof arguments[AM - 1] === 'function') {
          if (AM > 1 && typeof arguments[AM - 2] === 'function') {
            AO = {
              success: arguments[AM - 2],
              error: arguments[AM - 1]
            };
            AN.params = AK.call(arguments, 0, AM - 2)
          } else {
            AO = {
              success: arguments[AM - 1]
            };
            AN.params = AK.call(arguments, 0, AM - 1)
          }
          AF['' + (++AH)] = AO;
          AN.id = AH
        } else {
          AN.params = AK.call(arguments, 0)
        }
        if (AJ.namedParams && AN.params.length === 1) {
          AN.params = AN.params[0]
        }
        AA(AN)
      }
    }
    function AC(AQ, AP, AL, AO) {
      if (!AL) {
        if (AP) {
          AA({
            id: AP,
            error: {
              code: - 32601,
              message: 'Procedure not found.'
            }
          })
        }
        return
      }
      var AN,
      AK;
      if (AP) {
        AN = function (AR) {
          AN = R;
          AA({
            id: AP,
            result: AR
          })
        };
        AK = function (AR, AS) {
          AK = R;
          var AT = {
            id: AP,
            error: {
              code: - 32099,
              message: AR
            }
          };
          if (AS) {
            AT.error.data = AS
          }
          AA(AT)
        }
      } else {
        AN = AK = R
      }
      if (!S(AO)) {
        AO = [
          AO
        ]
      }
      try {
        var AJ = AL.method.apply(AL.scope, AO.concat([AN,
        AK]));
        if (!U(AJ)) {
          AN(AJ)
        }
      } catch (AM) {
        AK(AM.message)
      }
    }
    return (AD = {
      incoming: function (AK, AJ) {
        var AL = AI.parse(AK);
        if (AL.method) {
          if (AB.handle) {
            AB.handle(AL, AA)
          } else {
            AC(AL.method, AL.id, AB.local[AL.method], AL.params)
          }
        } else {
          var AM = AF[AL.id];
          if (AL.error) {
            if (AM.error) {
              AM.error(AL.error)
            }
          } else {
            if (AM.success) {
              AM.success(AL.result)
            }
          }
          delete AF[AL.id]
        }
      },
      init: function () {
        if (AB.remote) {
          for (var AJ in AB.remote) {
            if (AB.remote.hasOwnProperty(AJ)) {
              AG[AJ] = AE(AB.remote[AJ], AJ)
            }
          }
        }
        AD.down.init()
      },
      destroy: function () {
        for (var AJ in AB.remote) {
          if (AB.remote.hasOwnProperty(AJ) && AG.hasOwnProperty(AJ)) {
            delete AG[AJ]
          }
        }
        AD.down.destroy()
      }
    })
  };
  B.easyXDM = O
}) (window, document, location, window.setTimeout, decodeURIComponent, encodeURIComponent); (function (F) {
  if (!F || !(F.toJSON || Object.toJSON || window.JSON)) {
    throw new Error('jQuery, MooTools or Prototype needs to be loaded before jStorage!')
  }
  var G = {
  },
  D = {
    jStorage: '{}'
  },
  H = null,
  J = 0,
  L = F.toJSON || Object.toJSON || (window.JSON && (JSON.encode || JSON.stringify)),
  E = F.evalJSON || (window.JSON && (JSON.decode || JSON.parse)) || function (M) {
    return String(M).evalJSON()
  },
  I = false;
  _XMLService = {
    isXML: function (N) {
      var M = (N ? N.ownerDocument || N : 0).documentElement;
      return M ? M.nodeName !== 'HTML' : false
    },
    encode: function (N) {
      if (!this.isXML(N)) {
        return false
      }
      try {
        return new XMLSerializer().serializeToString(N)
      } catch (M) {
        try {
          return N.xml
        } catch (O) {
        }
      }
      return false
    },
    decode: function (N) {
      var M = ('DOMParser' in window && (new DOMParser()).parseFromString) || (window.ActiveXObject && function (P) {
        var R = new ActiveXObject('Microsoft.XMLDOM');
        R.async = 'false';
        R.loadXML(P);
        return R
      }),
      O;
      if (!M) {
        return false
      }
      O = M.call('DOMParser' in window && (new DOMParser()) || window, N, 'text/xml');
      return this.isXML(O) ? O : false
    }
  };
  function K() {
    if ('localStorage' in window) {
      try {
        if (window.localStorage) {
          D = window.localStorage;
          I = 'localStorage'
        }
      } catch (P) {
      }
    } else {
      if ('globalStorage' in window) {
        try {
          if (window.globalStorage) {
            D = window.globalStorage[window.location.hostname];
            I = 'globalStorage'
          }
        } catch (O) {
        }
      } else {
        H = document.createElement('link');
        if (H.addBehavior) {
          H.style.behavior = 'url(#default#userData)';
          document.getElementsByTagName('head') [0].appendChild(H);
          H.load('jStorage');
          var N = '{}';
          try {
            N = H.getAttribute('jStorage')
          } catch (M) {
          }
          D.jStorage = N;
          I = 'userDataBehavior'
        } else {
          H = null;
          return
        }
      }
    }
    B()
  }
  function B() {
    if (D.jStorage) {
      try {
        G = E(String(D.jStorage))
      } catch (M) {
        D.jStorage = '{}'
      }
    } else {
      D.jStorage = '{}'
    }
    J = D.jStorage ? String(D.jStorage).length : 0
  }
  function C() {
    try {
      D.jStorage = L(G);
      if (H) {
        H.setAttribute('jStorage', D.jStorage);
        H.save('jStorage')
      }
      J = D.jStorage ? String(D.jStorage).length : 0
    } catch (M) {
    }
  }
  function A(M) {
    if (!M || (typeof M != 'string' && typeof M != 'number')) {
      throw new TypeError('Key name must be string or numeric')
    }
    return true
  }
  F.jStorage = {
    version: '0.1.5.0',
    set: function (M, N) {
      A(M);
      if (_XMLService.isXML(N)) {
        N = {
          _is_xml: true,
          xml: _XMLService.encode(N)
        }
      }
      G[M] = N;
      C();
      return N
    },
    get: function (M, N) {
      A(M);
      if (M in G) {
        if (typeof G[M] == 'object' && G[M]._is_xml && G[M]._is_xml) {
          return _XMLService.decode(G[M].xml)
        } else {
          return G[M]
        }
      }
      return typeof (N) == 'undefined' ? null : N
    },
    deleteKey: function (M) {
      A(M);
      if (M in G) {
        delete G[M];
        C();
        return true
      }
      return false
    },
    flush: function () {
      G = {
      };
      C();
      try {
        window.localStorage.clear()
      } catch (M) {
      }
      return true
    },
    storageObj: function () {
      function M() {
      }
      M.prototype = G;
      return new M()
    },
    index: function () {
      var M = [
      ],
      N;
      for (N in G) {
        if (G.hasOwnProperty(N)) {
          M.push(N)
        }
      }
      return M
    },
    storageSize: function () {
      return J
    },
    currentBackend: function () {
      return I
    },
    storageAvailable: function () {
      return !!I
    },
    reInit: function () {
      var M,
      O;
      if (H && H.addBehavior) {
        M = document.createElement('link');
        H.parentNode.replaceChild(M, H);
        H = M;
        H.style.behavior = 'url(#default#userData)';
        document.getElementsByTagName('head') [0].appendChild(H);
        H.load('jStorage');
        O = '{}';
        try {
          O = H.getAttribute('jStorage')
        } catch (N) {
        }
        D.jStorage = O;
        I = 'userDataBehavior'
      }
      B()
    }
  };
  K()
}) (window.jQuery || {
});/* Socket.IO.min.js build:0.9.8, production. Copyright(c) 2011 LearnBoost <dev@learnboost.com> MIT Licensed */
var io = 'undefined' == typeof module ? {
}
 : module.exports; (function () {
  (function (a, b) {
    var c = a;
    c.version = '0.9.8',
    c.protocol = 1,
    c.transports = [
    ],
    c.j = [
    ],
    c.sockets = {
    },
    c.connect = function (a, d) {
      var e = c.util.parseUri(a),
      f,
      g;
      b && b.location && (e.protocol = e.protocol || b.location.protocol.slice(0, - 1), e.host = e.host || (b.document ? b.document.domain : b.location.hostname), e.port = e.port || b.location.port),
      f = c.util.uniqueUri(e);
      var h = {
        host: e.host,
        secure: 'https' == e.protocol,
        port: e.port || ('https' == e.protocol ? 443 : 80),
        query: e.query || ''
      };
      c.util.merge(h, d);
      if (h['force new connection'] || !c.sockets[f]) {
        g = new c.Socket(h)
      }
      return !h['force new connection'] && g && (c.sockets[f] = g),
      g = g || c.sockets[f],
      g.of(e.path.length > 1 ? e.path : '')
    }
  }) ('object' == typeof module ? module.exports : this.io = {
  }, this),
  function (a, b) {
    var c = a.util = {
    },
    d = /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,
    e = [
      'source',
      'protocol',
      'authority',
      'userInfo',
      'user',
      'password',
      'host',
      'port',
      'relative',
      'path',
      'directory',
      'file',
      'query',
      'anchor'
    ];
    c.parseUri = function (a) {
      var b = d.exec(a || ''),
      c = {
      },
      f = 14;
      while (f--) {
        c[e[f]] = b[f] || ''
      }
      return c
    },
    c.uniqueUri = function (a) {
      var c = a.protocol,
      d = a.host,
      e = a.port;
      return 'document' in b ? (d = d || document.domain, e = e || (c == 'https' && document.location.protocol !== 'https:' ? 443 : document.location.port))  : (d = d || 'localhost', !e && c == 'https' && (e = 443)),
      (c || 'http') + '://' + d + ':' + (e || 80)
    },
    c.query = function (a, b) {
      var d = c.chunkQuery(a || ''),
      e = [
      ];
      c.merge(d, c.chunkQuery(b || ''));
      for (var f in d) {
        d.hasOwnProperty(f) && e.push(f + '=' + d[f])
      }
      return e.length ? '?' + e.join('&')  : ''
    },
    c.chunkQuery = function (a) {
      var b = {
      },
      c = a.split('&'),
      d = 0,
      e = c.length,
      f;
      for (; d < e; ++d) {
        f = c[d].split('='),
        f[0] && (b[f[0]] = f[1])
      }
      return b
    };
    var f = !1;
    c.load = function (a) {
      if ('document' in b && document.readyState === 'complete' || f) {
        return a()
      }
      c.on(b, 'load', a, !1)
    },
    c.on = function (a, b, c, d) {
      a.attachEvent ? a.attachEvent('on' + b, c)  : a.addEventListener && a.addEventListener(b, c, d)
    },
    c.request = function (a) {
      if (a && 'undefined' != typeof XDomainRequest) {
        return new XDomainRequest
      }
      if ('undefined' != typeof XMLHttpRequest && (!a || c.ua.hasCORS)) {
        return new XMLHttpRequest
      }
      if (!a) {
        try {
          return new (window[['Active'].concat('Object').join('X')]) ('Microsoft.XMLHTTP')
        } catch (b) {
        }
      }
      return null
    },
    'undefined' != typeof window && c.load(function () {
      f = !0
    }),
    c.defer = function (a) {
      if (!c.ua.webkit || 'undefined' != typeof importScripts) {
        return a()
      }
      c.load(function () {
        setTimeout(a, 100)
      })
    },
    c.merge = function (b, d, e, f) {
      var g = f || [
      ],
      h = typeof e == 'undefined' ? 2 : e,
      i;
      for (i in d) {
        d.hasOwnProperty(i) && c.indexOf(g, i) < 0 && (typeof b[i] != 'object' || !h ? (b[i] = d[i], g.push(d[i]))  : c.merge(b[i], d[i], h - 1, g))
      }
      return b
    },
    c.mixin = function (a, b) {
      c.merge(a.prototype, b.prototype)
    },
    c.inherit = function (a, b) {
      function c() {
      }
      c.prototype = b.prototype,
      a.prototype = new c
    },
    c.isArray = Array.isArray || function (a) {
      return Object.prototype.toString.call(a) === '[object Array]'
    },
    c.intersect = function (a, b) {
      var d = [
      ],
      e = a.length > b.length ? a : b,
      f = a.length > b.length ? b : a;
      for (var g = 0, h = f.length; g < h; g++) {
        ~c.indexOf(e, f[g]) && d.push(f[g])
      }
      return d
    },
    c.indexOf = function (a, b, c) {
      for (var d = a.length, c = c < 0 ? c + d < 0 ? 0 : c + d : c || 0; c < d && a[c] !== b; c++) {
      }
      return d <= c ? - 1 : c
    },
    c.toArray = function (a) {
      var b = [
      ];
      for (var c = 0, d = a.length; c < d; c++) {
        b.push(a[c])
      }
      return b
    },
    c.ua = {
    },
    c.ua.hasCORS = 'undefined' != typeof XMLHttpRequest && function () {
      try {
        var a = new XMLHttpRequest
      } catch (b) {
        return !1
      }
      return a.withCredentials != undefined
    }(),
    c.ua.webkit = 'undefined' != typeof navigator && /webkit/i.test(navigator.userAgent),
    c.ua.iDevice = 'undefined' != typeof navigator && /iPad|iPhone|iPod/i.test(navigator.userAgent)
  }('undefined' != typeof io ? io : module.exports, this),
  function (a, b) {
    function c() {
    }
    a.EventEmitter = c,
    c.prototype.on = function (a, c) {
      return this.$events || (this.$events = {
      }),
      this.$events[a] ? b.util.isArray(this.$events[a]) ? this.$events[a].push(c)  : this.$events[a] = [
        this.$events[a],
        c
      ] : this.$events[a] = c,
      this
    },
    c.prototype.addListener = c.prototype.on,
    c.prototype.once = function (a, b) {
      function d() {
        c.removeListener(a, d),
        b.apply(this, arguments)
      }
      var c = this;
      return d.listener = b,
      this.on(a, d),
      this
    },
    c.prototype.removeListener = function (a, c) {
      if (this.$events && this.$events[a]) {
        var d = this.$events[a];
        if (b.util.isArray(d)) {
          var e = - 1;
          for (var f = 0, g = d.length; f < g; f++) {
            if (d[f] === c || d[f].listener && d[f].listener === c) {
              e = f;
              break
            }
          }
          if (e < 0) {
            return this
          }
          d.splice(e, 1),
          d.length || delete this.$events[a]
        } else {
          (d === c || d.listener && d.listener === c) && delete this.$events[a]
        }
      }
      return this
    },
    c.prototype.removeAllListeners = function (a) {
      return this.$events && this.$events[a] && (this.$events[a] = null),
      this
    },
    c.prototype.listeners = function (a) {
      return this.$events || (this.$events = {
      }),
      this.$events[a] || (this.$events[a] = [
      ]),
      b.util.isArray(this.$events[a]) || (this.$events[a] = [
        this.$events[a]
      ]),
      this.$events[a]
    },
    c.prototype.emit = function (a) {
      if (!this.$events) {
        return !1
      }
      var c = this.$events[a];
      if (!c) {
        return !1
      }
      var d = Array.prototype.slice.call(arguments, 1);
      if ('function' == typeof c) {
        c.apply(this, d)
      } else {
        if (!b.util.isArray(c)) {
          return !1
        }
        var e = c.slice();
        for (var f = 0, g = e.length; f < g; f++) {
          e[f].apply(this, d)
        }
      }
      return !0
    }
  }('undefined' != typeof io ? io : module.exports, 'undefined' != typeof io ? io : module.parent.exports),
  function (exports, nativeJSON) {
    function f(a) {
      return a < 10 ? '0' + a : a
    }
    function date(a, b) {
      return isFinite(a.valueOf()) ? a.getUTCFullYear() + '-' + f(a.getUTCMonth() + 1) + '-' + f(a.getUTCDate()) + 'T' + f(a.getUTCHours()) + ':' + f(a.getUTCMinutes()) + ':' + f(a.getUTCSeconds()) + 'Z' : null
    }
    function quote(a) {
      return escapable.lastIndex = 0,
      escapable.test(a) ? '"' + a.replace(escapable, function (a) {
        var b = meta[a];
        return typeof b == 'string' ? b : '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice( - 4)
      }) + '"' : '"' + a + '"'
    }
    function str(a, b) {
      var c,
      d,
      e,
      f,
      g = gap,
      h,
      i = b[a];
      i instanceof Date && (i = date(a)),
      typeof rep == 'function' && (i = rep.call(b, a, i));
      switch (typeof i) {
        case 'string':
          return quote(i);
        case 'number':
          return isFinite(i) ? String(i)  : 'null';
        case 'boolean':
        case 'null':
          return String(i);
        case 'object':
          if (!i) {
            return 'null'
          }
          gap += indent,
          h = [
          ];
          if (Object.prototype.toString.apply(i) === '[object Array]') {
            f = i.length;
            for (c = 0; c < f; c += 1) {
              h[c] = str(c, i) || 'null'
            }
            return e = h.length === 0 ? '[]' : gap ? '[\n' + gap + h.join(',\n' + gap) + '\n' + g + ']' : '[' + h.join(',') + ']',
            gap = g,
            e
          }
          if (rep && typeof rep == 'object') {
            f = rep.length;
            for (c = 0; c < f; c += 1) {
              typeof rep[c] == 'string' && (d = rep[c], e = str(d, i), e && h.push(quote(d) + (gap ? ': ' : ':') + e))
            }
          } else {
            for (d in i) {
              Object.prototype.hasOwnProperty.call(i, d) && (e = str(d, i), e && h.push(quote(d) + (gap ? ': ' : ':') + e))
            }
          }
          return e = h.length === 0 ? '{}' : gap ? '{\n' + gap + h.join(',\n' + gap) + '\n' + g + '}' : '{' + h.join(',') + '}',
          gap = g,
          e
      }
    }
    'use strict';
    if (nativeJSON && nativeJSON.parse) {
      return exports.JSON = {
        parse: nativeJSON.parse,
        stringify: nativeJSON.stringify
      }
    }
    var JSON = exports.JSON = {
    },
    cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
    escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
    gap,
    indent,
    meta = {
      '': '\\b',
      '\t': '\\t',
      '\n': '\\n',
      '\f': '\\f',
      '\r': '\\r',
      '"': '\\"',
      '\\': '\\\\'
    },
    rep;
    JSON.stringify = function (a, b, c) {
      var d;
      gap = '',
      indent = '';
      if (typeof c == 'number') {
        for (d = 0; d < c; d += 1) {
          indent += ' '
        }
      } else {
        typeof c == 'string' && (indent = c)
      }
      rep = b;
      if (!b || typeof b == 'function' || typeof b == 'object' && typeof b.length == 'number') {
        return str('', {
          '': a
        })
      }
      throw new Error('JSON.stringify')
    },
    JSON.parse = function (text, reviver) {
      function walk(a, b) {
        var c,
        d,
        e = a[b];
        if (e && typeof e == 'object') {
          for (c in e) {
            Object.prototype.hasOwnProperty.call(e, c) && (d = walk(e, c), d !== undefined ? e[c] = d : delete e[c])
          }
        }
        return reviver.call(a, b, e)
      }
      var j;
      text = String(text),
      cx.lastIndex = 0,
      cx.test(text) && (text = text.replace(cx, function (a) {
        return '\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice( - 4)
      }));
      if (/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']').replace(/(?:^|:|,)(?:\s*\[)+/g, ''))) {
        return j = eval('(' + text + ')'),
        typeof reviver == 'function' ? walk({
          '': j
        }, '')  : j
      }
      throw new SyntaxError('JSON.parse')
    }
  }('undefined' != typeof io ? io : module.exports, typeof JSON != 'undefined' ? JSON : undefined),
  function (a, b) {
    var c = a.parser = {
    },
    d = c.packets = [
      'disconnect',
      'connect',
      'heartbeat',
      'message',
      'json',
      'event',
      'ack',
      'error',
      'noop'
    ],
    e = c.reasons = [
      'transport not supported',
      'client not handshaken',
      'unauthorized'
    ],
    f = c.advice = [
      'reconnect'
    ],
    g = b.JSON,
    h = b.util.indexOf;
    c.encodePacket = function (a) {
      var b = h(d, a.type),
      c = a.id || '',
      i = a.endpoint || '',
      j = a.ack,
      k = null;
      switch (a.type) {
        case 'error':
          var l = a.reason ? h(e, a.reason)  : '',
          m = a.advice ? h(f, a.advice)  : '';
          if (l !== '' || m !== '') {
            k = l + (m !== '' ? '+' + m : '')
          }
          break;
        case 'message':
          a.data !== '' && (k = a.data);
          break;
        case 'event':
          var n = {
            name: a.name
          };
          a.args && a.args.length && (n.args = a.args),
          k = g.stringify(n);
          break;
        case 'json':
          k = g.stringify(a.data);
          break;
        case 'connect':
          a.qs && (k = a.qs);
          break;
        case 'ack':
          k = a.ackId + (a.args && a.args.length ? '+' + g.stringify(a.args)  : '')
      }
      var o = [
        b,
        c + (j == 'data' ? '+' : ''),
        i
      ];
      return k !== null && k !== undefined && o.push(k),
      o.join(':')
    },
    c.encodePayload = function (a) {
      var b = '';
      if (a.length == 1) {
        return a[0]
      }
      for (var c = 0, d = a.length; c < d; c++) {
        var e = a[c];
        b += '�' + e.length + '�' + a[c]
      }
      return b
    };
    var i = /([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;
    c.decodePacket = function (a) {
      var b = a.match(i);
      if (!b) {
        return {
        }
      }
      var c = b[2] || '',
      a = b[5] || '',
      h = {
        type: d[b[1]],
        endpoint: b[4] || ''
      };
      c && (h.id = c, b[3] ? h.ack = 'data' : h.ack = !0);
      switch (h.type) {
        case 'error':
          var b = a.split('+');
          h.reason = e[b[0]] || '',
          h.advice = f[b[1]] || '';
          break;
        case 'message':
          h.data = a || '';
          break;
        case 'event':
          try {
            var j = g.parse(a);
            h.name = j.name,
            h.args = j.args
          } catch (k) {
          }
          h.args = h.args || [
          ];
          break;
        case 'json':
          try {
            h.data = g.parse(a)
          } catch (k) {
          }
          break;
        case 'connect':
          h.qs = a || '';
          break;
        case 'ack':
          var b = a.match(/^([0-9]+)(\+)?(.*)/);
          if (b) {
            h.ackId = b[1],
            h.args = [
            ];
            if (b[3]) {
              try {
                h.args = b[3] ? g.parse(b[3])  : [
                ]
              } catch (k) {
              }
            }
          }
          break;
        case 'disconnect':
        case 'heartbeat':
      }
      return h
    },
    c.decodePayload = function (a) {
      if (a.charAt(0) == '�') {
        var b = [
        ];
        for (var d = 1, e = ''; d < a.length; d++) {
          a.charAt(d) == '�' ? (b.push(c.decodePacket(a.substr(d + 1).substr(0, e))), d += Number(e) + 1, e = '')  : e += a.charAt(d)
        }
        return b
      }
      return [c.decodePacket(a)]
    }
  }('undefined' != typeof io ? io : module.exports, 'undefined' != typeof io ? io : module.parent.exports),
  function (a, b) {
    function c(a, b) {
      this.socket = a,
      this.sessid = b
    }
    a.Transport = c,
    b.util.mixin(c, b.EventEmitter),
    c.prototype.onData = function (a) {
      this.clearCloseTimeout(),
      (this.socket.connected || this.socket.connecting || this.socket.reconnecting) && this.setCloseTimeout();
      if (a !== '') {
        var c = b.parser.decodePayload(a);
        if (c && c.length) {
          for (var d = 0, e = c.length; d < e; d++) {
            this.onPacket(c[d])
          }
        }
      }
      return this
    },
    c.prototype.onPacket = function (a) {
      return this.socket.setHeartbeatTimeout(),
      a.type == 'heartbeat' ? this.onHeartbeat()  : (a.type == 'connect' && a.endpoint == '' && this.onConnect(), a.type == 'error' && a.advice == 'reconnect' && (this.isOpen = !1), this.socket.onPacket(a), this)
    },
    c.prototype.setCloseTimeout = function () {
      if (!this.closeTimeout) {
        var a = this;
        this.closeTimeout = setTimeout(function () {
          a.onDisconnect()
        }, this.socket.closeTimeout)
      }
    },
    c.prototype.onDisconnect = function () {
      return this.isOpen && this.close(),
      this.clearTimeouts(),
      this.socket.onDisconnect(),
      this
    },
    c.prototype.onConnect = function () {
      return this.socket.onConnect(),
      this
    },
    c.prototype.clearCloseTimeout = function () {
      this.closeTimeout && (clearTimeout(this.closeTimeout), this.closeTimeout = null)
    },
    c.prototype.clearTimeouts = function () {
      this.clearCloseTimeout(),
      this.reopenTimeout && clearTimeout(this.reopenTimeout)
    },
    c.prototype.packet = function (a) {
      this.send(b.parser.encodePacket(a))
    },
    c.prototype.onHeartbeat = function (a) {
      this.packet({
        type: 'heartbeat'
      })
    },
    c.prototype.onOpen = function () {
      this.isOpen = !0,
      this.clearCloseTimeout(),
      this.socket.onOpen()
    },
    c.prototype.onClose = function () {
      var a = this;
      this.isOpen = !1,
      this.socket.onClose(),
      this.onDisconnect()
    },
    c.prototype.prepareUrl = function () {
      var a = this.socket.options;
      return this.scheme() + '://' + a.host + ':' + a.port + '/' + a.resource + '/' + b.protocol + '/' + this.name + '/' + this.sessid
    },
    c.prototype.ready = function (a, b) {
      b.call(this)
    }
  }('undefined' != typeof io ? io : module.exports, 'undefined' != typeof io ? io : module.parent.exports),
  function (a, b, c) {
    function d(a) {
      this.options = {
        port: 80,
        secure: !1,
        document: 'document' in c ? document : !1,
        resource: 'socket.io',
        transports: b.transports,
        'connect timeout': 10000,
        'try multiple transports': !0,
        reconnect: !0,
        'reconnection delay': 500,
        'reconnection limit': Infinity,
        'reopen delay': 3000,
        'max reconnection attempts': 10,
        'sync disconnect on unload': !0,
        'auto connect': !0,
        'flash policy port': 10843,
        manualFlush: !1
      },
      b.util.merge(this.options, a),
      this.connected = !1,
      this.open = !1,
      this.connecting = !1,
      this.reconnecting = !1,
      this.namespaces = {
      },
      this.buffer = [
      ],
      this.doBuffer = !1;
      if (this.options['sync disconnect on unload'] && (!this.isXDomain() || b.util.ua.hasCORS)) {
        var d = this;
        b.util.on(c, 'unload', function () {
          d.disconnectSync()
        }, !1)
      }
      this.options['auto connect'] && this.connect()
    }
    function e() {
    }
    a.Socket = d,
    b.util.mixin(d, b.EventEmitter),
    d.prototype.of = function (a) {
      return this.namespaces[a] || (this.namespaces[a] = new b.SocketNamespace(this, a), a !== '' && this.namespaces[a].packet({
        type: 'connect'
      })),
      this.namespaces[a]
    },
    d.prototype.publish = function () {
      this.emit.apply(this, arguments);
      var a;
      for (var b in this.namespaces) {
        this.namespaces.hasOwnProperty(b) && (a = this.of(b), a.$emit.apply(a, arguments))
      }
    },
    d.prototype.handshake = function (a) {
      function f(b) {
        b instanceof Error ? (c.connecting = !1, c.onError(b.message))  : a.apply(null, b.split(':'))
      }
      var c = this,
      d = this.options,
      g = [
        'http' + (d.secure ? 's' : '') + ':/',
        d.host + ':' + d.port,
        d.resource,
        b.protocol,
        b.util.query(this.options.query, 't=' + + (new Date))
      ].join('/');
      if (this.isXDomain() && !b.util.ua.hasCORS) {
        var h = document.getElementsByTagName('script') [0],
        i = document.createElement('script');
        i.src = g + '&jsonp=' + b.j.length,
        h.parentNode.insertBefore(i, h),
        b.j.push(function (a) {
          f(a),
          i.parentNode.removeChild(i)
        })
      } else {
        var j = b.util.request();
        j.open('GET', g, !0),
        j.withCredentials = !0,
        j.onreadystatechange = function () {
          j.readyState == 4 && (j.onreadystatechange = e, j.status == 200 ? f(j.responseText)  : (c.connecting = !1, !c.reconnecting && c.onError(j.responseText)))
        },
        j.send(null)
      }
    },
    d.prototype.getTransport = function (a) {
      var c = a || this.transports,
      d;
      for (var e = 0, f; f = c[e]; e++) {
        if (b.Transport[f] && b.Transport[f].check(this) && (!this.isXDomain() || b.Transport[f].xdomainCheck(this))) {
          return new b.Transport[f](this, this.sessionid)
        }
      }
      return null
    },
    d.prototype.connect = function (a) {
      if (this.connecting) {
        return this
      }
      var c = this;
      return c.connecting = !0,
      this.handshake(function (d, e, f, g) {
        function h(a) {
          c.transport && c.transport.clearTimeouts(),
          c.transport = c.getTransport(a);
          if (!c.transport) {
            return c.publish('connect_failed')
          }
          c.transport.ready(c, function () {
            c.connecting = !0,
            c.publish('connecting', c.transport.name),
            c.transport.open(),
            c.options['connect timeout'] && (c.connectTimeoutTimer = setTimeout(function () {
              if (!c.connected) {
                c.connecting = !1;
                if (c.options['try multiple transports']) {
                  c.remainingTransports || (c.remainingTransports = c.transports.slice(0));
                  var a = c.remainingTransports;
                  while (a.length > 0 && a.splice(0, 1) [0] != c.transport.name) {
                  }
                  a.length ? h(a)  : c.publish('connect_failed')
                }
              }
            }, c.options['connect timeout']))
          })
        }
        c.sessionid = d,
        c.closeTimeout = f * 1000,
        c.heartbeatTimeout = e * 1000,
        c.transports = g ? b.util.intersect(g.split(','), c.options.transports)  : c.options.transports,
        c.setHeartbeatTimeout(),
        h(c.transports),
        c.once('connect', function () {
          clearTimeout(c.connectTimeoutTimer),
          a && typeof a == 'function' && a()
        })
      }),
      this
    },
    d.prototype.setHeartbeatTimeout = function () {
      clearTimeout(this.heartbeatTimeoutTimer);
      var a = this;
      this.heartbeatTimeoutTimer = setTimeout(function () {
        a.transport.onClose()
      }, this.heartbeatTimeout)
    },
    d.prototype.packet = function (a) {
      return this.connected && !this.doBuffer ? this.transport.packet(a)  : this.buffer.push(a),
      this
    },
    d.prototype.setBuffer = function (a) {
      this.doBuffer = a,
      !a && this.connected && this.buffer.length && (this.options.manualFlush || this.flushBuffer())
    },
    d.prototype.flushBuffer = function () {
      this.transport.payload(this.buffer),
      this.buffer = [
      ]
    },
    d.prototype.disconnect = function () {
      if (this.connected || this.connecting) {
        this.open && this.of('').packet({
          type: 'disconnect'
        }),
        this.onDisconnect('booted')
      }
      return this
    },
    d.prototype.disconnectSync = function () {
      var a = b.util.request(),
      c = [
        'http' + (this.options.secure ? 's' : '') + ':/',
        this.options.host + ':' + this.options.port,
        this.options.resource,
        b.protocol,
        this.sessionid
      ].join('/');
      a.open('GET', c, !0),
      a.send(null),
      this.onDisconnect('booted')
    },
    d.prototype.isXDomain = function () {
      var a = c.location.port || ('https:' == c.location.protocol ? 443 : 80);
      return this.options.host !== c.location.hostname || this.options.port != a
    },
    d.prototype.onConnect = function () {
      this.connected || (this.connected = !0, this.connecting = !1, this.doBuffer || this.setBuffer(!1), this.emit('connect'))
    },
    d.prototype.onOpen = function () {
      this.open = !0
    },
    d.prototype.onClose = function () {
      this.open = !1,
      clearTimeout(this.heartbeatTimeoutTimer)
    },
    d.prototype.onPacket = function (a) {
      this.of(a.endpoint).onPacket(a)
    },
    d.prototype.onError = function (a) {
      a && a.advice && a.advice === 'reconnect' && (this.connected || this.connecting) && (this.disconnect(), this.options.reconnect && this.reconnect()),
      this.publish('error', a && a.reason ? a.reason : a)
    },
    d.prototype.onDisconnect = function (a) {
      var b = this.connected,
      c = this.connecting;
      this.connected = !1,
      this.connecting = !1,
      this.open = !1;
      if (b || c) {
        this.transport.close(),
        this.transport.clearTimeouts(),
        b && (this.publish('disconnect', a), 'booted' != a && this.options.reconnect && !this.reconnecting && this.reconnect())
      }
    },
    d.prototype.reconnect = function () {
      function e() {
        if (a.connected) {
          for (var b in a.namespaces) {
            a.namespaces.hasOwnProperty(b) && '' !== b && a.namespaces[b].packet({
              type: 'connect'
            })
          }
          a.publish('reconnect', a.transport.name, a.reconnectionAttempts)
        }
        clearTimeout(a.reconnectionTimer),
        a.removeListener('connect_failed', f),
        a.removeListener('connect', f),
        a.reconnecting = !1,
        delete a.reconnectionAttempts,
        delete a.reconnectionDelay,
        delete a.reconnectionTimer,
        delete a.redoTransports,
        a.options['try multiple transports'] = c
      }
      function f() {
        if (!a.reconnecting) {
          return
        }
        if (a.connected) {
          return e()
        }
        if (a.connecting && a.reconnecting) {
          return a.reconnectionTimer = setTimeout(f, 1000)
        }
        a.reconnectionAttempts++ >= b ? a.redoTransports ? (a.publish('reconnect_failed'), e())  : (a.on('connect_failed', f), a.options['try multiple transports'] = !0, a.transport = a.getTransport(), a.redoTransports = !0, a.connect())  : (a.reconnectionDelay < d && (a.reconnectionDelay *= 2), a.connect(), a.publish('reconnecting', a.reconnectionDelay, a.reconnectionAttempts), a.reconnectionTimer = setTimeout(f, a.reconnectionDelay))
      }
      this.reconnecting = !0,
      this.reconnectionAttempts = 0,
      this.reconnectionDelay = this.options['reconnection delay'];
      var a = this,
      b = this.options['max reconnection attempts'],
      c = this.options['try multiple transports'],
      d = this.options['reconnection limit'];
      this.options['try multiple transports'] = !1,
      this.reconnectionTimer = setTimeout(f, this.reconnectionDelay),
      this.on('connect', f)
    }
  }('undefined' != typeof io ? io : module.exports, 'undefined' != typeof io ? io : module.parent.exports, this),
  function (a, b) {
    function c(a, b) {
      this.socket = a,
      this.name = b || '',
      this.flags = {
      },
      this.json = new d(this, 'json'),
      this.ackPackets = 0,
      this.acks = {
      }
    }
    function d(a, b) {
      this.namespace = a,
      this.name = b
    }
    a.SocketNamespace = c,
    b.util.mixin(c, b.EventEmitter),
    c.prototype.$emit = b.EventEmitter.prototype.emit,
    c.prototype.of = function () {
      return this.socket.of.apply(this.socket, arguments)
    },
    c.prototype.packet = function (a) {
      return a.endpoint = this.name,
      this.socket.packet(a),
      this.flags = {
      },
      this
    },
    c.prototype.send = function (a, b) {
      var c = {
        type: this.flags.json ? 'json' : 'message',
        data: a
      };
      return 'function' == typeof b && (c.id = ++this.ackPackets, c.ack = !0, this.acks[c.id] = b),
      this.packet(c)
    },
    c.prototype.emit = function (a) {
      var b = Array.prototype.slice.call(arguments, 1),
      c = b[b.length - 1],
      d = {
        type: 'event',
        name: a
      };
      return 'function' == typeof c && (d.id = ++this.ackPackets, d.ack = 'data', this.acks[d.id] = c, b = b.slice(0, b.length - 1)),
      d.args = b,
      this.packet(d)
    },
    c.prototype.disconnect = function () {
      return this.name === '' ? this.socket.disconnect()  : (this.packet({
        type: 'disconnect'
      }), this.$emit('disconnect')),
      this
    },
    c.prototype.onPacket = function (a) {
      function d() {
        c.packet({
          type: 'ack',
          args: b.util.toArray(arguments),
          ackId: a.id
        })
      }
      var c = this;
      switch (a.type) {
        case 'connect':
          this.$emit('connect');
          break;
        case 'disconnect':
          this.name === '' ? this.socket.onDisconnect(a.reason || 'booted')  : this.$emit('disconnect', a.reason);
          break;
        case 'message':
        case 'json':
          var e = [
            'message',
            a.data
          ];
          a.ack == 'data' ? e.push(d)  : a.ack && this.packet({
            type: 'ack',
            ackId: a.id
          }),
          this.$emit.apply(this, e);
          break;
        case 'event':
          var e = [
            a.name
          ].concat(a.args);
          a.ack == 'data' && e.push(d),
          this.$emit.apply(this, e);
          break;
        case 'ack':
          this.acks[a.ackId] && (this.acks[a.ackId].apply(this, a.args), delete this.acks[a.ackId]);
          break;
        case 'error':
          a.advice ? this.socket.onError(a)  : a.reason == 'unauthorized' ? this.$emit('connect_failed', a.reason)  : this.$emit('error', a.reason)
      }
    },
    d.prototype.send = function () {
      this.namespace.flags[this.name] = !0,
      this.namespace.send.apply(this.namespace, arguments)
    },
    d.prototype.emit = function () {
      this.namespace.flags[this.name] = !0,
      this.namespace.emit.apply(this.namespace, arguments)
    }
  }('undefined' != typeof io ? io : module.exports, 'undefined' != typeof io ? io : module.parent.exports),
  function (a, b, c) {
    function d(a) {
      b.Transport.apply(this, arguments)
    }
    a.websocket = d,
    b.util.inherit(d, b.Transport),
    d.prototype.name = 'websocket',
    d.prototype.open = function () {
      var a = b.util.query(this.socket.options.query),
      d = this,
      e;
      return e || (e = c.MozWebSocket || c.WebSocket),
      this.websocket = new e(this.prepareUrl() + a),
      this.websocket.onopen = function () {
        d.onOpen(),
        d.socket.setBuffer(!1)
      },
      this.websocket.onmessage = function (a) {
        d.onData(a.data)
      },
      this.websocket.onclose = function () {
        d.onClose(),
        d.socket.setBuffer(!0)
      },
      this.websocket.onerror = function (a) {
        d.onError(a)
      },
      this
    },
    b.util.ua.iDevice ? d.prototype.send = function (a) {
      var b = this;
      return setTimeout(function () {
        b.websocket.send(a)
      }, 0),
      this
    }
     : d.prototype.send = function (a) {
      return this.websocket.send(a),
      this
    },
    d.prototype.payload = function (a) {
      for (var b = 0, c = a.length; b < c; b++) {
        this.packet(a[b])
      }
      return this
    },
    d.prototype.close = function () {
      return this.websocket.close(),
      this
    },
    d.prototype.onError = function (a) {
      this.socket.onError(a)
    },
    d.prototype.scheme = function () {
      return this.socket.options.secure ? 'wss' : 'ws'
    },
    d.check = function () {
      return 'WebSocket' in c && !('__addTask' in WebSocket) || 'MozWebSocket' in c
    },
    d.xdomainCheck = function () {
      return !0
    },
    b.transports.push('websocket')
  }('undefined' != typeof io ? io.Transport : module.exports, 'undefined' != typeof io ? io : module.parent.exports, this),
  function (a, b) {
    function c() {
      b.Transport.websocket.apply(this, arguments)
    }
    a.flashsocket = c,
    b.util.inherit(c, b.Transport.websocket),
    c.prototype.name = 'flashsocket',
    c.prototype.open = function () {
      var a = this,
      c = arguments;
      return WebSocket.__addTask(function () {
        b.Transport.websocket.prototype.open.apply(a, c)
      }),
      this
    },
    c.prototype.send = function () {
      var a = this,
      c = arguments;
      return WebSocket.__addTask(function () {
        b.Transport.websocket.prototype.send.apply(a, c)
      }),
      this
    },
    c.prototype.close = function () {
      return WebSocket.__tasks.length = 0,
      b.Transport.websocket.prototype.close.call(this),
      this
    },
    c.prototype.ready = function (a, d) {
      function e() {
        var b = a.options,
        e = b['flash policy port'],
        g = [
          'http' + (b.secure ? 's' : '') + ':/',
          b.host + ':' + b.port,
          b.resource,
          'static/flashsocket',
          'WebSocketMain' + (a.isXDomain() ? 'Insecure' : '') + '.swf'
        ];
        c.loaded || (typeof WEB_SOCKET_SWF_LOCATION == 'undefined' && (WEB_SOCKET_SWF_LOCATION = g.join('/')), e !== 843 && WebSocket.loadFlashPolicyFile('xmlsocket://' + b.host + ':' + e), WebSocket.__initialize(), c.loaded = !0),
        d.call(f)
      }
      var f = this;
      if (document.body) {
        return e()
      }
      b.util.load(e)
    },
    c.check = function () {
      return typeof WebSocket != 'undefined' && '__initialize' in WebSocket && !!swfobject ? swfobject.getFlashPlayerVersion().major >= 10 : !1
    },
    c.xdomainCheck = function () {
      return !0
    },
    typeof window != 'undefined' && (WEB_SOCKET_DISABLE_AUTO_INITIALIZATION = !0),
    b.transports.push('flashsocket')
  }('undefined' != typeof io ? io.Transport : module.exports, 'undefined' != typeof io ? io : module.parent.exports);
  if ('undefined' != typeof window) {
    var swfobject = function () {
      function A() {
        if (t) {
          return
        }
        try {
          var a = i.getElementsByTagName('body') [0].appendChild(Q('span'));
          a.parentNode.removeChild(a)
        } catch (b) {
          return
        }
        t = !0;
        var c = l.length;
        for (var d = 0; d < c; d++) {
          l[d]()
        }
      }
      function B(a) {
        t ? a()  : l[l.length] = a
      }
      function C(b) {
        if (typeof h.addEventListener != a) {
          h.addEventListener('load', b, !1)
        } else {
          if (typeof i.addEventListener != a) {
            i.addEventListener('load', b, !1)
          } else {
            if (typeof h.attachEvent != a) {
              R(h, 'onload', b)
            } else {
              if (typeof h.onload == 'function') {
                var c = h.onload;
                h.onload = function () {
                  c(),
                  b()
                }
              } else {
                h.onload = b
              }
            }
          }
        }
      }
      function D() {
        k ? E()  : F()
      }
      function E() {
        var c = i.getElementsByTagName('body') [0],
        d = Q(b);
        d.setAttribute('type', e);
        var f = c.appendChild(d);
        if (f) {
          var g = 0;
          (function () {
            if (typeof f.GetVariable != a) {
              var b = f.GetVariable('$version');
              b && (b = b.split(' ') [1].split(','), y.pv = [
                parseInt(b[0], 10),
                parseInt(b[1], 10),
                parseInt(b[2], 10)
              ])
            } else {
              if (g < 10) {
                g++,
                setTimeout(arguments.callee, 10);
                return
              }
            }
            c.removeChild(d),
            f = null,
            F()
          }) ()
        } else {
          F()
        }
      }
      function F() {
        var b = m.length;
        if (b > 0) {
          for (var c = 0; c < b; c++) {
            var d = m[c].id,
            e = m[c].callbackFn,
            f = {
              success: !1,
              id: d
            };
            if (y.pv[0] > 0) {
              var g = P(d);
              if (g) {
                if (S(m[c].swfVersion) && !(y.wk && y.wk < 312)) {
                  U(d, !0),
                  e && (f.success = !0, f.ref = G(d), e(f))
                } else {
                  if (m[c].expressInstall && H()) {
                    var h = {
                    };
                    h.data = m[c].expressInstall,
                    h.width = g.getAttribute('width') || '0',
                    h.height = g.getAttribute('height') || '0',
                    g.getAttribute('class') && (h.styleclass = g.getAttribute('class')),
                    g.getAttribute('align') && (h.align = g.getAttribute('align'));
                    var i = {
                    },
                    j = g.getElementsByTagName('param'),
                    k = j.length;
                    for (var l = 0; l < k; l++) {
                      j[l].getAttribute('name').toLowerCase() != 'movie' && (i[j[l].getAttribute('name')] = j[l].getAttribute('value'))
                    }
                    I(h, i, d, e)
                  } else {
                    J(g),
                    e && e(f)
                  }
                }
              }
            } else {
              U(d, !0);
              if (e) {
                var n = G(d);
                n && typeof n.SetVariable != a && (f.success = !0, f.ref = n),
                e(f)
              }
            }
          }
        }
      }
      function G(c) {
        var d = null,
        e = P(c);
        if (e && e.nodeName == 'OBJECT') {
          if (typeof e.SetVariable != a) {
            d = e
          } else {
            var f = e.getElementsByTagName(b) [0];
            f && (d = f)
          }
        }
        return d
      }
      function H() {
        return !u && S('6.0.65') && (y.win || y.mac) && !(y.wk && y.wk < 312)
      }
      function I(b, c, d, e) {
        u = !0,
        r = e || null,
        s = {
          success: !1,
          id: d
        };
        var g = P(d);
        if (g) {
          g.nodeName == 'OBJECT' ? (p = K(g), q = null)  : (p = g, q = d),
          b.id = f;
          if (typeof b.width == a || !/%$/.test(b.width) && parseInt(b.width, 10) < 310) {
            b.width = '310'
          }
          if (typeof b.height == a || !/%$/.test(b.height) && parseInt(b.height, 10) < 137) {
            b.height = '137'
          }
          i.title = i.title.slice(0, 47) + ' - Flash Player Installation';
          var j = y.ie && y.win ? [
            'Active'
          ].concat('').join('X')  : 'PlugIn',
          k = 'MMredirectURL=' + h.location.toString().replace(/&/g, '%26') + '&MMplayerType=' + j + '&MMdoctitle=' + i.title;
          typeof c.flashvars != a ? c.flashvars += '&' + k : c.flashvars = k;
          if (y.ie && y.win && g.readyState != 4) {
            var l = Q('div');
            d += 'SWFObjectNew',
            l.setAttribute('id', d),
            g.parentNode.insertBefore(l, g),
            g.style.display = 'none',
            function () {
              g.readyState == 4 ? g.parentNode.removeChild(g)  : setTimeout(arguments.callee, 10)
            }()
          }
          L(b, c, d)
        }
      }
      function J(a) {
        if (y.ie && y.win && a.readyState != 4) {
          var b = Q('div');
          a.parentNode.insertBefore(b, a),
          b.parentNode.replaceChild(K(a), b),
          a.style.display = 'none',
          function () {
            a.readyState == 4 ? a.parentNode.removeChild(a)  : setTimeout(arguments.callee, 10)
          }()
        } else {
          a.parentNode.replaceChild(K(a), a)
        }
      }
      function K(a) {
        var c = Q('div');
        if (y.win && y.ie) {
          c.innerHTML = a.innerHTML
        } else {
          var d = a.getElementsByTagName(b) [0];
          if (d) {
            var e = d.childNodes;
            if (e) {
              var f = e.length;
              for (var g = 0; g < f; g++) {
                (e[g].nodeType != 1 || e[g].nodeName != 'PARAM') && e[g].nodeType != 8 && c.appendChild(e[g].cloneNode(!0))
              }
            }
          }
        }
        return c
      }
      function L(c, d, f) {
        var g,
        h = P(f);
        if (y.wk && y.wk < 312) {
          return g
        }
        if (h) {
          typeof c.id == a && (c.id = f);
          if (y.ie && y.win) {
            var i = '';
            for (var j in c) {
              c[j] != Object.prototype[j] && (j.toLowerCase() == 'data' ? d.movie = c[j] : j.toLowerCase() == 'styleclass' ? i += ' class="' + c[j] + '"' : j.toLowerCase() != 'classid' && (i += ' ' + j + '="' + c[j] + '"'))
            }
            var k = '';
            for (var l in d) {
              d[l] != Object.prototype[l] && (k += '<param name="' + l + '" value="' + d[l] + '" />')
            }
            h.outerHTML = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"' + i + '>' + k + '</object>',
            n[n.length] = c.id,
            g = P(c.id)
          } else {
            var m = Q(b);
            m.setAttribute('type', e);
            for (var o in c) {
              c[o] != Object.prototype[o] && (o.toLowerCase() == 'styleclass' ? m.setAttribute('class', c[o])  : o.toLowerCase() != 'classid' && m.setAttribute(o, c[o]))
            }
            for (var p in d) {
              d[p] != Object.prototype[p] && p.toLowerCase() != 'movie' && M(m, p, d[p])
            }
            h.parentNode.replaceChild(m, h),
            g = m
          }
        }
        return g
      }
      function M(a, b, c) {
        var d = Q('param');
        d.setAttribute('name', b),
        d.setAttribute('value', c),
        a.appendChild(d)
      }
      function N(a) {
        var b = P(a);
        b && b.nodeName == 'OBJECT' && (y.ie && y.win ? (b.style.display = 'none', function () {
          b.readyState == 4 ? O(a)  : setTimeout(arguments.callee, 10)
        }())  : b.parentNode.removeChild(b))
      }
      function O(a) {
        var b = P(a);
        if (b) {
          for (var c in b) {
            typeof b[c] == 'function' && (b[c] = null)
          }
          b.parentNode.removeChild(b)
        }
      }
      function P(a) {
        var b = null;
        try {
          b = i.getElementById(a)
        } catch (c) {
        }
        return b
      }
      function Q(a) {
        return i.createElement(a)
      }
      function R(a, b, c) {
        a.attachEvent(b, c),
        o[o.length] = [
          a,
          b,
          c
        ]
      }
      function S(a) {
        var b = y.pv,
        c = a.split('.');
        return c[0] = parseInt(c[0], 10),
        c[1] = parseInt(c[1], 10) || 0,
        c[2] = parseInt(c[2], 10) || 0,
        b[0] > c[0] || b[0] == c[0] && b[1] > c[1] || b[0] == c[0] && b[1] == c[1] && b[2] >= c[2] ? !0 : !1
      }
      function T(c, d, e, f) {
        if (y.ie && y.mac) {
          return
        }
        var g = i.getElementsByTagName('head') [0];
        if (!g) {
          return
        }
        var h = e && typeof e == 'string' ? e : 'screen';
        f && (v = null, w = null);
        if (!v || w != h) {
          var j = Q('style');
          j.setAttribute('type', 'text/css'),
          j.setAttribute('media', h),
          v = g.appendChild(j),
          y.ie && y.win && typeof i.styleSheets != a && i.styleSheets.length > 0 && (v = i.styleSheets[i.styleSheets.length - 1]),
          w = h
        }
        y.ie && y.win ? v && typeof v.addRule == b && v.addRule(c, d)  : v && typeof i.createTextNode != a && v.appendChild(i.createTextNode(c + ' {' + d + '}'))
      }
      function U(a, b) {
        if (!x) {
          return
        }
        var c = b ? 'visible' : 'hidden';
        t && P(a) ? P(a).style.visibility = c : T('#' + a, 'visibility:' + c)
      }
      function V(b) {
        var c = /[\\\"<>\.;]/,
        d = c.exec(b) != null;
        return d && typeof encodeURIComponent != a ? encodeURIComponent(b)  : b
      }
      var a = 'undefined',
      b = 'object',
      c = 'Shockwave Flash',
      d = 'ShockwaveFlash.ShockwaveFlash',
      e = 'application/x-shockwave-flash',
      f = 'SWFObjectExprInst',
      g = 'onreadystatechange',
      h = window,
      i = document,
      j = navigator,
      k = !1,
      l = [
        D
      ],
      m = [
      ],
      n = [
      ],
      o = [
      ],
      p,
      q,
      r,
      s,
      t = !1,
      u = !1,
      v,
      w,
      x = !0,
      y = function () {
        var f = typeof i.getElementById != a && typeof i.getElementsByTagName != a && typeof i.createElement != a,
        g = j.userAgent.toLowerCase(),
        l = j.platform.toLowerCase(),
        m = l ? /win/.test(l)  : /win/.test(g),
        n = l ? /mac/.test(l)  : /mac/.test(g),
        o = /webkit/.test(g) ? parseFloat(g.replace(/^.*webkit\/(\d+(\.\d+)?).*$/, '$1'))  : !1,
        p = !1,
        q = [
          0,
          0,
          0
        ],
        r = null;
        if (typeof j.plugins != a && typeof j.plugins[c] == b) {
          r = j.plugins[c].description,
          r && (typeof j.mimeTypes == a || !j.mimeTypes[e] || !!j.mimeTypes[e].enabledPlugin) && (k = !0, p = !1, r = r.replace(/^.*\s+(\S+\s+\S+$)/, '$1'), q[0] = parseInt(r.replace(/^(.*)\..*$/, '$1'), 10), q[1] = parseInt(r.replace(/^.*\.(.*)\s.*$/, '$1'), 10), q[2] = /[a-zA-Z]/.test(r) ? parseInt(r.replace(/^.*[a-zA-Z]+(.*)$/, '$1'), 10)  : 0)
        } else {
          if (typeof h[['Active'].concat('Object').join('X')] != a) {
            try {
              var s = new (window[['Active'].concat('Object').join('X')]) (d);
              s && (r = s.GetVariable('$version'), r && (p = !0, r = r.split(' ') [1].split(','), q = [
                parseInt(r[0], 10),
                parseInt(r[1], 10),
                parseInt(r[2], 10)
              ]))
            } catch (t) {
            }
          }
        }
        return {
          w3: f,
          pv: q,
          wk: o,
          ie: p,
          win: m,
          mac: n
        }
      }(),
      z = function () {
        if (!y.w3) {
          return
        }(typeof i.readyState != a && i.readyState == 'complete' || typeof i.readyState == a && (i.getElementsByTagName('body') [0] || i.body)) && A(),
        t || (typeof i.addEventListener != a && i.addEventListener('DOMContentLoaded', A, !1), y.ie && y.win && (i.attachEvent(g, function () {
          i.readyState == 'complete' && (i.detachEvent(g, arguments.callee), A())
        }), h == top && function () {
          if (t) {
            return
          }
          try {
            i.documentElement.doScroll('left')
          } catch (a) {
            setTimeout(arguments.callee, 0);
            return
          }
          A()
        }()), y.wk && function () {
          if (t) {
            return
          }
          if (!/loaded|complete/.test(i.readyState)) {
            setTimeout(arguments.callee, 0);
            return
          }
          A()
        }(), C(A))
      }(),
      W = function () {
        y.ie && y.win && window.attachEvent('onunload', function () {
          var a = o.length;
          for (var b = 0; b < a; b++) {
            o[b][0].detachEvent(o[b][1], o[b][2])
          }
          var c = n.length;
          for (var d = 0; d < c; d++) {
            N(n[d])
          }
          for (var e in y) {
            y[e] = null
          }
          y = null;
          for (var f in swfobject) {
            swfobject[f] = null
          }
          swfobject = null
        })
      }();
      return {
        registerObject: function (a, b, c, d) {
          if (y.w3 && a && b) {
            var e = {
            };
            e.id = a,
            e.swfVersion = b,
            e.expressInstall = c,
            e.callbackFn = d,
            m[m.length] = e,
            U(a, !1)
          } else {
            d && d({
              success: !1,
              id: a
            })
          }
        },
        getObjectById: function (a) {
          if (y.w3) {
            return G(a)
          }
        },
        embedSWF: function (c, d, e, f, g, h, i, j, k, l) {
          var m = {
            success: !1,
            id: d
          };
          y.w3 && !(y.wk && y.wk < 312) && c && d && e && f && g ? (U(d, !1), B(function () {
            e += '',
            f += '';
            var n = {
            };
            if (k && typeof k === b) {
              for (var o in k) {
                n[o] = k[o]
              }
            }
            n.data = c,
            n.width = e,
            n.height = f;
            var p = {
            };
            if (j && typeof j === b) {
              for (var q in j) {
                p[q] = j[q]
              }
            }
            if (i && typeof i === b) {
              for (var r in i) {
                typeof p.flashvars != a ? p.flashvars += '&' + r + '=' + i[r] : p.flashvars = r + '=' + i[r]
              }
            }
            if (S(g)) {
              var s = L(n, p, d);
              n.id == d && U(d, !0),
              m.success = !0,
              m.ref = s
            } else {
              if (h && H()) {
                n.data = h,
                I(n, p, d, l);
                return
              }
              U(d, !0)
            }
            l && l(m)
          }))  : l && l(m)
        },
        switchOffAutoHideShow: function () {
          x = !1
        },
        ua: y,
        getFlashPlayerVersion: function () {
          return {
            major: y.pv[0],
            minor: y.pv[1],
            release: y.pv[2]
          }
        },
        hasFlashPlayerVersion: S,
        createSWF: function (a, b, c) {
          return y.w3 ? L(a, b, c)  : undefined
        },
        showExpressInstall: function (a, b, c, d) {
          y.w3 && H() && I(a, b, c, d)
        },
        removeSWF: function (a) {
          y.w3 && N(a)
        },
        createCSS: function (a, b, c, d) {
          y.w3 && T(a, b, c, d)
        },
        addDomLoadEvent: B,
        addLoadEvent: C,
        getQueryParamValue: function (a) {
          var b = i.location.search || i.location.hash;
          if (b) {
            /\?/.test(b) && (b = b.split('?') [1]);
            if (a == null) {
              return V(b)
            }
            var c = b.split('&');
            for (var d = 0; d < c.length; d++) {
              if (c[d].substring(0, c[d].indexOf('=')) == a) {
                return V(c[d].substring(c[d].indexOf('=') + 1))
              }
            }
          }
          return ''
        },
        expressInstallCallback: function () {
          if (u) {
            var a = P(f);
            a && p && (a.parentNode.replaceChild(p, a), q && (U(q, !0), y.ie && y.win && (p.style.display = 'block')), r && r(s)),
            u = !1
          }
        }
      }
    }()
  }(function () {
    if ('undefined' == typeof window || window.WebSocket) {
      return
    }
    var a = window.console;
    if (!a || !a.log || !a.error) {
      a = {
        log: function () {
        },
        error: function () {
        }
      }
    }
    if (!swfobject.hasFlashPlayerVersion('10.0.0')) {
      a.error('Flash Player >= 10.0.0 is required.');
      return
    }
    location.protocol == 'file:' && a.error('WARNING: web-socket-js doesn\'t work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://...'),
    WebSocket = function (a, b, c, d, e) {
      var f = this;
      f.__id = WebSocket.__nextId++,
      WebSocket.__instances[f.__id] = f,
      f.readyState = WebSocket.CONNECTING,
      f.bufferedAmount = 0,
      f.__events = {
      },
      b ? typeof b == 'string' && (b = [
        b
      ])  : b = [
      ],
      setTimeout(function () {
        WebSocket.__addTask(function () {
          WebSocket.__flash.create(f.__id, a, b, c || null, d || 0, e || null)
        })
      }, 0)
    },
    WebSocket.prototype.send = function (a) {
      if (this.readyState == WebSocket.CONNECTING) {
        throw 'INVALID_STATE_ERR: Web Socket connection has not been established'
      }
      var b = WebSocket.__flash.send(this.__id, encodeURIComponent(a));
      return b < 0 ? !0 : (this.bufferedAmount += b, !1)
    },
    WebSocket.prototype.close = function () {
      if (this.readyState == WebSocket.CLOSED || this.readyState == WebSocket.CLOSING) {
        return
      }
      this.readyState = WebSocket.CLOSING,
      WebSocket.__flash.close(this.__id)
    },
    WebSocket.prototype.addEventListener = function (a, b, c) {
      a in this.__events || (this.__events[a] = [
      ]),
      this.__events[a].push(b)
    },
    WebSocket.prototype.removeEventListener = function (a, b, c) {
      if (!(a in this.__events)) {
        return
      }
      var d = this.__events[a];
      for (var e = d.length - 1; e >= 0; --e) {
        if (d[e] === b) {
          d.splice(e, 1);
          break
        }
      }
    },
    WebSocket.prototype.dispatchEvent = function (a) {
      var b = this.__events[a.type] || [
      ];
      for (var c = 0; c < b.length; ++c) {
        b[c](a)
      }
      var d = this['on' + a.type];
      d && d(a)
    },
    WebSocket.prototype.__handleEvent = function (a) {
      'readyState' in a && (this.readyState = a.readyState),
      'protocol' in a && (this.protocol = a.protocol);
      var b;
      if (a.type == 'open' || a.type == 'error') {
        b = this.__createSimpleEvent(a.type)
      } else {
        if (a.type == 'close') {
          b = this.__createSimpleEvent('close')
        } else {
          if (a.type != 'message') {
            throw 'unknown event type: ' + a.type
          }
          var c = decodeURIComponent(a.message);
          b = this.__createMessageEvent('message', c)
        }
      }
      this.dispatchEvent(b)
    },
    WebSocket.prototype.__createSimpleEvent = function (a) {
      if (document.createEvent && window.Event) {
        var b = document.createEvent('Event');
        return b.initEvent(a, !1, !1),
        b
      }
      return {
        type: a,
        bubbles: !1,
        cancelable: !1
      }
    },
    WebSocket.prototype.__createMessageEvent = function (a, b) {
      if (document.createEvent && window.MessageEvent && !window.opera) {
        var c = document.createEvent('MessageEvent');
        return c.initMessageEvent('message', !1, !1, b, null, null, window, null),
        c
      }
      return {
        type: a,
        data: b,
        bubbles: !1,
        cancelable: !1
      }
    },
    WebSocket.CONNECTING = 0,
    WebSocket.OPEN = 1,
    WebSocket.CLOSING = 2,
    WebSocket.CLOSED = 3,
    WebSocket.__flash = null,
    WebSocket.__instances = {
    },
    WebSocket.__tasks = [
    ],
    WebSocket.__nextId = 0,
    WebSocket.loadFlashPolicyFile = function (a) {
      WebSocket.__addTask(function () {
        WebSocket.__flash.loadManualPolicyFile(a)
      })
    },
    WebSocket.__initialize = function () {
      if (WebSocket.__flash) {
        return
      }
      WebSocket.__swfLocation && (window.WEB_SOCKET_SWF_LOCATION = WebSocket.__swfLocation);
      if (!window.WEB_SOCKET_SWF_LOCATION) {
        a.error('[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf');
        return
      }
      var b = document.createElement('div');
      b.id = 'webSocketContainer',
      b.style.position = 'absolute',
      WebSocket.__isFlashLite() ? (b.style.left = '0px', b.style.top = '0px')  : (b.style.left = '-100px', b.style.top = '-100px');
      var c = document.createElement('div');
      c.id = 'webSocketFlash',
      b.appendChild(c),
      document.body.appendChild(b),
      swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION, 'webSocketFlash', '1', '1', '10.0.0', null, null, {
        hasPriority: !0,
        swliveconnect: !0,
        allowScriptAccess: 'always'
      }, null, function (b) {
        b.success || a.error('[WebSocket] swfobject.embedSWF failed')
      })
    },
    WebSocket.__onFlashInitialized = function () {
      setTimeout(function () {
        WebSocket.__flash = document.getElementById('webSocketFlash'),
        WebSocket.__flash.setCallerUrl(location.href),
        WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);
        for (var a = 0; a < WebSocket.__tasks.length; ++a) {
          WebSocket.__tasks[a]()
        }
        WebSocket.__tasks = [
        ]
      }, 0)
    },
    WebSocket.__onFlashEvent = function () {
      return setTimeout(function () {
        try {
          var b = WebSocket.__flash.receiveEvents();
          for (var c = 0; c < b.length; ++c) {
            WebSocket.__instances[b[c].webSocketId].__handleEvent(b[c])
          }
        } catch (d) {
          a.error(d)
        }
      }, 0),
      !0
    },
    WebSocket.__log = function (b) {
      a.log(decodeURIComponent(b))
    },
    WebSocket.__error = function (b) {
      a.error(decodeURIComponent(b))
    },
    WebSocket.__addTask = function (a) {
      WebSocket.__flash ? a()  : WebSocket.__tasks.push(a)
    },
    WebSocket.__isFlashLite = function () {
      if (!window.navigator || !window.navigator.mimeTypes) {
        return !1
      }
      var a = window.navigator.mimeTypes['application/x-shockwave-flash'];
      return !a || !a.enabledPlugin || !a.enabledPlugin.filename ? !1 : a.enabledPlugin.filename.match(/flashlite/i) ? !0 : !1
    },
    window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION || (window.addEventListener ? window.addEventListener('load', function () {
      WebSocket.__initialize()
    }, !1)  : window.attachEvent('onload', function () {
      WebSocket.__initialize()
    }))
  }) (),
  function (a, b, c) {
    function d(a) {
      if (!a) {
        return
      }
      b.Transport.apply(this, arguments),
      this.sendBuffer = [
      ]
    }
    function e() {
    }
    a.XHR = d,
    b.util.inherit(d, b.Transport),
    d.prototype.open = function () {
      return this.socket.setBuffer(!1),
      this.onOpen(),
      this.get(),
      this.setCloseTimeout(),
      this
    },
    d.prototype.payload = function (a) {
      var c = [
      ];
      for (var d = 0, e = a.length; d < e; d++) {
        c.push(b.parser.encodePacket(a[d]))
      }
      this.send(b.parser.encodePayload(c))
    },
    d.prototype.send = function (a) {
      return this.post(a),
      this
    },
    d.prototype.post = function (a) {
      function d() {
        this.readyState == 4 && (this.onreadystatechange = e, b.posting = !1, this.status == 200 ? b.socket.setBuffer(!1)  : b.onClose())
      }
      function f() {
        this.onload = e,
        b.socket.setBuffer(!1)
      }
      var b = this;
      this.socket.setBuffer(!0),
      this.sendXHR = this.request('POST'),
      c.XDomainRequest && this.sendXHR instanceof XDomainRequest ? this.sendXHR.onload = this.sendXHR.onerror = f : this.sendXHR.onreadystatechange = d,
      this.sendXHR.send(a)
    },
    d.prototype.close = function () {
      return this.onClose(),
      this
    },
    d.prototype.request = function (a) {
      var c = b.util.request(this.socket.isXDomain()),
      d = b.util.query(this.socket.options.query, 't=' + + (new Date));
      c.open(a || 'GET', this.prepareUrl() + d, !0);
      if (a == 'POST') {
        try {
          c.setRequestHeader ? c.setRequestHeader('Content-type', 'text/plain;charset=UTF-8')  : c.contentType = 'text/plain'
        } catch (e) {
        }
      }
      return c
    },
    d.prototype.scheme = function () {
      return this.socket.options.secure ? 'https' : 'http'
    },
    d.check = function (a, d) {
      try {
        var e = b.util.request(d),
        f = c.XDomainRequest && e instanceof XDomainRequest,
        g = a && a.options && a.options.secure ? 'https:' : 'http:',
        h = g != c.location.protocol;
        if (e && (!f || !h)) {
          return !0
        }
      } catch (i) {
      }
      return !1
    },
    d.xdomainCheck = function (a) {
      return d.check(a, !0)
    }
  }('undefined' != typeof io ? io.Transport : module.exports, 'undefined' != typeof io ? io : module.parent.exports, this),
  function (a, b) {
    function c(a) {
      b.Transport.XHR.apply(this, arguments)
    }
    a.htmlfile = c,
    b.util.inherit(c, b.Transport.XHR),
    c.prototype.name = 'htmlfile',
    c.prototype.get = function () {
      this.doc = new (window[['Active'].concat('Object').join('X')]) ('htmlfile'),
      this.doc.open(),
      this.doc.write('<html></html>'),
      this.doc.close(),
      this.doc.parentWindow.s = this;
      var a = this.doc.createElement('div');
      a.className = 'socketio',
      this.doc.body.appendChild(a),
      this.iframe = this.doc.createElement('iframe'),
      a.appendChild(this.iframe);
      var c = this,
      d = b.util.query(this.socket.options.query, 't=' + + (new Date));
      this.iframe.src = this.prepareUrl() + d,
      b.util.on(window, 'unload', function () {
        c.destroy()
      })
    },
    c.prototype._ = function (a, b) {
      this.onData(a);
      try {
        var c = b.getElementsByTagName('script') [0];
        c.parentNode.removeChild(c)
      } catch (d) {
      }
    },
    c.prototype.destroy = function () {
      if (this.iframe) {
        try {
          this.iframe.src = 'about:blank'
        } catch (a) {
        }
        this.doc = null,
        this.iframe.parentNode.removeChild(this.iframe),
        this.iframe = null,
        CollectGarbage()
      }
    },
    c.prototype.close = function () {
      return this.destroy(),
      b.Transport.XHR.prototype.close.call(this)
    },
    c.check = function (a) {
      if (typeof window != 'undefined' && [
        'Active'
      ].concat('Object').join('X') in window) {
        try {
          var c = new (window[['Active'].concat('Object').join('X')]) ('htmlfile');
          return c && b.Transport.XHR.check(a)
        } catch (d) {
        }
      }
      return !1
    },
    c.xdomainCheck = function () {
      return !1
    },
    b.transports.push('htmlfile')
  }('undefined' != typeof io ? io.Transport : module.exports, 'undefined' != typeof io ? io : module.parent.exports),
  function (a, b, c) {
    function d() {
      b.Transport.XHR.apply(this, arguments)
    }
    function e() {
    }
    a['xhr-polling'] = d,
    b.util.inherit(d, b.Transport.XHR),
    b.util.merge(d, b.Transport.XHR),
    d.prototype.name = 'xhr-polling',
    d.prototype.open = function () {
      var a = this;
      return b.Transport.XHR.prototype.open.call(a),
      !1
    },
    d.prototype.get = function () {
      function b() {
        this.readyState == 4 && (this.onreadystatechange = e, this.status == 200 ? (a.onData(this.responseText), a.get())  : a.onClose())
      }
      function d() {
        this.onload = e,
        this.onerror = e,
        a.onData(this.responseText),
        a.get()
      }
      function f() {
        a.onClose()
      }
      if (!this.isOpen) {
        return
      }
      var a = this;
      this.xhr = this.request(),
      c.XDomainRequest && this.xhr instanceof XDomainRequest ? (this.xhr.onload = d, this.xhr.onerror = f)  : this.xhr.onreadystatechange = b,
      this.xhr.send(null)
    },
    d.prototype.onClose = function () {
      b.Transport.XHR.prototype.onClose.call(this);
      if (this.xhr) {
        this.xhr.onreadystatechange = this.xhr.onload = this.xhr.onerror = e;
        try {
          this.xhr.abort()
        } catch (a) {
        }
        this.xhr = null
      }
    },
    d.prototype.ready = function (a, c) {
      var d = this;
      b.util.defer(function () {
        c.call(d)
      })
    },
    b.transports.push('xhr-polling')
  }('undefined' != typeof io ? io.Transport : module.exports, 'undefined' != typeof io ? io : module.parent.exports, this),
  function (a, b, c) {
    function e(a) {
      b.Transport['xhr-polling'].apply(this, arguments),
      this.index = b.j.length;
      var c = this;
      b.j.push(function (a) {
        c._(a)
      })
    }
    var d = c.document && 'MozAppearance' in c.document.documentElement.style;
    a['jsonp-polling'] = e,
    b.util.inherit(e, b.Transport['xhr-polling']),
    e.prototype.name = 'jsonp-polling',
    e.prototype.post = function (a) {
      function i() {
        j(),
        c.socket.setBuffer(!1)
      }
      function j() {
        c.iframe && c.form.removeChild(c.iframe);
        try {
          h = document.createElement('<iframe name="' + c.iframeId + '">')
        } catch (a) {
          h = document.createElement('iframe'),
          h.name = c.iframeId
        }
        h.id = c.iframeId,
        c.form.appendChild(h),
        c.iframe = h
      }
      var c = this,
      d = b.util.query(this.socket.options.query, 't=' + + (new Date) + '&i=' + this.index);
      if (!this.form) {
        var e = document.createElement('form'),
        f = document.createElement('textarea'),
        g = this.iframeId = 'socketio_iframe_' + this.index,
        h;
        e.className = 'socketio',
        e.style.position = 'absolute',
        e.style.top = '0px',
        e.style.left = '0px',
        e.style.display = 'none',
        e.target = g,
        e.method = 'POST',
        e.setAttribute('accept-charset', 'utf-8'),
        f.name = 'd',
        e.appendChild(f),
        document.body.appendChild(e),
        this.form = e,
        this.area = f
      }
      this.form.action = this.prepareUrl() + d,
      j(),
      this.area.value = b.JSON.stringify(a);
      try {
        this.form.submit()
      } catch (k) {
      }
      this.iframe.attachEvent ? h.onreadystatechange = function () {
        c.iframe.readyState == 'complete' && i()
      }
       : this.iframe.onload = i,
      this.socket.setBuffer(!0)
    },
    e.prototype.get = function () {
      var a = this,
      c = document.createElement('script'),
      e = b.util.query(this.socket.options.query, 't=' + + (new Date) + '&i=' + this.index);
      this.script && (this.script.parentNode.removeChild(this.script), this.script = null),
      c.async = !0,
      c.src = this.prepareUrl() + e,
      c.onerror = function () {
        a.onClose()
      };
      var f = document.getElementsByTagName('script') [0];
      f.parentNode.insertBefore(c, f),
      this.script = c,
      d && setTimeout(function () {
        var a = document.createElement('iframe');
        document.body.appendChild(a),
        document.body.removeChild(a)
      }, 100)
    },
    e.prototype._ = function (a) {
      return this.onData(a),
      this.isOpen && this.get(),
      this
    },
    e.prototype.ready = function (a, c) {
      var e = this;
      if (!d) {
        return c.call(this)
      }
      b.util.load(function () {
        c.call(e)
      })
    },
    e.check = function () {
      return 'document' in c
    },
    e.xdomainCheck = function () {
      return !0
    },
    b.transports.push('jsonp-polling')
  }('undefined' != typeof io ? io.Transport : module.exports, 'undefined' != typeof io ? io : module.parent.exports, this)
}) ();
(function () {
  var A = new Class({
    Implements: [
      Options,
      Events
    ],
    options: {
      container: null
    },
    ee: null,
    isParent: true,
    socket: null,
    ready: false,
    log: function () {
      try {
        if (window.console && window.console.log) {
          var B = Array.prototype.slice.call(arguments);
          B.unshift('XFrameMessager ' + (this.isParent ? 'parent' : 'child'));
          if (window.console.log.apply) {
            window.console.log.apply(window.console, B)
          } else {
            window.console.log(B)
          }
        }
      } catch (C) {
      }
    },
    initialize: function (C, B) {
      this.setOptions(C);
      this.ee = new Events();
      this.ee.on = this.ee.addEvent;
      this.ee.emit = this.ee.fireEvent;
      this.ee.removeEventListener = this.ee.removeEvent;
      if (typeOf(B) == 'boolean') {
        this.isParent = B
      } else {
        this.isParent = !this.isIframe()
      }
    },
    start: function (B, C) {
      var D = {
        onMessage: this.onMessage.bind(this),
        onReady: this.onReady.bind(this)
      };
      if (B) {
        D.container = B
      }
      if (C) {
        D.remote = C
      }
      try {
        if (!C && parent && parent.socket) {
          this.socket = parent.socket;
          this.onReady();
          return true
        }
      } catch (E) {
      }
      this.socket = new easyXDM.Socket(D);
      return true
    },
    isIframe: function () {
      if (top === self) {
        return false
      }
      return true
    },
    onReady: function () {
      this.ready = true;
      this.log('onReady', arguments);
      this.emit('xfm_ready', true)
    },
    onEmit: function (B) {
      this.log('onEmit', B)
    },
    emit: function (D, E, B) {
      if (!this.ready) {
        this.on('xfm_ready', function () {
          this.emit(D, E, B)
        }.bind(this));
        return
      }
      if (B) {
        E.cbid = B
      }
      var C = [
        D,
        E
      ];
      C = JSON.encode(C);
      this.onEmit(C);
      this.socket.postMessage(C)
    },
    onMessage: function (C, B) {
      this.log('onMessage', C, B);
      C = JSON.decode(C);
      if (typeOf(C) != 'array') {
        this.log('onMessage', 'incorrect format')
      }
      this.ee.emit(C[0], [
        null,
        C[1]
      ])
    },
    on: function (B, C) {
      this.ee.on(B, C)
    },
    once: function (F, I, D, G) {
      var C = this;
      var H;
      var B = function (J, K) {
        if (K && K.cbid != D) {
          return
        }
        E(J, K)
      };
      if (G) {
        H = E.delay(G, null, [
          'timeout',
          null
        ])
      }
      var E = function (J, K) {
        if (H) {
          clearTimeout(H)
        }
        C.ee.removeEvent(F, B);
        I(J, K)
      };
      this.on(F, B)
    },
    sendAndReceive: function (C, E, F, D) {
      var B = Math.round(new Date().getTime() + '' + Math.random() * 100000).toString(16);
      this.once(C, F, B, D);
      this.emit(C, E, B)
    },
    listeners: function (B) {
      if (B) {
        return this.ee.$events[B] || [
        ]
      }
      return this.ee.$events
    }
  });
  window.XFrameMessager = A
}) ();
(function () {
  var K = function (M, N, L) {
    return M.then(function (O) {
      if (typeOf(O) == 'object' && O[L] !== undefined) {
        O = O[L]
      }
      if (N) {
        N(null, O)
      }
      return O
    }, function (O) {
      if (N) {
        N(O)
      }
      return O
    })
  };
  var A = new Class({
    Implements: [
      Options,
      Events
    ],
    options: {
      urls: {
        scripts: {
          http: 'http://kxp-cdn3.kixeye.com/kxp/script/',
          https: 'https://kxp-cdn3.kixeye.com/kxp/script/'
        },
        php: 'http://api.kixeye.com/'
      },
      assetVersion: 2,
      requestTimeout: 6000,
      auth_data: null,
      appid: 'kxl',
      isKxl: false,
      inKxl: false,
      chatEnabled: false,
      socketTimeout: 10000,
      socketReconnects: 2,
      noSocket: false
    },
    debug: true,
    ready: false,
    comms: null,
    messages: null,
    chat: null,
    helper: null,
    socket: null,
    kixigned_request: null,
    kxid: null,
    userdata: {
    },
    platformdata: {
    },
    platformDataPromise: null,
    isShutdown: false,
    socketFailures: 0,
    socketPromise: null,
    socketReconnects: 0,
    socketReconnectTimer: null,
    socketSendAndReceiveTimeout: 30000,
    socketEe: null,
    xframeMessager: null,
    xframeListenerQueue: [
    ],
    initialize: function (L) {
      this.log('init', 'KXP Client initializing...');
      try {
        if (window.cc && window.cc.options && window.cc.options.app_id) {
          this.options.appid = window.cc.options.app_id
        }
      } catch (M) {
      }
      window.WEB_SOCKET_SWF_LOCATION = this.getScriptsUrl() + 'WebSocketMainInsecure.swf';
      if (!L) {
        L = {
        }
      }
      if (window.KXPoptions) {
        L = Object.merge(L, window.KXPoptions)
      }
      if (L && L.platformdata) {
        this.setPlatformData(L.platformdata);
        delete L.platformdata
      }
      this.setOptions(L);
      this.options.urls.php = this.getPhpUrl();
      if (this.options.auth_data && this.options.auth_data.kixigned_request) {
        this.options.inKxl = true
      }
      this.on = this.addEvent;
      this.emit = this.fireEvent;
      this.off = this.removeEvent;
      if (!this.options.isKxl) {
        this.init()
      }
    },
    init: function () {
      var L = false;
      var M = [
      ];
      return function (S, O) {
        if (L) {
          if (S) {
            M.push(S)
          }
          return
        }
        if (this.ready) {
          if (S) {
            S()
          }
          return
        }
        L = true;
        var R = function () {
          M.forEach(function (T) {
            T()
          });
          M = [
          ]
        };
        if (O) {
          this.setPlatformData(O)
        }
        var N = this;
        this.log('init', 'KXP Client init');
        var P = this.setupInstance();
        P.then(function () {
          N.ready = true;
          window.fireEvent('KXPready', N);
          N.fireEvent('ready', N);
          R();
          if (window.top !== window.self) {
            N.startXFrameMessager()
          }
        });
        P.fail(function (T) {
          window.fireEvent('KXPerror', [
            T,
            N
          ]);
          N.fireEvent('error', [
            T,
            N
          ])
        });
        return P
      }
    }(),
    setupInstance: function () {
      this.log('init', 'Setting up instance...');
      var M = this;
      var L = this.retrievePlatformData();
      var O = L.then(function () {
        return Q.all([M.connectSocket(),
        M.setupSubClasses()])
      });
      var N = false;
      var P = O.then(function (R) {
        N = R == 'checkroute';
        if (M.options.chatEnabled) {
          M.log('init', 'Chat is enabled.')
        } else {
          M.log('init', 'Chat is disabled.')
        }
        return M.options.chatEnabled ? M.chat.connectWithJid(M.kxid, M.kixigned_request)  : true
      }).fail(function (R) {
        M.log('init', 'Instance setup failed:', (R ? R.message : ''), (R ? R.stack : ''))
      }).then(function () {
        if (N) {
          M.log('init', 'Instance setup retrying: checkroute');
          return M.reconnectSocket().then(function (R) {
            if (R == 'checkroute') {
              throw new Error('badroute')
            }
            M.log('init', 'Instance setup successful');
            return true
          })
        }
        M.log('init', 'Instance setup successful');
        return true
      }).fail(function (R) {
        M.log('init', 'Instance setup failed:', (R ? R.message : ''), (R ? R.stack : ''))
      });
      return P
    },
    setupSubClasses: function () {
      this.log('debug', 'setupSubClasses');
      var L = Q.all([new H(this.options),
      new D(this.options),
      new B(this.options),
      new XMPPController(this.options)]);
      var M = L.spread(function (O, R, P, N) {
        this.comms = O;
        this.messages = R;
        this.helper = P;
        this.chat = N;
        return true
      }.bind(this));
      return M
    },
    log: function () {
      if (!this.debug) {
        return false
      }
      try {
        var L = Array.prototype.slice.call(arguments);
        L[0] = '[' + L[0] + ']';
        if (window.console && window.console.log.apply) {
          console.log.apply(console, L)
        } else {
          if (window.console) {
            console.log(L)
          }
        }
      } catch (M) {
        return false
      }
      return true
    },
    avatarUploaded: function (L) {
      this.log('debug', 'avatarUploaded', L);
      return
    },
    getPhpUrl: function () {
      if (this.isHTTPS()) {
        return this.options.urls.php.replace('http://', 'https://')
      }
      return this.options.urls.php
    },
    getScriptsUrl: function () {
      if (this.isHTTPS()) {
        return this.options.urls.scripts.https
      }
      return this.options.urls.scripts.http
    },
    startXFrameMessager: function (L, M, N) {
      if (this.xframeMessager && !N) {
        return true
      }
      this.xframeMessager = new window.XFrameMessager();
      this.xframeMessager.start(L, M);
      this.fireEvent('xframe-ready');
      return true
    },
    frameEmit: function (M, N, L) {
      if (!this.xframeMessager) {
        return false
      }
      this.xframeMessager.emit(M, N, L);
      return true
    },
    frameOn: function (M, N) {
      var L = this;
      if (!L.xframeMessager) {
        L.xframeListenerQueue.push([M,
        N]);
        if (L.xframeListenerQueue.length === 1) {
          L.addEvent('xframe-ready', function () {
            if (L.xframeListenerQueue.length < 1) {
              return
            }
            L.xframeListenerQueue.forEach(function (O) {
              L.frameOn.apply(L, O)
            })
          })
        }
        return false
      }
      L.xframeMessager.on(M, N);
      return true
    },
    frameSendAndReceive: function (L, M, N) {
      if (!this.xframeMessager) {
        return false
      }
      return this.xframeMessager.sendAndReceive(L, M, N)
    },
    connectXframe: function () {
      this.startXFrameMessager();
      this.socket = this.xframeMessager;
      this.applyEventForwarders();
      return Q.resolve(true)
    },
    connectSocket: function (N) {
      this.log('debug', 'connectSocket', typeOf(this.socketPromise), N);
      if (!this.socketEe) {
        this.socketEe = new io.EventEmitter()
      }
      if (this.socketPromise !== null && !N) {
        return this.socketPromise
      }
      this.socketReconnects = 0;
      var L = this.retrievePlatformData(N);
      var M = this;
      var O = L.then(function (U) {
        if (!U.route || M.options.noSocket) {
          M.fireEvent('socketStatus', 'disconnect');
          if (M.options.isKxl) {
            throw new Error('noroute')
          } else {
            return false
          }
        }
        var S = U.route.split(':');
        var T = 'ns' + S[1];
        S = S[0] + ':' + S[S.length - 1];
        M.socket = io.connect('https://' + S, {
          'connect timeout': M.options.socketTimeout,
          reconnect: true,
          'reconnection delay': 500,
          'max reconnection attempts': M.options.socketReconnects,
          resource: T
        });
        var R = Q.defer();
        var P = M.onFailedSocket.delay(M.options.socketTimeout + 1000, M);
        M.socket.on('connect', function () {
          M.log('debug', 'onSocketConnected');
          M.socketFailures = 0;
          window.clearTimeout(P);
          M.applyEventForwarders();
          M.loginSocket().then(function () {
            R.resolve(true)
          })
        });
        M.socket.on('disconnect', M.onSocketDisconnect.bind(M));
        M.socket.on('error', M.onSocketError.bind(M));
        M.socket.on('reconnecting', M.onSocketReconnecting.bind(M));
        M.socket.on('reconnect', M.onSocketReconnect.bind(M));
        M.socket.on('connect_failed', M.onFailedSocket.bind(M));
        M.socket.on('reconnect_failed', M.onFailedSocket.bind(M));
        return R.promise
      });
      this.socketPromise = O;
      return O
    },
    reconnectSocket: function () {
      this.log('debug', 'reconnectSocket');
      try {
        if (this.socket) {
          this.socket.disconnect()
        }
      } catch (L) {
      }
      return this.connectSocket(true)
    },
    onSocketError: function () {
      this.log('debug', 'onSocketError')
    },
    onSocketReconnecting: function () {
      this.log('debug', 'onSocketReconnecting', this.socketReconnects);
      if (++this.socketReconnects >= this.options.socketReconnects) {
        this.socketReconnectTimer = this.onFailedSocket.delay(3000, this)
      }
    },
    onSocketReconnect: function () {
      this.log('debug', 'onSocketReconnect');
      this.socketReconnects = 0;
      if (this.socketReconnectTimer) {
        window.clearTimeout(this.socketReconnectTimer)
      }
    },
    onSocketDisconnect: function () {
      this.log('debug', 'onSocketDisconnect')
    },
    onFailedSocket: function () {
      this.log('debug', 'onFailedSocket');
      if (this.socketFailures++ > 1) {
        return false
      }
      return this.reconnectSocket()
    },
    retrieveKixignedRequest: function (L) {
      return this.retrievePlatformData(L).get('kixigned_request')
    },
    retrieveSocketIoRoute: function (L) {
      return this.retrievePlatformData(L).get('route')
    },
    retrievePlatformData: function (O) {
      if (this.platformDataPromise !== null && !O) {
        return this.platformDataPromise
      }
      if (this.platformdata.kixigned_request && !O) {
        return (this.platformDataPromise = Q.resolve(this.platformdata))
      }
      var L = 'auth/getkixignedrequest';
      var N = {
      };
      if (this.options.auth_data) {
        N = this.options.auth_data
      }
      var M = this.callServer(L, N);
      var P = M.then(function (R) {
        this.setPlatformData(R);
        return R
      }.bind(this));
      this.platformDataPromise = P;
      return P
    },
    loginSocket: function () {
      this.log('debug', 'loginSocket');
      var M = {
        kixigned_request: this.kixigned_request
      };
      var N = this.options.isKxl || this.options.inKxl ? 'login' : 'auth';
      var L = Q.defer();
      this.socketOn(N, function (O, P) {
        if (O) {
          this.log('debug', 'loginSocket: Login failed', O.message);
          if (O.message == 'checkroute') {
            L.resolve(O.message)
          } else {
            L.reject(new Error(O));
            this.fireEvent('socketStatus', 'disconnect')
          }
        } else {
          this.log('debug', 'loginSocket: Logged in!');
          if (P) {
            this.userdata = Object.merge(this.userdata, P)
          }
          if (P.kxid) {
            this.kxid = P.kxid
          }
          L.resolve(true);
          this.fireEvent('socketStatus', 'connect')
        }
      }.bind(this));
      this.socket.emit(N, M);
      return L.promise
    },
    callServer: function (O, P, N) {
      if (this.isShutdown) {
        return Q.reject(new Error('KXP client has been shut down, please reload the page'))
      }
      var M = Q.defer();
      N = (N || this.options.urls.php) + O;
      this.log('debug', 'callServer', N, P);
      var R = function (S) {
        if (S.error) {
          M.reject(new Error(S.error))
        } else {
          M.resolve(S)
        }
      };
      var L = {
        timeout: this.options.requestTimeout || 6000,
        url: N,
        onComplete: R,
        onTimeout: function () {
          M.reject(new Error('timeout'))
        }
      };
      if (!P) {
        P = {
        }
      }
      if (!P.kixigned_request) {
        P.kixigned_request = this.kixigned_request
      }
      P.appid = this.options.appid;
      L.data = P;
      new Request.JSONP(L).send();
      return M.promise
    },
    socketOn: function (O, R, N, M) {
      var L = this;
      var P = function (T) {
        L.log('debug', 'socketOn:', O, T, N);
        if (N && (!T.cbid || T.cbid != N)) {
          return false
        }
        if (T.cbid) {
          delete T.cbid
        }
        if (M) {
          R(T);
          return true
        }
        var S = null;
        var U = null;
        if (T.error) {
          S = T.error
        }
        if (T.payload) {
          U = T.payload
        }
        R(S, U)
      };
      this.socketEe.on(O, P);
      if (this.socket && this.socket.listeners(O).length < 1) {
        this.socket.on(O, function (S) {
          this.socketEe.emit(O, S)
        }.bind(this))
      }
      return P
    },
    socketOff: function (L, M) {
      this.socketEe.removeListener(L, M)
    },
    socketOnce: function (N, P, M) {
      var L = this;
      var O = function (R, S) {
        L.socketOff(N, O);
        P(R, S)
      };
      O = L.socketOn(N, O, M)
    },
    socketEmit: function (M, N, O, L) {
      this.log('debug', 'socketEmit:', M, N, L);
      if (O && L) {
        this.socketOnce(M, O, L)
      }
      if (!N || typeOf(N) != 'object') {
        N = {
        }
      }
      N.cbid = L;
      this.socket.emit(M, N);
      return true
    },
    generateCbid: function () {
      var L = function () {
        return (((1 + Math.random()) * 65536) | 0).toString(16).substring(1)
      };
      return L() + L()
    },
    socketSendAndReceive: function (N, R, P, O) {
      var M = this.generateCbid();
      var L = Q.defer();
      if (!O) {
        O = {
        }
      }
      if (!O.payload && R) {
        O.payload = R
      }
      if (!P) {
        P = this.options.socketSendAndReceiveTimeout
      }
      this.socketEmit(N, O, L.makeNodeResolver(), M);
      if (P) {
        var S = L.reject.delay(P, L, new Error('timeout'));
        L.promise.then(clearTimeout.bind(null, S))
      }
      return L.promise
    },
    applyEventForwarders: function (N) {
      var L = this;
      var M = L.socketEe.$events;
      if (!N) {
        N = L.socket
      }
      Object.each(M, function (P, O) {
        L.socket.on(O, function (R) {
          if (L.socket.listeners(O).length > 0) {
            return false
          }
          L.socketEe.emit(O, R)
        })
      })
    },
    shutdown: function () {
      this.log('shutdown', 'Shutting down...');
      var L = Q.defer();
      this.ready = false;
      this.isShutdown = true;
      if (this.options.chatEnabled) {
        this.chat.disconnect()
      }
      this.socket.on('disconnect', function () {
        this.log('shutdown', 'Socket.io disconnected');
        window.KXPIcomms.destroy();
        window.KXPIcomms = null;
        window.KXPIchat.destroy();
        window.KXPIchat = null;
        L.resolve(true)
      }.bind(this));
      this.socket.disconnect();
      return L.promise
    },
    createCallback: function (M, L) {
      return function (N) {
        if (instanceOf(N, Error)) {
          N = {
            error: N.message
          }
        }
        window.KXPfc.emitToFlash(M, N, L)
      }.bind(this)
    },
    getIgnoredUsers: function (L) {
      var M = this.createCallback('getignoredusers', L);
      this.callServer('ignore/getignoredusers', {
      }).then(M).fail(M);
      return true
    },
    ignoreUsers: function (L, M) {
      var N = this.createCallback('ignoreusers', M);
      this.callServer('ignore/ignoreusers', {
        kxids: L
      }).then(N).fail(N);
      return true
    },
    unignoreUsers: function (L, M) {
      var N = this.createCallback('unignoreusers', M);
      this.callServer('ignore/unignoreusers', {
        kxids: L
      }).then(N).fail(N);
      return true
    },
    isHTTPS: function () {
      if (window.location.href.substr(0, 5) == 'https') {
        return true
      }
      return false
    },
    setPlatformData: function (L) {
      this.platformdata = L;
      if (L.kixigned_request) {
        this.kixigned_request = L.kixigned_request
      }
      if (L.kxid) {
        this.kxid = L.kxid
      }
    }
  });
  var D = new Class({
    Implements: [
      Options,
      Events
    ],
    options: {
    },
    kc: null,
    listening: false,
    initialize: function (L) {
      this.setOptions(L);
      this.kc = window.KXP;
      return Q.resolve(this)
    },
    startListening: function () {
      if (this.listening) {
        return true
      }
      this.kc.socketOn('msg', function (L, M) {
        if (L) {
          this.handleError(L)
        } else {
          if (typeOf(M) != 'object') {
            this.handleError(new Error('Invalid message body'))
          } else {
            this.handleMessage(M)
          }
        }
      }.bind(this));
      this.listening = true;
      return true
    },
    shutdown: function () {
      this.removeEvents();
      return true
    },
    getEventName: function (L) {
      return 'msg-' + L
    },
    handleError: function (M) {
      this.kc.log('error', 'KxpMessages.handleError', M);
      var L = this.getEventName('error');
      this.fireEvent(L, M)
    },
    handleMessage: function (M) {
      this.kc.log('debug', 'KxpMessages.handleMessage', M);
      if (M.namespace && M.namespace != this.options.appid) {
        return false
      }
      var L = this.getEventName(M.type);
      this.fireEvent(L, M)
    },
    onMessage: function (M, N) {
      this.kc.log('debug', 'KxpMessages.onMessage()', M);
      var L = this.getEventName(M);
      this.addEvent(L, N);
      this.startListening();
      return true
    },
    offMessage: function (M, N) {
      var L = this.getEventName(M);
      this.removeEvent(L, N);
      return true
    }
  });
  var H = new Class({
    Implements: [
      Options,
      Events
    ],
    options: {
      comms_controller: 'messaging'
    },
    kc: null,
    pollInterval: null,
    lastPoll: 0,
    isPolling: false,
    initialize: function (L) {
      this.setOptions(L);
      this.kc = window.KXP;
      this.kc.addEvent('socketStatus', function (M) {
        if (this.kc.options.isKxl) {
          return
        }
        if (M == 'disconnect') {
          this.startPolling()
        } else {
          if (M == 'connect') {
            this.stopPolling()
          }
        }
      }.bind(this));
      return Q.resolve(this)
    },
    callServer: function (O, N) {
      var L = this.options.urls.comms || null;
      var M = this.options.comms_controller + '/' + O;
      if (!N) {
        N = {
        }
      }
      return this.kc.callServer(M, N, L)
    },
    startPolling: function () {
      if (this.pollInterval) {
        return
      }
      this.kc.log('debug', 'startPolling');
      this.kc.retrievePlatformData().then(function (M) {
        var L = M.polltime || 30;
        this.lastPoll = M.time || 0;
        if (L < 30) {
          L = 30
        }
        L = parseInt(L, 10) * 1000;
        this.pollInterval = this.pollServer.periodical(L, this)
      }.bind(this))
    },
    stopPolling: function () {
      this.kc.log('debug', 'stopPolling');
      if (!this.pollInterval) {
        return
      }
      window.clearInterval(this.pollInterval)
    },
    pollServer: function () {
      if (this.isPolling) {
        return false
      }
      this.isPolling = true;
      var N = this.callServer('getnewnotifs', {
        ts: this.lastPoll
      });
      var M = this;
      var L = function () {
        M.lastPoll += M.pollInterval;
        M.isPolling = false
      };
      N.then(function (O) {
        if (!O.success) {
          return L()
        }
        M.lastPoll = O.time;
        M.isPolling = false;
        if (!O.notifs || typeOf(O.notifs) != 'array' || O.notifs.length < 1) {
          return false
        }
        O.notifs.forEach(function (P) {
          M.kc.socketEe.emit('msg', {
            payload: P
          })
        })
      }).fail(L)
    },
    getThreads: function (L, M) {
      var N = {
        limit: L,
        skip: M
      };
      return this.callServer('getthreads', N)
    },
    getThread: function (M) {
      var L = {
        threadid: M
      };
      return this.callServer('getthread', L)
    },
    create: function (L, O, M, R, N) {
      if (arguments.length < 2) {
        return false
      }
      if (typeOf(L) == 'array') {
        L = L.join(',')
      } else {
        L = L.toString()
      }
      O = O.substr(0, 255);
      if (M) {
        M = M.substr(0, 70)
      }
      var P = {
        recipients: L,
        type: N || 'normal',
        message: O
      };
      if (R) {
        P.headers = R
      }
      if (M) {
        P.subject = M
      }
      return this.callServer('create', P)
    }
  });
  var F = new Class({
    Implements: [
      Options,
      Events
    ],
    options: {
    },
    kc: null,
    flashEl: null,
    flashCallback: null,
    readyMonitor: null,
    ready: false,
    initialize: function (L) {
      this.setOptions(L);
      this.kc = window.KXP;
      this.addEvent('ready', function () {
        this.kc.log('init', 'KXPfc ready');
        this.ready = true;
        this.fireEvent('kxpready')
      }.bind(this));
      window.addEvent('domready', function () {
        this.setReadyListener();
        this.registerFlashElement('gameswf', true)
      }.bind(this))
    },
    kxpready: function (L) {
      if (this.ready) {
        L()
      } else {
        this.addEvent('kxpready', L)
      }
    },
    registerFlashElement: function (O, L, N) {
      var M = $(O);
      if (!M) {
        if (L) {
          if (!N) {
            N = 500
          } else {
            N = Math.round(N * 1.1)
          }
          if (N > 5000) {
            N = 5000
          }
          this.registerFlashElement.delay(N, this, [
            O,
            true,
            N
          ])
        }
        return false
      }
      this.kc.log('debug', 'registerFlashElement: success');
      this.flashEl = M;
      this.checkReady();
      return true
    },
    unregisterFlashElement: function () {
      if (!this.flashEl) {
        return false
      }
      this.flashEl = null;
      return true
    },
    registerCallback: function (L) {
      this.kc.log('debug', 'registerCallback: ', L);
      this.flashCallback = L;
      return true
    },
    setReadyListener: function () {
      this.kc.log('debug', 'setReadyListener');
      var L = function () {
        this.emitToFlash('KXPready', {
          ready: true,
          kxid: this.kc.kxid,
          kixigned_request: this.kc.kixigned_request
        })
      }.bind(this);
      if (this.ready) {
        L()
      } else {
        this.addEvent('ready', L)
      }
      return true
    },
    checkReady: function (L) {
      if (this.flashReady()) {
        this.fireEvent('ready');
        if (this.readyMonitor) {
          clearInterval(this.readyMonitor)
        }
      } else {
        if (!this.readyMonitor && !L) {
          this.readyMonitor = this.checkReady.periodical(1000, this)
        }
      }
    },
    flashReady: function () {
      if (!this.kc.ready || !this.flashEl || !this.flashCallback) {
        return false
      }
      return true
    },
    emitToFlash: function (M, N, L) {
      this.kc.log('debug', 'emitToFlash', M, N, L, this.flashReady());
      if (!this.flashReady()) {
        return false
      }
      try {
        Swiff.remote(this.flashEl, this.flashCallback, M, N, L)
      } catch (O) {
        this.kc.log('error', 'emitToFlash failed', O);
        return O
      }
      return true
    }
  });
  var G = new Class({
    Implements: [
      Options,
      Events
    ],
    options: {
    },
    kc: null,
    kfc: null,
    initialize: function (L) {
      this.setOptions(L);
      this.kc = window.KXP;
      this.kfc = window.KXPfc
    },
    destroy: function () {
      this.kc = this.kfc = null
    }
  });
  var E = new Class({
    Extends: G,
    initialize: function (L) {
      this.parent(L);
      this.kfc.kxpready(this.bindSocketListener.bind(this))
    },
    emit: function (N, O, M) {
      this.kc.log('debug', 'emit', N, O, M);
      if (typeOf(O) == 'string') {
        O = JSON.decode(O)
      }
      var P = this.kc.comms.callServer(N, O);
      var L = function (R) {
        if (instanceOf(R, Error)) {
          R = {
            error: R.message
          }
        }
        this.kfc.emitToFlash(N, R, M)
      }.bind(this);
      P.then(L);
      P.fail(L);
      return true
    },
    emitNewComms: function (N) {
      this.kc.log('debug', 'KXPfc.emitNewComms()', N);
      var M = N.headers;
      var L = N.type.replace('comms-', '');
      return this.kfc.emitToFlash(L, M)
    },
    bindSocketListener: function () {
      this.kc.log('debug', 'KXPfc.bindSocketListener()');
      this.kc.messages.onMessage('comms-newthread', this.emitNewComms.bind(this));
      this.kc.messages.onMessage('comms-newmessage', this.emitNewComms.bind(this));
      return true
    }
  });
  var C = (function () {
    function L() {
      var M = this;
      function N(O) {
        M.kc.chat.addEvent(O, function (P) {
          M.kfc.emitToFlash(O, P)
        })
      }
      N('addroom');
      N('removeroom');
      N('adduser');
      N('removeuser');
      N('addheadline');
      N('adderror');
      N('addmessage')
    }
    return new Class({
      Implements: [
        Options,
        Events
      ],
      Extends: G,
      initialize: function (M) {
        this.parent(M);
        this.kfc.kxpready(L.bind(this))
      },
      getMyConnectionJid: function () {
        return this.kc.chat.engine.myJid
      },
      whisper: function (N, M) {
        this.kc.chat.sendWhisper(M, N);
        return true
      },
      chat: function (N, M) {
        var O = this.kc.chat.getRoomByJid(M);
        if (null === O) {
          return false
        }
        this.kc.chat.sendMessageToRoom(O, N);
        return true
      },
      getRooms: function () {
        return this.kc.chat.getRooms().map(function (M) {
          return M.jid
        })
      },
      leaveMUC: function (M) {
        return this.kc.chat.leaveMUC(M)
      },
      getRoomMessages: function (M) {
        var N = this.kc.chat.getRoomByJid(M);
        return N ? N.messages : null
      }
    })
  }) ();
  window.KXPfc_callFunc = function () {
    var L = Array.prototype.slice.call(arguments);
    var P = L.shift();
    if (P.indexOf('.') === - 1) {
      return window[P].apply(window[P], L)
    }
    P = P.split('.');
    var O = window[P[0]];
    var N = O;
    for (var M = 1; M < P.length; M++) {
      O = O[P[M]]
    }
    return O.apply(N, L)
  };
  var B = new Class({
    kc: null,
    dataCache: {
    },
    retrievePromises: {
    },
    initialize: function () {
      this.kc = KXP
    },
    getTimestamp: function () {
      return Math.round(new Date().getTime() / 1000)
    },
    retrieveData: function (L, P, N, M) {
      var S = this;
      var R = L;
      if (P) {
        R += '/' + JSON.encode(P)
      }
      if (!M) {
        var U = S.getDataFromCache(R);
        if (U) {
          return Q.resolve(U)
        }
      }
      if (!N) {
        N = 0
      }
      var O;
      if (S.retrievePromises[R]) {
        O = S.retrievePromises[R]
      } else {
        var T = S.kc.socketSendAndReceive(L, P);
        O = S.retrievePromises[R] = T.then(function (W) {
          var V = {
            data: W,
            timeout: (S.getTimestamp() + N)
          };
          S.setDataInCache(R, V);
          delete S.retrievePromises[R];
          return W
        })
      }
      return O
    },
    setDataInCache: function (M, L) {
      this.dataCache[M] = L
    },
    getDataFromCache: function (L) {
      if (!this.dataCache[L]) {
        return null
      }
      if (this.dataCache[L].timeout > 0 && this.dataCache[L].timeout < this.getTimestamp()) {
        this.purgeDataFromCache(L);
        return null
      }
      return this.dataCache[L].data
    },
    purgeDataFromCache: function (L) {
      delete this.dataCache[L]
    },
    getFriends: function (N, L) {
      var M = this.retrieveData('getfriends', null, 20, L);
      return K(M, N, 'friends')
    },
    getFriend: function (L, N) {
      var M = this.getFriends().then(function (O) {
        return O[L] || null
      });
      return K(M, N)
    },
    watchFriends: function () {
      var M = [
      ];
      var L = function (N, O) {
        if (N || M.length === 0) {
          return
        }
        KXP.helper.getFriends(function (P, R) {
          M.forEach(function (S) {
            S(P, R)
          })
        }, true)
      };
      window.addEvent('KXPready', function () {
        KXP.socketOn('friendsupdated', L)
      });
      return function (O, N) {
        if (N) {
          delete M[M.indexOf(O)];
          return
        }
        M.push(O)
      }
    }(),
    unwatchFriends: function (L) {
      this.watchFriends(L, true)
    },
    getFriendIds: function (M) {
      var L = this.getFriends().then(function (N) {
        return Object.keys(N)
      });
      return K(L, M)
    },
    isFriend: function (L, N) {
      var M = this.getFriendIds().then(function (O) {
        return (O.indexOf(L) !== - 1)
      });
      return K(M, N)
    },
    requestFriend: function () {
      var N,
      L,
      M,
      O,
      R,
      P;
      N = Array.prototype.slice.call(arguments);
      while (true) {
        L = N.pop();
        if (L === undefined) {
          break
        }
        switch (typeOf(L)) {
          case 'null':
            break;
          case 'function':
            R = L;
            break;
          case 'object':
            O = L;
            break;
          default:
            M = L;
            break
        }
      }
      if (!O) {
        O = {
        }
      }
      if (typeOf(M) == 'array') {
        O.targets = M
      } else {
        O.target = M
      }
      P = this.kc.socketSendAndReceive('requestfriend', O);
      return K(P, R)
    },
    acceptFriendRequest: function () {
      var M,
      L,
      P,
      N,
      R,
      O;
      M = Array.prototype.slice.call(arguments);
      while (true) {
        L = M.pop();
        if (L === undefined) {
          break
        }
        switch (typeOf(L)) {
          case 'null':
            break;
          case 'function':
            R = L;
            break;
          case 'object':
            N = L;
            break;
          default:
            P = L;
            break
        }
      }
      if (!N) {
        N = {
        }
      }
      N.sig = P;
      O = this.kc.socketSendAndReceive('acceptfriendrequest', N);
      return K(O, R)
    },
    removeFriend: function () {
      var N,
      L,
      M,
      O,
      R,
      P;
      N = Array.prototype.slice.call(arguments);
      while (true) {
        L = N.pop();
        if (L === undefined) {
          break
        }
        switch (typeOf(L)) {
          case 'null':
            break;
          case 'function':
            R = L;
            break;
          case 'object':
            O = L;
            break;
          default:
            M = L;
            break
        }
      }
      if (!O) {
        O = {
        }
      }
      O.target = M;
      P = this.kc.socketSendAndReceive('removefriend', O);
      return K(P, R)
    },
    searchUsers: function (M, O) {
      var L = {
        target: M
      };
      var N = this.kc.socketSendAndReceive('searchusers', L).then(function (P) {
        return P.result
      });
      return K(N, O)
    },
    getProfile: function (L) {
      var O = typeOf(arguments[arguments.length - 1]) == 'function' ? arguments[arguments.length - 1] : null;
      var M = typeOf(L) == 'string' ? {
        kxid: L
      }
       : null;
      var N = this.retrieveData('getprofile', M, 20);
      return K(N, O, 'profile')
    },
    invokeEmitMessages: function (L, N) {
      var M = this.kc.socketSendAndReceive('invokeemitmessages', L);
      return K(M, N, 'result')
    },
    loadMessages: function (L, N) {
      var M = this.kc.socketSendAndReceive('loadmessages', L);
      return K(M, N, 'result')
    },
    actionMessage: function (L, N, P) {
      var M = {
        action: N
      };
      if (typeOf(L) == 'array') {
        M.messageids = L
      } else {
        M.messageid = L
      }
      var O = this.kc.socketSendAndReceive('actionmessage', M);
      return K(O, P)
    },
    getUserAppData: function (L) {
      var O = typeOf(arguments[arguments.length - 1]) == 'function' ? arguments[arguments.length - 1] : null;
      var M = typeOf(L) == 'string' ? {
        kxid: L
      }
       : null;
      var N = this.retrieveData('getuserappdata', M, 20);
      return K(N, O)
    },
    checkNameTaken: function (O, N) {
      var L = {
        username: O
      };
      var M = this.retrieveData('checknametaken', L, 20);
      return K(M, N, 'result')
    },
    combine: function (M, O) {
      var L = this;
      var N = [
      ];
      Object.each(M, function (R, P) {
        if (L[P]) {
          N.push(L[P].apply(L, R))
        }
      });
      if (N.length < 1) {
        return K(Q.reject('nomethods'), O)
      }
      return K(Q.all(N), O)
    }
  });
  if (window.addEvent) {
    var I = false;
    var J = false;
    window.addEvent('KXPloaded', function () {
      I = true
    });
    window.addEvent('KXPready', function () {
      J = true
    });
    window.addEvent('domready', function () {
      Element.Events.KXPloaded = {
        onAdd: function (L) {
          if (I) {
            L.call(this)
          }
        }
      };
      Element.Events.KXPready = {
        onAdd: function (L) {
          if (J) {
            L.call(this)
          }
        }
      };
      window.KXP = new A();
      window.KXPfc = new F();
      window.KXPIcomms = new E();
      window.KXPIchat = new C()
    })
  } else {
    if (window.console && console.log) {
      console.log('KXP Client failed to load (no mootools?)')
    }
  }
}) (); var swfobject = function () {
  var AQ = 'undefined',
  Ac = 'object',
  AB = 'Shockwave Flash',
  X = 'ShockwaveFlash.ShockwaveFlash',
  Ad = 'application/x-shockwave-flash',
  AC = 'SWFObjectExprInst',
  AW = 'onreadystatechange',
  AF = window,
  Ak = document,
  Aa = navigator,
  AA = false,
  Z = [
    Am
  ],
  Af = [
  ],
  AG = [
  ],
  AL = [
  ],
  Ai,
  AD,
  AP,
  AS,
  AK = false,
  At = false,
  Ag,
  AN,
  Ah = true,
  AH = function () {
    var A = typeof Ak.getElementById != AQ && typeof Ak.getElementsByTagName != AQ && typeof Ak.createElement != AQ,
    E = Aa.userAgent.toLowerCase(),
    C = Aa.platform.toLowerCase(),
    H = C ? /win/.test(C)  : /win/.test(E),
    J = C ? /mac/.test(C)  : /mac/.test(E),
    G = /webkit/.test(E) ? parseFloat(E.replace(/^.*webkit\/(\d+(\.\d+)?).*$/, '$1'))  : false,
    D = ! + '\v1',
    F = [
      0,
      0,
      0
    ],
    K = null;
    if (typeof Aa.plugins != AQ && typeof Aa.plugins[AB] == Ac) {
      K = Aa.plugins[AB].description;
      if (K && !(typeof Aa.mimeTypes != AQ && Aa.mimeTypes[Ad] && !Aa.mimeTypes[Ad].enabledPlugin)) {
        AA = true;
        D = false;
        K = K.replace(/^.*\s+(\S+\s+\S+$)/, '$1');
        F[0] = parseInt(K.replace(/^(.*)\..*$/, '$1'), 10);
        F[1] = parseInt(K.replace(/^.*\.(.*)\s.*$/, '$1'), 10);
        F[2] = /[a-zA-Z]/.test(K) ? parseInt(K.replace(/^.*[a-zA-Z]+(.*)$/, '$1'), 10)  : 0
      }
    } else {
      if (typeof AF.ActiveXObject != AQ) {
        try {
          var I = new ActiveXObject(X);
          if (I) {
            K = I.GetVariable('$version');
            if (K) {
              D = true;
              K = K.split(' ') [1].split(',');
              F = [
                parseInt(K[0], 10),
                parseInt(K[1], 10),
                parseInt(K[2], 10)
              ]
            }
          }
        } catch (B) {
        }
      }
    }
    return {
      w3: A,
      pv: F,
      wk: G,
      ie: D,
      win: H,
      mac: J
    }
  }(),
  Aj = function () {
    if (!AH.w3) {
      return
    }
    if ((typeof Ak.readyState != AQ && Ak.readyState == 'complete') || (typeof Ak.readyState == AQ && (Ak.getElementsByTagName('body') [0] || Ak.body))) {
      Ao()
    }
    if (!AK) {
      if (typeof Ak.addEventListener != AQ) {
        Ak.addEventListener('DOMContentLoaded', Ao, false)
      }
      if (AH.ie && AH.win) {
        Ak.attachEvent(AW, function () {
          if (Ak.readyState == 'complete') {
            Ak.detachEvent(AW, arguments.callee);
            Ao()
          }
        });
        if (AF == top) {
          (function () {
            if (AK) {
              return
            }
            try {
              Ak.documentElement.doScroll('left')
            } catch (A) {
              setTimeout(arguments.callee, 0);
              return
            }
            Ao()
          }) ()
        }
      }
      if (AH.wk) {
        (function () {
          if (AK) {
            return
          }
          if (!/loaded|complete/.test(Ak.readyState)) {
            setTimeout(arguments.callee, 0);
            return
          }
          Ao()
        }) ()
      }
      Ab(Ao)
    }
  }();
  function Ao() {
    if (AK) {
      return
    }
    try {
      var B = Ak.getElementsByTagName('body') [0].appendChild(AR('span'));
      B.parentNode.removeChild(B)
    } catch (A) {
      return
    }
    AK = true;
    var D = Z.length;
    for (var C = 0; C < D; C++) {
      Z[C]()
    }
  }
  function AJ(A) {
    if (AK) {
      A()
    } else {
      Z[Z.length] = A
    }
  }
  function Ab(A) {
    if (typeof AF.addEventListener != AQ) {
      AF.addEventListener('load', A, false)
    } else {
      if (typeof Ak.addEventListener != AQ) {
        Ak.addEventListener('load', A, false)
      } else {
        if (typeof AF.attachEvent != AQ) {
          Al(AF, 'onload', A)
        } else {
          if (typeof AF.onload == 'function') {
            var B = AF.onload;
            AF.onload = function () {
              B();
              A()
            }
          } else {
            AF.onload = A
          }
        }
      }
    }
  }
  function Am() {
    if (AA) {
      Y()
    } else {
      AM()
    }
  }
  function Y() {
    var D = Ak.getElementsByTagName('body') [0];
    var B = AR(Ac);
    B.setAttribute('type', Ad);
    var A = D.appendChild(B);
    if (A) {
      var C = 0;
      (function () {
        if (typeof A.GetVariable != AQ) {
          var E = A.GetVariable('$version');
          if (E) {
            E = E.split(' ') [1].split(',');
            AH.pv = [
              parseInt(E[0], 10),
              parseInt(E[1], 10),
              parseInt(E[2], 10)
            ]
          }
        } else {
          if (C < 10) {
            C++;
            setTimeout(arguments.callee, 10);
            return
          }
        }
        D.removeChild(B);
        A = null;
        AM()
      }) ()
    } else {
      AM()
    }
  }
  function AM() {
    var G = Af.length;
    if (G > 0) {
      for (var H = 0; H < G; H++) {
        var C = Af[H].id;
        var L = Af[H].callbackFn;
        var A = {
          success: false,
          id: C
        };
        if (AH.pv[0] > 0) {
          var I = Ar(C);
          if (I) {
            if (AO(Af[H].swfVersion) && !(AH.wk && AH.wk < 312)) {
              AX(C, true);
              if (L) {
                A.success = true;
                A.ref = AU(C);
                L(A)
              }
            } else {
              if (Af[H].expressInstall && AT()) {
                var E = {
                };
                E.data = Af[H].expressInstall;
                E.width = I.getAttribute('width') || '0';
                E.height = I.getAttribute('height') || '0';
                if (I.getAttribute('class')) {
                  E.styleclass = I.getAttribute('class')
                }
                if (I.getAttribute('align')) {
                  E.align = I.getAttribute('align')
                }
                var F = {
                };
                var D = I.getElementsByTagName('param');
                var K = D.length;
                for (var J = 0; J < K; J++) {
                  if (D[J].getAttribute('name').toLowerCase() != 'movie') {
                    F[D[J].getAttribute('name')] = D[J].getAttribute('value')
                  }
                }
                AE(E, F, C, L)
              } else {
                Ae(I);
                if (L) {
                  L(A)
                }
              }
            }
          }
        } else {
          AX(C, true);
          if (L) {
            var B = AU(C);
            if (B && typeof B.SetVariable != AQ) {
              A.success = true;
              A.ref = B
            }
            L(A)
          }
        }
      }
    }
  }
  function AU(B) {
    var D = null;
    var C = Ar(B);
    if (C && C.nodeName == 'OBJECT') {
      if (typeof C.SetVariable != AQ) {
        D = C
      } else {
        var A = C.getElementsByTagName(Ac) [0];
        if (A) {
          D = A
        }
      }
    }
    return D
  }
  function AT() {
    return !At && AO('6.0.65') && (AH.win || AH.mac) && !(AH.wk && AH.wk < 312)
  }
  function AE(F, D, H, E) {
    At = true;
    AP = E || null;
    AS = {
      success: false,
      id: H
    };
    var A = Ar(H);
    if (A) {
      if (A.nodeName == 'OBJECT') {
        Ai = An(A);
        AD = null
      } else {
        Ai = A;
        AD = H
      }
      F.id = AC;
      if (typeof F.width == AQ || (!/%$/.test(F.width) && parseInt(F.width, 10) < 310)) {
        F.width = '310'
      }
      if (typeof F.height == AQ || (!/%$/.test(F.height) && parseInt(F.height, 10) < 137)) {
        F.height = '137'
      }
      Ak.title = Ak.title.slice(0, 47) + ' - Flash Player Installation';
      var B = AH.ie && AH.win ? 'ActiveX' : 'PlugIn',
      C = 'MMredirectURL=' + AF.location.toString().replace(/&/g, '%26') + '&MMplayerType=' + B + '&MMdoctitle=' + Ak.title;
      if (typeof D.flashvars != AQ) {
        D.flashvars += '&' + C
      } else {
        D.flashvars = C
      }
      if (AH.ie && AH.win && A.readyState != 4) {
        var G = AR('div');
        H += 'SWFObjectNew';
        G.setAttribute('id', H);
        A.parentNode.insertBefore(G, A);
        A.style.display = 'none';
        (function () {
          if (A.readyState == 4) {
            A.parentNode.removeChild(A)
          } else {
            setTimeout(arguments.callee, 10)
          }
        }) ()
      }
      AZ(F, D, H)
    }
  }
  function Ae(A) {
    if (AH.ie && AH.win && A.readyState != 4) {
      var B = AR('div');
      A.parentNode.insertBefore(B, A);
      B.parentNode.replaceChild(An(A), B);
      A.style.display = 'none';
      (function () {
        if (A.readyState == 4) {
          A.parentNode.removeChild(A)
        } else {
          setTimeout(arguments.callee, 10)
        }
      }) ()
    } else {
      A.parentNode.replaceChild(An(A), A)
    }
  }
  function An(B) {
    var D = AR('div');
    if (AH.win && AH.ie) {
      D.innerHTML = B.innerHTML
    } else {
      var E = B.getElementsByTagName(Ac) [0];
      if (E) {
        var A = E.childNodes;
        if (A) {
          var F = A.length;
          for (var C = 0; C < F; C++) {
            if (!(A[C].nodeType == 1 && A[C].nodeName == 'PARAM') && !(A[C].nodeType == 8)) {
              D.appendChild(A[C].cloneNode(true))
            }
          }
        }
      }
    }
    return D
  }
  function AZ(E, G, C) {
    var D,
    A = Ar(C);
    if (AH.wk && AH.wk < 312) {
      return D
    }
    if (A) {
      if (typeof E.id == AQ) {
        E.id = C
      }
      if (AH.ie && AH.win) {
        var F = '';
        for (var I in E) {
          if (E[I] != Object.prototype[I]) {
            if (I.toLowerCase() == 'data') {
              G.movie = E[I]
            } else {
              if (I.toLowerCase() == 'styleclass') {
                F += ' class="' + E[I] + '"'
              } else {
                if (I.toLowerCase() != 'classid') {
                  F += ' ' + I + '="' + E[I] + '"'
                }
              }
            }
          }
        }
        var H = '';
        for (var J in G) {
          if (G[J] != Object.prototype[J]) {
            H += '<param name="' + J + '" value="' + G[J] + '" />'
          }
        }
        A.outerHTML = '<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"' + F + '>' + H + '</object>';
        AG[AG.length] = E.id;
        D = Ar(E.id)
      } else {
        var B = AR(Ac);
        B.setAttribute('type', Ad);
        for (var K in E) {
          if (E[K] != Object.prototype[K]) {
            if (K.toLowerCase() == 'styleclass') {
              B.setAttribute('class', E[K])
            } else {
              if (K.toLowerCase() != 'classid') {
                B.setAttribute(K, E[K])
              }
            }
          }
        }
        for (var L in G) {
          if (G[L] != Object.prototype[L] && L.toLowerCase() != 'movie') {
            Ap(B, L, G[L])
          }
        }
        A.parentNode.replaceChild(B, A);
        D = B
      }
    }
    return D
  }
  function Ap(B, D, C) {
    var A = AR('param');
    A.setAttribute('name', D);
    A.setAttribute('value', C);
    B.appendChild(A)
  }
  function AV(A) {
    var B = Ar(A);
    if (B && B.nodeName == 'OBJECT') {
      if (AH.ie && AH.win) {
        B.style.display = 'none';
        (function () {
          if (B.readyState == 4) {
            As(A)
          } else {
            setTimeout(arguments.callee, 10)
          }
        }) ()
      } else {
        B.parentNode.removeChild(B)
      }
    }
  }
  function As(A) {
    var B = Ar(A);
    if (B) {
      for (var C in B) {
        if (typeof B[C] == 'function') {
          B[C] = null
        }
      }
      B.parentNode.removeChild(B)
    }
  }
  function Ar(A) {
    var C = null;
    try {
      C = Ak.getElementById(A)
    } catch (B) {
    }
    return C
  }
  function AR(A) {
    return Ak.createElement(A)
  }
  function Al(A, C, B) {
    A.attachEvent(C, B);
    AL[AL.length] = [
      A,
      C,
      B
    ]
  }
  function AO(A) {
    var B = AH.pv,
    C = A.split('.');
    C[0] = parseInt(C[0], 10);
    C[1] = parseInt(C[1], 10) || 0;
    C[2] = parseInt(C[2], 10) || 0;
    return (B[0] > C[0] || (B[0] == C[0] && B[1] > C[1]) || (B[0] == C[0] && B[1] == C[1] && B[2] >= C[2])) ? true : false
  }
  function AY(B, F, A, C) {
    if (AH.ie && AH.mac) {
      return
    }
    var E = Ak.getElementsByTagName('head') [0];
    if (!E) {
      return
    }
    var G = (A && typeof A == 'string') ? A : 'screen';
    if (C) {
      Ag = null;
      AN = null
    }
    if (!Ag || AN != G) {
      var D = AR('style');
      D.setAttribute('type', 'text/css');
      D.setAttribute('media', G);
      Ag = E.appendChild(D);
      if (AH.ie && AH.win && typeof Ak.styleSheets != AQ && Ak.styleSheets.length > 0) {
        Ag = Ak.styleSheets[Ak.styleSheets.length - 1]
      }
      AN = G
    }
    if (AH.ie && AH.win) {
      if (Ag && typeof Ag.addRule == Ac) {
        Ag.addRule(B, F)
      }
    } else {
      if (Ag && typeof Ak.createTextNode != AQ) {
        Ag.appendChild(Ak.createTextNode(B + ' {' + F + '}'))
      }
    }
  }
  function AX(A, C) {
    if (!Ah) {
      return
    }
    var B = C ? 'visible' : 'hidden';
    if (AK && Ar(A)) {
      Ar(A).style.visibility = B
    } else {
      AY('#' + A, 'visibility:' + B)
    }
  }
  function AI(B) {
    var A = /[\\\"<>\.;]/;
    var C = A.exec(B) != null;
    return C && typeof encodeURIComponent != AQ ? encodeURIComponent(B)  : B
  }
  var Aq = function () {
    if (AH.ie && AH.win) {
      window.attachEvent('onunload', function () {
        var A = AL.length;
        for (var B = 0; B < A; B++) {
          AL[B][0].detachEvent(AL[B][1], AL[B][2])
        }
        var D = AG.length;
        for (var C = 0; C < D; C++) {
          AV(AG[C])
        }
        for (var E in AH) {
          AH[E] = null
        }
        AH = null;
        for (var F in swfobject) {
          swfobject[F] = null
        }
        swfobject = null
      })
    }
  }();
  return {
    registerObject: function (A, E, C, B) {
      if (AH.w3 && A && E) {
        var D = {
        };
        D.id = A;
        D.swfVersion = E;
        D.expressInstall = C;
        D.callbackFn = B;
        Af[Af.length] = D;
        AX(A, false)
      } else {
        if (B) {
          B({
            success: false,
            id: A
          })
        }
      }
    },
    getObjectById: function (A) {
      if (AH.w3) {
        return AU(A)
      }
    },
    embedSWF: function (K, E, H, F, C, A, B, I, G, J) {
      var D = {
        success: false,
        id: E
      };
      if (AH.w3 && !(AH.wk && AH.wk < 312) && K && E && H && F && C) {
        AX(E, false);
        AJ(function () {
          H += '';
          F += '';
          var R = {
          };
          if (G && typeof G === Ac) {
            for (var O in G) {
              R[O] = G[O]
            }
          }
          R.data = K;
          R.width = H;
          R.height = F;
          var N = {
          };
          if (I && typeof I === Ac) {
            for (var P in I) {
              N[P] = I[P]
            }
          }
          if (B && typeof B === Ac) {
            for (var L in B) {
              if (typeof N.flashvars != AQ) {
                N.flashvars += '&' + L + '=' + B[L]
              } else {
                N.flashvars = L + '=' + B[L]
              }
            }
          }
          if (AO(C)) {
            var M = AZ(R, N, E);
            if (R.id == E) {
              AX(E, true)
            }
            D.success = true;
            D.ref = M
          } else {
            if (A && AT()) {
              R.data = A;
              AE(R, N, E, J);
              return
            } else {
              AX(E, true)
            }
          }
          if (J) {
            J(D)
          }
        })
      } else {
        if (J) {
          J(D)
        }
      }
    },
    switchOffAutoHideShow: function () {
      Ah = false
    },
    ua: AH,
    getFlashPlayerVersion: function () {
      return {
        major: AH.pv[0],
        minor: AH.pv[1],
        release: AH.pv[2]
      }
    },
    hasFlashPlayerVersion: AO,
    createSWF: function (A, B, C) {
      if (AH.w3) {
        return AZ(A, B, C)
      } else {
        return undefined
      }
    },
    showExpressInstall: function (B, A, D, C) {
      if (AH.w3 && AT()) {
        AE(B, A, D, C)
      }
    },
    removeSWF: function (A) {
      if (AH.w3) {
        AV(A)
      }
    },
    createCSS: function (B, A, C, D) {
      if (AH.w3) {
        AY(B, A, C, D)
      }
    },
    addDomLoadEvent: AJ,
    addLoadEvent: Ab,
    getQueryParamValue: function (B) {
      var A = Ak.location.search || Ak.location.hash;
      if (A) {
        if (/\?/.test(A)) {
          A = A.split('?') [1]
        }
        if (B == null) {
          return AI(A)
        }
        var C = A.split('&');
        for (var D = 0; D < C.length; D++) {
          if (C[D].substring(0, C[D].indexOf('=')) == B) {
            return AI(C[D].substring((C[D].indexOf('=') + 1)))
          }
        }
      }
      return ''
    },
    expressInstallCallback: function () {
      if (At) {
        var A = Ar(AC);
        if (A && Ai) {
          A.parentNode.replaceChild(Ai, A);
          if (AD) {
            AX(AD, true);
            if (AH.ie && AH.win) {
              Ai.style.display = 'block'
            }
          }
          if (AP) {
            AP(AS)
          }
        }
        At = false
      }
    }
  }
}(); FallbackWebSocketGenerator = function (B) {
  if (!B && window.WebSocket && !window.WEB_SOCKET_FORCE_FLASH) {
    return
  }
  FallbackWebSocketGenerator = null;
  var A;
  if (window.WEB_SOCKET_LOGGER) {
    A = WEB_SOCKET_LOGGER
  } else {
    if (window.console && window.console.log && window.console.error) {
      A = window.console
    } else {
      A = {
        log: function () {
        },
        error: function () {
        }
      }
    }
  }
  if (swfobject.getFlashPlayerVersion().major < 9) {
    A.error('Flash Player >= 9.0.0 is required.');
    return
  }
  if (location.protocol == 'file:') {
    A.error('WARNING: web-socket-js doesn\'t work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://...')
  }
  WebSocket = function (E, F, D, H, G) {
    var C = this;
    C.__id = WebSocket.__nextId++;
    WebSocket.__instances[C.__id] = C;
    C.readyState = WebSocket.CONNECTING;
    C.bufferedAmount = 0;
    C.__events = {
    };
    if (!F) {
      F = [
      ]
    } else {
      if (typeof F == 'string') {
        F = [
          F
        ]
      }
    }
    C.__createTask = setTimeout(function () {
      WebSocket.__addTask(function () {
        C.__createTask = null;
        WebSocket.__flash.create(C.__id, E, F, D || null, H || 0, G || null)
      })
    }, 0)
  };
  WebSocket.prototype.send = function (D) {
    if (this.readyState == WebSocket.CONNECTING) {
      console.log('INVALID_STATE_ERR: Web Socket connection has not been established');
      return false
    }
    var C = WebSocket.__flash.send(this.__id, encodeURIComponent(D));
    if (C < 0) {
      return true
    } else {
      this.bufferedAmount += C;
      return false
    }
  };
  WebSocket.prototype.close = function () {
    if (this.__createTask) {
      clearTimeout(this.__createTask);
      this.__createTask = null;
      this.readyState = WebSocket.CLOSED;
      return
    }
    if (this.readyState == WebSocket.CLOSED || this.readyState == WebSocket.CLOSING) {
      return
    }
    this.readyState = WebSocket.CLOSING;
    WebSocket.__flash.close(this.__id)
  };
  WebSocket.prototype.addEventListener = function (D, E, C) {
    if (!(D in this.__events)) {
      this.__events[D] = [
      ]
    }
    this.__events[D].push(E)
  };
  WebSocket.prototype.removeEventListener = function (F, G, C) {
    if (!(F in this.__events)) {
      return
    }
    var E = this.__events[F];
    for (var D = E.length - 1; D >= 0; --D) {
      if (E[D] === G) {
        E.splice(D, 1);
        break
      }
    }
  };
  WebSocket.prototype.dispatchEvent = function (F) {
    var D = this.__events[F.type] || [
    ];
    for (var C = 0; C < D.length; ++C) {
      D[C](F)
    }
    var E = this['on' + F.type];
    if (E) {
      E.apply(this, [
        F
      ])
    }
  };
  WebSocket.prototype.__handleEvent = function (E) {
    if ('readyState' in E) {
      this.readyState = E.readyState
    }
    if ('protocol' in E) {
      this.protocol = E.protocol
    }
    var C;
    if (E.type == 'open' || E.type == 'error') {
      C = this.__createSimpleEvent(E.type)
    } else {
      if (E.type == 'close') {
        C = this.__createSimpleEvent('close');
        C.wasClean = E.wasClean ? true : false;
        C.code = E.code;
        C.reason = E.reason
      } else {
        if (E.type == 'message') {
          var D = decodeURIComponent(E.message);
          C = this.__createMessageEvent('message', D)
        } else {
          throw 'unknown event type: ' + E.type
        }
      }
    }
    this.dispatchEvent(C)
  };
  WebSocket.prototype.__createSimpleEvent = function (C) {
    if (document.createEvent && window.Event) {
      var D = document.createEvent('Event');
      D.initEvent(C, false, false);
      return D
    } else {
      return {
        type: C,
        bubbles: false,
        cancelable: false
      }
    }
  };
  WebSocket.prototype.__createMessageEvent = function (C, E) {
    if (document.createEvent && window.MessageEvent && !window.opera) {
      var D = document.createEvent('MessageEvent');
      D.initMessageEvent('message', false, false, E, null, null, window, null);
      return D
    } else {
      return {
        type: C,
        data: E,
        bubbles: false,
        cancelable: false
      }
    }
  };
  WebSocket.CONNECTING = 0;
  WebSocket.OPEN = 1;
  WebSocket.CLOSING = 2;
  WebSocket.CLOSED = 3;
  WebSocket.__flash = null;
  WebSocket.__instances = {
  };
  WebSocket.__tasks = [
  ];
  WebSocket.__nextId = 0;
  WebSocket.loadFlashPolicyFile = function (C) {
    WebSocket.__addTask(function () {
      WebSocket.__flash.loadManualPolicyFile(C)
    })
  };
  WebSocket.__initialize = function () {
    if (WebSocket.__flash) {
      return
    }
    if (WebSocket.__swfLocation) {
      window.WEB_SOCKET_SWF_LOCATION = WebSocket.__swfLocation
    }
    var E = 0;
    var D = 40;
    var C = setInterval(function () {
      E += 1;
      if (E === D) {
        clearInterval(C);
        C = null;
        A.error('[WebSocket] timeout waiting for window.WEB_SOCKET_SWF_LOCATION to be set of WebSocketMain.swf');
        A.error('[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf');
        return
      }
      if (window.WEB_SOCKET_SWF_LOCATION) {
        clearInterval(C);
        C = null;
        if (!window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR && !WEB_SOCKET_SWF_LOCATION.match(/(^|\/)WebSocketMainInsecure\.swf(\?.*)?$/) && WEB_SOCKET_SWF_LOCATION.match(/^\w+:\/\/([^\/]+)/)) {
          var H = RegExp.$1;
          if (location.host != H) {
            A.error('[WebSocket] You must host HTML and WebSocketMain.swf in the same host (\'' + location.host + '\' != \'' + H + '\'). See also \'How to host HTML file and SWF file in different domains\' section in README.md. If you use WebSocketMainInsecure.swf, you can suppress this message by WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR = true;')
          }
        }
        var F = document.createElement('div');
        F.id = 'webSocketContainer';
        F.style.position = 'absolute';
        if (WebSocket.__isFlashLite()) {
          F.style.left = '0px';
          F.style.top = '0px'
        } else {
          F.style.left = '-100px';
          F.style.top = '-100px'
        }
        var G = document.createElement('div');
        G.id = 'webSocketFlash';
        F.appendChild(G);
        document.body.appendChild(F);
        swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION, 'webSocketFlash', '1', '1', '10.0.0', null, null, {
          hasPriority: true,
          swliveconnect: true,
          allowScriptAccess: 'always'
        }, null, function (I) {
          if (!I.success) {
            A.error('[WebSocket] swfobject.embedSWF failed')
          }
        })
      }
    }, 500)
  };
  WebSocket.__onFlashInitialized = function () {
    setTimeout(function () {
      WebSocket.__flash = document.getElementById('webSocketFlash');
      WebSocket.__flash.setCallerUrl(location.href);
      WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);
      for (var C = 0; C < WebSocket.__tasks.length; ++C) {
        WebSocket.__tasks[C]()
      }
      WebSocket.__tasks = [
      ]
    }, 0)
  };
  WebSocket.__onFlashEvent = function () {
    setTimeout(function () {
      try {
        var D = WebSocket.__flash.receiveEvents();
        for (var C = 0; C < D.length; ++C) {
          WebSocket.__instances[D[C].webSocketId].__handleEvent(D[C])
        }
      } catch (E) {
        A.error(E)
      }
    }, 0);
    return true
  };
  WebSocket.__log = function (C) {
    A.log(decodeURIComponent(C))
  };
  WebSocket.__error = function (C) {
    A.error(decodeURIComponent(C))
  };
  WebSocket.__addTask = function (C) {
    if (WebSocket.__flash) {
      C()
    } else {
      WebSocket.__tasks.push(C)
    }
  };
  WebSocket.__isFlashLite = function () {
    if (!window.navigator || !window.navigator.mimeTypes) {
      return false
    }
    var C = window.navigator.mimeTypes['application/x-shockwave-flash'];
    if (!C || !C.enabledPlugin || !C.enabledPlugin.filename) {
      return false
    }
    return C.enabledPlugin.filename.match(/flashlite/i) ? true : false
  };
  if (B) {
    WebSocket.__initialize()
  } else {
    if (!window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION) {
      if (window.addEventListener) {
        window.addEventListener('load', function () {
          WebSocket.__initialize()
        }, false)
      } else {
        window.attachEvent('onload', function () {
          WebSocket.__initialize()
        })
      }
    }
  }
}; if (document.readyState != 'loading') {
  FallbackWebSocketGenerator(true)
} else {
  FallbackWebSocketGenerator(false)
}
var Base64 = (function () {
  var A = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
  var B = {
    encode: function (E) {
      var C = '';
      var L,
      J,
      H;
      var K,
      I,
      G,
      F;
      var D = 0;
      do {
        L = E.charCodeAt(D++);
        J = E.charCodeAt(D++);
        H = E.charCodeAt(D++);
        K = L >> 2;
        I = ((L & 3) << 4) | (J >> 4);
        G = ((J & 15) << 2) | (H >> 6);
        F = H & 63;
        if (isNaN(J)) {
          G = F = 64
        } else {
          if (isNaN(H)) {
            F = 64
          }
        }
        C = C + A.charAt(K) + A.charAt(I) + A.charAt(G) + A.charAt(F)
      } while (D < E.length);
      return C
    },
    decode: function (E) {
      var C = '';
      var L,
      J,
      H;
      var K,
      I,
      G,
      F;
      var D = 0;
      E = E.replace(/[^A-Za-z0-9\+\/\=]/g, '');
      do {
        K = A.indexOf(E.charAt(D++));
        I = A.indexOf(E.charAt(D++));
        G = A.indexOf(E.charAt(D++));
        F = A.indexOf(E.charAt(D++));
        L = (K << 2) | (I >> 4);
        J = ((I & 15) << 4) | (G >> 2);
        H = ((G & 3) << 6) | F;
        C = C + String.fromCharCode(L);
        if (G != 64) {
          C = C + String.fromCharCode(J)
        }
        if (F != 64) {
          C = C + String.fromCharCode(H)
        }
      } while (D < E.length);
      return C
    }
  };
  return B
}) (); var hexcase = 0; var b64pad = '='; var chrsz = 8; function hex_sha1(A) {
  return binb2hex(core_sha1(str2binb(A), A.length * chrsz))
}
function b64_sha1(A) {
  return binb2b64(core_sha1(str2binb(A), A.length * chrsz))
}
function str_sha1(A) {
  return binb2str(core_sha1(str2binb(A), A.length * chrsz))
}
function hex_hmac_sha1(A, B) {
  return binb2hex(core_hmac_sha1(A, B))
}
function b64_hmac_sha1(A, B) {
  return binb2b64(core_hmac_sha1(A, B))
}
function str_hmac_sha1(A, B) {
  return binb2str(core_hmac_sha1(A, B))
}
function sha1_vm_test() {
  return hex_sha1('abc') == 'a9993e364706816aba3e25717850c26c9cd0d89d'
}
function core_sha1(N, H) {
  N[H >> 5] |= 128 << (24 - H % 32);
  N[((H + 64 >> 9) << 4) + 15] = H;
  var O = new Array(80);
  var M = 1732584193;
  var L = - 271733879;
  var K = - 1732584194;
  var J = 271733878;
  var I = - 1009589776;
  var E,
  C,
  P,
  G,
  F,
  D,
  B,
  A;
  for (E = 0; E < N.length; E += 16) {
    G = M;
    F = L;
    D = K;
    B = J;
    A = I;
    for (C = 0; C < 80; C++) {
      if (C < 16) {
        O[C] = N[E + C]
      } else {
        O[C] = rol(O[C - 3] ^ O[C - 8] ^ O[C - 14] ^ O[C - 16], 1)
      }
      P = safe_add(safe_add(rol(M, 5), sha1_ft(C, L, K, J)), safe_add(safe_add(I, O[C]), sha1_kt(C)));
      I = J;
      J = K;
      K = rol(L, 30);
      L = M;
      M = P
    }
    M = safe_add(M, G);
    L = safe_add(L, F);
    K = safe_add(K, D);
    J = safe_add(J, B);
    I = safe_add(I, A)
  }
  return [M,
  L,
  K,
  J,
  I]
}
function sha1_ft(B, A, D, C) {
  if (B < 20) {
    return (A & D) | ((~A) & C)
  }
  if (B < 40) {
    return A ^ D ^ C
  }
  if (B < 60) {
    return (A & D) | (A & C) | (D & C)
  }
  return A ^ D ^ C
}
function sha1_kt(A) {
  return (A < 20) ? 1518500249 : (A < 40) ? 1859775393 : (A < 60) ? - 1894007588 : - 899497514
}
function core_hmac_sha1(C, F) {
  var E = str2binb(C);
  if (E.length > 16) {
    E = core_sha1(E, C.length * chrsz)
  }
  var A = new Array(16),
  D = new Array(16);
  for (var B = 0; B < 16; B++) {
    A[B] = E[B] ^ 909522486;
    D[B] = E[B] ^ 1549556828
  }
  var G = core_sha1(A.concat(str2binb(F)), 512 + F.length * chrsz);
  return core_sha1(D.concat(G), 512 + 160)
}
function safe_add(A, D) {
  var C = (A & 65535) + (D & 65535);
  var B = (A >> 16) + (D >> 16) + (C >> 16);
  return (B << 16) | (C & 65535)
}
function rol(A, B) {
  return (A << B) | (A >>> (32 - B))
}
function str2binb(D) {
  var C = [
  ];
  var A = (1 << chrsz) - 1;
  for (var B = 0; B < D.length * chrsz; B += chrsz) {
    C[B >> 5] |= (D.charCodeAt(B / chrsz) & A) << (32 - chrsz - B % 32)
  }
  return C
}
function binb2str(C) {
  var D = '';
  var A = (1 << chrsz) - 1;
  for (var B = 0; B < C.length * 32; B += chrsz) {
    D += String.fromCharCode((C[B >> 5] >>> (32 - chrsz - B % 32)) & A)
  }
  return D
}
function binb2hex(C) {
  var B = hexcase ? '0123456789ABCDEF' : '0123456789abcdef';
  var D = '';
  for (var A = 0; A < C.length * 4; A++) {
    D += B.charAt((C[A >> 2] >> ((3 - A % 4) * 8 + 4)) & 15) + B.charAt((C[A >> 2] >> ((3 - A % 4) * 8)) & 15)
  }
  return D
}
function binb2b64(D) {
  var C = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';
  var F = '';
  var E,
  A;
  for (var B = 0; B < D.length * 4; B += 3) {
    E = (((D[B >> 2] >> 8 * (3 - B % 4)) & 255) << 16) | (((D[B + 1 >> 2] >> 8 * (3 - (B + 1) % 4)) & 255) << 8) | ((D[B + 2 >> 2] >> 8 * (3 - (B + 2) % 4)) & 255);
    for (A = 0; A < 4; A++) {
      if (B * 8 + A * 6 > D.length * 32) {
        F += b64pad
      } else {
        F += C.charAt((E >> 6 * (3 - A)) & 63)
      }
    }
  }
  return F
}
var MD5 = (function () {
  var O = 0;
  var A = '';
  var L = 8;
  var J = function (S, V) {
    var U = (S & 65535) + (V & 65535);
    var T = (S >> 16) + (V >> 16) + (U >> 16);
    return (T << 16) | (U & 65535)
  };
  var N = function (S, T) {
    return (S << T) | (S >>> (32 - T))
  };
  var B = function (V) {
    var U = [
    ];
    var S = (1 << L) - 1;
    for (var T = 0; T < V.length * L; T += L) {
      U[T >> 5] |= (V.charCodeAt(T / L) & S) << (T % 32)
    }
    return U
  };
  var G = function (U) {
    var V = '';
    var S = (1 << L) - 1;
    for (var T = 0; T < U.length * 32; T += L) {
      V += String.fromCharCode((U[T >> 5] >>> (T % 32)) & S)
    }
    return V
  };
  var R = function (U) {
    var T = O ? '0123456789ABCDEF' : '0123456789abcdef';
    var V = '';
    for (var S = 0; S < U.length * 4; S++) {
      V += T.charAt((U[S >> 2] >> ((S % 4) * 8 + 4)) & 15) + T.charAt((U[S >> 2] >> ((S % 4) * 8)) & 15)
    }
    return V
  };
  var P = function (V) {
    var U = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';
    var X = '';
    var W,
    S;
    for (var T = 0; T < V.length * 4; T += 3) {
      W = (((V[T >> 2] >> 8 * (T % 4)) & 255) << 16) | (((V[T + 1 >> 2] >> 8 * ((T + 1) % 4)) & 255) << 8) | ((V[T + 2 >> 2] >> 8 * ((T + 2) % 4)) & 255);
      for (S = 0; S < 4; S++) {
        if (T * 8 + S * 6 > V.length * 32) {
          X += A
        } else {
          X += U.charAt((W >> 6 * (3 - S)) & 63)
        }
      }
    }
    return X
  };
  var D = function (X, U, T, S, W, V) {
    return J(N(J(J(U, X), J(S, V)), W), T)
  };
  var K = function (U, T, Y, X, S, W, V) {
    return D((T & Y) | ((~T) & X), U, T, S, W, V)
  };
  var C = function (U, T, Y, X, S, W, V) {
    return D((T & X) | (Y & (~X)), U, T, S, W, V)
  };
  var M = function (U, T, Y, X, S, W, V) {
    return D(T ^ Y ^ X, U, T, S, W, V)
  };
  var I = function (U, T, Y, X, S, W, V) {
    return D(Y ^ (T | (~X)), U, T, S, W, V)
  };
  var F = function (g, X) {
    g[X >> 5] |= 128 << ((X) % 32);
    g[(((X + 64) >>> 9) << 4) + 14] = X;
    var f = 1732584193;
    var e = - 271733879;
    var Z = - 1732584194;
    var Y = 271733878;
    var W,
    V,
    U,
    S;
    for (var T = 0; T < g.length; T += 16) {
      W = f;
      V = e;
      U = Z;
      S = Y;
      f = K(f, e, Z, Y, g[T + 0], 7, - 680876936);
      Y = K(Y, f, e, Z, g[T + 1], 12, - 389564586);
      Z = K(Z, Y, f, e, g[T + 2], 17, 606105819);
      e = K(e, Z, Y, f, g[T + 3], 22, - 1044525330);
      f = K(f, e, Z, Y, g[T + 4], 7, - 176418897);
      Y = K(Y, f, e, Z, g[T + 5], 12, 1200080426);
      Z = K(Z, Y, f, e, g[T + 6], 17, - 1473231341);
      e = K(e, Z, Y, f, g[T + 7], 22, - 45705983);
      f = K(f, e, Z, Y, g[T + 8], 7, 1770035416);
      Y = K(Y, f, e, Z, g[T + 9], 12, - 1958414417);
      Z = K(Z, Y, f, e, g[T + 10], 17, - 42063);
      e = K(e, Z, Y, f, g[T + 11], 22, - 1990404162);
      f = K(f, e, Z, Y, g[T + 12], 7, 1804603682);
      Y = K(Y, f, e, Z, g[T + 13], 12, - 40341101);
      Z = K(Z, Y, f, e, g[T + 14], 17, - 1502002290);
      e = K(e, Z, Y, f, g[T + 15], 22, 1236535329);
      f = C(f, e, Z, Y, g[T + 1], 5, - 165796510);
      Y = C(Y, f, e, Z, g[T + 6], 9, - 1069501632);
      Z = C(Z, Y, f, e, g[T + 11], 14, 643717713);
      e = C(e, Z, Y, f, g[T + 0], 20, - 373897302);
      f = C(f, e, Z, Y, g[T + 5], 5, - 701558691);
      Y = C(Y, f, e, Z, g[T + 10], 9, 38016083);
      Z = C(Z, Y, f, e, g[T + 15], 14, - 660478335);
      e = C(e, Z, Y, f, g[T + 4], 20, - 405537848);
      f = C(f, e, Z, Y, g[T + 9], 5, 568446438);
      Y = C(Y, f, e, Z, g[T + 14], 9, - 1019803690);
      Z = C(Z, Y, f, e, g[T + 3], 14, - 187363961);
      e = C(e, Z, Y, f, g[T + 8], 20, 1163531501);
      f = C(f, e, Z, Y, g[T + 13], 5, - 1444681467);
      Y = C(Y, f, e, Z, g[T + 2], 9, - 51403784);
      Z = C(Z, Y, f, e, g[T + 7], 14, 1735328473);
      e = C(e, Z, Y, f, g[T + 12], 20, - 1926607734);
      f = M(f, e, Z, Y, g[T + 5], 4, - 378558);
      Y = M(Y, f, e, Z, g[T + 8], 11, - 2022574463);
      Z = M(Z, Y, f, e, g[T + 11], 16, 1839030562);
      e = M(e, Z, Y, f, g[T + 14], 23, - 35309556);
      f = M(f, e, Z, Y, g[T + 1], 4, - 1530992060);
      Y = M(Y, f, e, Z, g[T + 4], 11, 1272893353);
      Z = M(Z, Y, f, e, g[T + 7], 16, - 155497632);
      e = M(e, Z, Y, f, g[T + 10], 23, - 1094730640);
      f = M(f, e, Z, Y, g[T + 13], 4, 681279174);
      Y = M(Y, f, e, Z, g[T + 0], 11, - 358537222);
      Z = M(Z, Y, f, e, g[T + 3], 16, - 722521979);
      e = M(e, Z, Y, f, g[T + 6], 23, 76029189);
      f = M(f, e, Z, Y, g[T + 9], 4, - 640364487);
      Y = M(Y, f, e, Z, g[T + 12], 11, - 421815835);
      Z = M(Z, Y, f, e, g[T + 15], 16, 530742520);
      e = M(e, Z, Y, f, g[T + 2], 23, - 995338651);
      f = I(f, e, Z, Y, g[T + 0], 6, - 198630844);
      Y = I(Y, f, e, Z, g[T + 7], 10, 1126891415);
      Z = I(Z, Y, f, e, g[T + 14], 15, - 1416354905);
      e = I(e, Z, Y, f, g[T + 5], 21, - 57434055);
      f = I(f, e, Z, Y, g[T + 12], 6, 1700485571);
      Y = I(Y, f, e, Z, g[T + 3], 10, - 1894986606);
      Z = I(Z, Y, f, e, g[T + 10], 15, - 1051523);
      e = I(e, Z, Y, f, g[T + 1], 21, - 2054922799);
      f = I(f, e, Z, Y, g[T + 8], 6, 1873313359);
      Y = I(Y, f, e, Z, g[T + 15], 10, - 30611744);
      Z = I(Z, Y, f, e, g[T + 6], 15, - 1560198380);
      e = I(e, Z, Y, f, g[T + 13], 21, 1309151649);
      f = I(f, e, Z, Y, g[T + 4], 6, - 145523070);
      Y = I(Y, f, e, Z, g[T + 11], 10, - 1120210379);
      Z = I(Z, Y, f, e, g[T + 2], 15, 718787259);
      e = I(e, Z, Y, f, g[T + 9], 21, - 343485551);
      f = J(f, W);
      e = J(e, V);
      Z = J(Z, U);
      Y = J(Y, S)
    }
    return [f,
    e,
    Z,
    Y]
  };
  var E = function (U, X) {
    var W = B(U);
    if (W.length > 16) {
      W = F(W, U.length * L)
    }
    var S = new Array(16),
    V = new Array(16);
    for (var T = 0; T < 16; T++) {
      S[T] = W[T] ^ 909522486;
      V[T] = W[T] ^ 1549556828
    }
    var Y = F(S.concat(B(X)), 512 + X.length * L);
    return F(V.concat(Y), 512 + 128)
  };
  var H = {
    hexdigest: function (S) {
      return R(F(B(S), S.length * L))
    },
    b64digest: function (S) {
      return P(F(B(S), S.length * L))
    },
    hash: function (S) {
      return G(F(B(S), S.length * L))
    },
    hmac_hexdigest: function (S, T) {
      return R(E(S, T))
    },
    hmac_b64digest: function (S, T) {
      return P(E(S, T))
    },
    hmac_hash: function (S, T) {
      return G(E(S, T))
    },
    test: function () {
      return MD5.hexdigest('abc') === '900150983cd24fb0d6963f7d28e17f72'
    }
  };
  return H
}) (); Function.prototype.bind = function (E) {
  var D = this;
  var C = Array.prototype.slice;
  var B = Array.prototype.concat;
  var A = C.call(arguments, 1);
  return function () {
    return D.apply(E ? E : this, B.call(A, C.call(arguments, 0)))
  }
}; if (!Array.prototype.indexOf) {
  Array.prototype.indexOf = function (B) {
    var A = this.length;
    var C = Number(arguments[1]) || 0;
    C = (C < 0) ? Math.ceil(C)  : Math.floor(C);
    if (C < 0) {
      C += A
    }
    for (; C < A; C++) {
      if (C in this && this[C] === B) {
        return C
      }
    }
    return - 1
  }
}(function (F) {
  var E;
  function C(H, G) {
    return new E.Builder(H, G)
  }
  function A(G) {
    return new E.Builder('message', G)
  }
  function D(G) {
    return new E.Builder('iq', G)
  }
  function B(G) {
    return new E.Builder('presence', G)
  }
  E = {
    VERSION: 'e9eced8',
    NS: {
      HTTPBIND: 'http://jabber.org/protocol/httpbind',
      BOSH: 'urn:xmpp:xbosh',
      CLIENT: 'jabber:client',
      AUTH: 'jabber:iq:auth',
      ROSTER: 'jabber:iq:roster',
      PROFILE: 'jabber:iq:profile',
      DISCO_INFO: 'http://jabber.org/protocol/disco#info',
      DISCO_ITEMS: 'http://jabber.org/protocol/disco#items',
      MUC: 'http://jabber.org/protocol/muc',
      SASL: 'urn:ietf:params:xml:ns:xmpp-sasl',
      STREAM: 'http://etherx.jabber.org/streams',
      BIND: 'urn:ietf:params:xml:ns:xmpp-bind',
      SESSION: 'urn:ietf:params:xml:ns:xmpp-session',
      VERSION: 'jabber:iq:version',
      STANZAS: 'urn:ietf:params:xml:ns:xmpp-stanzas',
      XHTML_IM: 'http://jabber.org/protocol/xhtml-im',
      XHTML: 'http://www.w3.org/1999/xhtml'
    },
    XHTML: {
      tags: [
        'a',
        'blockquote',
        'br',
        'cite',
        'em',
        'img',
        'li',
        'ol',
        'p',
        'span',
        'strong',
        'ul',
        'body'
      ],
      attributes: {
        a: [
          'href'
        ],
        blockquote: [
          'style'
        ],
        br: [
        ],
        cite: [
          'style'
        ],
        em: [
        ],
        img: [
          'src',
          'alt',
          'style',
          'height',
          'width'
        ],
        li: [
          'style'
        ],
        ol: [
          'style'
        ],
        p: [
          'style'
        ],
        span: [
          'style'
        ],
        strong: [
        ],
        ul: [
          'style'
        ],
        body: [
        ]
      },
      css: [
        'background-color',
        'color',
        'font-family',
        'font-size',
        'font-style',
        'font-weight',
        'margin-left',
        'margin-right',
        'text-align',
        'text-decoration'
      ],
      validTag: function (G) {
        for (var H = 0; H < E.XHTML.tags.length; H++) {
          if (G == E.XHTML.tags[H]) {
            return true
          }
        }
        return false
      },
      validAttribute: function (G, I) {
        if (typeof E.XHTML.attributes[G] !== 'undefined' && E.XHTML.attributes[G].length > 0) {
          for (var H = 0; H < E.XHTML.attributes[G].length; H++) {
            if (I == E.XHTML.attributes[G][H]) {
              return true
            }
          }
        }
        return false
      },
      validCSS: function (H) {
        for (var G = 0; G < E.XHTML.css.length; G++) {
          if (H == E.XHTML.css[G]) {
            return true
          }
        }
        return false
      }
    },
    addNamespace: function (G, H) {
      E.NS[G] = H
    },
    Status: {
      ERROR: 0,
      CONNECTING: 1,
      CONNFAIL: 2,
      AUTHENTICATING: 3,
      AUTHFAIL: 4,
      CONNECTED: 5,
      DISCONNECTED: 6,
      DISCONNECTING: 7,
      ATTACHED: 8
    },
    LogLevel: {
      DEBUG: 0,
      INFO: 1,
      WARN: 2,
      ERROR: 3,
      FATAL: 4
    },
    ElementType: {
      NORMAL: 1,
      TEXT: 3,
      CDATA: 4,
      FRAGMENT: 11
    },
    TIMEOUT: 1.1,
    SECONDARY_TIMEOUT: 0.1,
    forEachChild: function (J, K, I) {
      var H,
      G;
      for (H = 0; H < J.childNodes.length; H++) {
        G = J.childNodes[H];
        if (G.nodeType == E.ElementType.NORMAL && (!K || this.isTagEqual(G, K))) {
          I(G)
        }
      }
    },
    isTagEqual: function (H, G) {
      return H.tagName.toLowerCase() == G.toLowerCase()
    },
    _xmlGenerator: null,
    _makeGenerator: function () {
      var G;
      if (document.implementation.createDocument === undefined || document.implementation.createDocument && document.documentMode && document.documentMode < 10) {
        G = this._getIEXmlDom();
        G.appendChild(G.createElement('strophe'))
      } else {
        G = document.implementation.createDocument('jabber:client', 'strophe', null)
      }
      return G
    },
    xmlGenerator: function () {
      if (!E._xmlGenerator) {
        E._xmlGenerator = E._makeGenerator()
      }
      return E._xmlGenerator
    },
    _getIEXmlDom: function () {
      var H = null;
      var J = [
        'Msxml2.DOMDocument.6.0',
        'Msxml2.DOMDocument.5.0',
        'Msxml2.DOMDocument.4.0',
        'MSXML2.DOMDocument.3.0',
        'MSXML2.DOMDocument',
        'MSXML.DOMDocument',
        'Microsoft.XMLDOM'
      ];
      for (var I = 0; I < J.length; I++) {
        if (H === null) {
          try {
            H = new ActiveXObject(J[I])
          } catch (G) {
            H = null
          }
        } else {
          break
        }
      }
      return H
    },
    xmlElement: function (I) {
      if (!I) {
        return null
      }
      var K = E.xmlGenerator().createElement(I);
      var G,
      J,
      H;
      for (G = 1; G < arguments.length; G++) {
        if (!arguments[G]) {
          continue
        }
        if (typeof (arguments[G]) == 'string' || typeof (arguments[G]) == 'number') {
          K.appendChild(E.xmlTextNode(arguments[G]))
        } else {
          if (typeof (arguments[G]) == 'object' && typeof (arguments[G].sort) == 'function') {
            for (J = 0; J < arguments[G].length; J++) {
              if (typeof (arguments[G][J]) == 'object' && typeof (arguments[G][J].sort) == 'function') {
                K.setAttribute(arguments[G][J][0], arguments[G][J][1])
              }
            }
          } else {
            if (typeof (arguments[G]) == 'object') {
              for (H in arguments[G]) {
                if (arguments[G].hasOwnProperty(H)) {
                  K.setAttribute(H, arguments[G][H])
                }
              }
            }
          }
        }
      }
      return K
    },
    xmlescape: function (G) {
      G = G.replace(/\&/g, '&amp;');
      G = G.replace(/</g, '&lt;');
      G = G.replace(/>/g, '&gt;');
      G = G.replace(/'/g, '&apos;');
      G = G.replace(/"/g, '&quot;');
      return G
    },
    xmlTextNode: function (G) {
      return E.xmlGenerator().createTextNode(G)
    },
    xmlHtmlNode: function (G) {
      if (window.DOMParser) {
        parser = new DOMParser();
        node = parser.parseFromString(G, 'text/xml')
      } else {
        node = new ActiveXObject('Microsoft.XMLDOM');
        node.async = 'false';
        node.loadXML(G)
      }
      return node
    },
    getText: function (H) {
      if (!H) {
        return null
      }
      var I = '';
      if (H.childNodes.length === 0 && H.nodeType == E.ElementType.TEXT) {
        I += H.nodeValue
      }
      for (var G = 0; G < H.childNodes.length; G++) {
        if (H.childNodes[G].nodeType == E.ElementType.TEXT) {
          I += H.childNodes[G].nodeValue
        }
      }
      return E.xmlescape(I)
    },
    copyElement: function (I) {
      var G,
      H;
      if (I.nodeType == E.ElementType.NORMAL) {
        H = E.xmlElement(I.tagName);
        for (G = 0; G < I.attributes.length; G++) {
          H.setAttribute(I.attributes[G].nodeName.toLowerCase(), I.attributes[G].value)
        }
        for (G = 0; G < I.childNodes.length; G++) {
          H.appendChild(E.copyElement(I.childNodes[G]))
        }
      } else {
        if (I.nodeType == E.ElementType.TEXT) {
          H = E.xmlGenerator().createTextNode(I.nodeValue)
        }
      }
      return H
    },
    createHtml: function (K) {
      var N,
      J,
      L,
      V,
      I,
      U,
      P,
      R,
      T,
      M,
      O,
      H,
      G;
      if (K.nodeType == E.ElementType.NORMAL) {
        V = K.nodeName.toLowerCase();
        if (E.XHTML.validTag(V)) {
          try {
            J = E.xmlElement(V);
            for (N = 0; N < E.XHTML.attributes[V].length; N++) {
              I = E.XHTML.attributes[V][N];
              U = K.getAttribute(I);
              if (typeof U == 'undefined' || U === null || U === '' || U === false || U === 0) {
                continue
              }
              if (I == 'style' && typeof U == 'object') {
                if (typeof U.cssText != 'undefined') {
                  U = U.cssText
                }
              }
              if (I == 'style') {
                P = [
                ];
                R = U.split(';');
                for (L = 0; L < R.length; L++) {
                  T = R[L].split(':');
                  M = T[0].replace(/^\s*/, '').replace(/\s*$/, '').toLowerCase();
                  if (E.XHTML.validCSS(M)) {
                    O = T[1].replace(/^\s*/, '').replace(/\s*$/, '');
                    P.push(M + ': ' + O)
                  }
                }
                if (P.length > 0) {
                  U = P.join('; ');
                  J.setAttribute(I, U)
                }
              } else {
                J.setAttribute(I, U)
              }
            }
            for (N = 0; N < K.childNodes.length; N++) {
              J.appendChild(E.createHtml(K.childNodes[N]))
            }
          } catch (S) {
            J = E.xmlTextNode('')
          }
        } else {
          J = E.xmlGenerator().createDocumentFragment();
          for (N = 0; N < K.childNodes.length; N++) {
            J.appendChild(E.createHtml(K.childNodes[N]))
          }
        }
      } else {
        if (K.nodeType == E.ElementType.FRAGMENT) {
          J = E.xmlGenerator().createDocumentFragment();
          for (N = 0; N < K.childNodes.length; N++) {
            J.appendChild(E.createHtml(K.childNodes[N]))
          }
        } else {
          if (K.nodeType == E.ElementType.TEXT) {
            J = E.xmlTextNode(K.nodeValue)
          }
        }
      }
      return J
    },
    escapeNode: function (G) {
      return G.replace(/^\s+|\s+$/g, '').replace(/\\/g, '\\5c').replace(/ /g, '\\20').replace(/\"/g, '\\22').replace(/\&/g, '\\26').replace(/\'/g, '\\27').replace(/\//g, '\\2f').replace(/:/g, '\\3a').replace(/</g, '\\3c').replace(/>/g, '\\3e').replace(/@/g, '\\40')
    },
    unescapeNode: function (G) {
      return G.replace(/\\20/g, ' ').replace(/\\22/g, '"').replace(/\\26/g, '&').replace(/\\27/g, '\'').replace(/\\2f/g, '/').replace(/\\3a/g, ':').replace(/\\3c/g, '<').replace(/\\3e/g, '>').replace(/\\40/g, '@').replace(/\\5c/g, '\\')
    },
    getNodeFromJid: function (G) {
      if (G.indexOf('@') < 0) {
        return null
      }
      return G.split('@') [0]
    },
    getDomainFromJid: function (G) {
      var H = E.getBareJidFromJid(G);
      if (H.indexOf('@') < 0) {
        return H
      } else {
        var I = H.split('@');
        I.splice(0, 1);
        return I.join('@')
      }
    },
    getResourceFromJid: function (G) {
      var H = G.split('/');
      if (H.length < 2) {
        return null
      }
      H.splice(0, 1);
      return H.join('/')
    },
    getBareJidFromJid: function (G) {
      return G ? G.split('/') [0] : null
    },
    log: function (H, G) {
      return
    },
    debug: function (G) {
      this.log(this.LogLevel.DEBUG, G)
    },
    info: function (G) {
      this.log(this.LogLevel.INFO, G)
    },
    warn: function (G) {
      this.log(this.LogLevel.WARN, G)
    },
    error: function (G) {
      this.log(this.LogLevel.ERROR, G)
    },
    fatal: function (G) {
      this.log(this.LogLevel.FATAL, G)
    },
    serialize: function (I) {
      var G;
      if (!I) {
        return null
      }
      if (typeof (I.tree) === 'function') {
        I = I.tree()
      }
      var K = I.nodeName;
      var H,
      J;
      if (I.getAttribute('_realname')) {
        K = I.getAttribute('_realname')
      }
      G = '<' + K;
      for (H = 0; H < I.attributes.length; H++) {
        if (I.attributes[H].nodeName != '_realname') {
          G += ' ' + I.attributes[H].nodeName.toLowerCase() + '=\'' + I.attributes[H].value.replace(/&/g, '&amp;').replace(/\'/g, '&apos;').replace(/>/g, '&gt;').replace(/</g, '&lt;') + '\''
        }
      }
      if (I.childNodes.length > 0) {
        G += '>';
        for (H = 0; H < I.childNodes.length; H++) {
          J = I.childNodes[H];
          switch (J.nodeType) {
            case E.ElementType.NORMAL:
              G += E.serialize(J);
              break;
            case E.ElementType.TEXT:
              G += E.xmlescape(J.nodeValue);
              break;
            case E.ElementType.CDATA:
              G += '<![CDATA[' + J.nodeValue + ']]>'
          }
        }
        G += '</' + K + '>'
      } else {
        G += '/>'
      }
      return G
    },
    _requestId: 0,
    _connectionPlugins: {
    },
    addConnectionPlugin: function (G, H) {
      E._connectionPlugins[G] = H
    }
  };
  E.Builder = function (H, G) {
    if (H == 'presence' || H == 'message' || H == 'iq') {
      if (G && !G.xmlns) {
        G.xmlns = E.NS.CLIENT
      } else {
        if (!G) {
          G = {
            xmlns: E.NS.CLIENT
          }
        }
      }
    }
    this.nodeTree = E.xmlElement(H, G);
    this.node = this.nodeTree
  };
  E.Builder.prototype = {
    tree: function () {
      return this.nodeTree
    },
    toString: function () {
      return E.serialize(this.nodeTree)
    },
    up: function () {
      this.node = this.node.parentNode;
      return this
    },
    attrs: function (H) {
      for (var G in H) {
        if (H.hasOwnProperty(G)) {
          this.node.setAttribute(G, H[G])
        }
      }
      return this
    },
    c: function (H, G, I) {
      var J = E.xmlElement(H, G, I);
      this.node.appendChild(J);
      if (!I) {
        this.node = J
      }
      return this
    },
    cnode: function (I) {
      var K = E.xmlGenerator();
      try {
        var H = (K.importNode !== undefined)
      } catch (J) {
        var H = false
      }
      var G = H ? K.importNode(I, true)  : E.copyElement(I);
      this.node.appendChild(G);
      this.node = G;
      return this
    },
    t: function (G) {
      var H = E.xmlTextNode(G);
      this.node.appendChild(H);
      return this
    },
    h: function (H) {
      var G = document.createElement('body');
      G.innerHTML = H;
      var I = E.createHtml(G);
      while (I.childNodes.length > 0) {
        this.node.appendChild(I.childNodes[0])
      }
      return this
    }
  };
  E.Handler = function (K, J, H, I, M, L, G) {
    this.handler = K;
    this.ns = J;
    this.name = H;
    this.type = I;
    this.id = M;
    this.options = G || {
      matchbare: false
    };
    if (!this.options.matchBare) {
      this.options.matchBare = false
    }
    if (this.options.matchBare) {
      this.from = L ? E.getBareJidFromJid(L)  : null
    } else {
      this.from = L
    }
    this.user = true
  };
  E.Handler.prototype = {
    isMatch: function (H) {
      var J;
      var I = null;
      if (this.options.matchBare) {
        I = E.getBareJidFromJid(H.getAttribute('from'))
      } else {
        I = H.getAttribute('from')
      }
      J = false;
      if (!this.ns) {
        J = true
      } else {
        var G = this;
        E.forEachChild(H, null, function (K) {
          if (K.getAttribute('xmlns') == G.ns) {
            J = true
          }
        });
        J = J || H.getAttribute('xmlns') == this.ns
      }
      if (J && (!this.name || E.isTagEqual(H, this.name)) && (!this.type || H.getAttribute('type') == this.type) && (!this.id || H.getAttribute('id') == this.id) && (!this.from || I == this.from)) {
        return true
      }
      return false
    },
    run: function (H) {
      var G = null;
      try {
        G = this.handler(H)
      } catch (I) {
        if (I.sourceURL) {
          E.fatal('error: ' + this.handler + ' ' + I.sourceURL + ':' + I.line + ' - ' + I.name + ': ' + I.message)
        } else {
          if (I.fileName) {
            if (typeof (console) != 'undefined') {
              console.trace();
              console.error(this.handler, ' - error - ', I, I.message)
            }
            E.fatal('error: ' + this.handler + ' ' + I.fileName + ':' + I.lineNumber + ' - ' + I.name + ': ' + I.message)
          } else {
            E.fatal('error: ' + I.message + '\n' + I.stack)
          }
        }
        throw I
      }
      return G
    },
    toString: function () {
      return '{Handler: ' + this.handler + '(' + this.name + ',' + this.id + ',' + this.ns + ')}'
    }
  };
  E.TimedHandler = function (H, G) {
    this.period = H;
    this.handler = G;
    this.lastCalled = new Date().getTime();
    this.user = true
  };
  E.TimedHandler.prototype = {
    run: function () {
      this.lastCalled = new Date().getTime();
      return this.handler()
    },
    reset: function () {
      this.lastCalled = new Date().getTime()
    },
    toString: function () {
      return '{TimedHandler: ' + this.handler + '(' + this.period + ')}'
    }
  };
  E.Request = function (I, H, G, J) {
    this.id = ++E._requestId;
    this.xmlData = I;
    this.data = E.serialize(I);
    this.origFunc = H;
    this.func = H;
    this.rid = G;
    this.date = NaN;
    this.sends = J || 0;
    this.abort = false;
    this.dead = null;
    this.age = function () {
      if (!this.date) {
        return 0
      }
      var K = new Date();
      return (K - this.date) / 1000
    };
    this.timeDead = function () {
      if (!this.dead) {
        return 0
      }
      var K = new Date();
      return (K - this.dead) / 1000
    };
    this.xhr = this._newXHR()
  };
  E.Request.prototype = {
    getResponse: function () {
      var G = null;
      if (this.xhr.responseXML && this.xhr.responseXML.documentElement) {
        G = this.xhr.responseXML.documentElement;
        if (G.tagName == 'parsererror') {
          E.error('invalid response received');
          E.error('responseText: ' + this.xhr.responseText);
          E.error('responseXML: ' + E.serialize(this.xhr.responseXML));
          throw 'parsererror'
        }
      } else {
        if (this.xhr.responseText) {
          E.error('invalid response received');
          E.error('responseText: ' + this.xhr.responseText);
          E.error('responseXML: ' + E.serialize(this.xhr.responseXML))
        }
      }
      return G
    },
    _newXHR: function () {
      var G = null;
      if (window.XMLHttpRequest) {
        G = new XMLHttpRequest();
        if (G.overrideMimeType) {
          G.overrideMimeType('text/xml')
        }
      } else {
        if (window.ActiveXObject) {
          G = new ActiveXObject('Microsoft.XMLHTTP')
        }
      }
      G.onreadystatechange = this.func.bind(null, this);
      return G
    }
  };
  E.Connection = function (G) {
    this.service = G;
    this.jid = '';
    this.domain = null;
    this.rid = Math.floor(Math.random() * 4294967295);
    this.sid = null;
    this.streamId = null;
    this.features = null;
    this._sasl_data = [
    ];
    this.do_session = false;
    this.do_bind = false;
    this.timedHandlers = [
    ];
    this.handlers = [
    ];
    this.removeTimeds = [
    ];
    this.removeHandlers = [
    ];
    this.addTimeds = [
    ];
    this.addHandlers = [
    ];
    this._authentication = {
    };
    this._idleTimeout = null;
    this._disconnectTimeout = null;
    this.do_authentication = true;
    this.authenticated = false;
    this.disconnecting = false;
    this.connected = false;
    this.errors = 0;
    this.paused = false;
    this.hold = 1;
    this.wait = 60;
    this.window = 5;
    this._data = [
    ];
    this._requests = [
    ];
    this._uniqueId = Math.round(Math.random() * 10000);
    this._sasl_success_handler = null;
    this._sasl_failure_handler = null;
    this._sasl_challenge_handler = null;
    this.maxRetries = 5;
    this._idleTimeout = setTimeout(this._onIdle.bind(this), 100);
    for (var H in E._connectionPlugins) {
      if (E._connectionPlugins.hasOwnProperty(H)) {
        var J = E._connectionPlugins[H];
        var I = function () {
        };
        I.prototype = J;
        this[H] = new I();
        this[H].init(this)
      }
    }
  };
  E.Connection.prototype = {
    reset: function () {
      this.rid = Math.floor(Math.random() * 4294967295);
      this.sid = null;
      this.streamId = null;
      this.do_session = false;
      this.do_bind = false;
      this.timedHandlers = [
      ];
      this.handlers = [
      ];
      this.removeTimeds = [
      ];
      this.removeHandlers = [
      ];
      this.addTimeds = [
      ];
      this.addHandlers = [
      ];
      this._authentication = {
      };
      this.authenticated = false;
      this.disconnecting = false;
      this.connected = false;
      this.errors = 0;
      this._requests = [
      ];
      this._uniqueId = Math.round(Math.random() * 10000)
    },
    pause: function () {
      this.paused = true
    },
    resume: function () {
      this.paused = false
    },
    getUniqueId: function (G) {
      if (typeof (G) == 'string' || typeof (G) == 'number') {
        return ++this._uniqueId + ':' + G
      } else {
        return ++this._uniqueId + ''
      }
    },
    connect: function (I, K, N, M, L, H) {
      this.jid = I;
      this.pass = K;
      this.connect_callback = N;
      this.disconnecting = false;
      this.connected = false;
      this.authenticated = false;
      this.errors = 0;
      this.wait = M || this.wait;
      this.hold = L || this.hold;
      this.domain = this.domain || E.getDomainFromJid(this.jid);
      var G = this._buildBody().attrs({
        to: this.domain,
        'xml:lang': 'en',
        wait: this.wait,
        hold: this.hold,
        content: 'text/xml; charset=utf-8',
        ver: '1.6',
        'xmpp:version': '1.0',
        'xmlns:xmpp': E.NS.BOSH
      });
      if (H) {
        G.attrs({
          route: H
        })
      }
      this._changeConnectStatus(E.Status.CONNECTING, null);
      var J = this._connect_callback || this._connect_cb;
      this._connect_callback = null;
      this._requests.push(new E.Request(G.tree(), this._onRequestStateChange.bind(this, J.bind(this)), G.tree().getAttribute('rid')));
      this._throttledRequestHandler()
    },
    freeze: function () {
      if (this.connected) {
        this.pause();
        return ['xhr',
        this.jid,
        this.sid,
        this.rid,
        this.wait,
        this.hold,
        this.window].join('\n')
      } else {
        return ''
      }
    },
    thaw: function (G, I) {
      if (!G) {
        I(E.Status.CONNFAILED)
      } else {
        var H = G.split('\n');
        if (H[0] != 'xhr') {
          I(E.Status.CONNFAILED)
        }
        this.attach(H[1], H[2], H[3], I, H[4], H[5], H[6])
      }
    },
    attach: function (I, G, J, M, L, K, H) {
      this.jid = I;
      this.sid = G;
      this.rid = J;
      this.connect_callback = M;
      this.domain = E.getDomainFromJid(this.jid);
      this.authenticated = true;
      this.connected = true;
      this.wait = L || this.wait;
      this.hold = K || this.hold;
      this.window = H || this.window;
      this._changeConnectStatus(E.Status.ATTACHED, null)
    },
    xmlInput: function (G) {
      return
    },
    xmlOutput: function (G) {
      return
    },
    rawInput: function (G) {
      return
    },
    rawOutput: function (G) {
      return
    },
    send: function (H) {
      if (H === null) {
        return
      }
      if (typeof (H.sort) === 'function') {
        for (var G = 0; G < H.length; G++) {
          this._queueData(H[G])
        }
      } else {
        if (typeof (H.tree) === 'function') {
          this._queueData(H.tree())
        } else {
          this._queueData(H)
        }
      }
      this._throttledRequestHandler();
      clearTimeout(this._idleTimeout);
      this._idleTimeout = setTimeout(this._onIdle.bind(this), 100)
    },
    flush: function () {
      clearTimeout(this._idleTimeout);
      this._onIdle()
    },
    sendIQ: function (J, N, G, K) {
      var L = null;
      var I = this;
      if (typeof (J.tree) === 'function') {
        J = J.tree()
      }
      var M = J.getAttribute('id');
      if (!M) {
        M = this.getUniqueId('sendIQ');
        J.setAttribute('id', M)
      }
      var H = this.addHandler(function (P) {
        if (L) {
          I.deleteTimedHandler(L)
        }
        var O = P.getAttribute('type');
        if (O == 'result') {
          if (N) {
            N(P)
          }
        } else {
          if (O == 'error') {
            if (G) {
              G(P)
            }
          } else {
            throw {
              name: 'StropheError',
              message: 'Got bad IQ type of ' + O
            }
          }
        }
      }, null, 'iq', null, M);
      if (K) {
        L = this.addTimedHandler(K, function () {
          I.deleteHandler(H);
          if (G) {
            G(null)
          }
          return false
        })
      }
      this.send(J);
      return M
    },
    _queueData: function (G) {
      if (G === null || !G.tagName || !G.childNodes) {
        throw {
          name: 'StropheError',
          message: 'Cannot queue non-DOMElement.'
        }
      }
      this._data.push(G)
    },
    _sendRestart: function () {
      this._data.push('restart');
      this._throttledRequestHandler();
      clearTimeout(this._idleTimeout);
      this._idleTimeout = setTimeout(this._onIdle.bind(this), 100)
    },
    addTimedHandler: function (I, H) {
      var G = new E.TimedHandler(I, H);
      this.addTimeds.push(G);
      return G
    },
    deleteTimedHandler: function (G) {
      this.removeTimeds.push(G)
    },
    addHandler: function (L, K, I, J, N, M, H) {
      var G = new E.Handler(L, K, I, J, N, M, H);
      this.addHandlers.push(G);
      return G
    },
    deleteHandler: function (G) {
      this.removeHandlers.push(G)
    },
    disconnect: function (G) {
      this._changeConnectStatus(E.Status.DISCONNECTING, G);
      E.info('Disconnect was called because: ' + G);
      if (this.connected) {
        this._disconnectTimeout = this._addSysTimedHandler(3000, this._onDisconnectTimeout.bind(this));
        this._sendTerminate()
      }
    },
    _changeConnectStatus: function (G, L) {
      for (var H in E._connectionPlugins) {
        if (E._connectionPlugins.hasOwnProperty(H)) {
          var J = this[H];
          if (J.statusChanged) {
            try {
              J.statusChanged(G, L)
            } catch (I) {
              E.error('' + H + ' plugin caused an exception changing status: ' + I)
            }
          }
        }
      }
      if (this.connect_callback) {
        try {
          this.connect_callback(G, L)
        } catch (K) {
          E.error('User connection callback caused an exception: ' + K)
        }
      }
    },
    _buildBody: function () {
      var G = C('body', {
        rid: this.rid++,
        xmlns: E.NS.HTTPBIND
      });
      if (this.sid !== null) {
        G.attrs({
          sid: this.sid
        })
      }
      return G
    },
    _removeRequest: function (H) {
      E.debug('removing request');
      var G;
      for (G = this._requests.length - 1; G >= 0; G--) {
        if (H == this._requests[G]) {
          this._requests.splice(G, 1)
        }
      }
      H.xhr.onreadystatechange = function () {
      };
      this._throttledRequestHandler()
    },
    _restartRequest: function (G) {
      var H = this._requests[G];
      if (H.dead === null) {
        H.dead = new Date()
      }
      this._processRequest(G)
    },
    _processRequest: function (I) {
      var N = this._requests[I];
      var R = - 1;
      try {
        if (N.xhr.readyState == 4) {
          R = N.xhr.status
        }
      } catch (L) {
        E.error('caught an error in _requests[' + I + '], reqStatus: ' + R)
      }
      if (typeof (R) == 'undefined') {
        R = - 1
      }
      if (N.sends > this.maxRetries) {
        this._onDisconnectTimeout();
        return
      }
      var H = N.age();
      var G = (!isNaN(H) && H > Math.floor(E.TIMEOUT * this.wait));
      var J = (N.dead !== null && N.timeDead() > Math.floor(E.SECONDARY_TIMEOUT * this.wait));
      var P = (N.xhr.readyState == 4 && (R < 1 || R >= 500));
      if (G || J || P) {
        if (J) {
          E.error('Request ' + this._requests[I].id + ' timed out (secondary), restarting')
        }
        N.abort = true;
        N.xhr.abort();
        N.xhr.onreadystatechange = function () {
        };
        this._requests[I] = new E.Request(N.xmlData, N.origFunc, N.rid, N.sends);
        N = this._requests[I]
      }
      if (N.xhr.readyState === 0) {
        E.debug('request id ' + N.id + '.' + N.sends + ' posting');
        try {
          N.xhr.open('POST', this.service, true)
        } catch (M) {
          E.error('XHR open failed.');
          if (!this.connected) {
            this._changeConnectStatus(E.Status.CONNFAIL, 'bad-service')
          }
          this.disconnect();
          return
        }
        var O = function () {
          N.date = new Date();
          N.xhr.send(N.data)
        };
        if (N.sends > 1) {
          var K = Math.min(Math.floor(E.TIMEOUT * this.wait), Math.pow(N.sends, 3)) * 1000;
          setTimeout(O, K)
        } else {
          O()
        }
        N.sends++;
        if (this.xmlOutput !== E.Connection.prototype.xmlOutput) {
          this.xmlOutput(N.xmlData)
        }
        if (this.rawOutput !== E.Connection.prototype.rawOutput) {
          this.rawOutput(N.data)
        }
      } else {
        E.debug('_processRequest: ' + (I === 0 ? 'first' : 'second') + ' request has readyState of ' + N.xhr.readyState)
      }
    },
    _throttledRequestHandler: function () {
      if (!this._requests) {
        E.debug('_throttledRequestHandler called with undefined requests')
      } else {
        E.debug('_throttledRequestHandler called with ' + this._requests.length + ' requests')
      }
      if (!this._requests || this._requests.length === 0) {
        return
      }
      if (this._requests.length > 0) {
        this._processRequest(0)
      }
      if (this._requests.length > 1 && Math.abs(this._requests[0].rid - this._requests[1].rid) < this.window) {
        this._processRequest(1)
      }
    },
    _onRequestStateChange: function (J, I) {
      E.debug('request id ' + I.id + '.' + I.sends + ' state changed to ' + I.xhr.readyState);
      if (I.abort) {
        I.abort = false;
        return
      }
      var H;
      if (I.xhr.readyState == 4) {
        H = 0;
        try {
          H = I.xhr.status
        } catch (K) {
        }
        if (typeof (H) == 'undefined') {
          H = 0
        }
        if (this.disconnecting) {
          if (H >= 400) {
            this._hitError(H);
            return
          }
        }
        var G = (this._requests[0] == I);
        var L = (this._requests[1] == I);
        if ((H > 0 && H < 500) || I.sends > 5) {
          this._removeRequest(I);
          E.debug('request id ' + I.id + ' should now be removed')
        }
        if (H == 200) {
          if (L || (G && this._requests.length > 0 && this._requests[0].age() > Math.floor(E.SECONDARY_TIMEOUT * this.wait))) {
            this._restartRequest(0)
          }
          E.debug('request id ' + I.id + '.' + I.sends + ' got 200');
          J(I);
          this.errors = 0
        } else {
          E.error('request id ' + I.id + '.' + I.sends + ' error ' + H + ' happened');
          if (H === 0 || (H >= 400 && H < 600) || H >= 12000) {
            this._hitError(H);
            if (H >= 400 && H < 500) {
              this._changeConnectStatus(E.Status.DISCONNECTING, null);
              this._doDisconnect()
            }
          }
        }
        if (!((H > 0 && H < 500) || I.sends > 5)) {
          this._throttledRequestHandler()
        }
      }
    },
    _hitError: function (G) {
      this.errors++;
      E.warn('request errored, status: ' + G + ', number of errors: ' + this.errors);
      if (this.errors > 4) {
        this._onDisconnectTimeout()
      }
    },
    _doDisconnect: function () {
      E.info('_doDisconnect was called');
      this.authenticated = false;
      this.disconnecting = false;
      this.sid = null;
      this.streamId = null;
      this.rid = Math.floor(Math.random() * 4294967295);
      if (this.connected) {
        this._changeConnectStatus(E.Status.DISCONNECTED, null);
        this.connected = false
      }
      this.handlers = [
      ];
      this.timedHandlers = [
      ];
      this.removeTimeds = [
      ];
      this.removeHandlers = [
      ];
      this.addTimeds = [
      ];
      this.addHandlers = [
      ]
    },
    _dataRecv: function (O) {
      try {
        var G = O.getResponse()
      } catch (M) {
        if (M != 'parsererror') {
          throw M
        }
        this.disconnect('strophe-parsererror')
      }
      if (G === null) {
        return
      }
      if (this.xmlInput !== E.Connection.prototype.xmlInput) {
        this.xmlInput(G)
      }
      if (this.rawInput !== E.Connection.prototype.rawInput) {
        this.rawInput(E.serialize(G))
      }
      var K,
      I;
      while (this.removeHandlers.length > 0) {
        I = this.removeHandlers.pop();
        K = this.handlers.indexOf(I);
        if (K >= 0) {
          this.handlers.splice(K, 1)
        }
      }
      while (this.addHandlers.length > 0) {
        this.handlers.push(this.addHandlers.pop())
      }
      if (this.disconnecting && this._requests.length === 0) {
        this.deleteTimedHandler(this._disconnectTimeout);
        this._disconnectTimeout = null;
        this._doDisconnect();
        return
      }
      var H = G.getAttribute('type');
      var N,
      J;
      if (H !== null && H == 'terminate') {
        if (this.disconnecting) {
          return
        }
        N = G.getAttribute('condition');
        J = G.getElementsByTagName('conflict');
        if (N !== null) {
          if (N == 'remote-stream-error' && J.length > 0) {
            N = 'conflict'
          }
          this._changeConnectStatus(E.Status.CONNFAIL, N)
        } else {
          this._changeConnectStatus(E.Status.CONNFAIL, 'unknown')
        }
        this.disconnect();
        return
      }
      var L = this;
      E.forEachChild(G, null, function (U) {
        var R,
        S;
        S = L.handlers;
        L.handlers = [
        ];
        for (R = 0; R < S.length; R++) {
          var P = S[R];
          try {
            if (P.isMatch(U) && (L.authenticated || !P.user)) {
              if (P.run(U)) {
                L.handlers.push(P)
              }
            } else {
              L.handlers.push(P)
            }
          } catch (T) {
          }
        }
      })
    },
    _sendTerminate: function () {
      E.info('_sendTerminate was called');
      var G = this._buildBody().attrs({
        type: 'terminate'
      });
      if (this.authenticated) {
        G.c('presence', {
          xmlns: E.NS.CLIENT,
          type: 'unavailable'
        })
      }
      this.disconnecting = true;
      var H = new E.Request(G.tree(), this._onRequestStateChange.bind(this, this._dataRecv.bind(this)), G.tree().getAttribute('rid'));
      this._requests.push(H);
      this._throttledRequestHandler()
    },
    _connect_cb: function (G, L) {
      E.info('_connect_cb was called');
      this.connected = true;
      var X = G.getResponse();
      if (!X) {
        return
      }
      if (this.xmlInput !== E.Connection.prototype.xmlInput) {
        this.xmlInput(X)
      }
      if (this.rawInput !== E.Connection.prototype.rawInput) {
        this.rawInput(E.serialize(X))
      }
      var Y = X.getAttribute('type');
      var N,
      T;
      if (Y !== null && Y == 'terminate') {
        N = X.getAttribute('condition');
        T = X.getElementsByTagName('conflict');
        if (N !== null) {
          if (N == 'remote-stream-error' && T.length > 0) {
            N = 'conflict'
          }
          this._changeConnectStatus(E.Status.CONNFAIL, N)
        } else {
          this._changeConnectStatus(E.Status.CONNFAIL, 'unknown')
        }
        this.connected = false;
        return
      }
      if (!this.sid) {
        this.sid = X.getAttribute('sid')
      }
      if (!this.stream_id) {
        this.stream_id = X.getAttribute('authid')
      }
      var H = X.getAttribute('requests');
      if (H) {
        this.window = parseInt(H, 10)
      }
      var P = X.getAttribute('hold');
      if (P) {
        this.hold = parseInt(P, 10)
      }
      var U = X.getAttribute('wait');
      if (U) {
        this.wait = parseInt(U, 10)
      }
      this._authentication.sasl_scram_sha1 = false;
      this._authentication.sasl_plain = false;
      this._authentication.sasl_digest_md5 = false;
      this._authentication.sasl_anonymous = false;
      this._authentication.legacy_auth = false;
      var V = X.getElementsByTagName('stream:features').length > 0;
      if (!V) {
        V = X.getElementsByTagName('features').length > 0
      }
      var O = X.getElementsByTagName('mechanism');
      var W,
      S,
      I,
      J,
      R = false;
      if (V && O.length > 0) {
        var K = 0;
        for (W = 0; W < O.length; W++) {
          S = E.getText(O[W]);
          if (S == 'SCRAM-SHA-1') {
            this._authentication.sasl_scram_sha1 = true
          } else {
            if (S == 'DIGEST-MD5') {
              this._authentication.sasl_digest_md5 = true
            } else {
              if (S == 'PLAIN') {
                this._authentication.sasl_plain = true
              } else {
                if (S == 'ANONYMOUS') {
                  this._authentication.sasl_anonymous = true
                } else {
                  K++
                }
              }
            }
          }
        }
        this._authentication.legacy_auth = X.getElementsByTagName('auth').length > 0;
        R = this._authentication.legacy_auth || K < O.length
      }
      if (!R) {
        L = L || this._connect_cb;
        var M = this._buildBody();
        this._requests.push(new E.Request(M.tree(), this._onRequestStateChange.bind(this, L.bind(this)), M.tree().getAttribute('rid')));
        this._throttledRequestHandler();
        return
      }
      if (this.do_authentication !== false) {
        this.authenticate()
      }
    },
    authenticate: function () {
      if (E.getNodeFromJid(this.jid) === null && this._authentication.sasl_anonymous) {
        this._changeConnectStatus(E.Status.AUTHENTICATING, null);
        this._sasl_success_handler = this._addSysHandler(this._sasl_success_cb.bind(this), null, 'success', null, null);
        this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, 'failure', null, null);
        this.send(C('auth', {
          xmlns: E.NS.SASL,
          mechanism: 'ANONYMOUS'
        }).tree())
      } else {
        if (E.getNodeFromJid(this.jid) === null) {
          this._changeConnectStatus(E.Status.CONNFAIL, 'x-strophe-bad-non-anon-jid');
          this.disconnect()
        } else {
          if (this._authentication.sasl_scram_sha1) {
            var H = MD5.hexdigest(Math.random() * 1234567890);
            var G = 'n=' + E.getNodeFromJid(this.jid);
            G += ',r=';
            G += H;
            this._sasl_data.cnonce = H;
            this._sasl_data['client-first-message-bare'] = G;
            G = 'n,,' + G;
            this._changeConnectStatus(E.Status.AUTHENTICATING, null);
            this._sasl_challenge_handler = this._addSysHandler(this._sasl_scram_challenge_cb.bind(this), null, 'challenge', null, null);
            this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, 'failure', null, null);
            this.send(C('auth', {
              xmlns: E.NS.SASL,
              mechanism: 'SCRAM-SHA-1'
            }).t(Base64.encode(G)).tree())
          } else {
            if (this._authentication.sasl_digest_md5) {
              this._changeConnectStatus(E.Status.AUTHENTICATING, null);
              this._sasl_challenge_handler = this._addSysHandler(this._sasl_digest_challenge1_cb.bind(this), null, 'challenge', null, null);
              this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, 'failure', null, null);
              this.send(C('auth', {
                xmlns: E.NS.SASL,
                mechanism: 'DIGEST-MD5'
              }).tree())
            } else {
              if (this._authentication.sasl_plain) {
                G = E.getBareJidFromJid(this.jid);
                G = G + '\0';
                G = G + E.getNodeFromJid(this.jid);
                G = G + '\0';
                G = G + this.pass;
                this._changeConnectStatus(E.Status.AUTHENTICATING, null);
                this._sasl_success_handler = this._addSysHandler(this._sasl_success_cb.bind(this), null, 'success', null, null);
                this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, 'failure', null, null);
                hashed_auth_str = Base64.encode(G);
                this.send(C('auth', {
                  xmlns: E.NS.SASL,
                  mechanism: 'PLAIN'
                }).t(hashed_auth_str).tree())
              } else {
                this._changeConnectStatus(E.Status.AUTHENTICATING, null);
                this._addSysHandler(this._auth1_cb.bind(this), null, null, null, '_auth_1');
                this.send(D({
                  type: 'get',
                  to: this.domain,
                  id: '_auth_1'
                }).c('query', {
                  xmlns: E.NS.AUTH
                }).c('username', {
                }).t(E.getNodeFromJid(this.jid)).tree())
              }
            }
          }
        }
      }
    },
    _sasl_digest_challenge1_cb: function (K) {
      var H = /([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/;
      var R = Base64.decode(E.getText(K));
      var S = MD5.hexdigest('' + (Math.random() * 1234567890));
      var N = '';
      var T = null;
      var O = '';
      var G = '';
      var M;
      this.deleteHandler(this._sasl_failure_handler);
      while (R.match(H)) {
        M = R.match(H);
        R = R.replace(M[0], '');
        M[2] = M[2].replace(/^"(.+)"$/, '$1');
        switch (M[1]) {
          case 'realm':
            N = M[2];
            break;
          case 'nonce':
            O = M[2];
            break;
          case 'qop':
            G = M[2];
            break;
          case 'host':
            T = M[2];
            break
        }
      }
      var L = 'xmpp/' + this.domain;
      if (T !== null) {
        L = L + '/' + T
      }
      var J = MD5.hash(E.getNodeFromJid(this.jid) + ':' + N + ':' + this.pass) + ':' + O + ':' + S;
      var I = 'AUTHENTICATE:' + L;
      var P = '';
      P += 'username=' + this._quote(E.getNodeFromJid(this.jid)) + ',';
      P += 'realm=' + this._quote(N) + ',';
      P += 'nonce=' + this._quote(O) + ',';
      P += 'cnonce=' + this._quote(S) + ',';
      P += 'nc="00000001",';
      P += 'qop="auth",';
      P += 'digest-uri=' + this._quote(L) + ',';
      P += 'response=' + this._quote(MD5.hexdigest(MD5.hexdigest(J) + ':' + O + ':00000001:' + S + ':auth:' + MD5.hexdigest(I))) + ',';
      P += 'charset="utf-8"';
      this._sasl_challenge_handler = this._addSysHandler(this._sasl_digest_challenge2_cb.bind(this), null, 'challenge', null, null);
      this._sasl_success_handler = this._addSysHandler(this._sasl_success_cb.bind(this), null, 'success', null, null);
      this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, 'failure', null, null);
      this.send(C('response', {
        xmlns: E.NS.SASL
      }).t(Base64.encode(P)).tree());
      return false
    },
    _quote: function (G) {
      return '"' + G.replace(/\\/g, '\\\\').replace(/"/g, '\\"') + '"'
    },
    _sasl_digest_challenge2_cb: function (G) {
      this.deleteHandler(this._sasl_success_handler);
      this.deleteHandler(this._sasl_failure_handler);
      this._sasl_success_handler = this._addSysHandler(this._sasl_success_cb.bind(this), null, 'success', null, null);
      this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, 'failure', null, null);
      this.send(C('response', {
        xmlns: E.NS.SASL
      }).tree());
      return false
    },
    _sasl_scram_challenge_cb: function (I) {
      var O,
      M,
      R,
      L,
      J,
      G;
      var N,
      W,
      K;
      var P = 'c=biws,';
      var S = Base64.decode(E.getText(I));
      var T = this._sasl_data['client-first-message-bare'] + ',' + S + ',';
      var V = this._sasl_data.cnonce;
      var H = /([a-z]+)=([^,]+)(,|$)/;
      this.deleteHandler(this._sasl_failure_handler);
      while (S.match(H)) {
        matches = S.match(H);
        S = S.replace(matches[0], '');
        switch (matches[1]) {
          case 'r':
            O = matches[2];
            break;
          case 's':
            M = matches[2];
            break;
          case 'i':
            R = matches[2];
            break
        }
      }
      if (!(O.substr(0, V.length) === V)) {
        this._sasl_data = [
        ];
        return this._sasl_failure_cb(null)
      }
      P += 'r=' + O;
      T += P;
      M = Base64.decode(M);
      M += '\0\0\0';
      L = G = core_hmac_sha1(this.pass, M);
      for (i = 1; i < R; i++) {
        J = core_hmac_sha1(this.pass, binb2str(G));
        for (k = 0; k < 5; k++) {
          L[k] ^= J[k]
        }
        G = J
      }
      L = binb2str(L);
      N = core_hmac_sha1(L, 'Client Key');
      W = str_hmac_sha1(L, 'Server Key');
      K = core_hmac_sha1(str_sha1(binb2str(N)), T);
      this._sasl_data['server-signature'] = b64_hmac_sha1(W, T);
      for (k = 0; k < 5; k++) {
        N[k] ^= K[k]
      }
      P += ',p=' + Base64.encode(binb2str(N));
      this._sasl_success_handler = this._addSysHandler(this._sasl_success_cb.bind(this), null, 'success', null, null);
      this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, 'failure', null, null);
      this.send(C('response', {
        xmlns: E.NS.SASL
      }).t(Base64.encode(P)).tree());
      return false
    },
    _auth1_cb: function (G) {
      var H = D({
        type: 'set',
        id: '_auth_2'
      }).c('query', {
        xmlns: E.NS.AUTH
      }).c('username', {
      }).t(E.getNodeFromJid(this.jid)).up().c('password').t(this.pass);
      if (!E.getResourceFromJid(this.jid)) {
        this.jid = E.getBareJidFromJid(this.jid) + '/strophe'
      }
      H.up().c('resource', {
      }).t(E.getResourceFromJid(this.jid));
      this._addSysHandler(this._auth2_cb.bind(this), null, null, null, '_auth_2');
      this.send(H.tree());
      return false
    },
    _sasl_success_cb: function (H) {
      if (this._sasl_data['server-signature']) {
        var G;
        var J = Base64.decode(E.getText(H));
        var I = /([a-z]+)=([^,]+)(,|$)/;
        matches = J.match(I);
        if (matches[1] == 'v') {
          G = matches[2]
        }
        if (G != this._sasl_data['server-signature']) {
          this.deleteHandler(this._sasl_failure_handler);
          this._sasl_failure_handler = null;
          if (this._sasl_challenge_handler) {
            this.deleteHandler(this._sasl_challenge_handler);
            this._sasl_challenge_handler = null
          }
          this._sasl_data = [
          ];
          return this._sasl_failure_cb(null)
        }
      }
      E.info('SASL authentication succeeded.');
      this.deleteHandler(this._sasl_failure_handler);
      this._sasl_failure_handler = null;
      if (this._sasl_challenge_handler) {
        this.deleteHandler(this._sasl_challenge_handler);
        this._sasl_challenge_handler = null
      }
      this._addSysHandler(this._sasl_auth1_cb.bind(this), null, 'stream:features', null, null);
      this._sendRestart();
      return false
    },
    _sasl_auth1_cb: function (H) {
      this.features = H;
      var G,
      J;
      for (G = 0; G < H.childNodes.length; G++) {
        J = H.childNodes[G];
        if (J.nodeName == 'bind') {
          this.do_bind = true
        }
        if (J.nodeName == 'session') {
          this.do_session = true
        }
      }
      if (!this.do_bind) {
        this._changeConnectStatus(E.Status.AUTHFAIL, null);
        this.connected = false;
        return false
      } else {
        this._addSysHandler(this._sasl_bind_cb.bind(this), null, null, null, '_bind_auth_2');
        var I = E.getResourceFromJid(this.jid);
        if (I) {
          this.send(D({
            type: 'set',
            id: '_bind_auth_2'
          }).c('bind', {
            xmlns: E.NS.BIND
          }).c('resource', {
          }).t(I).tree())
        } else {
          this.send(D({
            type: 'set',
            id: '_bind_auth_2'
          }).c('bind', {
            xmlns: E.NS.BIND
          }).tree())
        }
      }
      return false
    },
    _sasl_bind_cb: function (G) {
      if (G.getAttribute('type') == 'error') {
        E.info('SASL binding failed.');
        var H = G.getElementsByTagName('conflict'),
        K;
        if (H.length > 0) {
          K = 'conflict'
        }
        this._changeConnectStatus(E.Status.AUTHFAIL, K);
        this.connected = false;
        return false
      }
      var J = G.getElementsByTagName('bind');
      var I;
      if (J.length > 0) {
        I = J[0].getElementsByTagName('jid');
        if (I.length > 0) {
          this.jid = E.getText(I[0]);
          if (this.do_session) {
            this._addSysHandler(this._sasl_session_cb.bind(this), null, null, null, '_session_auth_2');
            this.send(D({
              type: 'set',
              id: '_session_auth_2'
            }).c('session', {
              xmlns: E.NS.SESSION
            }).tree())
          } else {
            this.authenticated = true;
            this._changeConnectStatus(E.Status.CONNECTED, null)
          }
        }
      } else {
        E.info('SASL binding failed.');
        this._changeConnectStatus(E.Status.AUTHFAIL, null);
        this.connected = false;
        return false
      }
    },
    _sasl_session_cb: function (G) {
      if (G.getAttribute('type') == 'result') {
        this.authenticated = true;
        this._changeConnectStatus(E.Status.CONNECTED, null)
      } else {
        if (G.getAttribute('type') == 'error') {
          E.info('Session creation failed.');
          this._changeConnectStatus(E.Status.AUTHFAIL, null);
          this.connected = false;
          return false
        }
      }
      return false
    },
    _sasl_failure_cb: function (G) {
      if (this._sasl_success_handler) {
        this.deleteHandler(this._sasl_success_handler);
        this._sasl_success_handler = null
      }
      if (this._sasl_challenge_handler) {
        this.deleteHandler(this._sasl_challenge_handler);
        this._sasl_challenge_handler = null
      }
      this._changeConnectStatus(E.Status.AUTHFAIL, null);
      this.connected = false;
      return false
    },
    _auth2_cb: function (G) {
      if (G.getAttribute('type') == 'result') {
        this.authenticated = true;
        this._changeConnectStatus(E.Status.CONNECTED, null)
      } else {
        if (G.getAttribute('type') == 'error') {
          this._changeConnectStatus(E.Status.AUTHFAIL, null);
          this.disconnect()
        }
      }
      return false
    },
    _addSysTimedHandler: function (I, H) {
      var G = new E.TimedHandler(I, H);
      G.user = false;
      this.addTimeds.push(G);
      return G
    },
    _addSysHandler: function (K, J, H, I, L) {
      var G = new E.Handler(K, J, H, I, L);
      G.user = false;
      this.addHandlers.push(G);
      return G
    },
    _onDisconnectTimeout: function () {
      E.info('_onDisconnectTimeout was called');
      var G;
      while (this._requests.length > 0) {
        G = this._requests.pop();
        G.abort = true;
        G.xhr.abort();
        G.xhr.onreadystatechange = function () {
        }
      }
      this._doDisconnect();
      return false
    },
    _onIdle: function () {
      var I,
      K,
      M,
      J;
      while (this.addTimeds.length > 0) {
        this.timedHandlers.push(this.addTimeds.pop())
      }
      while (this.removeTimeds.length > 0) {
        K = this.removeTimeds.pop();
        I = this.timedHandlers.indexOf(K);
        if (I >= 0) {
          this.timedHandlers.splice(I, 1)
        }
      }
      var H = new Date().getTime();
      J = [
      ];
      for (I = 0; I < this.timedHandlers.length; I++) {
        K = this.timedHandlers[I];
        if (this.authenticated || !K.user) {
          M = K.lastCalled + K.period;
          if (M - H <= 0) {
            if (K.run()) {
              J.push(K)
            }
          } else {
            J.push(K)
          }
        }
      }
      this.timedHandlers = J;
      var G,
      L;
      if (this.authenticated && this._requests.length === 0 && this._data.length === 0 && !this.disconnecting) {
        E.info('no requests during idle cycle, sending blank request');
        this._data.push(null)
      }
      if (this._requests.length < 2 && this._data.length > 0 && !this.paused) {
        G = this._buildBody();
        for (I = 0; I < this._data.length; I++) {
          if (this._data[I] !== null) {
            if (this._data[I] === 'restart') {
              G.attrs({
                to: this.domain,
                'xml:lang': 'en',
                'xmpp:restart': 'true',
                'xmlns:xmpp': E.NS.BOSH
              })
            } else {
              G.cnode(this._data[I]).up()
            }
          }
        }
        delete this._data;
        this._data = [
        ];
        this._requests.push(new E.Request(G.tree(), this._onRequestStateChange.bind(this, this._dataRecv.bind(this)), G.tree().getAttribute('rid')));
        this._processRequest(this._requests.length - 1)
      }
      if (this._requests.length > 0) {
        L = this._requests[0].age();
        if (this._requests[0].dead !== null) {
          if (this._requests[0].timeDead() > Math.floor(E.SECONDARY_TIMEOUT * this.wait)) {
            this._throttledRequestHandler()
          }
        }
        if (L > Math.floor(E.TIMEOUT * this.wait)) {
          E.warn('Request ' + this._requests[0].id + ' timed out, over ' + Math.floor(E.TIMEOUT * this.wait) + ' seconds since last activity');
          this._throttledRequestHandler()
        }
      }
      clearTimeout(this._idleTimeout);
      if (this.connected) {
        this._idleTimeout = setTimeout(this._onIdle.bind(this), 100)
      }
    }
  };
  if (F) {
    F(E, C, A, D, B)
  }
}) (function () {
  window.Strophe = arguments[0];
  window.$build = arguments[1];
  window.$msg = arguments[2];
  window.$iq = arguments[3];
  window.$pres = arguments[4]
});
Strophe.addConnectionPlugin('xdomainrequest', {
  init: function () {
    if (window.XDomainRequest) {
      Strophe.debug('using XdomainRequest for IE');
      XDomainRequest.prototype.oldsend = XDomainRequest.prototype.send;
      XDomainRequest.prototype.send = function () {
        XDomainRequest.prototype.oldsend.apply(this, arguments);
        this.readyState = 2;
        try {
          this.onreadystatechange()
        } catch (A) {
        }
      };
      Strophe.Request.prototype._newXHR = function () {
        var A = function (E, C) {
          E.status = C;
          E.readyState = 4;
          try {
            E.onreadystatechange()
          } catch (D) {
          }
        };
        var B = new XDomainRequest();
        B.readyState = 0;
        B.onreadystatechange = this.func.prependArg(this);
        B.onload = function () {
          xmlDoc = new ActiveXObject('Microsoft.XMLDOM');
          xmlDoc.async = 'false';
          xmlDoc.loadXML(B.responseText);
          B.responseXML = xmlDoc;
          A(B, 200)
        };
        B.onerror = function () {
          A(B, 500)
        };
        B.ontimeout = function () {
          A(B, 500)
        };
        return B
      }
    } else {
      Strophe.error('XDomainRequest not found. Falling back to native XHR implementation.')
    }
  }
});
Strophe.Status.REBINDFAILED = 9;
Strophe.WebSocket = function (A) {
  this.service = A;
  this.ws = null;
  this.connect_timeout = 300;
  this.jid = '';
  this.streamId = null;
  this.do_session = false;
  this.do_bind = false;
  this.timedHandlers = [
  ];
  this.handlers = [
  ];
  this.removeTimeds = [
  ];
  this.removeHandlers = [
  ];
  this.addTimeds = [
  ];
  this.addHandlers = [
  ];
  this._idleTimeout = null;
  this._disconnectTimeout = null;
  this.authenticated = false;
  this.disconnecting = false;
  this.connected = false;
  this._keep_alive_timer = 20000;
  this.errors = 0;
  this._data = [
  ];
  this._requests = [
  ];
  this._uniqueId = Math.round(Math.random() * 10000);
  this._sasl_success_handler = null;
  this._sasl_failure_handler = null;
  this._sasl_challenge_handler = null;
  this._rebind_success_handler = null;
  this._rebind_failure_handler = null;
  this._idleTimeout = setTimeout(this._onIdle.bind(this), 100);
  for (var B in Strophe._connectionPlugins) {
    if (Strophe._connectionPlugins.hasOwnProperty(B)) {
      var D = Strophe._connectionPlugins[B];
      var C = function () {
      };
      C.prototype = D;
      this[B] = new C();
      this[B].init(this)
    }
  }
};
Strophe.WebSocket.prototype = {
  reset: function () {
    this.sid = null;
    this.streamId = null;
    this.do_session = false;
    this.do_bind = false;
    this.timedHandlers = [
    ];
    this.handlers = [
    ];
    this.removeTimeds = [
    ];
    this.removeHandlers = [
    ];
    this.addTimeds = [
    ];
    this.addHandlers = [
    ];
    this.authenticated = false;
    this.disconnecting = false;
    this.connected = false;
    this.errors = 0
  },
  pause: function () {
    return
  },
  resume: function () {
    return
  },
  getUniqueId: function (A) {
    if (typeof (A) == 'string' || typeof (A) == 'number') {
      return ++this._uniqueId + ':' + A
    } else {
      return ++this._uniqueId + ''
    }
  },
  connect: function (A, B, D) {
    this.jid = A;
    this.pass = B;
    this.connect_callback = D;
    this.disconnecting = false;
    this.connected = false;
    this.authenticated = false;
    this.errors = 0;
    this.domain = Strophe.getDomainFromJid(this.jid);
    if (window.WebSocket) {
      try {
        this.ws = new WebSocket(this.service);
        this.ws.onopen = this._send_initial_stream.bind(this);
        this._addSysTimedHandler(this._keep_alive_timer, this._keep_alive_handler.bind(this));
        this.ws.onmessage = this._get_stream_id.bind(this, this._connect_cb.bind(this));
        this.ws.onerror = function (E) {
          Strophe.error('error : ' + E)
        };
        this.ws.onclose = this._ws_on_close.bind(this)
      } catch (C) {
        console.log('exception ' + C);
        D(Strophe.Status.CONNFAIL)
      }
    } else {
      D(Strophe.Status.CONNFAIL)
    }
  },
  freeze: function () {
    if (this.connected) {
      this.save();
      return ['ws',
      this.jid,
      this.streamId].join('\n')
    } else {
      return ''
    }
  },
  thaw: function (A, C) {
    if (!A) {
      C(Strophe.Status.REBINDFAILED)
    } else {
      var B = A.split('\n');
      if (B[0] != 'ws') {
        C(Strophe.Status.REBINDFAILED)
      }
      this.rebind(B[1], B[2], C)
    }
  },
  attach: function () {
    return
  },
  rebind: function (B, A, C) {
    this.jid = B;
    this._sid = A;
    this.connect_callback = C;
    this.domain = Strophe.getDomainFromJid(this.jid);
    this._addSysTimedHandler(this._keep_alive_timer, this._keep_alive_handler.bind(this));
    this.ws = new WebSocket(this.service);
    this.ws.onopen = this._send_initial_stream.bind(this);
    this.ws.onmessage = this._get_stream_id.bind(this, this._rebind_cb.bind(this, B, A));
    this.ws.onclose = this._ws_on_close.bind(this)
  },
  save: function (D, B, C) {
    var A = $iq({
      type: 'set'
    }).c('push', {
      xmlns: 'p1:push'
    }).c('keepalive', {
      max: C || '30'
    }).up().c('session', {
      duration: '1'
    });
    this.sendIQ(A, D, B)
  },
  xmlInput: function (A) {
    return
  },
  xmlOutput: function (A) {
    return
  },
  rawInput: function (A) {
    return
  },
  rawOutput: function (A) {
    return
  },
  send: function (B) {
    var C = '';
    if (B === null) {
      return
    }
    if (typeof (B.sort) === 'function') {
      for (var A = 0; A < B.length; A++) {
        C += Strophe.serialize(B[A]);
        this.xmlOutput(B)
      }
    } else {
      if (typeof (B.tree) === 'function') {
        C = Strophe.serialize(B.tree());
        this.xmlOutput(B.tree())
      } else {
        C = Strophe.serialize(B);
        this.xmlOutput(B)
      }
    }
    this.rawOutput(C);
    this.ws.send(C)
  },
  flush: function () {
    return
  },
  sendIQ: function (D, H, A, E) {
    var F = null;
    var C = this;
    if (typeof (D.tree) === 'function') {
      D = D.tree()
    }
    var G = D.getAttribute('id');
    if (!G) {
      G = this.getUniqueId('sendIQ');
      D.setAttribute('id', G)
    }
    var B = this.addHandler(function (J) {
      if (F) {
        C.deleteTimedHandler(F)
      }
      var I = J.getAttribute('type');
      if (I == 'result') {
        if (H) {
          H(J)
        }
      } else {
        if (I == 'error') {
          if (A) {
            A(J)
          }
        } else {
          throw {
            name: 'StropheError',
            message: 'Got bad IQ type of ' + I
          }
        }
      }
    }, null, 'iq', null, G);
    if (E) {
      F = this.addTimedHandler(E, function () {
        C.deleteHandler(B);
        if (A) {
          A(null)
        }
        return false
      })
    }
    this.send(D);
    return G
  },
  addTimedHandler: function (C, B) {
    var A = new Strophe.TimedHandler(C, B);
    this.addTimeds.push(A);
    return A
  },
  deleteTimedHandler: function (A) {
    this.removeTimeds.push(A)
  },
  addHandler: function (F, E, C, D, H, G, B) {
    var A = new Strophe.Handler(F, E, C, D, H, G, B);
    this.addHandlers.push(A);
    return A
  },
  deleteHandler: function (A) {
    this.removeHandlers.push(A)
  },
  disconnect: function (A) {
    this._changeConnectStatus(Strophe.Status.DISCONNECTING, A);
    Strophe.info('Disconnect was called because: ' + A);
    if (this.connected) {
      this._disconnectTimeout = this._addSysTimedHandler(3000, this._onDisconnectTimeout.bind(this));
      this._sendTerminate()
    }
  },
  _changeConnectStatus: function (A, F) {
    for (var B in Strophe._connectionPlugins) {
      if (Strophe._connectionPlugins.hasOwnProperty(B)) {
        var D = this[B];
        if (D.statusChanged) {
          try {
            D.statusChanged(A, F)
          } catch (C) {
            Strophe.error('' + B + ' plugin caused an exception changing status: ' + C)
          }
        }
      }
    }
    if (this.connect_callback) {
      try {
        this.connect_callback(A, F)
      } catch (E) {
        Strophe.error('User connection callback caused an exception: ' + E)
      }
    }
  },
  _doDisconnect: function () {
    Strophe.info('_doDisconnect was called');
    this.authenticated = false;
    this.disconnecting = false;
    this.sid = null;
    this.streamId = null;
    if (this.connected) {
      this._changeConnectStatus(Strophe.Status.DISCONNECTED, null);
      this.connected = false
    } else {
      this._changeConnectStatus(Strophe.Status.CONNFAIL, null)
    }
    this.handlers = [
    ];
    this.timedHandlers = [
    ];
    this.removeTimeds = [
    ];
    this.removeHandlers = [
    ];
    this.addTimeds = [
    ];
    this.addHandlers = [
    ];
    if (this.ws.readyState != this.ws.CLOSED) {
      this.ws.close()
    }
  },
  _ws_on_close: function (A) {
    if (!this.streamOpened && FallbackWebSocketGenerator) {
      Strophe.info('switching to fallback websocket implementation');
      FallbackWebSocketGenerator(true);
      this.timedHandlers = [
      ];
      this.addTimeds = [
      ];
      if (this._sid) {
        this.rebind(this.jid, this._sid, this.connect_callback)
      } else {
        this.connect(this.jid, this.pass, this.connect_callback)
      }
      return
    }
    Strophe.info('websocket closed');
    this._doDisconnect()
  },
  _keep_alive_handler: function () {
    this.ws.send('\n');
    return true
  },
  _send_initial_stream: function () {
    this._changeConnectStatus(Strophe.Status.CONNECTING, null);
    var A = '<?xml version="1.0"?><stream:stream xmlns:stream="http://etherx.jabber.org/streams" version="1.0" xmlns="jabber:client" to="' + this.domain + '" xml:lang="en" xmlns:xml="http://www.w3.org/XML/1998/namespace" >';
    this.rawOutput(A);
    this.ws.send(A)
  },
  _get_stream_id: function (B, A) {
    this.streamOpened = true;
    elem = A.data;
    this.rawInput(elem);
    if (A.data.match(/id=[\'\"]([^\'\"]+)[\'\"]/)) {
      this.streamId = RegExp.$1
    }
    this.ws.onmessage = B
  },
  _parseTree: function (A) {
    try {
      if (this._xml_parse == undefined) {
        if (window.DOMParser) {
          this._xml_parser = new DOMParser();
          this._xml_parse = function (C) {
            return this._xml_parser.parseFromString('<body xmlns:stream=\'foo\' >' + C + '</body>', 'text/xml').documentElement.firstChild
          }
        } else {
          this._xml_parse = function (D) {
            var C = new ActiveXObject('MSXML2.DomDocument');
            C.async = 'false';
            C.loadXML('<body xmlns:stream=\'foo\'>' + D + '</body>');
            return C.documentElement.firstChild
          }
        }
      }
      return this._xml_parse(A)
    } catch (B) {
      Strophe.error('Error : ' + B.message)
    }
    return null
  },
  _dataRecv: function (A) {
    var C;
    try {
      C = this._parseTree(A.data)
    } catch (H) {
      if (H != 'parsererror') {
        throw H
      }
      this.disconnect('strophe-parsererror')
    }
    if (C === null) {
      return
    }
    this.xmlInput(C);
    this.rawInput(A.data);
    var G,
    E;
    while (this.removeHandlers.length > 0) {
      E = this.removeHandlers.pop();
      G = this.handlers.indexOf(E);
      if (G >= 0) {
        this.handlers.splice(G, 1)
      }
    }
    while (this.addHandlers.length > 0) {
      this.handlers.push(this.addHandlers.pop())
    }
    if (this.disconnecting) {
      this.deleteTimedHandler(this._disconnectTimeout);
      this._disconnectTimeout = null;
      this._doDisconnect();
      return
    }
    var D = C.getAttribute('type');
    var I,
    F;
    if (D !== null && D == 'terminate') {
      I = C.getAttribute('condition');
      F = C.getElementsByTagName('conflict');
      if (I !== null) {
        if (I == 'remote-stream-error' && F.length > 0) {
          I = 'conflict'
        }
        this._changeConnectStatus(Strophe.Status.CONNFAIL, I)
      } else {
        this._changeConnectStatus(Strophe.Status.CONNFAIL, 'unknown')
      }
      this.disconnect();
      return
    }
    var G,
    B;
    B = this.handlers;
    this.handlers = [
    ];
    for (G = 0; G < B.length; G++) {
      var E = B[G];
      if (E.isMatch(C) && (this.authenticated || !E.user)) {
        if (E.run(C)) {
          this.handlers.push(E)
        }
      } else {
        this.handlers.push(E)
      }
    }
  },
  _sendTerminate: function () {
    Strophe.info('_sendTerminate was called');
    var A = {
    };
    if (this.authenticated) {
      A = $pres({
        xmlns: Strophe.NS.CLIENT,
        type: 'unavailable'
      })
    }
    this.disconnecting = true;
    this.send(A);
    this.ws.send('</stream:stream>')
  },
  _connect_cb: function (B) {
    Strophe.info('_connect_cb was called');
    this.connected = true;
    this.ws.onmessage = this._dataRecv.bind(this);
    var A = B.data;
    if (!A) {
      return
    }
    stanza = this._parseTree(A);
    this.xmlInput(stanza);
    this.rawInput(Strophe.serialize(stanza));
    var I = false;
    var D = false;
    var H = false;
    var J = stanza.getElementsByTagName('mechanism');
    var E,
    G,
    F,
    C;
    if (J.length > 0) {
      for (E = 0; E < J.length; E++) {
        G = Strophe.getText(J[E]);
        if (G == 'DIGEST-MD5') {
          D = true
        } else {
          if (G == 'PLAIN') {
            I = true
          } else {
            if (G == 'ANONYMOUS') {
              H = true
            }
          }
        }
      }
    }
    if (Strophe.getNodeFromJid(this.jid) === null && H) {
      this._changeConnectStatus(Strophe.Status.AUTHENTICATING, null);
      this._sasl_success_handler = this._addSysHandler(this._sasl_success_cb.bind(this), null, 'success', null, null);
      this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, 'failure', null, null);
      this.send($build('auth', {
        xmlns: Strophe.NS.SASL,
        mechanism: 'ANONYMOUS'
      }).tree())
    } else {
      if (Strophe.getNodeFromJid(this.jid) === null) {
        this._changeConnectStatus(Strophe.Status.CONNFAIL, 'x-strophe-bad-non-anon-jid');
        this.disconnect()
      } else {
        if (D) {
          this._changeConnectStatus(Strophe.Status.AUTHENTICATING, null);
          this._sasl_challenge_handler = this._addSysHandler(this._sasl_challenge1_cb.bind(this), null, 'challenge', null, null);
          this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, 'failure', null, null);
          this.send($build('auth', {
            xmlns: Strophe.NS.SASL,
            mechanism: 'DIGEST-MD5'
          }).tree())
        } else {
          if (I) {
            F = Strophe.getBareJidFromJid(this.jid);
            F = F + '\0';
            F = F + Strophe.getNodeFromJid(this.jid);
            F = F + '\0';
            F = F + this.pass;
            this._changeConnectStatus(Strophe.Status.AUTHENTICATING, null);
            this._sasl_success_handler = this._addSysHandler(this._sasl_success_cb.bind(this), null, 'success', null, null);
            this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, 'failure', null, null);
            C = Base64.encode(F);
            this.send($build('auth', {
              xmlns: Strophe.NS.SASL,
              mechanism: 'PLAIN'
            }).t(C).tree())
          } else {
            this._changeConnectStatus(Strophe.Status.AUTHENTICATING, null);
            this._addSysHandler(this._auth1_cb.bind(this), null, null, null, '_auth_1');
            this.send($iq({
              type: 'get',
              to: this.domain,
              id: '_auth_1'
            }).c('query', {
              xmlns: Strophe.NS.AUTH
            }).c('username', {
            }).t(Strophe.getNodeFromJid(this.jid)).tree())
          }
        }
      }
    }
  },
  _rebind_cb: function (B, A, C) {
    this.connected = true;
    this.ws.onmessage = this._dataRecv.bind(this);
    var E = C.data;
    if (!E) {
      return
    }
    stanza = this._parseTree(E);
    this.xmlInput(stanza);
    this.rawInput(Strophe.serialize(stanza));
    var D = stanza.getElementsByTagName('rebind');
    if (D.length > 0) {
      this.send($build('rebind', {
        xmlns: 'p1:rebind',
        id: this.getUniqueId('sendIQ')
      }).c('jid', {
      }).t(B).up().c('sid', {
      }).t(A).tree());
      this._rebind_success_handler = this._addSysHandler(this._rebind_success_cb.bind(this, A), null, 'rebind', null, null);
      this._rebind_failure_handler = this._addSysHandler(this._rebind_failure_cb.bind(this), null, 'failure', null, null)
    } else {
      this._changeConnectStatus(Strophe.Status.CONNFAIL, 'x-strophe-rebind-not-supported')
    }
  },
  _rebind_success_cb: function (A, B) {
    Strophe.info('Rebinding  succeeded.');
    this.streamId = A;
    this.authenticated = true;
    this.connected = true;
    this.deleteHandler(this._rebind_failure_handler);
    this._rebind_failure_handler = null;
    this._changeConnectStatus(Strophe.Status.ATTACHED, null);
    return false
  },
  _rebind_failure_cb: function (A) {
    Strophe.info('Rebinding failed.');
    if (this._rebind_success_handler) {
      this.deleteHandler(this._rebind_success_handler);
      this._rebind_success_handler = null
    }
    this._changeConnectStatus(Strophe.Status.REBINDFAILED, null);
    return false
  },
  _sasl_challenge1_cb: function (E) {
    var B = /([a-z]+)=("[^"]+"|[^,"]+)(?:,|$)/;
    var K = Base64.decode(Strophe.getText(E));
    var L = MD5.hexdigest(Math.random() * 1234567890);
    var H = '';
    var M = null;
    var I = '';
    var A = '';
    var G;
    this.deleteHandler(this._sasl_failure_handler);
    while (K.match(B)) {
      G = K.match(B);
      K = K.replace(G[0], '');
      G[2] = G[2].replace(/^"(.+)"$/, '$1');
      switch (G[1]) {
        case 'realm':
          H = G[2];
          break;
        case 'nonce':
          I = G[2];
          break;
        case 'qop':
          A = G[2];
          break;
        case 'host':
          M = G[2];
          break
      }
    }
    var F = 'xmpp/' + this.domain;
    if (M !== null) {
      F = F + '/' + M
    }
    var D = MD5.hash(Strophe.getNodeFromJid(this.jid) + ':' + H + ':' + this.pass) + ':' + I + ':' + L;
    var C = 'AUTHENTICATE:' + F;
    var J = '';
    J += 'username=' + this._quote(Strophe.getNodeFromJid(this.jid)) + ',';
    J += 'realm=' + this._quote(H) + ',';
    J += 'nonce=' + this._quote(I) + ',';
    J += 'cnonce=' + this._quote(L) + ',';
    J += 'nc="00000001",';
    J += 'qop="auth",';
    J += 'digest-uri=' + this._quote(F) + ',';
    J += 'response=' + this._quote(MD5.hexdigest(MD5.hexdigest(D) + ':' + I + ':00000001:' + L + ':auth:' + MD5.hexdigest(C))) + ',';
    J += 'charset="utf-8"';
    this._sasl_challenge_handler = this._addSysHandler(this._sasl_challenge2_cb.bind(this), null, 'challenge', null, null);
    this._sasl_success_handler = this._addSysHandler(this._sasl_success_cb.bind(this), null, 'success', null, null);
    this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, 'failure', null, null);
    this.send($build('response', {
      xmlns: Strophe.NS.SASL
    }).t(Base64.encode(J)).tree());
    return false
  },
  _quote: function (A) {
    return '"' + A.replace(/\\/g, '\\\\').replace(/"/g, '\\"') + '"'
  },
  _sasl_challenge2_cb: function (A) {
    this.deleteHandler(this._sasl_success_handler);
    this.deleteHandler(this._sasl_failure_handler);
    this._sasl_success_handler = this._addSysHandler(this._sasl_success_cb.bind(this), null, 'success', null, null);
    this._sasl_failure_handler = this._addSysHandler(this._sasl_failure_cb.bind(this), null, 'failure', null, null);
    this.send($build('response', {
      xmlns: Strophe.NS.SASL
    }).tree());
    return false
  },
  _auth1_cb: function (A) {
    var B = $iq({
      type: 'set',
      id: '_auth_2'
    }).c('query', {
      xmlns: Strophe.NS.AUTH
    }).c('username', {
    }).t(Strophe.getNodeFromJid(this.jid)).up().c('password').t(this.pass);
    if (!Strophe.getResourceFromJid(this.jid)) {
      this.jid = Strophe.getBareJidFromJid(this.jid) + '/strophe'
    }
    B.up().c('resource', {
    }).t(Strophe.getResourceFromJid(this.jid));
    this._addSysHandler(this._auth2_cb.bind(this), null, null, null, '_auth_2');
    this.send(B.tree());
    return false
  },
  _sasl_success_cb: function (A) {
    Strophe.info('SASL authentication succeeded.');
    this.deleteHandler(this._sasl_failure_handler);
    this._sasl_failure_handler = null;
    if (this._sasl_challenge_handler) {
      this.deleteHandler(this._sasl_challenge_handler);
      this._sasl_challenge_handler = null
    }
    this._addSysHandler(this._sasl_auth1_cb.bind(this), null, 'stream:features', null, null);
    this.ws.onmessage = this._get_stream_id.bind(this, this._dataRecv.bind(this));
    this._send_initial_stream();
    return false
  },
  _sasl_auth1_cb: function (B) {
    var A,
    D;
    for (A = 0; A < B.childNodes.length; A++) {
      D = B.childNodes[A];
      if (D.nodeName == 'bind') {
        this.do_bind = true
      }
      if (D.nodeName == 'session') {
        this.do_session = true
      }
    }
    if (!this.do_bind) {
      this._changeConnectStatus(Strophe.Status.AUTHFAIL, null);
      return false
    } else {
      this._addSysHandler(this._sasl_bind_cb.bind(this), null, null, null, '_bind_auth_2');
      var C = Strophe.getResourceFromJid(this.jid);
      if (C) {
        this.send($iq({
          type: 'set',
          id: '_bind_auth_2'
        }).c('bind', {
          xmlns: Strophe.NS.BIND
        }).c('resource', {
        }).t(C).tree())
      } else {
        this.send($iq({
          type: 'set',
          id: '_bind_auth_2'
        }).c('bind', {
          xmlns: Strophe.NS.BIND
        }).tree())
      }
    }
    return false
  },
  _sasl_bind_cb: function (A) {
    if (A.getAttribute('type') == 'error') {
      Strophe.info('SASL binding failed.');
      this._changeConnectStatus(Strophe.Status.AUTHFAIL, null);
      return false
    }
    var C = A.getElementsByTagName('bind');
    var B;
    if (C.length > 0) {
      B = C[0].getElementsByTagName('jid');
      if (B.length > 0) {
        this.jid = Strophe.getText(B[0]);
        if (this.do_session) {
          this._addSysHandler(this._sasl_session_cb.bind(this), null, null, null, '_session_auth_2');
          this.send($iq({
            type: 'set',
            id: '_session_auth_2'
          }).c('session', {
            xmlns: Strophe.NS.SESSION
          }).tree())
        } else {
          this.authenticated = true;
          this._changeConnectStatus(Strophe.Status.CONNECTED, null)
        }
      }
    } else {
      Strophe.info('SASL binding failed.');
      this._changeConnectStatus(Strophe.Status.AUTHFAIL, null);
      return false
    }
    return false
  },
  _sasl_session_cb: function (A) {
    if (A.getAttribute('type') == 'result') {
      this.authenticated = true;
      this._changeConnectStatus(Strophe.Status.CONNECTED, null)
    } else {
      if (A.getAttribute('type') == 'error') {
        Strophe.info('Session creation failed.');
        this._changeConnectStatus(Strophe.Status.AUTHFAIL, null);
        return false
      }
    }
    return false
  },
  _sasl_failure_cb: function (A) {
    if (this._sasl_success_handler) {
      this.deleteHandler(this._sasl_success_handler);
      this._sasl_success_handler = null
    }
    if (this._sasl_challenge_handler) {
      this.deleteHandler(this._sasl_challenge_handler);
      this._sasl_challenge_handler = null
    }
    this._changeConnectStatus(Strophe.Status.AUTHFAIL, null);
    return false
  },
  _auth2_cb: function (A) {
    if (A.getAttribute('type') == 'result') {
      this.authenticated = true;
      this._changeConnectStatus(Strophe.Status.CONNECTED, null)
    } else {
      if (A.getAttribute('type') == 'error') {
        this._changeConnectStatus(Strophe.Status.AUTHFAIL, null);
        this.disconnect()
      }
    }
    return false
  },
  _addSysTimedHandler: function (C, B) {
    var A = new Strophe.TimedHandler(C, B);
    A.user = false;
    this.addTimeds.push(A);
    return A
  },
  _addSysHandler: function (E, D, B, C, F) {
    var A = new Strophe.Handler(E, D, B, C, F);
    A.user = false;
    this.addHandlers.push(A);
    return A
  },
  _onDisconnectTimeout: function () {
    Strophe.info('_onDisconnectTimeout was called');
    this._doDisconnect();
    return false
  },
  _onIdle: function () {
    var B,
    D,
    E,
    C;
    while (this.removeTimeds.length > 0) {
      D = this.removeTimeds.pop();
      B = this.timedHandlers.indexOf(D);
      if (B >= 0) {
        this.timedHandlers.splice(B, 1)
      }
    }
    while (this.addTimeds.length > 0) {
      this.timedHandlers.push(this.addTimeds.pop())
    }
    var A = new Date().getTime();
    C = [
    ];
    for (B = 0; B < this.timedHandlers.length; B++) {
      D = this.timedHandlers[B];
      if (this.authenticated || !D.user) {
        E = D.lastCalled + D.period;
        if (E - A <= 0) {
          if (D.run()) {
            C.push(D)
          }
        } else {
          C.push(D)
        }
      }
    }
    this.timedHandlers = C;
    clearTimeout(this._idleTimeout);
    this._idleTimeout = setTimeout(this._onIdle.bind(this), 100)
  }
};
if (window.MozWebSocket) {
  WebSocket = MozWebSocket
}
Strophe.makeConnection = function (G, D, C, E, B, F) {
  if (F) {
    var A = F.indexOf('ws') == 0 ? new Strophe.WebSocket(D)  : new Strophe.Connection(G);
    A.thaw(F, function (H) {
      if (H == Strophe.Status.CONNECTED || H == Strophe.Status.ATTACHED) {
        A.connect_callback = B.bind(null, A);
        B(A, H)
      } else {
        if (H == Strophe.Status.ERROR || H == Strophe.Status.CONNFAIL || H == Strophe.Status.AUTHFAIL || H == Strophe.Status.DISCONNECTED) {
          if (C) {
            Strophe.makeConnection(G, D, C, E, B)
          } else {
            B(A, Strophe.Status.CONNFAIL)
          }
        }
      }
    });
    return
  }
  var A = new Strophe.WebSocket(D);
  A.connect(C, E, function (H) {
    if (H == Strophe.Status.ERROR || H == Strophe.Status.CONNFAIL || H == Strophe.Status.AUTHFAIL || H == Strophe.Status.DISCONNECTED) {
      A = new Strophe.Connection(G);
      A.connect(C, E, B.bind(null, A))
    } else {
      if (H == Strophe.Status.CONNECTED) {
        A.connect_callback = B.bind(null, A);
        B(A, H)
      }
    }
  })
};
var XMPPUser = new Class((function () {
  return {
    Implements: [
      Events
    ],
    jid: null,
    roomJid: null,
    initialize: function (A) {
      this.jid = A
    },
    destroy: function () {
      this.jid = this.roomJid = null
    },
    getNick: function () {
      return Strophe.getResourceFromJid(this.jid)
    }
  }
}) ());
var XMPPMessage = new Class((function () {
  return {
    type: null,
    body: null,
    subject: null,
    fromJid: null,
    errorCode: 0,
    initialize: function () {
    },
    destroy: function () {
      this.type = this.body = this.fromJid = this.errorCode = null
    }
  }
}) ());
XMPPMessage.FromMessageNode = function (B) {
  var A = B.getAttribute('type');
  switch (A) {
    case 'headline':
      return XMPPMessage.FromHeadlineMessageNode(B);
    case 'error':
      return XMPPMessage.FromErrorMessageNode(B);
    default:
  }
  return XMPPMessage.FromDefaultMessageNode(B)
};
XMPPMessage.FromDefaultMessageNode = function (A) {
  var B = new XMPPMessage();
  B.fromJid = A.getAttribute('from');
  B.type = A.getAttribute('type');
  B.body = A.childNodes[0].textContent || A.text;
  return B
};
XMPPMessage.FromHeadlineMessageNode = function (B) {
  var A = new XMPPMessage();
  B.childNodes.forEach(function (D, C, E) {
    if ('subject' === D.nodeName) {
      A.subject = D.textContent
    }
  });
  B.childNodes.forEach(function (D, C, E) {
    if ('body' === D.nodeName) {
      A.body = D.textContent
    }
  });
  return A
};
XMPPMessage.FromErrorMessageNode = function (B) {
  var A = new XMPPMessage();
  B.childNodes.forEach(function (G, F, H) {
    if ('error' === G.nodeName) {
      A.body = G.textContent;
      var D = G.attributes;
      for (var E = 0, C = D.len; E < C; E++) {
        if ('code' === D[E].nodeName) {
          A.errorCode = D[E].textContent
        }
      }
      return A
    }
  });
  A.errorCode = - 1;
  return A
};
var XMPPRoom = new Class((function () {
  return {
    Implements: [
      Events
    ],
    jid: null,
    messages: [
    ],
    initialize: function (A) {
      this.jid = A
    },
    addMessage: function (A) {
      this.messages.push(A)
    },
    destroy: function () {
      this.messages = this.jid = null
    }
  }
}) ());
var XMPPController = new Class((function () {
  function C(D) {
    var E = this.getRoomByJid(D);
    if (null === E) {
      return 'chat'
    }
    return 'groupchat'
  }
  function A(E) {
    var G = E.getAttribute('from');
    var D = Strophe.getBareJidFromJid(G);
    var F = E.getAttribute('type');
    Strophe.forEachChild(E, 'x', function (I) {
      var J = I.getAttribute('xmlns');
      if (J && 0 === J.indexOf(Strophe.NS.MUC)) {
        var K = this.getRoomByJid(D);
        if (!K) {
          K = new XMPPRoom(D);
          this.rooms.push(K);
          this.fireEvent('addroom', [
            K.jid
          ])
        }
        var H = new XMPPUser(G);
        H.roomJid = D;
        if ('unavailable' === F) {
          this.fireEvent('removeuser', [
            H
          ])
        } else {
          this.fireEvent('adduser', [
            H
          ])
        }
      }
    }.bind(this));
    return true
  }
  function B(D) {
    var E = XMPPMessage.FromMessageNode(D);
    var F = this.getRoomByJid(Strophe.getBareJidFromJid(D.getAttribute('from')));
    if (null != F) {
      F.addMessage(E)
    }
    switch (E.type) {
      case 'headline':
        this.fireEvent('addheadline', [
          E
        ]);
      case 'error':
        this.fireEvent('adderror', [
          E
        ]);
      default:
        this.fireEvent('addmessage', [
          E
        ])
    }
    return true
  }
  return {
    Implements: [
      Events,
      Options
    ],
    engine: null,
    rooms: [
    ],
    initialize: function (D) {
      this.setOptions(D);
      this.engine = new XMPPEngine(D);
      return Q.resolve(this)
    },
    getRooms: function () {
      return this.rooms.slice(0)
    },
    getRoomByJid: function (F) {
      for (var E = 0, D = this.rooms.length; E < D; E++) {
        if (this.rooms[E].jid === F) {
          return this.rooms[E]
        }
      }
      return this.rooms[E]
    },
    connectWithJid: function (E, D) {
      return this.engine.connect(E, D).then(function (F) {
        this.engine.connection.addHandler(A.bind(this), null, 'presence');
        this.engine.connection.addHandler(B.bind(this), null, 'message');
        return F
      }.bind(this))
    },
    joinMUC: function (D) {
      this.engine.sendPresence(D, Strophe.NS.MUC)
    },
    leaveMUC: function (D) {
      var E = this.getRoomByJid(D);
      if (!E) {
        return
      }
      this.rooms.splice(this.rooms.indexOf(E), 1);
      this.engine.sendPresence(D, Strophe.NS.MUC, 'unavailable');
      E.destroy();
      this.fireEvent('removeroom', [
        E.jid
      ])
    },
    disconnect: function () {
      this.rooms.forEach(function (E, D, F) {
        this.leaveMUC(E.jid)
      })
    },
    sendMessageToRoom: function (E, D) {
      this.engine.sendMessage(E.jid, D, 'groupchat')
    },
    sendWhisper: function (E, D) {
      this.engine.sendMessage(E, D)
    }
  }
}) ()); var XMPPEngine = new Class((function () {
  function A(C, D) {
    for (var B in D) {
      C = C.replace(new RegExp('{' + B + '}', 'g'), D[B])
    }
    return C
  }
  return {
    Implements: [
      Options,
      Events
    ],
    options: {
      url: 'kxl-chat1.dev.kixeye.com',
      domain: 'kxl-chat.dev.kixeye.com',
      urls: {
        bosh: 'http://{url}:5280/http-bind',
        ws: 'ws://{url}:5280/xmpp'
      },
      fullJidTemplate: '{kxid}@{domain}/{kxid}{rand}',
      debug: true
    },
    connection: null,
    connectionPromise: null,
    myJid: null,
    initialize: function (B) {
      this.setOptions(B)
    },
    connect: function (B, D) {
      if (this.connectionPromise) {
        return this.connectionPromise
      }
      var C = Q.defer();
      var F = A(this.options.fullJidTemplate, {
        kxid: B,
        domain: this.options.domain,
        rand: String(Math.random()).split('.') [1]
      });
      var H = A(this.options.urls.bosh, {
        url: this.options.url
      });
      var G = A(this.options.urls.ws, {
        url: this.options.url
      });
      window.KXP.log('init', 'Initializing chat connection to ' + this.options.url);
      Strophe.makeConnection(H, G, F, D, E.bind(this));
      function E(J, I) {
        if (Strophe.Status.CONNFAIL === I) {
          window.KXP.log('debug', 'Chat could not connect!');
          C.reject(new Error('Could not connect.'))
        } else {
          if (Strophe.Status.DISCONNECTED === I) {
            window.KXP.log('debug', 'Chat was disconnected!');
            C.reject(new Error('Disconnected.'))
          } else {
            if (Strophe.Status.REBINDFAILED === I) {
              window.KXP.log('debug', 'Chat rebind failed!');
              C.reject(new Error('Rebind failed.'))
            } else {
              if (Strophe.Status.CONNECTED === I || Strophe.Status.ATTACHED == I) {
                this.connection = J;
                this.myJid = F;
                window.KXP.log('debug', 'Chat connection successful!');
                this.connection.send($pres().c('x', {
                }));
                C.resolve(F)
              }
            }
          }
        }
      }
      return C.promise
    },
    disconnect: function () {
      this.connection.disconnect()
    },
    sendPresence: function (D, F, E) {
      var B = {
        to: D
      };
      if (E) {
        B.type = E
      }
      var C = $pres().attrs(B);
      if (F) {
        C.c('x', {
          xmlns: F
        })
      }
      this.connection.send(C)
    },
    sendMessage: function (B, D, C) {
      this.connection.send($msg({
        to: B,
        type: C
      }).c('body').t(D))
    }
  }
}) ());

//# sourceMappingURL=main.body.min.js.map
